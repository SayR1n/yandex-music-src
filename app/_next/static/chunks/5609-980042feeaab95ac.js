(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5609],{4115:e=>{e.exports={root:"PostAlbums_root__u2a1q",content:"PostAlbums_content__uMSez"}},5663:(e,t,a)=>{"use strict";a.d(t,{P:()=>i});let i=e=>{if("number"==typeof e&&!Number.isNaN(e))return e;if("string"==typeof e){let t=Number.parseInt(e,10);if(!Number.isNaN(t))return t}}},7091:(e,t,a)=>{"use strict";a.r(t),a.d(t,{SavedOfferInitializer:()=>l});var i=a(97531),r=a(66268),s=a(94767);let l=(0,i.PA)(()=>{let{paymentWidgetModal:{modal:e,setTarget:t,setTariffOfferName:a,setServiceSessionId:i,setIsSilent:l,setOffersBatchId:n,setOffersPositionIds:o},user:d}=(0,s.Pjs)(),{hasFreeUserAccess:u}=(0,s.XCI)(),c=(0,s.NFA)(),g=(0,r.useMemo)(()=>c.get(s.vHc),[c]);(0,r.useLayoutEffect)(()=>{if(!d.isAuthorized||!u||null===g)return;let r=g.get(s.cYZ.Offer);if(null===r)return;let{target:c,serviceSessionId:m,tariffOfferName:h,isSilent:y,offersBatchId:p,offersPositionIds:v}=r;g.remove(s.cYZ.Offer),t(c),l(y),i(m),n(p),o(v),h&&a(h),e.open()},[u,g,e,a,t,i,l,n,o,d.isAuthorized])})},8038:e=>{e.exports={root:"FeedConcerts_root__W7OGN",header:"FeedConcerts_header__Ht1xd",container:"FeedConcerts_container__CONvW",column:"FeedConcerts_column__FpMgx",row:"FeedConcerts_row__HEdtn"}},8957:(e,t,a)=>{"use strict";a.r(t),a.d(t,{SettingsInitializer:()=>n});var i=a(97531),r=a(66268),s=a(49444),l=a(94767);let n=(0,i.PA)(e=>{let{browserInfo:t}=e,a=(0,s.j)(),{settings:i}=(0,l.Pjs)(),n=(0,l.uoh)();i.setBrowserInfo(t),n&&i.setPlatform(n),(0,r.useLayoutEffect)(()=>{i.initializeLiteVersionMode()},[]),(0,r.useEffect)(()=>{i.liteVersionMode&&a.count(i.liteVersionMode,"liteVersionMode")},[a,i.liteVersionMode])})},9332:(e,t,a)=>{"use strict";a.r(t),a.d(t,{LayoutProvider:()=>v,setClientSideLayout:()=>p});var i=a(33008),r=a(13201),s=a(97531),l=a(66268),n=a(73827),o=a(44612);let d={Chrome:105,ChromeMobile:105,Edge:105,Firefox:104,MobileFirefox:104,Opera:90,OperaMobile:80,Safari:16,MobileSafari:16,UCBrowser:15,MSIE:12,YandexBrowser:23};var u=a(85896),c=a(53799),g=a(59938),m=a.n(g);let h=e=>{let{message:t,closeToast:a}=e;return(0,i.jsx)(c.$W,{className:(0,u.$)(m().root,m().important),message:t,closeToast:a})};var y=a(94767);let p=e=>{{document.body.classList.remove("desktop"),e.setLayout((0,y.Svc)(window.innerWidth)),e.setIsLandscape(window.matchMedia("(orientation: landscape)").matches);let t=window.screen.availHeight||window.innerHeight;e.setIsMobileLandscapeHeight(t<450)}},v=(0,s.PA)(e=>{let{children:t}=e,{formatMessage:a}=(0,n.A)(),{notify:s}=(0,y.lkh)(),{settings:u}=(0,y.Pjs)(),[c,g]=(0,o.d)(),[m,v]=(0,o.d)(),[S,E]=(0,o.d)(),[P,b]=(0,o.d)(),[f,I]=(0,o.d)(),[k,_]=(0,o.d)(),[T,C]=(0,o.d)(),[A,D]=(0,o.d)(),[N,L]=(0,o.d)();u.layout;let x=(0,l.useMemo)(()=>(0,r.A)(()=>{p(u)},100),[u]);(0,l.useEffect)(()=>{(function(e){if(!(null==e?void 0:e.isBrowser)||!e.name||!e.version)return!1;let t=d[e.name];if(!t)return!1;let a=parseFloat(e.version);return!Number.isNaN(a)&&a<t})(u.browserInfo)&&s((0,i.jsx)(h,{message:a({id:"warning-messages.update-your-browser"})}),{containerId:y.uQT.IMPORTANT,single:!0})},[a,s,u.browserInfo]),(0,l.useLayoutEffect)(()=>{p(u)},[u]),(0,l.useEffect)(()=>(window.addEventListener("resize",x),()=>{window.removeEventListener("resize",x)}),[x]);let R=(0,l.useMemo)(()=>({defaultLayoutRef:c,contentRef:m,contentRootRef:S,contentScrollRef:P,sideBannerRef:k,playlistStickyFiltersRef:T,playlistStaticFiltersRef:A,compositePlayerBarRef:f,paywallRef:N,setContentRef:v,setDefaultLayoutRef:g,setContentRootRef:E,setContentScrollRef:b,setSideBannerRef:_,setPlaylistStickyFiltersRef:C,setPlaylistStaticFiltersRef:D,setCompositePlayerBarRef:I,setPaywallRef:L}),[c,m,S,P,k,T,A,f,N,g,v,E,b,_,C,D,I,L]);return(0,i.jsx)(y.MQO.Provider,{value:R,children:t})})},9644:(e,t,a)=>{"use strict";a.r(t),a.d(t,{SonataProvider:()=>aQ});var i,r,s,l,n,o,d,u,c,g,m,h,y,p,v,S,E,P,b,f,I,k,_,T=a(33008),C=a(97531),A=a(66268),D=a(30293),N=a(86211),L=a(25581),x=a(6247),R=a(75305),w=a(88063),G=a(44580);!function(e){e.PLAYING="playing",e.NOT_PLAYING="not-playing"}(i||(i={}));let K=e=>!!("object"==typeof e&&e&&"streamProgress"in e&&"object"==typeof e.streamProgress&&e.streamProgress&&"endPositionSec"in e.streamProgress&&"number"==typeof e.streamProgress.endPositionSec);class O{set playId(e){this.entityPlayId=e}get playId(){return this.entityPlayId}set addTracksToPlayerTime(e){this.entityAddTracksToPlayerTime=e}get addTracksToPlayerTime(){return this.entityAddTracksToPlayerTime}get totalPlayedSeconds(){return function(e){let t,a,r=0,s=[];if(0!==e.length){for(let r of function(e){let t=[];for(;0!==e.length;){let a=e.shift();if(a&&a.stage===i.PLAYING){let e=t[t.length-1];e&&e.stage!==i.NOT_PLAYING||t.push(a)}else if(a&&a.stage===i.NOT_PLAYING){let e=t[t.length-1];e&&e.stage===i.PLAYING&&t.push(a)}}let a=t[t.length-1];return a&&a.stage===i.PLAYING&&t.push({stage:i.NOT_PLAYING,perfNow:performance.now(),ts:Date.now()}),t}(e))r.stage===i.PLAYING?t=r.perfNow:a=r.perfNow,t&&a&&(s.push(a-t),t=void 0,a=void 0);for(let e of s)r+=e;return Math.round((r/1e3+Number.EPSILON)*1e3)/1e3}return r}([...this.entityTimeStagesOfPlayback])}get timeStagesOfPlayback(){return this.entityTimeStagesOfPlayback}saveTimeStageOfPlayback(e){let t={stage:e.stage,perfNow:performance.now(),ts:Date.now()};e.reason&&(t.reason=e.reason),this.entityTimeStagesOfPlayback.push(t)}clearTimeStagesOfPlayback(){this.entityTimeStagesOfPlayback=[]}get data(){return this.entityData}get isAvailable(){return!!("available"in this.entityData.meta&&this.entityData.meta.available)}get isDisliked(){return void 0!==this.likeStore&&this.likeStore.isTrackDisliked(this.entityData.meta.id)}get isExplicit(){return"contentWarning"in this.entityData.meta&&this.entityData.meta.contentWarning===w.K.EXPLICIT}get everFinished(){return K(this.entityData.meta)?this.entityData.meta.streamProgress.everFinished:null}set everFinished(e){K(this.entityData.meta)&&null!==e&&(this.entityData.meta.streamProgress.everFinished=e)}hasPlayId(){return""!==this.playId}constructor(e){(0,N._)(this,"entityData",void 0),(0,N._)(this,"likeStore",void 0),(0,N._)(this,"entityPlayId",""),(0,N._)(this,"entityAddTracksToPlayerTime",""),(0,N._)(this,"entityTimeStagesOfPlayback",[]),(0,N._)(this,"mediaElementErrorReloadCounter",0),(0,N._)(this,"mediaSourceData",null),(0,N._)(this,"expectedQuality",null),(0,N._)(this,"startPosition",null),(0,N._)(this,"lastSeekPosition",null),(0,N._)(this,"contentKind","audio"),(0,N._)(this,"contentType",G.e.AUDIO),(0,N._)(this,"hidden",!1),this.entityData=e.data,this.likeStore=e.likeStore}}class M extends O{}class X extends O{constructor(...e){super(...e),(0,N._)(this,"contentType",G.e.DOWNLOADED_AUDIO)}}class F extends O{}class j extends O{get isAvailable(){return!1}get isDisliked(){return!1}}var U=a(38230);class V extends U.t{constructor(e,{code:t="E_ENTITY_FACTORY",...a}={}){super(e,{code:t,...a}),(0,N._)(this,"name","EntityFactoryException"),Object.setPrototypeOf(this,V.prototype)}}class B extends O{get isAvailable(){return!0}get isDisliked(){return!1}constructor(...e){super(...e),(0,N._)(this,"contentType",G.e.HLS)}}class q extends O{get isAvailable(){return!0}get isDisliked(){return!1}}class Y extends O{get isAvailable(){return!0}get isDisliked(){return!1}constructor(...e){super(...e),(0,N._)(this,"contentType",G.e.CLIP),(0,N._)(this,"contentKind","video")}}class W extends O{get isAvailable(){return!0}get isDisliked(){return!1}constructor(...e){super(...e),(0,N._)(this,"contentType",G.e.HLS)}}class z{create(e){let t=null,{data:a}=e;void 0===a.fromCurrentContext&&(a.fromCurrentContext=!0);try{switch(a.type){case R.R.Music:t=new M({data:a,likeStore:this.likeStore});break;case R.R.DownloadedMusic:t=new X({data:a,likeStore:this.likeStore});break;case R.R.VibeTrack:t=new F({data:a,likeStore:this.likeStore});break;case R.R.Generative:t=new B({data:a,likeStore:this.likeStore});break;case R.R.SmartPreview:t=new q({data:a,likeStore:this.likeStore});break;case R.R.Clip:t=new Y({data:a,likeStore:this.likeStore});break;case R.R.Radio:t=new W({data:a,likeStore:this.likeStore});break;case R.R.Unknown:a.meta.type,x.S.MUSIC,t=new M({data:{...a,type:R.R.Music},likeStore:this.likeStore});break;case L.z4.Unloaded:t=new j({data:a,likeStore:this.likeStore})}}catch(e){throw new V("Error while creating entity",{cause:e,data:{type:a.type,meta:a.meta}})}if(null!==t)return t;throw new V("Cannot create entities with nonexistent type",{code:"E_NONEXISTENT_ENTITY_TYPE",data:{type:a.type,meta:a.meta}})}constructor(e){(0,N._)(this,"likeStore",void 0),this.likeStore=e.likeStore}}var H=a(48509);function Q(e,t){let a=[];for(let i of e)for(let e of i)a.push({type:L.z4.Unloaded,meta:e,additional:t});return a}var $=a(30159);class J extends U.t{constructor(e,{code:t="E_CONTEXT",name:a,...i}={}){super(e,{code:t,...i}),(0,N._)(this,"name",void 0),this.name=null!=a?a:"ContextException",Object.setPrototypeOf(this,J.prototype)}}class Z extends L.EX{get isCurrentContext(){return this.isCurrent}set isCurrentContext(e){this.isCurrent=e}get availableActions(){return this.actions}logError(e){let t,{name:a,message:i="Error in YaMusicContext",data:r,cause:s,originalError:l}=e;t=l instanceof U.t?l:new J(i,{name:a,cause:(0,D.createObjectFromError)(s),data:r}),this.logger.error(t,{...t.data,code:t.code,cause:t.cause,stack:t.stack,message:t.message})}constructor({logger:e}){super(),(0,N._)(this,"isCurrent",!1),(0,N._)(this,"actions",{moveBackward:new $.cJ(!1),moveForward:new $.cJ(!0),repeat:new $.cJ(null),shuffle:new $.cJ(null),speed:new $.cJ(null)}),(0,N._)(this,"from",""),(0,N._)(this,"utmLink",void 0),(0,N._)(this,"logger",void 0),this.logger=e}}function ee(e,t){return e.map(e=>({type:R.R.SmartPreview,meta:e,additional:t}))}class et extends Z{loadTrailer(){return this.albumsResource.getTrailer({albumId:Number(this.contextData.meta.id)}).then(e=>(this.contextData.meta.trailerTracks=e.trailer.tracks,e)).catch(e=>{throw new J("Error in AlbumContext",{code:"E_ALBUM_LOAD_TRAILER",cause:(0,D.createObjectFromError)(e),data:{contextId:this.contextData.meta.id}})})}apply(e){}loadContextMeta(){return this.albumsResource.getAlbumWithRichTracks({albumId:Number(this.contextData.meta.id),resumeStream:!0}).then(e=>(this.contextData.meta=e,e)).catch(e=>{throw new J("Error in AlbumContext",{code:"E_ALBUM_LOAD_CONTEXT_META",cause:(0,D.createObjectFromError)(e),data:{contextId:this.contextData.meta.id}})})}getContextEntitiesData(){let e={from:this.from,utmLink:this.utmLink};return this.contextData.trailer?this.loadTrailer().then(t=>ee(t.trailer.tracks,e)):this.contextData.meta.volumes?Promise.resolve(Q(this.contextData.meta.volumes,e)):this.loadContextMeta().then(t=>Promise.resolve(Q(t.volumes,e)))}get type(){return this.contextData.type}get data(){return this.contextData}get resumeFromIndex(){var e;if((null==(e=this.contextData.meta.resumeFrom)?void 0:e.trackId)&&Array.isArray(this.contextData.meta.volumes)){let e=[].concat(...this.contextData.meta.volumes).findIndex(e=>{var t;return String(e.id)===String(null==(t=this.contextData.meta.resumeFrom)?void 0:t.trackId)});if(e>=0)return e}return null}constructor(e){super(e),(0,N._)(this,"contextData",void 0),(0,N._)(this,"albumsResource",void 0),(0,N._)(this,"variables",void 0);let{data:t,albumsResource:a,variables:i}=e;this.albumsResource=a,this.contextData=t,this.from=t.from,this.utmLink=t.utmLink,this.variables=i}}var ea=a(66788);class ei extends Z{loadTrailer(){let{uid:e,kind:t}=(0,ea.I)(this.contextData.meta.id);return this.usersResource.getPlaylistTrailer({userId:e,playlistKind:t}).then(e=>(this.contextData.meta.trailerTracks=e.trailer.tracks,e)).catch(e=>{throw new J("Error in PlaylistContext",{code:"E_PLAYLIST_LOAD_TRAILER",cause:(0,D.createObjectFromError)(e),data:{contextId:this.contextData.meta.id}})})}apply(e){}loadContextMeta(){let e=this.contextData.meta.uuid,{uid:t,kind:a}=(0,ea.I)(this.contextData.meta.id),i=3===a;return(i&&void 0!==e?this.playlistResource.getPlaylist({playlistUuid:e,resumeStream:!1,richTracks:!1}):this.usersResource.getPlaylistWithTracksIds({userId:t,playlistKind:a,resumeStream:!1,trackMetaType:i?"music":void 0})).then(e=>{let t,a,i={...e,id:(t=e.uid,a=e.kind,"".concat(t,":").concat(a))};return this.contextData.meta=i,i}).catch(e=>{throw new J("Error in PlaylistContext",{code:"E_PLAYLIST_LOAD_CONTEXT_META",cause:(0,D.createObjectFromError)(e),data:{contextId:this.contextData.meta.id}})})}getContextEntitiesData(){let e={from:this.from,utmLink:this.utmLink};if(this.contextData.trailer)return this.loadTrailer().then(t=>ee(t.trailer.tracks,e));if(this.contextData.meta.tracks){let t=[];for(let a of this.contextData.meta.tracks)t.push({type:L.z4.Unloaded,meta:a,additional:e});return Promise.resolve(t)}return this.loadContextMeta().then(t=>{let a=[];for(let i of t.tracks)a.push({type:L.z4.Unloaded,meta:i,additional:e});return a})}get type(){return this.contextData.type}get data(){return this.contextData}constructor(e){super(e),(0,N._)(this,"contextData",void 0),(0,N._)(this,"usersResource",void 0),(0,N._)(this,"playlistResource",void 0),(0,N._)(this,"variables",void 0);let{data:t,playlistResource:a,usersResource:i,variables:r}=e;this.usersResource=i,this.playlistResource=a,this.contextData=t,this.from=t.from,this.utmLink=t.utmLink,this.variables=r}}class er extends Z{loadTrailer(){return this.artistsResource.getTrailer({artistId:String(this.contextData.meta.id)}).then(e=>(this.contextData.meta.trailerTracks=e.trailer.tracks,e)).catch(e=>{throw new J("Error in ArtistContext",{code:"E_ARTIST_LOAD_TRAILER",cause:(0,D.createObjectFromError)(e),data:{contextId:this.contextData.meta.id}})})}apply(e){}loadContextMeta(){return this.artistsResource.getBriefInfo({artistId:String(this.contextData.meta.id),discographyBlockEnabled:!1,fetchPlaylistLikesCounts:!1}).then(e=>{this.contextData.meta.artist=e.artist}).catch(e=>{throw new J("Error in ArtistContext",{code:"E_ARTIST_LOAD_CONTEXT_META",cause:(0,D.createObjectFromError)(e),data:{contextId:this.contextData.meta.id}})}),this.artistsResource.getArtistTrackIds({artistId:String(this.contextData.meta.id)}).then(e=>(this.contextData.meta.trackIds=e,this.contextData.meta)).catch(e=>{throw new J("Error in ArtistContext",{code:"E_ARTIST_LOAD_CONTEXT_META",cause:(0,D.createObjectFromError)(e),data:{contextId:this.contextData.meta.id}})})}getContextEntitiesData(){let e={from:this.from,utmLink:this.utmLink};if(this.contextData.trailer)return this.loadTrailer().then(t=>ee(t.trailer.tracks,e));if(this.contextData.meta.trackIds){let t=[];for(let a of this.contextData.meta.trackIds)t.push({type:L.z4.Unloaded,meta:{id:a},additional:e});return Promise.resolve(t)}return this.loadContextMeta().then(t=>{let a=[];if(t.trackIds)for(let i of t.trackIds)a.push({type:L.z4.Unloaded,meta:{id:i},additional:e});return a})}get type(){return this.contextData.type}get data(){return this.contextData}constructor(e){super(e),(0,N._)(this,"contextData",void 0),(0,N._)(this,"artistsResource",void 0),(0,N._)(this,"variables",void 0);let{data:t,artistsResource:a,variables:i}=e;this.artistsResource=a,this.contextData=t,this.from=t.from,this.utmLink=t.utmLink,this.variables=i}}var es=a(68565);function el(e,t){let a=[],{batchId:i,sequence:r}=e;for(let e of r)a.push({type:R.R.VibeTrack,additional:t,batchId:i,meta:{...e.track,liked:e.liked,trackParameters:e.trackParameters},fromCurrentContext:!0,wasPlayed:!1});return a}function en(e){var t;let a;if(!(a=e.data.type===L.z4.Unloaded?e.data.meta.id:"realId"in e.data.meta?e.data.meta.realId:e.data.meta.id))throw new J("Error in VibeContext",{code:"E_WRONG_VIBE_CONTEXT"});let i="albums"in e.data.meta?e.data.meta.albums:[];return i&&(null==(t=i[0])?void 0:t.id)?"".concat(a,":").concat(i[0].id):String(a)}function eo(e){return(null==e?void 0:e.data.type)===R.R.VibeTrack}function ed(e,t){let a=[],i=!1;for(let r=0;r<e.length;r++){let s=e[r];if(s&&eo(s.entity)){let{entity:e}=s;if(e.data.wasPlayed||t===r)a.push(s);else if(!i){a.push(s),i=!0;break}}}return a}function eu(e,t){return ed(e,t).map(e=>{let{entity:t}=e;return en(t)})}var ec=a(73273);function eg(){return new Date().toISOString()}function em(e){let t,{entity:a,type:i,from:r}=e,s="user-queue-".concat(a.data.meta.id,"-").concat(Date.now());switch(eo(a)&&a.data.batchId&&(s=a.data.batchId),i){case es.O.RADIO_STARTED:return{event:{type:i,timestamp:eg(),from:r},from:r};case es.O.TRACK_STARTED:case es.O.LIKE:case es.O.UNLIKE:case es.O.UNDISLIKE:return{batchId:s,event:{type:i,timestamp:eg(),trackId:en(a)},from:r};case es.O.TRACK_FINISHED:if(eo(a)&&a.data.meta.durationMs){let e=a.data.meta.durationMs/1e3;t=e%1==0?e:Number(e.toFixed(3))}return{batchId:s,event:{type:i,timestamp:eg(),trackId:en(a),totalPlayedSeconds:a.totalPlayedSeconds,trackLengthSeconds:t},from:r};case es.O.SKIP:case es.O.DISLIKE:return{batchId:s,event:{type:i,timestamp:eg(),trackId:en(a),totalPlayedSeconds:a.totalPlayedSeconds},from:r}}return null}function eh(e,t){return e.some(e=>(function(e,t){if(e===t)return!0;let a=[es.O.SKIP,es.O.TRACK_FINISHED];return a.includes(e)&&a.includes(t)})(t.event.type,e.event.type)&&"trackId"in t.event&&"trackId"in e.event&&t.event.trackId===e.event.trackId)}class ey{storeFeedbacksForWasPlayedTracks(e,t){var a;if(null==(a=this.variables)?void 0:a.dontSendDuplicatedFeedbacks){for(let a of e)if(eo(a.entity)&&a.entity.data.wasPlayed){let e=em({entity:a.entity,type:es.O.TRACK_STARTED,from:t}),i=em({entity:a.entity,type:es.O.TRACK_FINISHED,from:t});e&&i&&this.storeFeedbacksInHistory([e,i])}}}storeFeedbacksInHistory(e){var t;if(e&&(null==(t=this.variables)?void 0:t.dontSendDuplicatedFeedbacks))for(let t of e)this.feedbacksHistory.push(t)}clearStoredFeedbacks(){this.feedbacksHistory=[],this.feedbacksForSending=[]}storeFeedbacksForSending(e){var t;if(e&&(null==(t=this.variables)?void 0:t.sendFeedbackToSessionTracks)){let t=Array.isArray(e)?e:[e];this.feedbacksForSending.push(...t)}}getFeedbacksForSending(){var e;if(!(null==(e=this.variables)?void 0:e.sendFeedbackToSessionTracks))return null;let t=this.feedbacksForSending;return this.feedbacksForSending=[],t}sendFeedbackRequest(e){let{feedback:t,session:a}=e,{radioSessionId:i}=a;return this.rotorResource.sessionFeedback({radioSessionId:i,feedback:t}).then(()=>Promise.resolve())}sendFeedback(e){var t,a;let{entity:i,type:r,from:s,session:l,sendWithSessionTracks:n=!1,saveFeedbackToHistory:o=!1}=e,d=em({entity:i,type:r,from:s});return d?(eh(this.feedbacksHistory,d)||eh(this.feedbacksForSending,d))&&(null==(t=this.variables)?void 0:t.dontSendDuplicatedFeedbacks)?Promise.resolve():n&&(null==(a=this.variables)?void 0:a.sendFeedbackToSessionTracks)?(this.storeFeedbacksForSending(d),Promise.resolve()):this.sendFeedbackRequest({feedback:d,session:l}).then(()=>{var e;return o&&(null==(e=this.variables)?void 0:e.dontSendDuplicatedFeedbacks)&&this.storeFeedbacksInHistory([d]),Promise.resolve()}):Promise.reject(new U.t("Cannot create feedback",{data:{type:r}}))}constructor({rotorResource:e,variables:t}){(0,N._)(this,"rotorResource",void 0),(0,N._)(this,"feedbacksForSending",[]),(0,N._)(this,"feedbacksHistory",[]),(0,N._)(this,"variables",void 0),this.rotorResource=e,this.variables=t}}class ep extends Z{apply(e){let{hooks:t,playback:a}=e;t.beforeContextSet.tap("VibeContext",()=>{if(!this.isCurrentContext)return;let e=a.state.queueState.currentEntity.value;e&&(this.sendFeedback({entity:e.entity,type:es.O.SKIP}),this.feedbacksController.clearStoredFeedbacks())}),t.afterSetupQueue.tap("VibeContext",()=>{var e;if(!this.isCurrentContext)return;let{value:t}=a.state.queueState.entityList;if(this.feedbacksController.storeFeedbacksForWasPlayedTracks(t.slice(0,-1),this.from),this.contextData.cloneSessionId&&this.contextData.meta.session&&(null==(e=this.variables)?void 0:e.enableGetNextTracksAfterCloneVibeContext)){let e=el(this.contextData.meta.session,{from:this.from,utmLink:this.utmLink});a.injectLast(e)}}),t.afterMediaStartPlaying.tapPromise("VibeContext",()=>this.isCurrentContext?new Promise(e=>{let t=a.state.queueState.currentEntity.value;if(!t)return void e();let{entity:i}=t;this.isVibeStarted?this.sendFeedback({type:es.O.TRACK_STARTED,entity:i,saveFeedbackToHistory:!0}):(this.sendFeedback({type:es.O.RADIO_STARTED,entity:i}).then(()=>{this.sendFeedback({type:es.O.TRACK_STARTED,entity:i,saveFeedbackToHistory:!0})}),this.isVibeStarted=!0),e()}):Promise.resolve()),t.beforeFindPlayableEntityIndex.tapPromise("VibeContext",e=>this.isCurrentContext?new Promise((t,i)=>{switch(e){case L.So.AUTO_MOVE_FORWARD:this.onAutoMoveForward(a).then(t).catch(i);break;case L.So.MOVE_FORWARD:this.onMoveForward(a).then(t).catch(i);break;case L.So.MOVE_BACKWARD:this.onMoveBackward(a).then(t).catch(i);break;default:t()}}):Promise.resolve()),t.beforeEntityChange.tapPromise("VibeContext",e=>this.isCurrentContext&&e.method===L.So.SET_INDEX?this.onSetIndex(a,e.index):Promise.resolve()),t.beforeEntityPlayingProcessStart.tapPromise("VibeContext",()=>{if(!this.isCurrentContext)return Promise.resolve();let{currentEntity:e}=a.state.queueState;return e.value&&eo(e.value.entity)&&(e.value.entity.data.wasPlayed=!0),Promise.resolve()})}get interactive(){var e;return(null==(e=this.variables)?void 0:e.sendInteractiveToSession)&&void 0!==this.contextData.interactive?{interactive:this.contextData.interactive}:{}}loadContextMeta(){this.timeOfLastInteractionWithVibe=performance.now();let{meta:{id:e},seeds:t,cloneSessionId:a,queue:i,trackToStartFrom:r,includeTracksInResponse:s,allowExplicit:l}=this.contextData;return(a?this.rotorResource.sessionClone({seeds:t,includeWaveModel:!0,radioSessionId:a,trackToStartFrom:r,queue:i,allowExplicit:l,includeTracksInResponse:s,...this.interactive}).catch(e=>{throw this.createException("Error in clone vibe session",e)}):this.rotorResource.sessionNew({seeds:t,includeWaveModel:!0,trackToStartFrom:r,queue:i,allowExplicit:l,includeTracksInResponse:s,...this.interactive}).catch(e=>{throw this.createException("Error in create new vibe session",e)})).then(t=>(this.contextData.meta.session=t,this.contextData.trackToStartFrom=void 0,{id:e,session:t}))}setSettings(e){let{seeds:t,queueState:a,allowExplicit:i,interactive:r}=e;this.contextData.interactive=r;let s=eu(a.entityList.value,a.index.value),l=a.currentEntity.value,n=null!=i?i:a.filterParams.value.allowExplicit,o=Promise.resolve();l&&eo(l.entity)&&(o=this.sendFeedback({entity:l.entity,type:es.O.SKIP}));let{trackToStartFrom:d,includeTracksInResponse:u}=this.contextData;return o.then(()=>this.rotorResource.sessionNew({includeTracksInResponse:u,trackToStartFrom:d,seeds:t,queue:s,allowExplicit:n,includeWaveModel:!0,...this.interactive}).then(e=>{this.contextData.meta.session=e,this.contextData.meta.id=(0,ec.f)(e.wave.seeds),this.contextData.meta.allowExplicit=n,this.feedbacksController.clearStoredFeedbacks()}).catch(e=>{this.logVibeError({message:"Error while setting new vibe settings",cause:e})}))}getContextEntitiesData(){let{meta:{session:e}}=this.contextData,t={from:this.from,utmLink:this.utmLink};return e?Promise.resolve(el(e,t)):this.loadContextMeta().then(e=>{let{session:a}=e;return el(a,t)})}get type(){return this.contextData.type}get data(){return this.contextData}logVibeError(e){var t,a;let{message:i,cause:r,originalError:s}=e;this.logError({name:"VibeContextException",message:i,cause:r,data:{contextId:this.contextData.meta.id,sessionId:null!=(a=null==(t=this.contextData.meta.session)?void 0:t.radioSessionId)?a:""},originalError:s})}createException(e,t){var a,i;return new J(e,{name:"VibeContextException",cause:(0,D.createObjectFromError)(t),data:{contextId:this.contextData.meta.id,sessionId:null!=(i=null==(a=this.contextData.meta.session)?void 0:a.radioSessionId)?i:""}})}onAutoMoveForward(e){var t,a;if((null==(t=this.variables)?void 0:t.disableFastVibeSkip)&&this.sessionTracksPromise)return Promise.resolve();let i=this.onQueueNavigationCommon(e);return this.sendFeedback({type:es.O.TRACK_FINISHED,entity:null==(a=e.state.queueState.currentEntity.value)?void 0:a.entity,sendWithSessionTracks:!0,saveFeedbackToHistory:!0}).then(()=>{let{index:t,entityList:a}=e.state.queueState,r=t.value===a.value.length-2,s=t.value===a.value.length-1;if(!r&&!s)return Promise.resolve();let l=this.getNextSessionTracks(i).then(t=>{e.injectLast(t),this.availableActions.moveForward.value=!0});return s?l:(r&&l.catch(e=>this.logVibeError({originalError:e})),Promise.resolve())})}onMoveForward(e){var t,a;if((null==(t=this.variables)?void 0:t.disableFastVibeSkip)&&this.sessionTracksPromise)return Promise.resolve();let i=this.onQueueNavigationCommon(e);return this.sendFeedback({type:es.O.SKIP,entity:null==(a=e.state.queueState.currentEntity.value)?void 0:a.entity,sendWithSessionTracks:!0,saveFeedbackToHistory:!0}).then(()=>{var t;let{index:a,entityList:r}=e.state.queueState,s=a.value===r.value.length-1;if(null==(t=this.variables)?void 0:t.enableUpdatedForwardSkipInVibeContext){let t=e.getEntityByIndex({index:a.value+1}),i=a.value+1===r.value.length-1;if(t&&eo(t.entity)&&t.entity.data.wasPlayed&&!i)return Promise.resolve()}this.removeVibeTracksBeforeMoveForward(e);let l=this.getNextSessionTracks(i).then(t=>e.injectLast(t));return s?l:(l.catch(e=>this.logVibeError({originalError:e})),Promise.resolve())})}onMoveBackward(e){this.removeNotPlayedVibeTracksByTtl(e),this.timeOfLastInteractionWithVibe=performance.now();let t=e.state.queueState.currentEntity.value;if(!t)return Promise.resolve();let{entity:a}=t;return this.sendFeedback({entity:a,type:es.O.SKIP,saveFeedbackToHistory:!0}),Promise.resolve()}onSetIndex(e,t){var a,i;if((null==(a=this.variables)?void 0:a.disableFastVibeSkip)&&this.sessionTracksPromise)return Promise.resolve();let r=this.onQueueNavigationCommon(e),s=e.getEntityByIndex({index:t});return s&&eo(s.entity)&&s.entity.data.wasPlayed?Promise.resolve():this.sendFeedback({type:es.O.SKIP,entity:null==(i=e.state.queueState.currentEntity.value)?void 0:i.entity,sendWithSessionTracks:!0,saveFeedbackToHistory:!0}).then(()=>{let{index:t,entityList:a}=e.state.queueState,i=t.value===a.value.length-1;this.removeVibeTracksBeforeMoveForward(e);let s=this.getNextSessionTracks(r).then(t=>e.injectLast(t)).catch(e=>this.logVibeError({originalError:e}));return i?s:Promise.resolve()})}getNextSessionTracks(e){var t;if(!this.contextData.meta.session)return Promise.reject(this.createException("Cannot get next vibe tracks. No session"));let{meta:{session:a},aliceExperiments:i,djData:r,useIchwill:s}=this.contextData,l={from:this.from,utmLink:this.utmLink},n=this.feedbacksController.getFeedbacksForSending();return this.sessionTracksPromise=this.rotorResource.sessionTracks({radioSessionId:a.radioSessionId,queue:e,aliceExperiments:i,djData:r,useIchwill:s,feedbacks:n||void 0}).then(e=>(this.feedbacksController.storeFeedbacksInHistory(n),this.contextData.meta.sessionTracks=e,el(e,l))).catch(e=>(this.feedbacksController.storeFeedbacksForSending(n),Promise.reject(this.createException("Error in next vibe tracks request",e)))).finally(()=>{var e;(null==(e=this.variables)?void 0:e.disableFastVibeSkip)&&(this.sessionTracksPromise=null,this.availableActions.moveForward.value=!0)}),(null==(t=this.variables)?void 0:t.disableFastVibeSkip)&&(this.availableActions.moveForward.value=!1),this.sessionTracksPromise}sendFeedback(e){let{entity:t,type:a,sendWithSessionTracks:i=!1,saveFeedbackToHistory:r=!1}=e;if(!t)return this.logVibeError({message:"Cannot send feedback. No entity"}),Promise.resolve();let{session:s}=this.contextData.meta;return s?this.feedbacksController.sendFeedback({entity:t,type:a,session:s,from:this.contextData.from,sendWithSessionTracks:i,saveFeedbackToHistory:r}).catch(e=>(this.logVibeError({message:"Error while sending feedback",cause:e}),Promise.resolve())):(this.logVibeError({message:"Cannot send feedback. No session"}),Promise.resolve())}removeNotPlayedVibeTracksByTtl(e){var t;let{index:a,entityList:i}=e.state.queueState;if(performance.now()-this.timeOfLastInteractionWithVibe>=18e5&&(null==(t=this.variables)?void 0:t.enableRemovingNotPlayedVibeTracksByTtl)){let t=[];for(let e=a.value+1;e<i.value.length;e++){let a=i.value[e];a&&eo(a.entity)&&!a.entity.data.wasPlayed&&t.push(e)}e.remove(t,!0)}}removeVibeTracksBeforeMoveForward(e){let t=[],{index:a,entityList:i}=e.state.queueState;for(let e=a.value+2;e<i.value.length;e++)t.push(e);e.remove(t,!0)}onQueueNavigationCommon(e){let t=eu(e.state.queueState.entityList.value,e.state.queueState.index.value);return this.removeNotPlayedVibeTracksByTtl(e),this.timeOfLastInteractionWithVibe=performance.now(),t}constructor(e){super(e),(0,N._)(this,"contextData",void 0),(0,N._)(this,"rotorResource",void 0),(0,N._)(this,"isVibeStarted",!1),(0,N._)(this,"timeOfLastInteractionWithVibe",performance.now()),(0,N._)(this,"variables",void 0),(0,N._)(this,"sessionTracksPromise",null),(0,N._)(this,"feedbacksController",void 0);let{data:t,rotorResource:a,variables:i}=e;this.rotorResource=a,this.contextData=t,this.from=t.from,this.utmLink=t.utmLink,this.availableActions.repeat.value=!1,this.availableActions.shuffle.value=!1,this.variables=i,this.feedbacksController=new ey({rotorResource:a,variables:i})}}class ev extends Z{getContextId(){var e,t;let a=null==(t=this.contextData.meta.albums)||null==(e=t[0])?void 0:e.id;return a?"".concat(this.contextData.meta.id,":").concat(a):String(this.contextData.meta.id)}loadTrailer(){return this.tracksResource.getTrailer({trackId:this.getContextId()}).then(e=>(this.contextData.meta=e.track,e)).catch(e=>{throw new J("Error in PlaylistContext",{code:"E_PLAYLIST_LOAD_TRAILER",cause:e,data:{contextId:this.contextData.meta.id}})})}apply(e){}loadContextMeta(){let e=this.getContextId();return this.tracksResource.getTracksMeta({trackIds:[e],withProgress:!0}).then(t=>{let a=t[0];if(a)return this.contextData.meta=a,a;throw new J("Error in VariousContext. Track not found",{code:"E_VARIOUS_LOAD_CONTEXT_META",data:{contextId:e}})}).catch(t=>{throw new J("Error in VariousContext",{code:"E_VARIOUS_LOAD_CONTEXT_META",cause:t,data:{contextId:e}})})}getContextEntitiesData(){let e={from:this.from,utmLink:this.utmLink};return this.contextData.trailer?this.loadTrailer().then(t=>[{meta:t.track,type:R.R.SmartPreview,additional:e}]):this.contextData.meta?Promise.resolve([{meta:this.contextData.meta,type:R.R.Unknown,additional:e}]):this.loadContextMeta().then(t=>[{meta:t,type:R.R.Unknown,additional:e}])}get type(){return this.contextData.type}get data(){return this.contextData}constructor(e){super(e),(0,N._)(this,"contextData",void 0),(0,N._)(this,"tracksResource",void 0),(0,N._)(this,"variables",void 0);let{data:t,tracksResource:a,variables:i}=e;this.tracksResource=a,this.contextData=t,this.from=t.from,this.utmLink=t.utmLink,this.variables=i}}class eS extends U.t{constructor(e,{code:t="E_CONTEXT_FACTORY",...a}={}){super(e,{code:t,...a}),(0,N._)(this,"name","ContextFactoryException"),Object.setPrototypeOf(this,eS.prototype)}}var eE=a(77205);let eP=e=>[{type:R.R.Generative,meta:e}],eb="E_GENERATIVE_RESTART_LIMIT",ef="E_GENERATIVE_RESTART_FAILED";class eI extends Z{apply(e){let{hooks:t,playback:a}=e;a.state.playerState.status.onChange(e=>{this.isCurrentContext&&e&&(e===L.MT.PLAYING?(this.isPaused&&this.sendFeedback(eE.Q.StreamPlay,a),this.isPaused=!1):e===L.MT.PAUSED&&(this.sendFeedback(eE.Q.StreamPause,a),this.isPaused=!0))}),t.afterError.tap("GenerativeContext",e=>{let t=e&&e instanceof J&&e.code===eb,i=e&&e instanceof J&&e.code===ef;!t&&!i&&this.isCurrentContext&&(this.restartsCount>=5||this.restart(a))})}loadContextMeta(){return this.rotorResource.getGenerativeInfo({stationId:String(this.contextData.meta.id)}).then(e=>{let t={id:String(this.contextData.meta.id),stream:e.stream,...e.data};return this.contextData.meta=t,t}).catch(e=>{throw new J("Error GenerativeContext",{code:"E_GENERATIVE_LOAD_CONTEXT_META",cause:(0,D.createObjectFromError)(e),data:{contextId:this.contextData.meta.id}})})}getContextEntitiesData(){var e;return(null==(e=this.contextData.meta.stream)?void 0:e.id)?Promise.resolve(eP(this.contextData.meta)):this.loadContextMeta().then(e=>Promise.resolve(eP(e)))}get type(){return this.contextData.type}get data(){return this.contextData}sendFeedback(e,t){var a;return this.rotorResource.stationFeedback({type:e,stationId:String(this.contextData.meta.id),streamId:String(null==(a=this.contextData.meta.stream)?void 0:a.id),timestamp:eg()}).then(a=>{if(a.reload_stream){let a=e===eE.Q.TimestampDislike;this.restart(t,a)}})}restart(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.restartsCount>=5){let t=new J("Error GenerativeContext",{code:eb,data:{contextId:this.contextData.meta.id}});return e.hooks.afterError.promise(t),Promise.reject(t)}return this.restartsCount++,this.loadContextMeta().then(()=>{let a=t||!this.isPaused;return t&&this.isPaused&&(this.isPaused=!1),e.restartContext({playAfterRestart:a,entitiesData:eP(this.contextData.meta)})}).catch(t=>{let a=new J("Error GenerativeContext restart",{code:ef,cause:(0,D.createObjectFromError)(t),data:{contextId:this.contextData.meta.id,restartsCount:this.restartsCount}});throw e.hooks.afterError.promise(a),a})}constructor(e){super(e),(0,N._)(this,"contextData",void 0),(0,N._)(this,"rotorResource",void 0),(0,N._)(this,"isPaused",!1),(0,N._)(this,"variables",void 0),(0,N._)(this,"restartsCount",0);let{data:t,variables:a,rotorResource:i}=e;this.rotorResource=i,this.contextData=t,this.from=t.from,this.utmLink=t.utmLink,this.availableActions.repeat.value=!1,this.availableActions.shuffle.value=!1,this.availableActions.moveBackward.value=!1,this.availableActions.moveForward.value=!1,this.variables=a}}let ek=e=>[{type:R.R.Radio,meta:e}];class e_ extends Z{apply(e){}loadContextMeta(){return Promise.all([this.radioStationsResource.getStreamBySlug({stationSlug:String(this.contextData.meta.stationSlug),streamSlug:String(this.contextData.meta.streamSlug)}),this.radioStationsResource.getStreamUrlBySlug({stationSlug:String(this.contextData.meta.stationSlug),streamSlug:String(this.contextData.meta.streamSlug)})]).then(e=>{let[t,{url:a}]=e,i={id:this.contextData.meta.id,stationSlug:String(this.contextData.meta.stationSlug),streamSlug:String(this.contextData.meta.streamSlug),stream:t,streamUrl:a};return this.contextData.meta=i,i}).catch(e=>{throw new J("Error RadioContext",{code:"E_RADIO_LOAD_CONTEXT_META",cause:(0,D.createObjectFromError)(e),data:{contextId:this.contextData.meta.id}})})}getContextEntitiesData(){var e,t;return(null==(t=this.contextData.meta)||null==(e=t.stream)?void 0:e.slug)?Promise.resolve(ek(this.contextData.meta)):this.loadContextMeta().then(e=>Promise.resolve(ek(e)))}get type(){return this.contextData.type}get data(){return this.contextData}constructor(e){super(e),(0,N._)(this,"contextData",void 0),(0,N._)(this,"radioStationsResource",void 0),(0,N._)(this,"variables",void 0);let{data:t,variables:a,radioStationsResource:i}=e;this.radioStationsResource=i,this.contextData=t,this.from=t.from,this.utmLink=t.utmLink,this.availableActions.repeat.value=!1,this.availableActions.shuffle.value=!1,this.availableActions.moveBackward.value=!1,this.availableActions.moveForward.value=!1,this.variables=a}}class eT{create(e){let t=null,{data:a}=e;try{var i,r,s,l,n,o,d;switch(a.type){case H.K.Album:if(!this.albumsResource)throw new eS("Albums resource is not provided",{code:"E_ALBUMS_RESOURCE_NOT_PROVIDED",data:{type:a.type,meta:a.meta}});t=new et({data:a,albumsResource:this.albumsResource,logger:this.logger,variables:null==(i=this.variables)?void 0:i[H.K.Album]});break;case H.K.Playlist:if(!this.usersResource||!this.playlistResource)throw new eS("Users and playlist resources are not provided",{code:"E_USERS_AND_PLAYLIST_RESOURCES_NOT_PROVIDED",data:{type:a.type,meta:a.meta}});t=new ei({data:a,usersResource:this.usersResource,playlistResource:this.playlistResource,logger:this.logger,variables:null==(r=this.variables)?void 0:r[H.K.Playlist]});break;case H.K.Artist:if(!this.artistsResource)throw new eS("Artists resource is not provided",{code:"E_ARTISTS_RESOURCE_NOT_PROVIDED",data:{type:a.type,meta:a.meta}});t=new er({data:a,artistsResource:this.artistsResource,logger:this.logger,variables:null==(s=this.variables)?void 0:s[H.K.Artist]});break;case H.K.Vibe:if(!this.rotorResource)throw new eS("Rotor resource is not provided",{code:"E_ROTOR_RESOURCE_NOT_PROVIDED",data:{type:a.type,meta:a.meta}});t=new ep({data:a,rotorResource:this.rotorResource,logger:this.logger,variables:null==(l=this.variables)?void 0:l[H.K.Vibe]});break;case H.K.Various:if(!this.tracksResource)throw new eS("Tracks resource is not provided",{code:"E_TRACKS_RESOURCE_NOT_PROVIDED",data:{type:a.type,meta:a.meta}});t=new ev({data:a,tracksResource:this.tracksResource,logger:this.logger,variables:null==(n=this.variables)?void 0:n[H.K.Various]});break;case H.K.Generative:if(!this.rotorResource)throw new eS("Rotor resource is not provided",{code:"E_ROTOR_RESOURCE_NOT_PROVIDED",data:{type:a.type,meta:a.meta}});t=new eI({data:a,rotorResource:this.rotorResource,logger:this.logger,variables:null==(o=this.variables)?void 0:o[H.K.Generative]});break;case H.K.Radio:if(!this.radioStationsResource)throw new eS("Radio stations resource is not provided",{code:"E_RADIO_STATIONS_RESOURCE_NOT_PROVIDED",data:{type:a.type,meta:a.meta}});t=new e_({data:a,radioStationsResource:this.radioStationsResource,logger:this.logger,variables:null==(d=this.variables)?void 0:d[H.K.Radio]})}}catch(e){throw new eS("Error while creating context",{cause:(0,D.createObjectFromError)(e),data:{type:a.type,meta:a.meta}})}if(null!==t)return t;throw new eS("Cannot create context with nonexistent type",{code:"E_NONEXISTENT_CONTEXT_TYPE",data:{type:a.type,meta:a.meta}})}constructor(e){(0,N._)(this,"logger",void 0),(0,N._)(this,"variables",void 0),(0,N._)(this,"albumsResource",void 0),(0,N._)(this,"usersResource",void 0),(0,N._)(this,"artistsResource",void 0),(0,N._)(this,"rotorResource",void 0),(0,N._)(this,"tracksResource",void 0),(0,N._)(this,"playlistResource",void 0),(0,N._)(this,"radioStationsResource",void 0);let{variables:t,logger:a,rotorResource:i,usersResource:r,playlistResource:s,tracksResource:l,albumsResource:n,artistsResource:o,radioStationsResource:d}=e;this.albumsResource=null!=n?n:null,this.artistsResource=null!=o?o:null,this.rotorResource=null!=i?i:null,this.usersResource=null!=r?r:null,this.tracksResource=null!=l?l:null,this.playlistResource=null!=s?s:null,this.radioStationsResource=null!=d?d:null,this.variables=t,this.logger=a}}var eC=a(58624);class eA{canBePlayed(e){let t="playDisliked"in this.context.data&&void 0!==this.context.data.playDisliked&&this.context.data.playDisliked,{entityChangeMethod:a,index:i}=e,r=t||a===L.So.SET_INDEX||a===L.So.PLAY_CONTEXT&&void 0!==i,s=a===L.So.SET_INDEX,l=!r&&this.entity.isDisliked,n=!s&&this.entity.hidden;return!!(this.entity.isAvailable&&(!this.entity.isExplicit||!1!==e.filterParams.allowExplicit))&&(l?!!(0,eC.i)(this.context):!n)}constructor(e,t){(0,N._)(this,"context",void 0),(0,N._)(this,"entity",void 0),this.context=e,this.entity=t}}class eD{createContext(e){return this.contextFactory.create(e)}createEntity(e){return this.entityFactory.create(e)}createContextEntityPair(e,t){return new eA(e,t)}constructor(e){(0,N._)(this,"entityFactory",void 0),(0,N._)(this,"contextFactory",void 0),this.entityFactory=new z(e.entityFactoryParams),this.contextFactory=new eT(e.contextFactoryParams)}}var eN=a(43459),eL=a(47635);class ex{getAverageFrequencies(e){if(null===this.currentGraph)return[];let{analyserNode:t,spectrum:a,bufferLength:i,context:r}=this.currentGraph;if(!t)throw new U.t("No analyser node has been created");t.getByteFrequencyData(a);let s=r.sampleRate/i,l=0,n=e.map(e=>{let{low:t,high:a}=e,i=Math.floor(t/s),r=Math.floor(a/s);return l=Math.max(l,r),{startIndex:i,endIndex:r}}),o=Array(l+2).fill(0);for(let e=0;e<l+1;e++){var d,u;let t=(null!=(d=a[e])?d:0)/256;o[e+1]=(null!=(u=o[e])?u:0)+t}return n.map(e=>{let{startIndex:t,endIndex:a}=e,i=o[t],r=o[a+1];return void 0===i||void 0===r?0:(r-i)/(a-t+1)})}constructor({currentAudioElement:e,graphs:t}){(0,N._)(this,"currentGraph",null),(0,N._)(this,"graphs",void 0),this.graphs=t,e.onChange(e=>{let t=this.graphs.find(t=>t.audioElement===e);t&&(this.currentGraph=t)})}}!function(e){e.IDLE="IDLE",e.ENABLED="ENABLED",e.DISABLED="DISABLED"}(r||(r={}));class eR{enable(){this.state!==r.ENABLED&&(this.graphs.forEach(e=>{e.connectEqualizer()}),this.state=r.ENABLED)}disable(){this.state!==r.DISABLED&&(this.graphs.forEach(e=>{e.disconnectEqualizer()}),this.state=r.DISABLED)}applyPreset(e){this.graphs.forEach(t=>{t.setPreamp(e.preamp),t.setBands(e.frequencies)})}constructor({preset:e,graphs:t}){(0,N._)(this,"graphs",void 0),(0,N._)(this,"state",r.DISABLED),this.graphs=t,e&&this.applyPreset(e)}}!function(e){e.IDLE="IDLE",e.ENABLED="ENABLED",e.DISABLED="DISABLED"}(s||(s={}));let ew=1e3/60;class eG{updateGain(){if(this.state!==s.ENABLED||!this.currentGraph)return;let e=this.currentGraph.audioElement.currentTime,t=e>=this.inStart&&e<=this.inStop,a=e>=this.outStart&&e<=this.outStop;if(t){let t=this.getFadeInVolume(e);this.currentGraph.gainNode.gain.setValueAtTime(t,this.currentGraph.context.currentTime)}if(a){let t=this.getFadeOutVolume(e);this.currentGraph.gainNode.gain.setValueAtTime(t,this.currentGraph.context.currentTime)}e>this.inStop&&e<this.outStart&&this.currentGraph.gainNode.gain.setValueAtTime(1,this.currentGraph.context.currentTime),e>this.outStop&&this.currentGraph.gainNode.gain.setValueAtTime(0,this.currentGraph.context.currentTime)}getFadeInVolume(e){return Math.min(e/(this.inStop-this.inStart),1)}getFadeOutVolume(e){let t=this.outStop-this.outStart;return Math.max(1-(e-this.outStart)/t,0)}enable(){this.state=s.ENABLED,this.intervalId||(this.intervalId=setInterval(this.updateGain.bind(this),ew))}disable(){this.state=s.DISABLED,this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}apply(e){if(!this.currentGraph)return;if(!e){this.disable(),this.currentGraph.gainNode.gain.value=1;return}this.currentGraph.gainNode.gain.value=0;let{inStart:t,inStop:a,outStart:i,outStop:r}=e;this.inStart=t,this.inStop=a,this.outStart=i,this.outStop=r,this.enable()}constructor({currentAudioElement:e,graphs:t}){(0,N._)(this,"state",s.IDLE),(0,N._)(this,"inStart",0),(0,N._)(this,"inStop",0),(0,N._)(this,"outStart",0),(0,N._)(this,"outStop",0),(0,N._)(this,"intervalId",null),(0,N._)(this,"graphs",void 0),(0,N._)(this,"currentGraph",null),this.graphs=t,e.onChange(e=>{let t=this.graphs.find(t=>t.audioElement===e);t&&(this.currentGraph=t)})}}class eK{apply(e){this.durationMs=e}constructor({playback:e}){(0,N._)(this,"playback",null),(0,N._)(this,"durationMs",void 0),this.playback=e,this.playback.state.playerState.progress.onChange(e=>{var t,a;let i=(null!=(t=this.durationMs)?t:0)/1e3,r=e&&Math.abs(e.duration-i)>1;e&&e.position>i&&r&&(null==(a=this.playback)||a.moveForward())})}}!function(e){e.HIGHSHELF="highshelf",e.PEAKING="peaking",e.LOWSHELF="lowshelf"}(l||(l={})),function(e){e.SUSPENDED="suspended",e.RUNNING="running",e.CLOSED="closed"}(n||(n={}));class eO{connectNodes(){let{useAnalyser:e,useFade:t}=this.config;t&&e&&(this.sourceNode.connect(this.gainNode),this.gainNode.connect(this.analyserNode),this.analyserNode.connect(this.context.destination)),t&&!e&&(this.sourceNode.connect(this.gainNode),this.gainNode.connect(this.context.destination)),!t&&e&&(this.sourceNode.connect(this.analyserNode),this.analyserNode.connect(this.context.destination)),t||e||this.sourceNode.connect(this.context.destination)}connectEqualizer(){let{useAnalyser:e,useFade:t}=this.config,a=this.bands[this.bands.length-1];a&&(this.sourceNode.disconnect(),this.sourceNode.connect(this.preamp),t&&a.connect(this.gainNode),!t&&e&&a.connect(this.analyserNode),t||e||a.connect(this.context.destination))}disconnectEqualizer(){let{useAnalyser:e,useFade:t}=this.config,a=this.bands[this.bands.length-1];a&&(this.sourceNode.disconnect(),a.disconnect(),t&&this.sourceNode.connect(this.gainNode),!t&&e&&this.sourceNode.connect(this.analyserNode),t||e||this.sourceNode.connect(this.context.destination))}setBands(e){0===this.bands.length?this.bands=this.connectBandsBetween(this.createBandsByFrequencies(e)):this.updateBands(e)}setPreamp(e){this.preamp.gain.linearRampToValueAtTime(e,this.context.currentTime+.3)}createBandsByFrequencies(e){return e.map((t,a)=>{let{key:i,value:r}=t;return this.createBand(this.getBiquadFilterType(a,e.length),i,r)})}createBand(e,t,a){let i=this.context.createBiquadFilter();return i.type=e,i.frequency.value=t,i.Q.value=1,a&&i.gain.setValueAtTime(a,this.context.currentTime+.3),i}getBiquadFilterType(e,t){return 0===e?l.LOWSHELF:e===t-1?l.HIGHSHELF:l.PEAKING}connectBandsBetween(e){let t=this.preamp;return e.forEach(e=>{t.connect(e),t=e}),e}updateBands(e){this.bands.forEach((t,a)=>{let i=e[a];i&&t.gain.setValueAtTime(i.value,this.context.currentTime+.3)})}createAnalyzerNode(e){let t=e.createAnalyser();return t.fftSize=32,t.smoothingTimeConstant=0,t}checkAndResumeAudioContext(e){let t=()=>{e.resume().then(()=>{document.body.removeEventListener("touchend",t,!0),document.body.removeEventListener("click",t,!0),document.body.removeEventListener("keydown",t,!0)})};e.state===n.SUSPENDED&&(document.body.addEventListener("touchend",t,!0),document.body.addEventListener("click",t,!0),document.body.addEventListener("keydown",t,!0))}constructor(e,t){(0,N._)(this,"audioElement",void 0),(0,N._)(this,"context",void 0),(0,N._)(this,"sourceNode",void 0),(0,N._)(this,"preamp",void 0),(0,N._)(this,"bands",[]),(0,N._)(this,"analyserNode",void 0),(0,N._)(this,"bufferLength",0),(0,N._)(this,"spectrum",new Uint8Array),(0,N._)(this,"gainNode",void 0),(0,N._)(this,"config",void 0),this.audioElement=e,this.context=new AudioContext,this.checkAndResumeAudioContext(this.context),this.sourceNode=this.context.createMediaElementSource(this.audioElement),this.analyserNode=this.createAnalyzerNode(this.context),this.bufferLength=this.analyserNode.frequencyBinCount,this.spectrum=new Uint8Array(this.bufferLength),this.gainNode=this.context.createGain(),this.preamp=this.context.createGain(),this.config=t,this.connectNodes()}}class eM{get isAudioContextRequired(){return!!this.options.useEqualizer||!!this.options.useAnalyser||!!this.options.useFade}createGraphs(e){if((0,L.s4)(e))return[new eO(e.currentAudioElement.value,{useAnalyser:this.options.useAnalyser,useFade:this.options.useFade})];if((0,L.uo)(e))return e.audioElementsStore.map(e=>new eO(e,{useAnalyser:this.options.useAnalyser,useFade:this.options.useFade}));throw new U.t("Can not create audio graph for this type of media player")}initializeContext(e,t){if(this.isAudioContextRequired){if(this.graphs=this.createGraphs(e),this.options.useAnalyser&&(this.analyser=new ex({currentAudioElement:e.currentAudioElement,graphs:this.graphs})),this.options.useEqualizer){let e="object"==typeof this.options.useEqualizer?this.options.useEqualizer:void 0;this.equalizer.value=new eR({graphs:this.graphs,preset:null==e?void 0:e.preset})}this.options.useFade&&(this.fade=new eG({currentAudioElement:e.currentAudioElement,graphs:this.graphs}))}this.options.useSmartPreview&&(this.smartPreview=new eK({playback:t}))}apply(e){let{hooks:t,playback:a}=e;a.state.mediaPlayersStore.onChange(e=>{if(void 0===e)return;let t=e[G.e.AUDIO];void 0!==t&&((0,L.s4)(t)||(0,L.uo)(t))&&this.initializeContext(t,a)}),a.state.playerState.event.onChange(()=>{if(this.fade)switch(a.state.playerState.event.value){case L.Iu.PLAYING:this.fade.enable();break;case L.Iu.PAUSED:case L.Iu.STOP:this.fade.disable()}}),t.beforeMediaStartPlaying.tapPromise("WebAudioPlugin",()=>{var e,t,i;let r,s,{currentEntity:l}=a.state.queueState,n=null==(e=l.value)?void 0:e.entity;return(0,eN.l)(n)&&(r=null==(t=n.data.meta.smartPreviewParams)?void 0:t.fade,s=null==(i=n.data.meta.smartPreviewParams)?void 0:i.durationMs),(0,eL.b)(n)&&(r=n.data.meta.fade,s=n.data.meta.durationMs),this.fade&&this.fade.apply(r),this.smartPreview&&this.smartPreview.apply(s),Promise.resolve()})}constructor(e){(0,N._)(this,"options",void 0),(0,N._)(this,"graphs",[]),(0,N._)(this,"analyser",void 0),(0,N._)(this,"equalizer",new $.cJ(null)),(0,N._)(this,"fade",void 0),(0,N._)(this,"smartPreview",void 0),this.options=e}}function eX(e){return(null==e?void 0:e.data.type)===R.R.Clip}!function(e){e.AD="ad",e.SHOT="shot"}(o||(o={})),function(e){e.NONE="none",e.AD="ad",e.JINGLE="jingle"}(d||(d={})),function(e){e.NONE="none",e.AD="ad",e.JINGLE="jingle"}(u||(u={})),function(e){e.VIDEO="video",e.AUDIO="audio"}(c||(c={}));class eF{apply(e){let{playback:t,hooks:a}=e;a.beforeEntityChange.tapPromise("AdvertPlugin",()=>new Promise(e=>{if(!this.variables.enabled)return void e();let{state:{currentContext:a,queueState:{index:{value:i},order:{value:r},entityList:{value:s},currentEntity:{value:l}}}}=t;if(void 0!==a.value){let n=r[i+1],g=n?s[n]:void 0,m=g?String(g.entity.data.meta.id):void 0,h=r[i-1],y=h?s[h]:void 0,p=y?String(y.entity.data.meta.id):void 0,v=((null==l?void 0:l.entity.totalPlayedSeconds)||0)/(((null==l?void 0:l.entity.data.meta)&&"durationMs"in l.entity.data.meta&&l.entity.data.meta.durationMs||1)/1e3);this.currentTrackId=String(null==l?void 0:l.entity.data.meta.id),this.from=a.value.from,this.afterTrackResource.getAfterTrack({contextItem:String(a.value.data.meta.id),from:a.value.from,types:o.AD,nextTrackId:m,prevTrackId:p}).then(a=>{var i,r,s;let l=v>=.5&&(null==(i=a.ad)?void 0:i.afterPlay)===d.AD||v<.5&&(null==(r=a.ad)?void 0:r.afterSkip)===u.AD;if("ad"in a&&this.advertModule&&l){let i=eX(null==(s=t.state.queueState.currentEntity.value)?void 0:s.entity)?c.VIDEO:void 0;t.pause(),this.advertModule.playAdvert({afterTrackResponse:a,advertType:i}).finally(e)}else e()})}else e()}))}advertFeedbackCallback(){this.adsResource.saveAds({from:this.from,trackId:this.currentTrackId,type:"ad"})}constructor(e){var t;(0,N._)(this,"advertModule",void 0),(0,N._)(this,"variables",void 0),(0,N._)(this,"afterTrackResource",void 0),(0,N._)(this,"adsResource",void 0),(0,N._)(this,"currentTrackId",""),(0,N._)(this,"from","");let{afterTrackResource:a,advertModule:i,adsResource:r,variables:s}=e;this.afterTrackResource=a,this.adsResource=r,this.variables=s,this.advertModule=i,null==(t=this.advertModule)||t.setAdvertFeedbackCallback(this.advertFeedbackCallback.bind(this))}}var ej=a(19679),eU=a(5471);function eV(e){let t=ej.FM.r.PAUSE;switch(e.status.value){case L.MT.BUFFERING:t=ej.FM.r.BUFFERING;break;case L.MT.ENDED:case L.MT.STOPPED:t=ej.FM.r.END;break;case L.MT.PLAYING:t=ej.FM.r.PLAY;break;case L.MT.PAUSED:case L.MT.IDLE:case L.MT.LOADING_MEDIA_SOURCE:t=ej.FM.r.PAUSE}return t}class eB{createTelemetry(e){this.vsid=(0,D.createVsid)(e.playbackInitializationTime,this.playerTypeForVsid),this.telemetry=new ej.YT({getState:()=>{let{progress:{value:{duration:t,position:a,remainingBufferedTime:i}},volume:r}=e.state.playerState;return{duration:(0,eU.fP)(t),currentTime:(0,eU.fP)(a),utcStartTime:void 0,videoType:"VOD",isFullscreen:!1,volume:r.value,muted:0===r.value,remainingBufferedTime:{total:(0,eU.fP)(null!=i?i:0)},playingState:eV(e.state.playerState),videoSize:void 0,liveLatency:void 0,videoTracks:[],audioTrack:void 0,isVisible:!1}},sendLog:(e,t)=>{this.telemetryResource.log({payload:e,urlParams:t})},playerInfo:{service:this.service,version:"1.0.0",vsid:this.vsid,isVideoADB:!1}}),this.telemetry.setStaticParams({labels:{from:this.from}})}logEvent(e,t){var a;null==(a=this.telemetry)||a.logEvent(e,t)}logError(e,t){var a;null==(a=this.telemetry)||a.logError(e,t)}setPlayingState(e){var t;let a=eV(e);null==(t=this.telemetry)||t.setPlayingState(a)}setStaticParams(e,t){var a;null==(a=this.telemetry)||a.setStaticParams(e,t)}onBeforeSetSource(){var e;return null==(e=this.telemetry)?void 0:e.onBeforeSetSource()}onSetSource(e){var t;null==(t=this.telemetry)||t.onSetSource(e,{streams:[],params:{}})}onSeek(e,t){var a;null==(a=this.telemetry)||a.onSeek({oldPosition:e,newPosition:t})}logYaspEvent(e,t){var a;null==(a=this.telemetry)||a.logEvent({name:e,data:t})}logYaspError(e){var t;null==(t=this.telemetry)||t.logError({error:{...e.detail,isFatal:!!e.detail.isFatal,code:String(e.detail.code)}})}constructor({telemetryResource:e,service:t,from:a,playerTypeForVsid:i}){(0,N._)(this,"telemetry",void 0),(0,N._)(this,"telemetryResource",void 0),(0,N._)(this,"from",void 0),(0,N._)(this,"service",void 0),(0,N._)(this,"playerTypeForVsid",void 0),(0,N._)(this,"vsid",void 0),this.telemetryResource=e,this.service=t,this.from=a,this.playerTypeForVsid=i}}class eq{send(e){new Promise(t=>{let a={[e.name]:{...e.data}};this.yaMetrika.count(a,"player-metrics"),t()})}constructor(e){(0,N._)(this,"yaMetrika",void 0),this.yaMetrika=e}}var eY=a(66928);let eW=null;function ez(e,t){let a,i,r=e.state.queueState.order.value,s=e.state.queueState.index.value,l=e.state.currentContext.value,n=e.state.queueState.entityList.value,o=e.state.queueState.repeat.value===L.pM.CONTEXT;for(let e=s-1;e>=0;e--){let t=r[e];if("number"!=typeof t)break;let i=n[t];if(void 0!==i&&!i.entity.hidden){a=i.entity;break}}let d=!!a||o;for(let e=s+1;e<r.length;e++){let t=r[e];if("number"!=typeof t)break;let a=n[t];if(void 0!==a&&!a.entity.hidden){i=a.entity;break}}let u=!!i||o&&!!a||!o&&t;l&&(l.availableActions.moveBackward.value=d,l.availableActions.moveForward.value=u&&!(0,eY.S)(l),a||i||!o||(l.availableActions.moveBackward.value=!1,l.availableActions.moveForward.value=!1)),null!==eW&&(eW(),eW=null),0!==s||(0,eY.S)(l)||(eW=e.state.playerState.progress.onChange(t=>{l&&t&&((o=e.state.queueState.repeat.value===L.pM.CONTEXT)&&!a&&!i||!o)&&(l.availableActions.moveBackward.value=t.position>L.DS)})),(0,eY.S)(l)||e.state.queueState.repeat.onChange(e=>{if(l){if(e===L.pM.CONTEXT){l.availableActions.moveBackward.value=!!a||0===s&&!!i,l.availableActions.moveForward.value=!!i||!!a;return}l.availableActions.moveBackward.value=!!a,l.availableActions.moveForward.value=!!i||t}})}let eH=[x.S.AUDIOBOOK,x.S.FAIRY_TALE,x.S.PODCAST,x.S.COMMENT];var eQ=a(15479);class e${apply(e){let{hooks:t,playback:a}=e,i=()=>{let{value:e}=a.state.currentContext,{value:t}=a.state.queueState.currentEntity,i=void 0!==t;if(void 0!==e&&i){let{meta:i}=t.entity.data;(0,eC.i)(e)||(0,eY.S)(e)||"type"in i&&i.type&&eH.includes(i.type)?(e.availableActions.repeat.value=!1,e.availableActions.shuffle.value=!1,a.state.queueState.repeat.value!==L.pM.NONE&&a.setRepeatMode(L.pM.NONE),a.state.queueState.shuffle.value&&a.toggleShuffle()):(e.availableActions.repeat.value=!0,e.availableActions.shuffle.value=!0)}let{value:r}=a.state.currentContext,{value:s}=a.state.queueState.currentEntity,l=void 0!==s;if(void 0!==r&&l){let e=(e=>{let{meta:t}=e.data,a="albums"in t&&t.albums&&t.albums.length>0&&t.albums[0]&&t.albums[0].type===eQ._.PODCAST;return!!("type"in t&&t.type&&eH.includes(t.type)||a)})(s.entity);r.availableActions.speed.value=!!e}};t.afterContextSet.tap("AvailableActionsPlugin",i),t.beforeMediaStartPlaying.tap("AvailableActionsPlugin",i),a.state.queueState.entityList.onChange(()=>{i(),ez(a,this.variables.isAutoflowEnabled)}),a.state.queueState.index.onChange(()=>{ez(a,this.variables.isAutoflowEnabled)})}constructor({variables:e}){(0,N._)(this,"variables",void 0),this.variables=e}}class eJ{apply(e){let{hooks:t,playback:a}=e;t.afterContextSet.tap("ApplyContextPlugin",()=>{let e=a.state.currentContext.value;e&&e instanceof L.EX&&e.apply({hooks:t,playback:a})})}}class eZ{apply(e){let{playback:t,hooks:a}=e;t.state.playerState.event.onChange(()=>{let{currentEntity:e}=t.state.queueState;if(e.value)switch(t.state.playerState.event.value){case L.Iu.PAUSED:e.value.entity.saveTimeStageOfPlayback({stage:i.NOT_PLAYING,reason:"event-".concat(L.Iu.PAUSED)});break;case L.Iu.WAITING:e.value.entity.saveTimeStageOfPlayback({stage:i.NOT_PLAYING,reason:"event-".concat(L.Iu.WAITING)});break;case L.Iu.PLAYING:e.value.entity.saveTimeStageOfPlayback({stage:i.PLAYING,reason:"event-".concat(L.Iu.PLAYING)});break;case L.Iu.MEDIA_ELEMENT_ERROR:e.value.entity.saveTimeStageOfPlayback({stage:i.NOT_PLAYING,reason:"event-".concat(L.Iu.MEDIA_ELEMENT_ERROR)})}}),a.beforeEntityPlayingProcessStart.tapPromise("TotalPlayedTimePlugin",()=>{let{currentEntity:e}=t.state.queueState;return e.value&&e.value.entity.clearTimeStagesOfPlayback(),Promise.resolve()}),a.afterMediaStartPlaying.tapPromise("TotalPlayedTimePlugin",()=>{let{currentEntity:e}=t.state.queueState;return e.value&&e.value.entity.saveTimeStageOfPlayback({stage:i.PLAYING,reason:"hook-afterMediaStartPlaying"}),Promise.resolve()}),a.afterMediaEndPlaying.tapPromise("TotalPlayedTimePlugin",()=>{let{currentEntity:e}=t.state.queueState;return e.value&&e.value.entity.saveTimeStageOfPlayback({stage:i.NOT_PLAYING,reason:"hook-afterMediaEndPlaying"}),Promise.resolve()}),a.beforeEntityChange.tapPromise("TotalPlayedTimePlugin",()=>{let{currentEntity:e}=t.state.queueState;return e.value&&e.value.entity.saveTimeStageOfPlayback({stage:i.NOT_PLAYING,reason:"hook-beforeEntityChange"}),Promise.resolve()}),a.beforeContextSet.tapPromise("TotalPlayedTimePlugin",()=>{let{currentEntity:e}=t.state.queueState;return e.value&&e.value.entity.saveTimeStageOfPlayback({stage:i.NOT_PLAYING,reason:"hook-beforeContextSet"}),Promise.resolve()})}}var e0=a(13201),e1=a(61979);!function(e){e.PREPARE="prepare",e.PLAY="play"}(g||(g={})),function(e){e.FINISH="finish",e.SKIP="skip",e.DISLIKE="dislike",e.BACK_SKIP="back_skip",e.OTHER_TRACK="other_track",e.IN_PROGRESS="in_progress"}(m||(m={}));var e3=a(94967),e6=a(11936);class e7 extends e3.X{async sendPlays(e,t){return(await this.httpClient.post("plays",this.createHttpOptions({timeoutKey:"sendPlays",params:e,searchParams:(0,e6.P)({clientNow:e.clientNow}),json:{plays:e.plays},signal:null==t?void 0:t.signal}))).json()}constructor(e,t){super(e,t),(0,N._)(this,"httpClient",void 0),(0,N._)(this,"config",void 0),this.httpClient=e,this.config=t}}class e8 extends U.t{constructor(e,{code:t="E_MEDIA_PROVIDER",...a}={}){super(e,{code:t,...a}),(0,N._)(this,"name","MediaProviderException"),Object.setPrototypeOf(this,e8.prototype)}}class e4 extends e8{constructor(e,{code:t="E_GET_FILE_INFO_MEDIA_PROVIDER",...a}={}){super(e,{code:t,...a}),(0,N._)(this,"name","GetFileInfoMediaProviderException"),Object.setPrototypeOf(this,e4.prototype)}}function e9(e){return(null==e?void 0:e.data.type)===H.K.Radio}!function(e){e.START="start",e.END="end",e.PLAYING="playing",e.PAUSE="pause"}(h||(h={}));let e2=e=>{if(e.mediaSourceData&&"urls"in e.mediaSourceData.data){let t=e.mediaSourceData.data.urls[0];if(t&&t.startsWith("blob:"))return!0}return!1};var e5=a(77282),te=a(40178);function tt(){return new Date().toISOString()}function ta(e){var t,a,i,r,s,l;let n,{contextEntityPair:o,totalPlayedSeconds:d,endPositionSeconds:u,type:c,maxPlayerStage:g,seek:m,pause:h,startTimestamp:y,radioSessionId:p,radioBatchId:v,isFromAutoflow:S,isFromPumpkin:E,changeReason:P}=e,{entity:b,context:f}=o,I=String(b.data.meta.id),k=function(e){let t;if("albums"in e.data.meta){let{data:{meta:{albums:a}}}=e;if(a){let e=a[0];e&&(t=String(e.id))}}return t}(b),_=(null==(t=b.data.additional)?void 0:t.from)||f.from,T=(null==(a=b.data.additional)?void 0:a.utmLink)||f.utmLink||{},C=0;(0,eN.l)(b)?"smartPreviewParams"in b.data.meta&&(null==(i=b.data.meta.smartPreviewParams)?void 0:i.durationMs)&&(C=(null==(r=b.data.meta.smartPreviewParams)?void 0:r.durationMs)/1e3):"durationMs"in b.data.meta&&b.data.meta.durationMs&&(C=b.data.meta.durationMs/1e3);let A=d,D=u;.5>Math.abs(C-d)&&(A=C),.5>Math.abs(C-u)&&(D=C),n=(0,eY.S)(f)?{generativeStreamId:String(null==(s=f.data.meta.stream)?void 0:s.id)}:{trackId:I},e9(f)&&(D=A);let N=!!b.data.isRestored,L={playId:b.playId,timestamp:tt(),totalPlayedSeconds:A,endPositionSeconds:D,trackLengthSeconds:C,albumId:k,from:_,context:f.data.type,contextItem:String(f.data.meta.id),addTracksToPlayerTime:b.addTracksToPlayerTime,audioAuto:"none",audioOutputName:"Динамик",audioOutputType:"Speaker",maxPlayerStage:g,seek:m,pause:h,startTimestamp:y,fromCache:e2(b),isRestored:N,changeReason:P,...T,...n};if((0,eC.i)(f)&&f.data.meta.session&&(L.radioSessionId=null!=p?p:f.data.meta.session.radioSessionId,L.batchId=null!=v?v:f.data.meta.session.batchId,L.isFromAutoflow=S,L.isFromPumpkin=E,L.context="radio",L.contextItem=f.data.meta.session.wave.stationId),(null==f?void 0:f.data.type)===H.K.Playlist&&(L.playlistId="".concat(f.data.meta.uid,":").concat(f.data.meta.kind),L.contextItem="".concat(f.data.meta.uid,":").concat(f.data.meta.kind)),(0,e5.p)(f)){let e=[te.b.Search,te.b.Other],t=null!=(l=f.data.overrideContextType)?l:te.b.Other;L.context=t,e.includes(t)&&(L.contextItem=null)}return(0,eN.l)(b)&&(L.smartPreview=!0),{type:c,data:L}}var ti=a(96537),tr=a(35689),ts=a(28320),tl=a(29889),tn=a(38025);let to=e=>!!(e&&"object"==typeof e&&"playId"in e&&"totalPlayedSeconds"in e),td=e=>{let t=[e.find(e=>0===e.totalPlayedSeconds),(0,ts.A)(e,"totalPlayedSeconds")];return(0,tl.A)(t.filter(to),"totalPlayedSeconds")};class tu extends U.t{constructor(e,{code:t="E_PLAYS",...a}={}){super(e,{code:t,...a}),(0,N._)(this,"name","PlaysException"),Object.setPrototypeOf(this,tu.prototype)}}var tc=a(8282),tg=a(2257);let tm="playsHeartBeats";class th extends U.t{constructor(e,{code:t="E_PLAYS_IDB_STORE",...a}={}){super(e,{code:t,...a}),(0,N._)(this,"name","PlaysStoreException"),Object.setPrototypeOf(this,th.prototype)}}class ty{deleteDatabase(){return window.indexedDB.databases().then(e=>e.find(e=>this.idbName===e.name)?new tg.h(this.idbName).deleteDB({onBlocked:tc.A}):Promise.resolve()).catch(e=>{this.logError("Error while deleting database",e)})}isAvailable(){return this.idbIsAvailable}openDatabase(){return this.openIdb({onBlocked:()=>this.onBlockedHandler(),onTerminated:()=>this.onTerminatedHandler()}).then(e=>{this.idb=Promise.resolve(e)})}setErrorLogger(e){this.errorLogger=e}storePlaysData(e){return this.executeTransaction(t=>t.put(tm,e).then(()=>t.count(tm))).then(e=>"number"==typeof e&&e>this.storedPlaysLimit?this.deleteOverLimitPlays(this.storedPlaysLimit):Promise.resolve()).catch(e=>{throw this.generateError("Saving Play Error",e)})}getStoredPlaysData(e){return this.executeTransaction(t=>t.getAll(tm,null,e),{defaultValue:[]}).catch(e=>{throw this.generateError("Error getting Plays",e)})}deleteAllByPlayId(e,t){return Promise.all(e.map(e=>{let{playId:a}=e;return this.iterateByCursor("playId",a,"readwrite",e=>!t||t(e.value)?e.delete():Promise.resolve())})).then(tc.A).catch(e=>{throw this.generateError("Error deleting Plays",e)})}deleteOverLimitPlays(e){return this.iterateByCursor(null,null,"readwrite",(t,a)=>a<=e?Promise.resolve():t.delete()).catch(e=>{throw this.generateError("Error deleting overlimit Plays",e)})}iterateByCursor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,r=0,s=e=>e?i(e,++r).then(()=>e.continue()).then(s):Promise.resolve();return this.getCursor(e,t,a).then(s)}onBlockedHandler(){this.closeConnection(this.idb).then(()=>{this.idb=this.openIdb({onBlocked:()=>{this.closeConnection(this.idb)},onTerminated:()=>this.onTerminatedHandler()})})}onTerminatedHandler(){this.idbIsAvailable=!1,this.idb=this.openIdb({onBlocked:()=>this.onBlockedHandler(),onTerminated:()=>{this.idbIsAvailable=!1}})}openIdb(e){return new tg.h(this.idbName).openDB(1,{onBlocked:(t,a,i)=>{var r;this.logError("Connection has been blocked"),null==e||null==(r=e.onBlocked)||r.call(e,t,a,i)},onTerminated:()=>{var t;this.logError("Storage has been terminated"),null==e||null==(t=e.onTerminated)||t.call(e)},onUpgrade:e=>{let t=e.createObjectStore(tm,{keyPath:"id",autoIncrement:!0});t.createIndex("playId","playId",{unique:!1}),t.createIndex("trackId","trackId",{unique:!1})}}).then(e=>(this.idbIsAvailable=!0,e)).catch(e=>{this.idbIsAvailable=!1,this.logError("Open storage error",e)})}closeConnection(e){return(this.idbIsAvailable=!1,this.idb=void 0,e)?e.then(e=>{e&&e.close()}).catch(e=>{this.logError("Error while try to close connection",e)}):Promise.resolve()}getCursor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2?arguments[2]:void 0;return this.executeTransaction(i=>{let r=i.transaction([tm],a).objectStore(tm);return e?r.index(e).openCursor(t,"prev"):r.openCursor(t,"prev")},{defaultValue:null})}executeTransaction(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.idbIsAvailable&&this.idb?this.idb.then(a=>a?e(a):Promise.resolve(null==t?void 0:t.defaultValue)):Promise.resolve(null==t?void 0:t.defaultValue)}logError(e,t){var a;let i=this.generateError(e,t);null==(a=this.errorLogger)||a.call(this,i)}generateError(e,t){var a;let i="[IndexedDB][".concat(this.idbName,".").concat(tm,"]: ").concat(e),r=String(t);return("".concat(t).includes("QuotaExceededError")||/connection.*lost/i.test("".concat(t)))&&this.closeConnection(),new th(i,{data:{originalError:r,storageEstimate:null!=(a=this.storageEstimate)?a:{}}})}constructor(e){(0,N._)(this,"storedPlaysLimit",void 0),(0,N._)(this,"idb",void 0),(0,N._)(this,"errorLogger",void 0),(0,N._)(this,"idbIsAvailable",!1),(0,N._)(this,"idbName",void 0),(0,N._)(this,"storageEstimate",void 0),this.storedPlaysLimit=e,(()=>{var e,t;return(null==(t=window.navigator)||null==(e=t.storage)?void 0:e.estimate)?window.navigator.storage.estimate().catch(()=>({})):Promise.resolve({})})().then(e=>{this.storageEstimate=e}),this.idbName="".concat("music_plays","_").concat("1.0.0")}}class tp{apply(e){var t,a;let{hooks:i,playback:r}=e;this.hooks=i,this.variables.enableLocalStoredPlaysData&&this.playsStore.setErrorLogger(e=>{i.afterError.promise(e)}),this.variables.shouldDeletePlaysObjectStore&&(null==(t=this.playsStore)||t.deleteDatabase()),this.variables.enableLocalStoredPlaysData&&!this.variables.shouldDeletePlaysObjectStore&&(null==(a=this.playsStore)||a.openDatabase().then(()=>{this.sendStoredPlaysData()})),r.state.playerState.event.onChange(()=>{let{currentEntity:e}=r.state.queueState;if(e.value)switch(r.state.playerState.event.value){case L.Iu.PLAYING:return this.setVibeContextDynamicData(r),this.changeDynamicPlaysDataByPlayId({playId:e.value.entity.playId,dynamicData:{maxPlayerStage:g.PLAY}});case L.Iu.PAUSED:if(Math.abs(r.state.playerState.progress.value.position-r.state.playerState.progress.value.duration)>.2&&this.changeDynamicPlaysDataByPlayId({playId:e.value.entity.playId,dynamicData:{pause:!0}}),e9(e.value.context))return void this.sendPausePlayReport(r,i);return;case L.Iu.SET_PROGRESS:if((0,eY.S)(e.value.context)||e9(e.value.context))return;return this.changeDynamicPlaysDataByPlayId({playId:e.value.entity.playId,dynamicData:{seek:!0}})}});let s=(0,e0.A)(()=>{let e=r.state.queueState.currentEntity.value;if(!e||(0,eY.S)(e.context))return;let t=this.getDynamicPlaysDataByPlayId(e.entity.playId),a=this.variables.enableSendChangeReason?m.IN_PROGRESS:void 0,{data:i}=ta({type:h.PLAYING,contextEntityPair:e,totalPlayedSeconds:e.entity.totalPlayedSeconds,endPositionSeconds:r.state.playerState.progress.value.position,...t,changeReason:a});i.playId&&i.totalPlayedSeconds>0&&this.storeAndReplace(i)},this.storePlaysProgressIntervalMs,{trailing:!1}),l=(0,e0.A)(()=>{this.sendPartialPlayReport(r,i)},2e3,{trailing:!1});this.variables.enableLocalStoredPlaysData&&r.state.playerState.progress.onChange(s),this.variables.enablePartialPlayReporting&&r.state.playerState.progress.onChange(l),i.beforeEntityPlayingProcessStart.tapPromise("PlaysPlugin",()=>(this.variables.enableRemoveDuplicatePlays&&this.sentPlayIds.clear(),this.setVibeContextDynamicData(r),this.sendStartEntityPlay(r,i),Promise.resolve())),i.beforeMediaStartPlaying.tapPromise("PlaysPlugin",()=>{let{currentEntity:e}=r.state.queueState;if(e.value){var t;let a=e.value.entity.playId,i=null==(t=this.dynamicPlaysDataByEntitiesPlayId.get(a))?void 0:t.startTimestamp;e.value.entity.isDisliked&&this.alreadyDislikedPlayIds.add(a),i||this.changeDynamicPlaysDataByPlayId({playId:a,dynamicData:{startTimestamp:tt()}})}return Promise.resolve()}),i.afterMediaEndPlaying.tapPromise("PlaysPlugin",()=>{let{index:{value:e},entityList:{value:t},repeat:{value:a}}=r.state.queueState,s=r.state.queueState.currentEntity.value;return(e===t.length-1||a===L.pM.ONE)&&(s&&((0,eY.S)(s.context)||e9(s.context)?this.setChangeReasonToDynamicPlaysData(r,m.OTHER_TRACK):this.setChangeReasonToDynamicPlaysData(r,m.FINISH)),this.sendEndEntityPlay(r,i)),Promise.resolve()}),i.afterError.tapPromise("PlaysPlugin",e=>((e instanceof e4||e instanceof L.LI)&&this.sendEndEntityPlay(r,i),Promise.resolve())),i.beforeContextSet.tapPromise("PlaysPlugin",()=>(this.setChangeReasonToDynamicPlaysData(r,m.OTHER_TRACK),this.sendCurrentEntityEndPlay(r,i))),i.afterSetupQueue.tap("PlaysPlugin",()=>this.setVibeContextDynamicData(r)),i.beforeEntityChange.tapPromise("PlaysPlugin",e=>{var t,a;let{currentEntity:s}=r.state.queueState,{method:l}=e,n=null==(t=s.value)?void 0:t.entity.playId;switch(l){case L.So.AUTO_MOVE_FORWARD:this.setChangeReasonToDynamicPlaysData(r,m.FINISH);break;case L.So.MOVE_FORWARD:{let e=m.SKIP;(null==(a=s.value)?void 0:a.entity.isDisliked)&&n&&!this.alreadyDislikedPlayIds.has(n)&&(e=m.DISLIKE),this.setChangeReasonToDynamicPlaysData(r,e);break}case L.So.MOVE_BACKWARD:this.setChangeReasonToDynamicPlaysData(r,m.BACK_SKIP);break;case L.So.SET_INDEX:case L.So.PLAY_CONTEXT:case L.So.RESTART_CONTEXT:this.setChangeReasonToDynamicPlaysData(r,m.OTHER_TRACK)}return this.sendCurrentEntityEndPlay(r,i,n)}),i.beforeDestroy.tap("PlaysPlugin",()=>new Promise(e=>{if(!this.isSendingPlays.value)return void e();let t=this.isSendingPlays.onChange(a=>{a||(t(),e())})}))}setVibeContextDynamicData(e){var t;let{queueState:a}=e.state;if((0,eC.i)(null==(t=a.currentEntity.value)?void 0:t.context)&&a.currentEntity.value){let{meta:{session:e,sessionTracks:t},parentContext:i}=a.currentEntity.value.context.data,r=null==e?void 0:e.radioSessionId,s=t?t.batchId:null==e?void 0:e.batchId,l=t?t.pumpkin:null==e?void 0:e.pumpkin;this.changeDynamicPlaysDataByPlayId({playId:a.currentEntity.value.entity.playId,dynamicData:{radioSessionId:r,radioBatchId:s,isFromPumpkin:l,isFromAutoflow:!!i}})}}setChangeReasonToDynamicPlaysData(e,t){let{currentEntity:a}=e.state.queueState;a.value&&this.variables.enableSendChangeReason&&this.changeDynamicPlaysDataByPlayId({playId:a.value.entity.playId,dynamicData:{changeReason:t}})}isStorageEnabled(){return!!this.variables.enableLocalStoredPlaysData&&this.playsStore.isAvailable()}setPlaysDataForSending(e){e.forEach(e=>{let{playId:t}=e;this.sendingInProgressForPlayId.set(t)})}clearSendedPlaysData(e){e.forEach(e=>{let{playId:t}=e;this.sendingInProgressForPlayId.has(t)&&this.sendingInProgressForPlayId.delete(t)})}filterPlaysForSending(e){var t=e.filter(e=>{let{playId:t}=e;return!this.sendingInProgressForPlayId.has(t)});let a=(0,tr.A)((0,ti.A)(t,"playId"),td);return(0,tn.A)(a)}playsResourceSend(e){return this.setPlaysDataForSending(e),this.playsResource.sendPlays({clientNow:tt(),plays:e}).finally(()=>{this.clearSendedPlaysData(e)})}validatePlaysRequiredData(e,t){var a,i,r;if(!e.entity.playId){let a={};return a.contextId=e.context.data.meta.id,a.entityId=e.entity.data.meta.id,null==(i=this.hooks)||i.afterError.promise(new tu("Trying to ".concat(t," without playId"),{data:a})),!1}return!!((null==(a=e.entity.data.additional)?void 0:a.from)||e.context.from)||(null==(r=this.hooks)||r.afterError.promise(new tu("from field is required for ".concat(t,", but was not found in plays data"))),!1)}deletePlaysData(e,t,a){return this.isStorageEnabled()?this.playsStore.deleteAllByPlayId(e,t).then(()=>{if(a)return a()}).catch(e=>{var t;null==(t=this.hooks)||t.afterError.promise(e)}):Promise.resolve()}storeAndReplace(e){return this.isStorageEnabled()?this.deletePlaysData([e],e=>e.totalPlayedSeconds>0,()=>{var t;return null==(t=this.playsStore)?void 0:t.storePlaysData(e)}):Promise.resolve()}sendStoredPlaysData(){this.isSendingPlays.value=!0;let e=this.variables.limitOfStoredPlaysData||25;return this.isStorageEnabled()?this.playsStore.getStoredPlaysData(e).then(e=>{let t=this.filterPlaysForSending(e);if(!t.length){this.isSendingPlays.value=!1;return}this.playsResourceSend(t).then(()=>{this.deletePlaysData(t).then(()=>{this.sendStoredPlaysData()})}).catch(e=>{var a;this.isSendingPlays.value=!1,e instanceof e1.GX&&e.statusCode===e1.X1.BAD_REQUEST&&this.deletePlaysData(t),null==(a=this.hooks)||a.afterError.promise(new tu("Error while sending plays",{cause:e}))})}).catch(e=>{var t;null==(t=this.hooks)||t.afterError.promise(e)}):Promise.resolve()}sendPlayData(e){this.isSendingPlays.value=!0;let t=[e];return this.playsResourceSend(t).then(()=>{this.isStorageEnabled()&&this.deletePlaysData(t,e=>e.totalPlayedSeconds>0)}).catch(a=>{throw a instanceof e1.GX&&a.statusCode===e1.X1.BAD_REQUEST?this.deletePlaysData(t):this.storeAndReplace(e),a}).finally(()=>{if(!this.isStorageEnabled()){this.isSendingPlays.value=!1;return}this.sendStoredPlaysData()})}sendCurrentEntityEndPlay(e,t,a){if(e.state.queueState.currentEntity.value&&e.state.currentContext.value){if((0,eC.i)(e.state.currentContext.value))return this.sendEndEntityPlay(e,t);this.sendEndEntityPlay(e,t).finally(()=>{a&&this.alreadyDislikedPlayIds.delete(a)})}return Promise.resolve()}sendStartEntityPlay(e,t){let a=e.state.queueState.currentEntity.value;if(!a||!this.validatePlaysRequiredData(a,"send start entity play"))return Promise.resolve();try{a.entity.addTracksToPlayerTime="".concat(Math.random().toString().slice(2),"-").concat(Math.ceil(Number(new Date)/1e3));let{seek:i,pause:r,radioSessionId:s,radioBatchId:l,isFromAutoflow:n,isFromPumpkin:o}=this.getDynamicPlaysDataByPlayId(a.entity.playId),d=ta({type:h.START,contextEntityPair:a,totalPlayedSeconds:0,endPositionSeconds:0,seek:i,pause:r,radioSessionId:s,radioBatchId:l,isFromAutoflow:n,isFromPumpkin:o});if(d.data.totalPlayedSeconds>2e3&&t.afterError.promise(new tu("Plays error. Too big play time",{code:"E_PLAYS_BIG_PLAY_TIME",data:{timeStagesOfPlayback:a.entity.timeStagesOfPlayback,contextId:a.context.data.meta.id,entityId:a.entity.data.meta.id,totalPlayedSeconds:d.data.totalPlayedSeconds,trackLengthSeconds:d.data.trackLengthSeconds,playId:d.data.playId,isOnStart:!0,entityListLength:e.state.queueState.entityList.value.length,index:e.state.queueState.index.value,repeat:e.state.queueState.repeat.value}})),!this.variables.disableSendPlaysOnTrackStart)return this.sendPlayData(d.data).catch(e=>{let i="",r="";a&&(i=a.context.data.meta.id,r=a.entity.data.meta.id),t.afterError.promise(new tu("Error while sending plays",{cause:e,data:{contextId:i,entityId:r}}))})}catch(r){let e="",i="";a&&(e=a.context.data.meta.id,i=a.entity.data.meta.id),t.afterError.promise(new tu("Error while sending plays",{cause:r,data:{contextId:e,entityId:i}}))}return Promise.resolve()}sendPartialPlayReport(e,t){let a=e.state.queueState.currentEntity.value;if(!a||!this.validatePlaysRequiredData(a,"send partial play report"))return Promise.resolve();try{let i=this.sentPartialPlayReportIds.has(a.entity.playId),r=a.entity.totalPlayedSeconds;if(!(0,eY.S)(a.context)&&!i&&r>=30.1){let{entity:i}=a,s=this.getDynamicPlaysDataByPlayId(i.playId),l=this.variables.enableSendChangeReason?m.IN_PROGRESS:void 0,n=ta({type:h.PLAYING,contextEntityPair:a,totalPlayedSeconds:r,endPositionSeconds:e.state.playerState.progress.value.position,...s,changeReason:l});return n.data.totalPlayedSeconds>2e3&&t.afterError.promise(new tu("Plays error. Too big play time while trying to send partial play report",{code:"E_PLAYS_BIG_PLAY_TIME",data:{timeStagesOfPlayback:a.entity.timeStagesOfPlayback,contextId:a.context.data.meta.id,entityId:a.entity.data.meta.id,totalPlayedSeconds:n.data.totalPlayedSeconds,trackLengthSeconds:n.data.trackLengthSeconds,playId:n.data.playId,isOnStart:!1,entityListLength:e.state.queueState.entityList.value.length,index:e.state.queueState.index.value,repeat:e.state.queueState.repeat.value}})),this.sendPlayData(n.data).then(()=>{this.variables.enablePartialPlayReporting&&this.sentPartialPlayReportIds.add(n.data.playId)}).catch(e=>{let i="",r="";a&&(i=a.context.data.meta.id,r=a.entity.data.meta.id),t.afterError.promise(new tu("Error while sending plays",{cause:e,data:{contextId:i,entityId:r}}))})}}catch(r){let e="",i="";a&&(e=a.context.data.meta.id,i=a.entity.data.meta.id),t.afterError.promise(new tu("Error while sending plays partial play report",{cause:r,data:{contextId:e,entityId:i}}))}return Promise.resolve()}sendPausePlayReport(e,t){let a=e.state.queueState.currentEntity.value;if(!a||!this.validatePlaysRequiredData(a,"send pause play report"))return Promise.resolve();try{let i=a.entity.totalPlayedSeconds,{entity:r}=a,s=this.getDynamicPlaysDataByPlayId(r.playId),l=ta({type:h.PAUSE,contextEntityPair:a,totalPlayedSeconds:i,endPositionSeconds:e.state.playerState.progress.value.position,...s,changeReason:void 0});return l.data.totalPlayedSeconds>2e3&&t.afterError.promise(new tu("Plays error. Too big play time while trying to send pause play report",{code:"E_PLAYS_BIG_PLAY_TIME",data:{timeStagesOfPlayback:a.entity.timeStagesOfPlayback,contextId:a.context.data.meta.id,entityId:a.entity.data.meta.id,totalPlayedSeconds:l.data.totalPlayedSeconds,trackLengthSeconds:l.data.trackLengthSeconds,playId:l.data.playId,isOnStart:!1,entityListLength:e.state.queueState.entityList.value.length,index:e.state.queueState.index.value,repeat:e.state.queueState.repeat.value}})),this.sendPlayData(l.data).catch(e=>{let i="",r="";a&&(i=a.context.data.meta.id,r=a.entity.data.meta.id),t.afterError.promise(new tu("Error while sending plays",{cause:e,data:{contextId:i,entityId:r}}))})}catch(r){let e="",i="";a&&(e=a.context.data.meta.id,i=a.entity.data.meta.id),t.afterError.promise(new tu("Error while sending plays pause play report",{cause:r,data:{contextId:e,entityId:i}}))}return Promise.resolve()}sendEndEntityPlay(e,t){let a=e.state.queueState.currentEntity.value;if(!a||!this.validatePlaysRequiredData(a,"send end entity play"))return Promise.resolve();try{let i=this.variables.enableRemoveDuplicatePlays,r=!!i&&this.sentPlayIds.has(a.entity.playId),s=this.variables.enableSendChangeReason,l=s&&(0,eY.S)(a.context);if((!(0,eY.S)(a.context)||l)&&!this.sentPlayIds.has(a.entity.playId)&&!r){let r,{entity:l}=a,n=a.entity.totalPlayedSeconds,{changeReason:o,...d}=this.getDynamicPlaysDataByPlayId(l.playId);return i&&this.sentPlayIds.add(l.playId),r=0!==n||s?ta({type:h.END,contextEntityPair:a,totalPlayedSeconds:n,endPositionSeconds:e.state.playerState.progress.value.position,changeReason:s?o:void 0,...d}):ta({type:h.END,contextEntityPair:a,totalPlayedSeconds:.1,endPositionSeconds:.1,...d}),this.dynamicPlaysDataByEntitiesPlayId.delete(r.data.playId),this.variables.enablePartialPlayReporting&&this.sentPartialPlayReportIds.delete(r.data.playId),r.data.totalPlayedSeconds>2e3&&t.afterError.promise(new tu("Plays error. Too big play time",{code:"E_PLAYS_BIG_PLAY_TIME",data:{timeStagesOfPlayback:a.entity.timeStagesOfPlayback,contextId:a.context.data.meta.id,entityId:a.entity.data.meta.id,totalPlayedSeconds:r.data.totalPlayedSeconds,trackLengthSeconds:r.data.trackLengthSeconds,playId:r.data.playId,isOnStart:!1,entityListLength:e.state.queueState.entityList.value.length,index:e.state.queueState.index.value,repeat:e.state.queueState.repeat.value}})),this.sendPlayData(r.data).catch(e=>{let i="",r="";a&&(i=a.context.data.meta.id,r=a.entity.data.meta.id),t.afterError.promise(new tu("Error while sending plays",{cause:e,data:{contextId:i,entityId:r}}))}).finally(()=>{l.data.isRestored&&(l.data.isRestored=!1)})}}catch(r){let e="",i="";a&&(e=a.context.data.meta.id,i=a.entity.data.meta.id),t.afterError.promise(new tu("Error while sending plays",{cause:r,data:{contextId:e,entityId:i}}))}return Promise.resolve()}changeDynamicPlaysDataByPlayId(e){let{playId:t,dynamicData:a}=e,i=this.dynamicPlaysDataByEntitiesPlayId.get(t);this.dynamicPlaysDataByEntitiesPlayId.set(t,{...null!=i?i:{},...null!=a?a:{}})}getDynamicPlaysDataByPlayId(e){var t,a,i;let r=this.dynamicPlaysDataByEntitiesPlayId.get(e);return{seek:null!=(t=null==r?void 0:r.seek)&&t,pause:null!=(a=null==r?void 0:r.pause)&&a,maxPlayerStage:null!=(i=null==r?void 0:r.maxPlayerStage)?i:g.PREPARE,startTimestamp:null==r?void 0:r.startTimestamp,radioSessionId:null==r?void 0:r.radioSessionId,radioBatchId:null==r?void 0:r.radioBatchId,isFromAutoflow:null==r?void 0:r.isFromAutoflow,isFromPumpkin:null==r?void 0:r.isFromPumpkin,changeReason:null==r?void 0:r.changeReason}}constructor(e){(0,N._)(this,"dynamicPlaysDataByEntitiesPlayId",new Map),(0,N._)(this,"sendingInProgressForPlayId",new Map),(0,N._)(this,"sentPlayIds",new Set),(0,N._)(this,"sentPartialPlayReportIds",new Set),(0,N._)(this,"alreadyDislikedPlayIds",new Set),(0,N._)(this,"playsResource",void 0),(0,N._)(this,"playsStore",void 0),(0,N._)(this,"variables",void 0),(0,N._)(this,"storePlaysProgressIntervalMs",void 0),(0,N._)(this,"isSendingPlays",void 0),(0,N._)(this,"hooks",void 0);let{httpClient:t,playsResourceConfig:a,variables:i}=e;this.playsResource=new e7(t,a),this.variables=i||{},this.storePlaysProgressIntervalMs=e.storePlaysProgressIntervalMs||1e4;let r=this.variables.limitOfStoredPlaysData||100;this.playsStore=new ty(r),this.isSendingPlays=new $.cJ(!1)}}function tv(e){return(null==e?void 0:e.data.type)===R.R.Generative}!function(e){e.PLAY="play",e.PAUSE="pause",e.NEXT="nexttrack",e.PREV="previoustrack",e.SEEK="seekto",e.STOP="stop"}(y||(y={}));let tS=[40,50,80,100,200,300,400],tE=[y.PLAY,y.PAUSE,y.STOP,y.SEEK];class tP{isSupported(){return"mediaSession"in window.navigator&&"MediaMetadata"in window}handleMediaActionEvents(e,t){let{action:a}=e;switch(a){case y.PLAY:t.resume();break;case y.PAUSE:case y.STOP:t.pause();break;case y.NEXT:t.moveForward();break;case y.PREV:t.moveBackward();break;case y.SEEK:{var i;if(tv(null==(i=t.state.queueState.currentEntity.value)?void 0:i.entity))return;let{seekTime:a}=e;a&&t.setProgress(a)}}}prepareMetadata(e){let t,a,i={title:e.title};if("artists"in e&&(i.artist=(e.artists||[]).map(e=>e.name).join(", ")),"albums"in e){var r,s;i.album=null==(s=e.albums)||null==(r=s[0])?void 0:r.title}return"coverUri"in e&&(t=e.coverUri),"imageUrl"in e&&(t=e.imageUrl),t&&(a=tS.map(e=>{let a="".concat(e,"x").concat(e);"Safari"===this.browserName&&(a="".concat(2*e,"x").concat(2*e));let i="";return"string"==typeof t&&(i=t.startsWith("blob:")?t:"https://".concat(t.replace("%%",a))),{sizes:a,src:i,type:"image/jpg"}})),i.artwork=a,i}updateMetadata(e){if(!e)return;let t=this.prepareMetadata(e);window.navigator.mediaSession.metadata=new MediaMetadata(t)}handlePlayerEvents(e){let t,a;e.state.playerState.event.onChange(()=>{if(e.state.playerState.event.value===L.Iu.UPDATING_PROGRESS){var t,a;this.updateMetadata(null==(t=e.state.queueState.currentEntity.value)?void 0:t.entity.data.meta),tv(null==(a=e.state.queueState.currentEntity.value)?void 0:a.entity)?navigator.mediaSession.setPositionState({duration:0,position:0}):navigator.mediaSession.setPositionState(),tE.forEach(t=>{try{window.navigator.mediaSession.setActionHandler(t,t=>this.handleMediaActionEvents(t,e))}catch(e){console.log('The media session action "'.concat(t,'" is not supported yet.'))}})}}),e.state.currentContext.onChange(()=>{var i,r;null==t||t(),null==a||a(),t=null==(i=e.state.currentContext.value)?void 0:i.availableActions.moveBackward.onChange(()=>{var t,a;let i=null!=(a=null==(t=e.state.currentContext.value)?void 0:t.availableActions.moveBackward.value)&&a;window.navigator.mediaSession.setActionHandler(y.PREV,i?t=>this.handleMediaActionEvents(t,e):null)}),a=null==(r=e.state.currentContext.value)?void 0:r.availableActions.moveForward.onChange(()=>{var t,a;let i=null!=(a=null==(t=e.state.currentContext.value)?void 0:t.availableActions.moveForward.value)&&a;window.navigator.mediaSession.setActionHandler(y.NEXT,i?t=>this.handleMediaActionEvents(t,e):null)})})}apply(e){let{playback:t}=e;this.isSupported()&&this.handlePlayerEvents(t)}constructor({browserName:e,browserVersion:t}){(0,N._)(this,"browserName",void 0),(0,N._)(this,"browserVersion",void 0),this.browserName=e,this.browserVersion=t}}var tb=a(48429);class tf{apply(e){let{hooks:t,playback:a}=e;t.afterError.tapPromise("LoggerPlugin",e=>{let t,i=a.state.queueState.currentEntity.value?a.state.queueState.currentEntity.value.entity.mediaSourceData:null;(t=e instanceof U.t?e:new U.t("Error in Sonata player",{code:"E_SONATA",cause:e})).name="[Sonata] ".concat(t.name);let r=t.cause instanceof Error?(0,tb.y0)(t.cause):t.cause;return this.logger.error(t,{...t.data,...i||{},code:t.code,cause:r,stack:t.stack,message:t.message}),Promise.resolve()})}constructor(e){(0,N._)(this,"logger",void 0);let{logger:t}=e;this.logger=t}}(p||(p={})).QUALITY_CHANGE="QUALITY_CHANGE";class tI{apply(e){let{playback:t,hooks:a}=e;this.quality.onChange(()=>{t.state.playerState.status.value!==L.MT.IDLE&&t.reloadEntity(p.QUALITY_CHANGE).catch(e=>{a.afterError.promise(e)})})}constructor(e){(0,N._)(this,"quality",void 0),this.quality=e}}var tk=a(71068);let t_=e=>"object"==typeof e&&e&&"rememberPosition"in e&&"boolean"==typeof e.rememberPosition;class tT{apply(e){let{hooks:t,playback:a}=e;t.beforeEntityChange.tapPromise("ContinuePlayingPlugin",()=>{let{position:e,duration:t}=this.getTimingsFromPlayback(a);return new Promise(i=>{e!==t&&this.checkBeforeProgressSync(a),i()})}),a.state.playerState.status.onChange(e=>{(e===L.MT.PAUSED||e===L.MT.STOPPED)&&(this.clearTimeout(),this.checkBeforeProgressSync(a)),e===L.MT.PLAYING&&this.shouldSendProgressSync(a)&&this.setTimeout(a)}),a.state.playerState.event.onChange(()=>{if(a.state.playerState.event.value===L.Iu.SET_PROGRESS){let e=a.state.queueState.currentEntity.value,t=a.state.playerState.progress.value.position;if(!e)return;let{entity:i}=e;t_(i.data.meta)&&i.data.meta.rememberPosition&&(i.lastSeekPosition=t)}}),a.state.queueState.currentEntity.onChange(()=>{let e=a.state.queueState.currentEntity.value;if(!e)return;let{entity:t}=e;if(t_(t.data.meta)&&t.data.meta.rememberPosition&&K(t.data.meta)){let{endPositionSec:e}=t.data.meta.streamProgress;t.everFinished?t.startPosition=e:t.startPosition=Number.isFinite(t.lastSeekPosition)?t.lastSeekPosition:e}})}checkBeforeProgressSync(e){var t;if(this.clearTimeout(),!this.shouldSendProgressSync(e))return;let{position:a,duration:i}=this.getTimingsFromPlayback(e),r=null==(t=e.state.queueState.currentEntity.value)?void 0:t.entity.data.meta.id;Number.isFinite(i)&&Number.isFinite(a)&&i&&a&&r&&(this.sendProgressSync({duration:i,position:a,trackId:r}),e.state.playerState.status.value===L.MT.PLAYING&&this.setTimeout(e))}sendProgressSync(e){let t=new Date().toISOString(),{duration:a,position:i,trackId:r}=e;this.streamsResource.progressSync({lastSyncTimestamp:t,trackStreams:[{trackId:r,positionSec:i,trackLengthSec:a,finished:i===a,timestamp:t}]})}shouldSendProgressSync(e){var t;if(!this.variables.isEnabled)return!1;let a=null==(t=e.state.queueState.currentEntity.value)?void 0:t.entity.data.meta;return!!(a&&"rememberPosition"in a&&a.rememberPosition)}setTimeout(e){this.clearTimeout(),this.timeoutId=window.setTimeout(()=>{this.checkBeforeProgressSync(e)},3e4)}clearTimeout(){window.clearTimeout(this.timeoutId)}getTimingsFromPlayback(e){return{duration:Math.floor(e.state.playerState.progress.value.duration),position:Math.floor(e.state.playerState.progress.value.position)}}constructor(e){(0,N._)(this,"streamsResource",void 0),(0,N._)(this,"variables",void 0),(0,N._)(this,"timeoutId",0);let{httpClient:t,streamsResourceConfig:a,variables:i}=e;this.streamsResource=new tk.c(t,a),this.variables=i}}var tC=a(55845),tA=a(20282);let tD={[tA.N.AACMP4]:"mp4a.40.2",[tA.N.HEAACMP4]:"mp4a.40.5",[tA.N.FLACMP4]:"flac"};class tN{get src(){if("error"in this.data)throw new U.t("Error in DownloadInfoSource data",{data:{error:this.data.error}});if(!this.data.urls[0])throw new U.t("No urls in DownloadInfoSource");let e=this.getQueryParamsString();return e?"".concat(this.data.urls[0]).concat(e):this.data.urls[0]}get mirrorUrls(){if("error"in this.data)throw new U.t("Error in DownloadInfoSource data",{data:{error:this.data.error}});let e=this.getQueryParamsString(),t=this.data.urls.slice(1);return e?t.map(t=>"".concat(t).concat(e)):t}get key(){if("error"in this.data)throw new U.t("Error in DownloadInfoSource data",{data:{error:this.data.error}});if(this.data.transport===tC.o.ENCRAW)return this.data.key}get canBePreloaded(){if("error"in this.data)throw new U.t("Error in DownloadInfoSource data",{data:{error:this.data.error}});return[tA.N.FLACMP4,tA.N.AACMP4,tA.N.HEAACMP4].includes(this.data.codec)}getQueryParamsString(){if("error"in this.data)throw new U.t("Error in DownloadInfoSource data",{data:{error:this.data.error}});let e=tD[this.data.codec],t=e?"mp4":void 0,a=void 0===this.sourceIndex?void 0:String(this.sourceIndex),i=new URLSearchParams;t&&i.append("container",t),e&&i.append("codec",e),this.vsid&&i.append("vsid",this.vsid),a&&i.append("source_index",a);let r=i.toString();return r?"?".concat(r):void 0}constructor(e){(0,N._)(this,"type","downloadInfoSource"),(0,N._)(this,"data",void 0),(0,N._)(this,"vsid",void 0),(0,N._)(this,"sourceIndex",void 0),(0,N._)(this,"loadingTime",void 0),(0,N._)(this,"getFileInfoResponseTime",void 0),(0,N._)(this,"url",void 0),this.data=e.data,this.vsid=e.vsid,this.loadingTime=e.loadingTime,this.getFileInfoResponseTime=e.getFileInfoResponseTime,this.url=e.url,this.sourceIndex=e.sourceIndex}}!function(e){e.WANT_PLAY_TRACK="WANT_PLAY_TRACK",e.TRACK_IS_BUFFERING="TRACK_IS_BUFFERING",e.TRACK_IS_PLAYING="TRACK_IS_PLAYING",e.TRACK_IS_PLAYING_MISSED="TRACK_IS_PLAYING_MISSED",e.TRACK_ERROR_PREPARE="TRACK_ERROR_PREPARE",e.TRACK_ERROR_INITIAL_BUFFERING="TRACK_ERROR_INITIAL_BUFFERING",e.TRACK_ERROR_PLAYING="TRACK_ERROR_PLAYING",e.REQUEST_TIME="REQUEST_TIME"}(v||(v={})),(S||(S={})).GET_FILE_INFO="get_file_info",function(e){e.E_GET_MEDIA_SRC="E_GET_MEDIA_SRC",e.E_CREATE_SIGN="E_CREATE_SIGN",e.E_UNSUITABLE_ENTITY_TYPE="E_UNSUITABLE_ENTITY_TYPE"}(E||(E={})),function(e){e.NETWORK="NETWORK",e.OTHER="OTHER"}(P||(P={})),!function(e){e.BAD_RESPONSE_4XX="BAD_RESPONSE_4XX",e.BAD_RESPONSE_5XX="BAD_RESPONSE_5XX",e.OTHER="OTHER"}(b||(b={}));var tL=a(493),tx=a(43090);function tR(e){switch(e){case tL.e.LOSSLESS:case tx.e.HIGH_QUALITY:return f.LOSSLESS;case tL.e.NQ:case tx.e.BALANCED:return f.NQ;case tL.e.LQ:case tx.e.EFFICIENT:return f.LQ;case tL.e.PREVIEW:case tx.e.PREVIEW:return f.PREVIEW;case tL.e.SMART_PREVIEW:return f.SMART_PREVIEW;default:return}}!function(e){e.LOSSLESS="Lossless",e.NQ="NQ",e.LQ="LQ",e.PREVIEW="Preview",e.SMART_PREVIEW="SmartPreview"}(f||(f={})),function(e){e.SKIPPED="SKIPPED",e.NEXT="NEXT",e.FROM_QUEUE="FROM_QUEUE",e.OTHER="OTHER"}(I||(I={}));class tw{getEntityQualityInfo(e){let t,a,i;return!e.mediaSourceData||"error"in e.mediaSourceData.data||"downloadInfoSource"!==e.mediaSourceData.type||(t=e.mediaSourceData.data.codec,a=e.mediaSourceData.data.bitrate),e.expectedQuality&&(i=tR(e.expectedQuality)),{codec:t,bitrate:a,expectedQuality:i}}logEvent(e){let{event:t,eventName:a}=e;this.enableDebugMode&&(t?(console.group("".concat(null!=a?a:"Untitled Log Metrics Event Info")),console.table(t.data),console.group("Raw event"),console.dir(t),console.groupEnd(),console.groupEnd()):console.error("Event in logEvent method not provided"))}requestTime(e){var t,a;if(!(e.mediaSourceData instanceof tN))return null;let i=String(e.data.meta.id),r=null==(t=e.mediaSourceData)?void 0:t.getFileInfoResponseTime,s=null==(a=e.mediaSourceData)?void 0:a.url,l=null;return"number"==typeof r&&s&&(l={name:v.REQUEST_TIME,data:{trackId:i,urlType:S.GET_FILE_INFO,url:s,time:r}}),this.logEvent({event:l,eventName:null==l?void 0:l.name}),l&&this.transport.send(l),l}wantPlayTrack(e){let t=String(e.data.meta.id),a=Math.trunc(performance.now()),i={name:v.WANT_PLAY_TRACK,data:{trackId:t,uuid:e.playId,expectedQuality:tR(this.mediaConfigController.quality.value)}};return this.wantPlayTracksEvents.size>0&&this.sendTrackIsPlayingMissed(),this.wantPlayTracksEvents.set(e.playId,{time:a,event:i,trackId:t}),this.logEvent({event:i,eventName:null==i?void 0:i.name}),this.transport.send(i),i}trackError(e,t){let{codec:a,bitrate:i,expectedQuality:r}=this.getEntityQualityInfo(t),s=null;return e instanceof e8?s={name:v.TRACK_ERROR_PREPARE,data:{trackId:String(t.data.meta.id),uuid:t.playId,type:e.code===E.E_GET_MEDIA_SRC?P.NETWORK:P.OTHER,subType:function(e){let t=b.OTHER;if(e.cause instanceof e1.GX)switch(String(e.cause.statusCode)[0]){case"4":t=b.BAD_RESPONSE_4XX;break;case"5":t=b.BAD_RESPONSE_5XX}return t}(e),name:e.name,code:e.code,bitrate:i,codec:a,expectedQuality:r}}:e instanceof L.LI&&e.code===L.QC.PLAY?s={name:v.TRACK_ERROR_INITIAL_BUFFERING,data:{trackId:String(t.data.meta.id),uuid:t.playId,name:e.name,code:e.code,bitrate:i,codec:a,expectedQuality:r,...e.cause instanceof DOMException?{causeCode:e.cause.code,causeMessage:e.cause.message,causeName:e.cause.name}:{causeCode:-1,causeMessage:"Unknown error message",causeName:"Unknown error name"}}}:e instanceof L.LI&&e.code===L.QC.MEDIA_ELEMENT_ERROR&&(s={name:v.TRACK_ERROR_PLAYING,data:{trackId:String(t.data.meta.id),uuid:t.playId,name:e.name,code:e.code,bitrate:i,codec:a,expectedQuality:r,...e.cause instanceof MediaError?{causeCode:e.cause.code,causeMessage:e.cause.message}:{causeCode:-1,causeMessage:"Unknown cause"}}}),e instanceof L.LI&&this.wantPlayTracksEvents.has(t.playId)&&(!s||!("causeCode"in s.data)||"causeCode"in s.data&&(null==s?void 0:s.data.causeCode)!==20)&&this.wantPlayTracksEvents.delete(t.playId),s&&this.transport.send(s),this.logEvent({event:s,eventName:null==s?void 0:s.name}),s}trackIsBuffering(e){let t=String(e.data.meta.id),{codec:a,bitrate:i}=this.getEntityQualityInfo(e);if(0===e.totalPlayedSeconds)return null;let r={name:v.TRACK_IS_BUFFERING,data:{trackId:t,uuid:e.playId,codec:a,bitrate:i}};return this.transport.send(r),this.logEvent({event:r,eventName:r.name}),r}trackIsPlaying(e){var t,a;let i=String(e.data.meta.id),r=this.wantPlayTracksEvents.has(e.playId)&&(null==(t=this.wantPlayTracksEvents.get(e.playId))?void 0:t.time),s=function(e){switch(e){case L.So.SET_INDEX:case L.So.MOVE_BACKWARD:return I.FROM_QUEUE;case L.So.AUTO_MOVE_FORWARD:return I.NEXT;case L.So.MOVE_FORWARD:return I.SKIPPED;default:return I.OTHER}}(null==(a=this.addtionalInfoByPlayId.get(this.lastAdditionalInfoKey))?void 0:a.entityChangeMethod),{codec:l,bitrate:n,expectedQuality:o}=this.getEntityQualityInfo(e),d=null;return"number"==typeof r&&(d={name:v.TRACK_IS_PLAYING,data:{trackId:i,time:Math.trunc(performance.now()-r),uuid:e.playId,codec:l,bitrate:n,expectedQuality:o,extraTrackType:s}},this.addtionalInfoByPlayId.delete(this.lastAdditionalInfoKey),this.wantPlayTracksEvents.delete(e.playId),this.lastAdditionalInfoKey=null),d&&this.transport.send(d),this.logEvent({event:d,eventName:null==d?void 0:d.name}),d}sendTrackIsPlayingMissed(){let[e,{trackId:t}]=Array.from(this.wantPlayTracksEvents.entries())[0],a={name:v.TRACK_IS_PLAYING_MISSED,data:{trackId:t,uuid:e}};return this.wantPlayTracksEvents.delete(e),this.transport.send(a),this.logEvent({event:a,eventName:a.name}),a}trackHasBeenChanged(e,t){let{method:a}=t;this.addtionalInfoByPlayId.size&&this.addtionalInfoByPlayId.clear(),this.lastAdditionalInfoKey=e.playId,this.addtionalInfoByPlayId.set(e.playId,{entityChangeMethod:a})}constructor(e){var t;(0,N._)(this,"mediaConfigController",void 0),(0,N._)(this,"wantPlayTracksEvents",new Map),(0,N._)(this,"addtionalInfoByPlayId",new Map),(0,N._)(this,"lastAdditionalInfoKey",null),(0,N._)(this,"enableDebugMode",void 0),(0,N._)(this,"transport",void 0),this.enableDebugMode=null==(t=e.variables)?void 0:t.enableDebugMode,this.mediaConfigController=e.mediaConfigController,this.transport=e.transport}}class tG{apply(e){let{hooks:t,playback:a}=e;a.state.playerState.event.onChange(()=>{let e=a.state.playerState.event.value;if(e===L.Iu.WAITING&&this.recentMediaPlayerEventType!==L.Iu.SETTING_PROGRESS){let e=a.state.queueState.currentEntity.value;e&&this.metricsEventsStore.trackIsBuffering(e.entity)}this.recentMediaPlayerEventType=e}),t.beforeEntityChange.tapPromise("MetricsPlugin",e=>{let t=a.state.queueState.currentEntity.value;return t&&this.metricsEventsStore.trackHasBeenChanged(t.entity,e),Promise.resolve()}),t.beforeEntityPlayingProcessStart.tapPromise("MetricsPlugin",()=>{let e=a.state.queueState.currentEntity.value;return e&&this.metricsEventsStore.wantPlayTrack(e.entity),Promise.resolve()}),t.afterError.tapPromise("MetricsPlugin",e=>{let t=a.state.queueState.currentEntity.value;return t&&this.metricsEventsStore.trackError(e,t.entity),Promise.resolve()}),t.afterMediaStartPlaying.tapPromise("MetricsPlugin",()=>{let e=a.state.queueState.currentEntity.value;return e&&this.metricsEventsStore.trackIsPlaying(e.entity),Promise.resolve()}),t.beforeMediaStartPlaying.tapPromise("MetricsPlugin",()=>{let e=a.state.queueState.currentEntity.value;return e&&this.metricsEventsStore.requestTime(e.entity),Promise.resolve()})}constructor(e){(0,N._)(this,"metricsEventsStore",void 0),(0,N._)(this,"recentMediaPlayerEventType",null),this.metricsEventsStore=new tw(e)}}function tK(e,t,a){return!(e instanceof j)&&!!e.isAvailable&&(null===e.mediaSourceData||!("downloadInfoSource"!==e.mediaSourceData.type||"error"in e.mediaSourceData.data||e2(e))&&(!!(performance.now()-e.mediaSourceData.loadingTime>t)||function(e){switch(e){case tL.e.LOSSLESS:case tL.e.HQ:return tx.e.HIGH_QUALITY;case tL.e.NQ:return tx.e.BALANCED;case tL.e.LQ:}return tx.e.EFFICIENT}(e.mediaSourceData.data.quality)!==a.quality.value))}class tO{apply(e){let{hooks:t,playback:a}=e;this.variables.isMediaSourcePreloadEnabled&&(a.state.queueState.nextEntity.onChange(()=>{this.preload(a,t)}),this.mediaConfigController.quality.onChange(()=>{this.realeaseAllPreloadedSrc(a),this.preload(a,t)}))}preloadStrmUrls(e){let{queueState:{order:t,entityList:a,nextIndex:i}}=e.state;if(null!==i.value){let e=function(e){let{preloadCount:t,contextEntityPairs:a,index:i,order:r}=e,s=0,l=i,n=[];for(;s<t&&!(l>=r.length);){let e=r[l];void 0!==e&&n.push(e),l+=1,s+=1}return n.map(e=>a[e])}({contextEntityPairs:a.value,index:i.value,order:t.value,preloadCount:this.config.entitiesToPreloadStrmUrlsCount}),r=(function(e){let{contextEntityPairs:t,mediaSourceTtlMs:a,mediaConfigController:i}=e;return t.filter(e=>tK(e.entity,a,i))})({contextEntityPairs:e,mediaSourceTtlMs:this.config.strmUrlsTtlMs,mediaConfigController:this.mediaConfigController}).map(e=>e.entity);return 0===r.length?Promise.resolve([]):this.mediaProvider.getMediaSourceBatch({entities:r}).then(()=>e)}return Promise.resolve([])}preloadSources(e,t,a){return 0===a.length?Promise.resolve():(this.releaseRedundantPreloadedSrc(e,a.length),Promise.allSettled(a.slice(0,this.config.entitiesToPreloadSourceCount).map(a=>e.preloadSrc({entity:a.entity,bufferGoal:this.config.bufferGoal,startPosition:a.entity.startPosition}).then(()=>{this.preloadedSrcArray.push(structuredClone(a.entity.mediaSourceData))}).catch(e=>t.afterError.promise(e)))).then(()=>Promise.resolve()))}preload(e,t){this.preloadStrmUrls(e).then(a=>{this.preloadSources(e,t,a).catch(e=>t.afterError.promise(e))}).catch(e=>t.afterError.promise(e))}releaseRedundantPreloadedSrc(e,t){if(!(this.preloadedSrcArray.length+t<=this.config.preloadedSourcesMaxCount))for(;this.preloadedSrcArray.length+t!==this.config.preloadedSourcesMaxCount;){let t=this.preloadedSrcArray.shift();t&&e.releaseSrc(t)}}realeaseAllPreloadedSrc(e){for(;this.preloadedSrcArray.length;){let t=this.preloadedSrcArray.shift();t&&e.releaseSrc(t)}}constructor({mediaProvider:e,config:t,mediaConfigController:a,variables:i}){var r;(0,N._)(this,"variables",void 0),(0,N._)(this,"mediaProvider",void 0),(0,N._)(this,"config",void 0),(0,N._)(this,"mediaConfigController",void 0),(0,N._)(this,"preloadedSrcArray",[]),this.variables={isMediaSourcePreloadEnabled:null!=(r=null==i?void 0:i.isMediaSourcePreloadEnabled)&&r},this.mediaProvider=e,this.mediaConfigController=a,this.config=t}}class tM{apply(){this.trailerPlayback.hooks.afterContextEnd.tapPromise("TrailerPlugin",()=>(this.trailerPlayback.restartContext({playAfterRestart:!1}),Promise.resolve())),this.trailerPlayback.hooks.afterMediaPause.tapPromise("TrailerPlugin",()=>(this.onTrailerPaused(),Promise.resolve())),this.trailerPlayback.hooks.afterMediaStartPlaying.tapPromise("TrailerPlugin",()=>(this.onTrailerPlaying(),Promise.resolve())),this.trailerPlayback.hooks.afterMediaResume.tapPromise("TrailerPlugin",()=>(this.onTrailerPlaying(),Promise.resolve()))}constructor({onTrailerPaused:e,onTrailerPlaying:t,playbackController:a,trailerPlaybackParams:i}){if((0,N._)(this,"onTrailerPaused",void 0),(0,N._)(this,"onTrailerPlaying",void 0),(0,N._)(this,"trailerPlayback",void 0),this.onTrailerPaused=e,this.onTrailerPlaying=t,a.createPlayback(i.id,{factory:i.factory,entityProvider:i.entityProvider,playbackConfig:i.playbackConfig,mediaPlayerParams:i.mediaPlayerParams,syncVolumeWithMainPlayback:!0}),this.trailerPlayback=a.getPlayback(i.id),i.plugins)for(let e of i.plugins)e.apply({playback:this.trailerPlayback,hooks:this.trailerPlayback.hooks})}}var tX=a(54960);(k||(k={})).START="start";class tF{apply(e){let{playback:t}=e;this.channel&&(this.channel.onmessage=e=>{let{type:a,id:i}=e.data;t.state.playerState.status.value===L.MT.PLAYING&&a===k.START&&i!==this.activeStreamId&&t.pause()},t.state.playerState.status.onChange(e=>{if(e===L.MT.PLAYING){var t;null==(t=this.channel)||t.postMessage({type:k.START,id:this.activeStreamId})}}))}constructor(){(0,N._)(this,"channel",void 0),(0,N._)(this,"activeStreamId",void 0),this.activeStreamId=(0,tX.A)(),this.channel=new BroadcastChannel("ya_music_playback")}}class tj{push(e){this.callbacks.push(e)}exec(){let e=[];for(let t of this.callbacks)if(0===e.length)e.push(t());else{let a=e[e.length-1].then(t);e.push(a)}return Promise.allSettled(e).then(()=>Promise.resolve())}constructor(){(0,N._)(this,"callbacks",[])}}let tU={ynisonToPlayback:e=>{switch(e){case tb.ot.ONE:return L.pM.ONE;case tb.ot.ALL:return L.pM.CONTEXT;default:return L.pM.NONE}}};class tV extends U.t{constructor(e,{code:t="E_YNISON",...a}={}){super(e,{code:t,...a}),(0,N._)(this,"name","YnisonException"),Object.setPrototypeOf(this,tV.prototype)}}let tB=(e,t)=>new tV("[YnisonException] ".concat(e),{cause:(0,tb.y0)(t)}),tq=e=>{let{playableList:t,getEntityData:a,restoredParams:{currentPlayableIndex:i}={}}=e,r=t.filter(e=>{let{playable_type:t,playable_id:a}=e;return t===tb.yi.TRACK&&a}).map(a),s="number"==typeof i&&r[i];return s&&(s.isRestored=!0),r};function tY(e){return{type:L.z4.Unloaded,meta:{id:e.playable_id,albumId:e.album_id_optional}}}function tW(e){var t,a;return{type:R.R.VibeTrack,meta:{id:e.playable_id,albumId:e.album_id_optional},loadEntityMeta:!0,wasPlayed:!0,batchId:null!=(a=null==(t=e.track_info)?void 0:t.batch_id_optional)?a:void 0}}let tz=e=>!isNaN(Number(e))&&Number(e)>0,tH=e=>{var t,a;let i=null==(t=e.player_state)?void 0:t.player_queue,r=(null==i?void 0:i.playable_list)||[];return i.from_optional||(null==(a=r[0])?void 0:a.from)||"embedded-radio"},tQ=e=>{var t,a,i,r;let s=null==(t=e.player_state)?void 0:t.player_queue,l=(null==s?void 0:s.playable_list)||[],n=null==(r=l[null==(i=e.player_state)||null==(a=i.player_queue)?void 0:a.current_playable_index])?void 0:r.playable_id;return n&&l.length?{type:H.K.Various,from:tH(e),meta:{id:n}}:null},t$=e=>{var t,a,i,r,s;let l=null!=(s=null==(a=e.player_state)||null==(t=a.player_queue)?void 0:t.current_playable_index)?s:0;return((null==(r=e.player_state)||null==(i=r.player_queue)?void 0:i.playable_list)||[]).slice(0,l+1)};function tJ(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];switch(e.state.playerState.status.value){case L.MT.PLAYING:return!1;case L.MT.PAUSED:case L.MT.STOPPED:case L.MT.IDLE:return!0;default:return t}}class tZ{onYnisonStateUpdated(e){this.variables.shouldApplyState&&this.applyYnisonDiff(e)}applyYnisonDiff(e){var t,a,i,r,s,l;let n=new tj;if((l=e.diff).player_state&&l.player_state.player_queue&&(void 0!==l.player_state.player_queue.current_playable_index||l.player_state.player_queue.playable_list||l.player_state.player_queue.entity_id||0)&&n.push(()=>this.changeContext(e.state)),null==(a=e.diff.player_state)||null==(t=a.player_queue)?void 0:t.shuffle_optional){let t=e.diff.player_state.player_queue.shuffle_optional;n.push(()=>this.changeShuffle(t))}if(null==(r=e.diff.player_state)||null==(i=r.player_queue)?void 0:i.options){let t=e.diff.player_state.player_queue.options;e.state.player_state.player_queue.entity_type===tb.$P.RADIO&&(t={repeat_mode:tb.ot.NONE}),n.push(()=>this.changeOptions(t))}if(null==(s=e.diff.player_state)?void 0:s.status){let t=e.diff.player_state.status;n.push(()=>this.changeStatus(t))}return n.exec()}changeOptions(e){let t=tU.ynisonToPlayback(e.repeat_mode);return this.playback.setRepeatMode(t),Promise.resolve()}changeShuffle(e){let t=!!(Array.isArray(e.playable_indices)&&e.playable_indices.length);return this.playback.setShuffle(t),Promise.resolve()}changeStatus(e){let t=new tj,a=Number(e.playback_speed),i=Number(e.progress_ms)/1e3;return Number.isNaN(a)||t.push(()=>this.playback.setSpeed(a).then(()=>Promise.resolve())),Number.isNaN(i)||t.push(()=>{let e=this.playback.state.playerState.status.value===L.MT.PLAYING,t=Math.abs(this.playback.state.playerState.progress.value.position-i);if(e&&t>tb.O5)return this.playback.setProgress(i).then(()=>Promise.resolve());let{currentEntity:{value:a}}=this.playback.state.queueState;return a&&(a.entity.startPosition=i),Promise.resolve()}),void 0!==e.paused&&e.paused!==tJ(this.playback,e.paused)&&t.push(()=>this.playback.togglePause()),t.exec()}changeContext(e){let t=this.getContextParams(e);return t?this.playback.setContext(t).then(()=>{let e=this.playback.state.queueState.currentEntity.value;return e&&!e.entity.hasPlayId()&&(e.entity.playId=(0,tX.A)()),this.playback.stop()}).then(()=>{void 0!==e.player_state.status.paused&&e.player_state.status.paused!==tJ(this.playback,e.player_state.status.paused)&&this.playback.togglePause()}).catch(e=>{this.playback.hooks.afterError.promise(tB("PlaybackSetContextError",e))}):Promise.resolve()}getContextParams(e){try{var t,a;let i=(e=>{var t;let a=null==(t=e.player_state)?void 0:t.player_queue,i=null==a?void 0:a.entity_type;if(!i)return null;switch(i){case tb.$P.ALBUM:var r,s=e;let l=null==(r=s.player_state)?void 0:r.player_queue,n=null==l?void 0:l.entity_id;return tz(n)?{type:H.K.Album,from:tH(s),meta:{id:n}}:tQ(s);case tb.$P.ARTIST:var o,d=e;let u=null==(o=d.player_state)?void 0:o.player_queue,c=null==u?void 0:u.entity_id;return tz(c)?{type:H.K.Artist,from:tH(d),meta:{id:c}}:tQ(d);case tb.$P.PLAYLIST:return(e=>{var t;let a=null==(t=e.player_state)?void 0:t.player_queue,i=null==a?void 0:a.entity_id,r=tH(e),[s,l]=String(i).split(":");if(tz(s)&&tz(l)){let e={uid:Number(s)};return{type:H.K.Playlist,from:r,meta:{id:i,kind:Number(l),owner:e}}}return tQ(e)})(e);case tb.$P.RADIO:return(e=>{var t,a,i,r,s;let l=null==(t=e.player_state)?void 0:t.player_queue,n=t$(e),o=null==l?void 0:l.entity_id,d=null==(s=l.queue)||null==(r=s.wave_queue)||null==(i=r.entity_options)||null==(a=i.wave_entity_optional)?void 0:a.session_id,u=n.map(e=>e.album_id_optional?"".concat(e.playable_id,":").concat(e.album_id_optional):e.playable_id);return"string"==typeof o||d?{type:H.K.Vibe,from:tH(e),seeds:String(o).split(","),includeTracksInResponse:!0,cloneSessionId:d,meta:{id:o},queue:u,interactive:!1}:tQ(e)})(e);case tb.$P.GENERATIVE:var g,m,h=e;let y=null==(g=h.player_state)?void 0:g.player_queue,[p,v]=(null==y||null==(m=y.entity_id)?void 0:m.split(" "))||[];return p?{type:H.K.Generative,from:tH(h),meta:{id:p,stream:v?{id:p,url:v}:void 0}}:null;case tb.$P.VARIOUS:return tQ(e);default:return null}})(e);if(!i)return null;let r=this.factory.createContext({data:i}),s=null==(a=e.player_state)||null==(t=a.player_queue)?void 0:t.playable_list,l=(e=>{var t,a,i,r;let s=(null==(a=e.player_state)||null==(t=a.player_queue)?void 0:t.current_playable_index)||0,l=((null==(r=e.player_state)||null==(i=r.player_queue)?void 0:i.playable_list)||[])[s];return l?{entityId:l.playable_id,index:s}:{index:0}})(e);if((0,eC.i)(r)){let t=this.variables.enableLimitTracksFromYnison?t$(e):s,a=tq({playableList:t,getEntityData:tW,restoredParams:{currentPlayableIndex:e.player_state.player_queue.current_playable_index}});return{context:r,entitiesData:a.length?a:void 0,loadContextMeta:!0,queueParams:l}}let n=tq({playableList:s,getEntityData:tY,restoredParams:{currentPlayableIndex:e.player_state.player_queue.current_playable_index}});if((0,e5.p)(r))return{context:r,entitiesData:n,loadContextMeta:!1,queueParams:l};if((0,eY.S)(r))return{context:r,loadContextMeta:!0};if(200===s.length)return{context:r,loadContextMeta:!0,queueParams:l};return{context:r,entitiesData:n,loadContextMeta:!0,queueParams:l}}catch(e){return this.playback.hooks.afterError.promise(tB("GetContextParamsError",e)),null}}destroy(){this.unlisteners.forEach(e=>e())}constructor({factory:e,playback:t,ynisonStateController:a,variables:i}){(0,N._)(this,"factory",void 0),(0,N._)(this,"playback",void 0),(0,N._)(this,"variables",void 0),(0,N._)(this,"unlisteners",void 0),this.factory=e,this.playback=t,this.variables=i,this.unlisteners=[];let r=a.on(tb.p$.UPDATED,this.onYnisonStateUpdated.bind(this),"YnisonPlugin");this.unlisteners.push(r),this.onYnisonStateUpdated(a.fullState)}}let t0=e=>{var t,a,i,r,s,l,n;switch(null==(t=e.state.queueState.currentEntity.value)?void 0:t.entity.data.type){case R.R.Music:case R.R.VibeTrack:return(null==(a=e.state.currentContext.value)?void 0:a.data.meta.id)?String(null==(i=e.state.currentContext.value)?void 0:i.data.meta.id):"";case R.R.Generative:return(null==(r=e.state.currentContext.value)?void 0:r.data.meta.id)?String(null==(s=e.state.currentContext.value)?void 0:s.data.meta.id):"";default:return(null==(l=e.state.currentContext.value)?void 0:l.data.meta.id)?String(null==(n=e.state.currentContext.value)?void 0:n.data.meta.id):""}},t1=e=>{switch(e){case H.K.Album:return tb.$P.ALBUM;case H.K.Playlist:return tb.$P.PLAYLIST;case H.K.Artist:return tb.$P.ARTIST;case H.K.Vibe:return tb.$P.RADIO;case H.K.Various:return tb.$P.VARIOUS;case H.K.Generative:return tb.$P.GENERATIVE;default:return tb.$P.VARIOUS}},t3=e=>{var t,a,i;return(e=>"object"==typeof e&&e&&"durationMs"in e&&"number"==typeof e.durationMs)(null==(t=e.state.queueState.currentEntity.value)?void 0:t.entity.data.meta)&&null!=(i=null==(a=e.state.queueState.currentEntity.value)?void 0:a.entity.data.meta.durationMs)?i:0},t6=function(e){var t,a,i,r,s,l,n,o,d,u,c,g;let{entity:m}=e,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";switch(m.data.type){case R.R.Music:return{album_id_optional:"number"==typeof(null==(a=m.data.meta.albums)||null==(t=a[0])?void 0:t.id)?String(null==(i=m.data.meta.albums)?void 0:i[0].id):null,from:h,playable_id:String(m.data.meta.id),playable_type:tb.yi.TRACK,title:null!=(r=m.data.meta.title)?r:"",cover_url_optional:null!=(s=m.data.meta.coverUri)?s:null,navigation_id_optional:null,playback_action_id_optional:null};case R.R.Generative:return{album_id_optional:null,from:h,playable_id:"",playable_type:tb.yi.INFINITE,title:null!=(l=m.data.meta.title)?l:"",cover_url_optional:null,navigation_id_optional:null,playback_action_id_optional:null};case R.R.VibeTrack:return{album_id_optional:"number"==typeof(null==(o=m.data.meta.albums)||null==(n=o[0])?void 0:n.id)?String(null==(d=m.data.meta.albums)?void 0:d[0].id):null,from:h,playable_id:String(m.data.meta.id),playable_type:tb.yi.TRACK,title:null!=(u=m.data.meta.title)?u:"",cover_url_optional:null!=(c=m.data.meta.coverUri)?c:null,track_info:{batch_id_optional:null!=(g=m.data.batchId)?g:null,track_source_key:0},navigation_id_optional:null,playback_action_id_optional:null};default:return{album_id_optional:null,from:h,playable_id:String(m.data.meta.id),playable_type:tb.yi.TRACK,title:"",cover_url_optional:null,navigation_id_optional:null,playback_action_id_optional:null}}};function t7(e){return e.entity.hidden}class t8{subscribeOnPlayerEvents(){let e=this.playback.state.playerState.status.onChange(e=>{switch(e){case L.MT.PLAYING:case L.MT.PAUSED:this.updateYnisonState()}}),t=this.playback.state.playerState.event.onChange(e=>{switch(e){case L.Iu.SET_PROGRESS:this.ynisonStateController.currentState.player_state.status.progress_ms/1e3!==this.playback.state.playerState.progress.value.position&&this.updateYnisonState();break;case L.Iu.SET_SPEED:this.ynisonStateController.currentState.player_state.status.playback_speed!==this.playback.state.playerState.speed.value&&this.updateYnisonState()}}),a=this.playback.state.playerState.speed.onChange(()=>{this.updateYnisonState()}),i=this.playback.state.queueState.repeat.onChange(()=>{this.updateYnisonState()}),r=this.playback.state.queueState.shuffle.onChange(()=>{this.updateYnisonState()}),s=this.playback.state.queueState.currentEntity.onChange(()=>{this.updateYnisonState({useYnisonStatus:!0})}),l=this.playback.state.queueState.entityList.onChange(()=>{this.updateYnisonState({useYnisonStatus:!0})}),n=this.playback.state.queueState.index.onChange(()=>{this.updateYnisonState({useYnisonStatus:!0})}),o=this.playback.state.queueState.order.onChange(()=>{this.updateYnisonState({useYnisonStatus:!0})});this.unsubscribeFromPlayerEvents=()=>{e(),t(),i(),r(),a(),s(),l(),n(),o()}}updateYnisonState(e){setTimeout(()=>{let t=function(e){var t,a,i,r,s,l,n,o,d,u;let{playback:c,ynisonStateController:g,deviceConfig:m,variables:h}=e,{devices:y,active_device_id_optional:p,player_state:{player_queue_inject_optional:v,status:S}}=g.currentState,E=function(e,t){let a=e.state.queueState.index.value,i=e.state.queueState.entityList.value;return t.enableSendLimitedEntityListToYnison&&(i=i.filter(e=>!t7(e))),(0,eC.i)(e.state.currentContext.value)&&t.enableSendLimitedEntityListToYnison&&(i=ed(e.state.queueState.entityList.value,a)),i}(c,h),P=(l=null==(t=c.state.currentContext.value)?void 0:t.from,E.map(e=>t6(e,l))),{playableIndices:b,currentPlayableIndex:f,playableList:I}=function(e){let{playableList:t,currentPlayableIndex:a,playback:i,newIndexOrderMap:r,variables:s}=e,l=i.state.queueState.order.value;if(s.enableSendLimitedEntityListToYnison&&(l=l.filter(e=>r.has(e)).map(e=>r.get(e))),t.length<=200)return{playableList:t,currentPlayableIndex:a,playableIndices:l};if(i.state.queueState.shuffle.value){let e=l.indexOf(a),i=l.slice(e,200),r=[...i].sort((e,t)=>e-t).map(e=>t[e]),s=new Map,n=i.map(e=>{var a;let i=t[e].playable_id,l=null!=(a=s.get(i))?a:-1,n=r.findIndex((e,t)=>t>l&&e.playable_id===i);return s.set(i,n),n}),o=r.findIndex(e=>e.playable_id===t[a].playable_id);return{playableList:r,currentPlayableIndex:o,playableIndices:n}}let n=t[a].playable_id,o=Math.max(0,a-100);o+200>t.length&&(o=t.length-200);let d=t.slice(o,o+200),u=d.findIndex(e=>e.playable_id===n);return{playableList:d,currentPlayableIndex:u,playableIndices:l}}({playableList:P,currentPlayableIndex:function(e,t){let{order:{value:a},index:{value:i},entityList:{value:r}}=e.state.queueState,s=a[i];if("number"!=typeof s)return -1;let l=r[s];return t.findIndex(e=>{let{entity:t}=e;return t.data.meta.id===(null==l?void 0:l.entity.data.meta.id)})}(c,E),newIndexOrderMap:function(e,t){let a=new Map,i=0;for(let r=0;r<e.length;r++){let s=e[r];s&&!t(s)&&(a.set(r,i),i++)}return a}(c.state.queueState.entityList.value,t7),playback:c,variables:h}),k=null!=(r=h.forcePause)?r:tJ(c,S.paused),_={duration_ms:t3(c),progress_ms:(e=>{var t;let a=1e3*Math.floor(e.state.playerState.progress.value.position),i=t3(e);return(null==(t=e.state.queueState.currentEntity.value)?void 0:t.context.data.type)===H.K.Generative?0:a<i?a:0})(c),paused:k,playback_speed:c.state.playerState.speed.value,version:(0,tb.fD)(m.device_id,0)};return{active_device_id_optional:p,devices:y,player_state:{player_queue_inject_optional:v,status:h.useYnisonStatus?S:_,player_queue:{entity_id:t0(c),entity_type:t1(null==(a=c.state.currentContext.value)?void 0:a.data.type),current_playable_index:f,playable_list:I,shuffle_optional:c.state.queueState.shuffle.value?{playable_indices:b}:null,options:{repeat_mode:(e=>{switch(e){case L.pM.NONE:return tb.ot.NONE;case L.pM.ONE:return tb.ot.ONE;case L.pM.CONTEXT:return tb.ot.ALL;default:return tb.ot.NONE}})(c.state.queueState.repeat.value)},entity_context:tb.oh.BASED_ON_ENTITY_BY_DEFAULT,from_optional:null!=(s=null==(i=c.state.currentContext.value)?void 0:i.from)?s:null,initial_entity_optional:(0,eY.S)(null==(n=c.state.queueState.currentEntity.value)?void 0:n.context)?{entity_id:t0(c),entity_type:t1(null==(o=c.state.currentContext.value)?void 0:o.data.type)}:null,adding_options_optional:(0,eC.i)(null==(d=c.state.queueState.currentEntity.value)?void 0:d.context)&&(null==(u=c.state.queueState.currentEntity.value)?void 0:u.context.data.meta.session)?{radio_options:{session_id:c.state.queueState.currentEntity.value.context.data.meta.session.radioSessionId}}:null,queue:null,version:(0,tb.fD)(m.device_id,0)}}}}({playback:this.playback,ynisonStateController:this.ynisonStateController,deviceConfig:this.deviceConfig,variables:{...this.variables,...e}});this.ynisonStateController.updateState({newState:t,skipVersionCompare:!0,trigger:"YnisonPlugin"})},0)}destroy(){var e;null==(e=this.unsubscribeFromPlayerEvents)||e.call(this),this.updateYnisonState({forcePause:!0})}constructor({playback:e,ynisonStateController:t,deviceConfig:a,variables:i}){(0,N._)(this,"unsubscribeFromPlayerEvents",void 0),(0,N._)(this,"playback",void 0),(0,N._)(this,"ynisonStateController",void 0),(0,N._)(this,"deviceConfig",void 0),(0,N._)(this,"variables",void 0),this.playback=e,this.ynisonStateController=t,this.deviceConfig=a,this.variables=i,this.subscribeOnPlayerEvents(),this.updateYnisonState()}}class t4{apply(e){let{playback:t,hooks:a}=e,i=new tZ({playback:t,factory:this.factory,ynisonStateController:this.ynisonStateController,variables:this.variables}),r=new t8({playback:t,ynisonStateController:this.ynisonStateController,deviceConfig:this.deviceConfig,variables:this.variables});a.beforeEntityChange.tapPromise("YnisonPlugin",()=>{let{currentEntity:{value:e}}=t.state.queueState;return e&&(e.entity.startPosition=null),Promise.resolve()}),a.beforeDestroy.tapPromise("YnisonPlugin",()=>(i.destroy(),r.destroy(),Promise.resolve()))}constructor({factory:e,deviceConfig:t,ynisonStateController:a,variables:i}){(0,N._)(this,"factory",void 0),(0,N._)(this,"deviceConfig",void 0),(0,N._)(this,"ynisonStateController",void 0),(0,N._)(this,"variables",void 0),this.factory=e,this.deviceConfig=t,this.ynisonStateController=a,this.variables=i}}let t9=[H.K.Album,H.K.Artist,H.K.Playlist,H.K.Various];class t2{apply(e){let{playback:t,hooks:a}=e;a.afterContextEnd.tapPromise("AutoflowPlugin",()=>{var e,a,i;if(!this.variables.enabled)return Promise.resolve();let r=null==(e=t.state.currentContext.value)?void 0:e.data.type;return(null==(a=t.state.currentContext.value)?void 0:a.data)&&"enableVariousAutoFlow"in t.state.currentContext.value.data&&(null==(i=t.state.currentContext.value)?void 0:i.data.enableVariousAutoFlow)&&(r=H.K.Various),r&&t9.includes(r)&&this.playAutoflow(t),Promise.resolve()})}playAutoflow(e){var t,a,i;let r=null==(t=e.state.currentContext.value)?void 0:t.data.type;(null==(a=e.state.currentContext.value)?void 0:a.data)&&"enableVariousAutoFlow"in e.state.currentContext.value.data&&(null==(i=e.state.currentContext.value)?void 0:i.data.enableVariousAutoFlow)&&(r=H.K.Various);let s=((e,t)=>{var a,i,r,s;let l=null==(a=t.state.currentContext.value)?void 0:a.data;if(l){if(e===H.K.Album)return["album:".concat(l.meta.id)];if(e===H.K.Artist)return["artist:".concat(l.meta.id)];if(e===H.K.Playlist&&"owner"in l.meta&&(null==(i=l.meta.owner)?void 0:i.uid)&&"kind"in l.meta&&l.meta.kind)return["playlist:".concat(null==(r=l.meta.owner)?void 0:r.uid,"_").concat(l.meta.kind)];if(e===H.K.Various){if("overrideAutoflowSeeds"in l&&l.overrideAutoflowSeeds)return l.overrideAutoflowSeeds;let e=null==(s=t.state.queueState.currentEntity.value)?void 0:s.entity.data.meta.id;return["track:".concat(e)]}}})(r,e),l=e.state.currentContext.value,n=Object.create(null!=l?l:null);if(!(r&&s))return;let o=this.factory.createContext({data:{type:H.K.Vibe,meta:{id:(0,ec.f)(s)},seeds:s,from:((e,t,a)=>{var i;let r=null==(i=t.state.currentContext.value)?void 0:i.data;if(!r)return"";let s=e,l=t.state.queueState.entityList.value.length||0;return s===H.K.Various&&1===l&&(s="track"),e===H.K.Various&&"overrideContextType"in r&&r.overrideContextType&&(s=r.overrideContextType),"".concat(a,"-radio-").concat(s,"-autoflow")})(r,e,this.platform),includeTracksInResponse:!0,parentContext:n,interactive:!1}});e.playContext({context:o,loadContextMeta:!0})}constructor({platform:e,factory:t,variables:a}){(0,N._)(this,"platform",void 0),(0,N._)(this,"factory",void 0),(0,N._)(this,"variables",void 0),this.platform=e,this.factory=t,this.variables=a}}class t5{apply(e){let{playback:t,hooks:a}=e;this.telemetry.createTelemetry(t),this.telemetry.setStaticParams({labels:{from:this.telemetry.from},puid:this.puid?String(this.puid):void 0,yaspVersion:this.yaspVersion},!0),t.state.playerState.status.onChange(()=>{this.telemetry.setPlayingState(t.state.playerState)}),t.state.playerState.event.onChange(e=>{e&&e!==L.Iu.UPDATING_PROGRESS&&this.telemetry.logEvent({name:e})}),a.afterError.tapPromise("TelemetryPlugin",e=>(e instanceof L.LI&&this.telemetry.logError({error:{...e,isFatal:!1}}),Promise.resolve())),a.beforeMediaStartPlaying.tapPromise("TelemetryPlugin",()=>{let{value:e}=t.state.queueState.currentEntity;return this.beforeMediaHandler(null==e?void 0:e.entity),Promise.resolve()}),a.beforeMediaSourceContentReload.tapPromise("TelemetryPlugin",()=>{let{value:e}=t.state.queueState.currentEntity;return this.beforeMediaHandler(null==e?void 0:e.entity),Promise.resolve()}),a.beforeMediaSourceContentPreload.tapPromise("TelemetryPlugin",e=>(this.beforeMediaHandler(e),Promise.resolve()))}beforeMediaHandler(e){if(!e||e2(e))return;let{mediaSourceData:t}=e;t&&"vsid"in t&&void 0===t.vsid&&(t.vsid=this.telemetry.vsid),t&&"sourceIndex"in t&&void 0===t.sourceIndex&&(t.sourceIndex=this.telemetry.onBeforeSetSource());let a=function(e){let{mediaSourceData:t}=e;if(!t)return;let{data:a}=t;return{streamUrl:t.src,...a}}(e);a&&(this.telemetry.setStaticParams({labels:{from:this.telemetry.from},puid:this.puid?String(this.puid):void 0,yaspVersion:this.yaspVersion,testIds:this.telemetryTestIds,...a},!0),this.telemetry.onSetSource(a))}constructor({telemetry:e,puid:t,yaspVersion:a,telemetryTestIds:i}){(0,N._)(this,"telemetry",void 0),(0,N._)(this,"puid",void 0),(0,N._)(this,"yaspVersion",void 0),(0,N._)(this,"telemetryTestIds",void 0),this.telemetry=e,this.puid=t,this.yaspVersion=a,this.telemetryTestIds=i}}class ae{setQuality(e){switch(e){case tx.e.HIGH_QUALITY:this.qualityConfig.lossless.value=!0,this.qualityConfig.hq.value=!0,this.qualityConfig.nq.value=!0,this.qualityConfig.lq.value=!0,this.qualityConfig.preview.value=!1,this.quality.value=tx.e.HIGH_QUALITY;break;case tx.e.BALANCED:this.qualityConfig.lossless.value=!1,this.qualityConfig.hq.value=!0,this.qualityConfig.nq.value=!0,this.qualityConfig.lq.value=!0,this.qualityConfig.preview.value=!1,this.quality.value=tx.e.BALANCED;break;case tx.e.EFFICIENT:this.qualityConfig.lossless.value=!1,this.qualityConfig.hq.value=!1,this.qualityConfig.nq.value=!0,this.qualityConfig.lq.value=!0,this.qualityConfig.preview.value=!1,this.quality.value=tx.e.EFFICIENT;break;case tx.e.PREVIEW:this.qualityConfig.lossless.value=!1,this.qualityConfig.hq.value=!1,this.qualityConfig.nq.value=!1,this.qualityConfig.lq.value=!1,this.qualityConfig.preview.value=!0,this.quality.value=tx.e.PREVIEW}}constructor(e){(0,N._)(this,"qualityConfig",{lossless:new $.cJ(!1),hq:new $.cJ(!0),nq:new $.cJ(!0),lq:new $.cJ(!0),preview:new $.cJ(!0),smart_preview:new $.cJ(!1)}),(0,N._)(this,"quality",new $.cJ(tx.e.BALANCED)),this.setQuality(e)}}function at(e){return(null==e?void 0:e.data.type)===R.R.Radio}class aa{get src(){let e=this.getQueryParamsString();return e?"".concat(this.data.url).concat(e):this.data.url}getQueryParamsString(){let e=new URLSearchParams;this.vsid&&e.append("vsid",this.vsid),void 0!==this.sourceIndex&&e.append("source_index",String(this.sourceIndex));let t=e.toString();return t?"?".concat(t):void 0}constructor(e){(0,N._)(this,"type","generativeSource"),(0,N._)(this,"data",void 0),(0,N._)(this,"vsid",void 0),(0,N._)(this,"sourceIndex",void 0),(0,N._)(this,"getFileInfoResponseTime",void 0),(0,N._)(this,"url",void 0),this.data=e.data,this.vsid=e.vsid,this.sourceIndex=e.sourceIndex}}class ai extends e8{constructor(e,{code:t="E_GENERATIVE_MEDIA_PROVIDER",...a}={}){super(e,{code:t,...a}),(0,N._)(this,"name","GenerativeMediaProviderException"),Object.setPrototypeOf(this,ai.prototype)}}class ar{getMediaSource(e){if(tv(e.entity)){var t;if(null==(t=e.entity.data.meta.stream)?void 0:t.url){let t=new aa({data:e.entity.data.meta.stream});return e.entity.mediaSourceData=t,Promise.resolve(t)}return Promise.reject(new ai("Failed to create generative src link",{code:E.E_GET_MEDIA_SRC}))}return Promise.reject(new ai("Provided entity is not generative entity",{code:E.E_UNSUITABLE_ENTITY_TYPE}))}}var as=a(39503),al=a(98369),an=a(28999);function ao(e){return e instanceof Error?{name:e.name,message:e.message,stack:e.stack,cause:e.cause}:{data:e}}class ad{getPreloadedFileInfo(e){let{entity:t,disableCache:a=!1}=e;if(!(a||tK(t,this.mediaSourceTtlMs,this.mediaConfigController))&&t.mediaSourceData&&"downloadInfoSource"===t.mediaSourceData.type)return t.mediaSourceData.data}getFileInfoFromResource(e){let{trackId:t,quality:a,codecs:i,transports:r}=e,s=(0,as.T)(),l=i.join(""),n=r.join(""),o="".concat(s).concat(t).concat(a).concat(l).concat(n);return new Promise((e,n)=>{this.tools.createSign({data:o,secretKey:this.secretKey}).then(o=>{this.resource.getFileInfo({tsInSeconds:s,trackId:t,quality:a,codecs:i,transports:r,sign:o,fromPromoLanding:this.variables.fromPromoLanding}).then(t=>{e({downloadInfo:t.downloadInfo,responseTime:t.responseTime,url:t.url})}).catch(e=>{n(new e4("Error in get-file-info request",{code:E.E_GET_MEDIA_SRC,cause:e,data:{trackId:t,quality:a,codecs:l,causeAsObject:ao(e)}}))})}).catch(e=>{n(new e4("Error in creating sign for get-file-info request",{code:E.E_CREATE_SIGN,cause:e,data:{trackId:t,quality:a,codecs:l,causeAsObject:ao(e)}}))})})}getFileInfo(e){let{entity:t,disableCache:a=!1,codecs:i,quality:r,transports:s}=e;if(this.variables.isMediaSourcePreloadEnabled)try{let e=this.getPreloadedFileInfo({entity:t,disableCache:a});if(e)return Promise.resolve({downloadInfo:e})}catch(e){return Promise.reject(e)}return this.getFileInfoFromResource({trackId:t.data.meta.id,quality:r,codecs:i,transports:s})}getMediaSource(e){let{entity:t,disableCache:a=!1}=e,i=(0,al.i)({productQuality:this.mediaConfigController.quality.value,entity:t}),r=(0,eN.l)(t)?tC.o.RAW:this.transport;return t.expectedQuality=i,this.getFileInfo({entity:t,disableCache:a,quality:i,transports:[r],codecs:this.codecs}).then(e=>{let{downloadInfo:r,responseTime:s,url:l}=e;if(!("error"in r)&&!an.DM.includes(r.codec)&&r.transport===tC.o.ENCRAW)return t.mediaSourceData=null,this.getFileInfo({entity:t,disableCache:a,quality:i,transports:[tC.o.RAW],codecs:this.codecs}).then(e=>{let{downloadInfo:a,responseTime:r,url:s}=e,l=this.createMediaSource({downloadInfo:a,trackId:t.data.meta.id,quality:i,codecs:this.codecs,getFileInfoResponseTime:r,getFileInfoUrl:s});return t.mediaSourceData=l,t.expectedQuality=i,l}).catch(e=>{let a=this.createMediaSource({downloadInfo:r,trackId:t.data.meta.id,quality:i,codecs:this.codecs,getFileInfoResponseTime:s});throw t.mediaSourceData=a,new e4("Error in get-file-info retry enclaw request",{code:E.E_GET_MEDIA_SRC,cause:e,data:{trackId:t.data.meta.id,quality:i,codecs:this.codecs.join(""),causeAsObject:ao(e)}})});let n=this.createMediaSource({downloadInfo:r,trackId:t.data.meta.id,quality:i,codecs:this.codecs,getFileInfoResponseTime:s,getFileInfoUrl:l});return t.mediaSourceData=n,n})}getMediaSourceBatch(e){let{entities:t}=e,a=(0,as.T)(),i=(0,al.i)({productQuality:this.mediaConfigController.quality.value,entities:t}),r=this.codecs.join(""),s=t.reduce((e,t)=>"".concat(e).concat(t.data.meta.id,","),"").slice(0,-1),l=t.some(e=>(0,eN.l)(e))?tC.o.RAW:this.transport,n="".concat(a).concat(s).concat(i).concat(r).concat(l);return new Promise((e,o)=>{this.tools.createSign({data:n,secretKey:this.secretKey}).then(n=>{this.resource.getFileInfoBatch({tsInSeconds:a,trackIds:s,quality:i,codecs:this.codecs,transports:[l],sign:n,fromPromoLanding:this.variables.fromPromoLanding}).then(a=>{try{for(let e of a.downloadInfos){let a=t.find(t=>t.data.meta.id===e.trackId);a&&(a.mediaSourceData=this.createMediaSource({downloadInfo:e,trackId:e.trackId,quality:i,codecs:this.codecs}),a.expectedQuality=i)}e(a.downloadInfos)}catch(e){o(e)}}).catch(e=>{o(new e4("Error in get-file-info/batch request",{code:E.E_GET_MEDIA_SRC,cause:e,data:{trackId:s,quality:i,codecs:r,causeAsObject:ao(e)}}))})}).catch(e=>{o(new e4("Error in creating sign for get-file-info request",{code:E.E_CREATE_SIGN,cause:e,data:{trackId:s,quality:i,codecs:r,causeAsObject:ao(e)}}))})})}createMediaSource(e){let{downloadInfo:t,trackId:a,codecs:i,quality:r,getFileInfoResponseTime:s,getFileInfoUrl:l}=e,n=i.join("");if("error"in t)throw new e4("Error message in get-file-info response",{code:E.E_GET_MEDIA_SRC,data:{trackId:a,quality:r,codecs:n,mediaSource:t}});if(!t.urls[0])throw new e4("No urls in get-file-info response",{code:E.E_GET_MEDIA_SRC,data:{trackId:a,quality:r,codecs:n,mediaSource:t}});return new tN({data:t,loadingTime:performance.now(),getFileInfoResponseTime:s,url:l})}constructor(e){var t;(0,N._)(this,"secretKey",void 0),(0,N._)(this,"resource",void 0),(0,N._)(this,"mediaConfigController",void 0),(0,N._)(this,"transport",void 0),(0,N._)(this,"codecs",void 0),(0,N._)(this,"variables",void 0),(0,N._)(this,"mediaSourceTtlMs",void 0),(0,N._)(this,"tools",void 0);let{resource:a,secretKey:i,mediaConfigController:r,transport:s,variables:l,mediaSourceTtlMs:n,codecs:o,tools:d}=e;this.resource=a,this.secretKey=i,this.mediaConfigController=r,this.transport=s,this.codecs=o,this.variables={isMediaSourcePreloadEnabled:null!=(t=null==l?void 0:l.isMediaSourcePreloadEnabled)&&t,fromPromoLanding:null==l?void 0:l.fromPromoLanding},this.mediaSourceTtlMs=null!=n?n:0,this.tools=d||an.$n}}class au{get src(){return this.data.src}constructor(e){(0,N._)(this,"type","clipSource"),(0,N._)(this,"data",void 0),(0,N._)(this,"vsid",void 0),(0,N._)(this,"getFileInfoResponseTime",void 0),(0,N._)(this,"url",void 0),this.data=e.data}}class ac{getMediaSource(e){let{entity:t}=e;if(eX(t)){let e=new au({data:{src:"".concat(this.vhUrl).concat(t.data.meta.playerId,"?service=").concat(this.service,"&from=").concat(this.from)}});return t.mediaSourceData=e,Promise.resolve(e)}return Promise.reject(new U.t("Provided entity is not clip entity",{code:E.E_UNSUITABLE_ENTITY_TYPE}))}constructor({service:e,from:t,vhUrl:a}){(0,N._)(this,"service",void 0),(0,N._)(this,"from",void 0),(0,N._)(this,"vhUrl",void 0),this.service=e,this.from=t,this.vhUrl=a}}class ag{get src(){let e=this.getQueryParamsString();return e?"".concat(this.data.streamUrl).concat(e):this.data.streamUrl}getQueryParamsString(){let e=new URLSearchParams;this.vsid&&e.append("vsid",this.vsid),void 0!==this.sourceIndex&&e.append("source_index",String(this.sourceIndex));let t=e.toString();return t?"?".concat(t):void 0}constructor(e){(0,N._)(this,"type","radioSource"),(0,N._)(this,"data",void 0),(0,N._)(this,"vsid",void 0),(0,N._)(this,"sourceIndex",void 0),(0,N._)(this,"getFileInfoResponseTime",void 0),(0,N._)(this,"url",void 0),this.data=e.data,this.vsid=e.vsid,this.sourceIndex=e.sourceIndex}}class am extends e8{constructor(e,{code:t="E_RADIO_MEDIA_PROVIDER",...a}={}){super(e,{code:t,...a}),(0,N._)(this,"name","RadioMediaProviderException"),Object.setPrototypeOf(this,am.prototype)}}class ah{getMediaSource(e){if(at(e.entity)){if(e.entity.data.meta.streamUrl){let t=new ag({data:{streamUrl:e.entity.data.meta.streamUrl}});return e.entity.mediaSourceData=t,Promise.resolve(t)}return Promise.reject(new am('Failed to create fm radio src link because the "streamUrl" property is missing in the entity meta',{code:E.E_GET_MEDIA_SRC}))}return Promise.reject(new am("Provided entity is not fm radio entity",{code:E.E_UNSUITABLE_ENTITY_TYPE}))}}class ay{async getMediaSource(e){return tv(e.entity)?this.generativeProvider.getMediaSource(e):eX(e.entity)?this.vhMediaProvider.getMediaSource(e):at(e.entity)?this.radioProvider.getMediaSource(e):this.getFileInfoProvider.getMediaSource(e)}getMediaSourceBatch(e){let{entities:t}=e;return t.some(e=>tv(e))?Promise.reject(new e8("Can not use getMediaSourceBatch for generative entities",{code:E.E_UNSUITABLE_ENTITY_TYPE})):this.getFileInfoProvider.getMediaSourceBatch({entities:t})}constructor(e){(0,N._)(this,"generativeProvider",new ar),(0,N._)(this,"radioProvider",new ah),(0,N._)(this,"getFileInfoProvider",void 0),(0,N._)(this,"vhMediaProvider",void 0),this.getFileInfoProvider=new ad(e.getFileInfoProviderParams),this.vhMediaProvider=new ac(e.vhMediaProviderParams)}}class ap{async loadEntities(e){let{trackIds:t}=function(e){let t=[];return e.forEach(e=>{let{context:a,entity:i}=e,r=i.data.meta.id,s="string"==typeof r&&r.includes(":");if(!i.data.fromCurrentContext||s)return void t.push(i.data.meta.id);(null==a?void 0:a.data.type)===H.K.Album&&(r="".concat(i.data.meta.id,":").concat(a.data.meta.id)),"albumId"in i.data.meta&&i.data.meta.albumId&&(r="".concat(i.data.meta.id,":").concat(i.data.meta.albumId)),t.push(r)},{}),{trackIds:t}}(e),a=e.some(e=>{let{context:t}=e;return(0,eC.i)(t)});return this.resource.getTracksMeta({trackIds:t,withProgress:!0,withMixData:a}).then(t=>{let a=[];for(let i of t){let t=e.find(e=>String(e.entity.data.meta.id).includes(String(i.id)));if(t){let e=t.entity.data.type===L.z4.Unloaded?R.R.Unknown:t.entity.data.type;e!==R.R.Clip&&a.push({...t.entity.data,type:e,meta:i,loadEntityMeta:!1})}}return a}).catch(e=>{throw new U.t("Failed to get track meta",{code:"E_TRACK_META_PROVIDER",cause:ao(e)})})}constructor(e){(0,N._)(this,"resource",void 0);let{tracksResource:t}=e;this.resource=t}}class av{loadEntities(e){let t=e.map(e=>e.entity.data.meta.id);return this.resource.getClip({clipIds:t}).then(t=>{let a=[];for(let i of t){let t=e.find(e=>String(e.entity.data.meta.id)===String(i.clipId));t&&a.push({...t.entity.data,type:R.R.Clip,meta:{id:i.clipId,...i},loadEntityMeta:!1})}return a}).catch(e=>{throw new U.t("Failed to get clip meta",{code:"E_CLIP_META_PROVIDER",cause:ao(e)})})}constructor(e){(0,N._)(this,"resource",void 0),this.resource=e.clipsResource}}class aS{loadEntities(e){return e.some(e=>eX(e.entity))?this.clipMetaProvider.loadEntities(e):this.trackMetaProvider.loadEntities(e)}constructor(e){(0,N._)(this,"trackMetaProvider",void 0),(0,N._)(this,"clipMetaProvider",void 0),this.trackMetaProvider=new ap({tracksResource:e.tracksResource}),this.clipMetaProvider=new av({clipsResource:e.clipsResource})}}var aE=a(42213);(_||(_={})).MAIN="MAIN";class aP{get availablePlaybacks(){return Array.from(this.playbacks.values())}afterPlayHandler(e){return this.activePlayback.value=e,Promise.resolve()}beforePlayHandler(e){return this.activePlayback.value&&this.activePlayback.value!==e?this.activePlayback.value.pause():Promise.resolve()}beforeDestroyHandler(e){return e.stop()}getPlayback(e){if(e){let t=this.playbacks.get(e);if(t)return t}let t=this.playbacks.get(_.MAIN);if(void 0!==t)return t;throw new U.t("MAIN playback was not created",{code:"NO_MAIN_PLAYBACK"})}checkPlaybackBlockingStatus(){var e,t;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_.MAIN,i=null==(e=this.activePlayback.value)?void 0:e.getId(),r=i===a;return((null==(t=this.activePlayback.value)?void 0:t.isBlocking)||r)&&!r?{status:L.N.BLOCKED,blockingPlaybackId:i}:{status:L.N.UNBLOCKED}}callIfUnblocked(e,t){let{status:a,blockingPlaybackId:i}=this.checkPlaybackBlockingStatus(t);return a===L.N.UNBLOCKED?e():(this.getPlayback(t).hooks.afterPlaybackCheckBlockingStatus.promise({status:a,blockingPlaybackId:i}),Promise.resolve())}createPlayback(e,t){if(!this.playbacks.has(e)){let a=new L.VE({id:e,isBlocking:t.isBlocking||!1,factory:t.factory,entityProvider:t.entityProvider,mediaPlayerParams:t.mediaPlayerParams,playbackConfig:t.playbackConfig});this.playbacks.set(e,a),a.hooks.afterMediaStartPlaying.tapPromise("MusicPlaybackController",()=>this.afterPlayHandler(a)),a.hooks.beforeMediaStartPlaying.tapPromise("MusicPlaybackController",()=>this.beforePlayHandler(a)),a.hooks.afterMediaResume.tapPromise("MusicPlaybackController",()=>this.afterPlayHandler(a)),a.hooks.beforeMediaResume.tapPromise("MusicPlaybackController",()=>this.beforePlayHandler(a)),a.hooks.beforeDestroy.tapPromise("MusicPlaybackController",()=>this.beforeDestroyHandler(a)),this.syncWithMainPlayback(a,t.syncVolumeWithMainPlayback)}}syncWithMainPlayback(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.getId()===_.MAIN)return void this.playbacksWaitingForSync.forEach(t=>{this.syncVolume(e,t)});let a=this.playbacks.get(_.MAIN);if(t&&a)return void this.syncVolume(a,e);t&&!a&&this.playbacksWaitingForSync.push(e)}syncVolume(e,t){(this.useExponentVolume?e.state.playerState.exponentVolume:e.state.playerState.volume).onChange(e=>{void 0!==e&&this.useExponentVolume?t.setExponentVolume(e):void 0===e||this.useExponentVolume||t.setVolume(e)})}constructor(e){(0,N._)(this,"activePlayback",new $.cJ(null)),(0,N._)(this,"playbacks",new Map),(0,N._)(this,"playbacksWaitingForSync",[]),(0,N._)(this,"useExponentVolume",void 0),this.useExponentVolume=!!e.useExponentVolume}}class ab{get state(){return this.playbackController.getPlayback().state}getState(e){return this.playbackController.getPlayback(e).state}playContext(e,t){let a=this.playbackController.getPlayback(t);try{let{contextData:i}=e,r=this.factory.createContext({data:i});return this.playbackController.callIfUnblocked(()=>a.playContext({context:r,entitiesData:e.entitiesData,loadContextMeta:e.loadContextMeta,queueParams:e.queueParams}).catch(e=>{a.hooks.afterError.promise(e)}),t)}catch(e){return a.hooks.afterError.promise(e),Promise.resolve()}}setContext(e,t){let a=this.playbackController.getPlayback(t);try{let{contextData:i}=e,r=this.factory.createContext({data:i});return this.playbackController.callIfUnblocked(()=>a.setContext({context:r,entitiesData:e.entitiesData,loadContextMeta:e.loadContextMeta,queueParams:e.queueParams}).catch(e=>{a.hooks.afterError.promise(e)}),t)}catch(e){return a.hooks.afterError.promise(e),Promise.resolve()}}restartContext(e,t){let a=this.playbackController.getPlayback(t);return this.playbackController.callIfUnblocked(()=>a.restartContext({playAfterRestart:e.playAfterRestart,entitiesData:e.entitiesData,queueParams:e.queueParams}).catch(e=>{a.hooks.afterError.promise(e)}),t)}play(e){let t=this.playbackController.getPlayback(e);return this.playbackController.callIfUnblocked(()=>t.play().catch(e=>{t.hooks.afterError.promise(e)}),e)}stop(e){let t=this.playbackController.getPlayback(e);return this.playbackController.callIfUnblocked(()=>t.stop().catch(e=>{t.hooks.afterError.promise(e)}),e)}pause(e){let t=this.playbackController.getPlayback(e);return this.playbackController.callIfUnblocked(()=>t.pause().catch(e=>{t.hooks.afterError.promise(e)}),e)}resume(e){let t=this.playbackController.getPlayback(e);return this.playbackController.callIfUnblocked(()=>t.resume().catch(e=>{t.hooks.afterError.promise(e)}),e)}setProgress(e,t){let a=this.playbackController.getPlayback(t);return this.playbackController.callIfUnblocked(()=>a.setProgress(e).catch(e=>(a.hooks.afterError.promise(e),0)),t)}setExponentVolume(e,t){let a=this.playbackController.getPlayback(t);return this.playbackController.callIfUnblocked(()=>a.setExponentVolume(e).catch(e=>(a.hooks.afterError.promise(e),0)),t)}setVolume(e,t){let a=this.playbackController.getPlayback(t);return this.playbackController.callIfUnblocked(()=>a.setVolume(e).catch(e=>(a.hooks.afterError.promise(e),0)),t)}setSpeed(e,t){let a=this.playbackController.getPlayback(t);return this.playbackController.callIfUnblocked(()=>a.setSpeed(e).catch(e=>(a.hooks.afterError.promise(e),1)),t)}slideForward(e,t){let a=this.playbackController.getPlayback(t);return this.playbackController.callIfUnblocked(()=>a.slideForward(e).catch(e=>(a.hooks.afterError.promise(e),0)),t)}slideBackward(e,t){let a=this.playbackController.getPlayback(t);return this.playbackController.callIfUnblocked(()=>a.slideBackward(e).catch(e=>(a.hooks.afterError.promise(e),0)),t)}increaseExponentVolume(e,t){let a=this.playbackController.getPlayback(t);return this.playbackController.callIfUnblocked(()=>a.increaseExponentVolume(e).catch(e=>(a.hooks.afterError.promise(e),0)),t)}increaseVolume(e,t){let a=this.playbackController.getPlayback(t);return this.playbackController.callIfUnblocked(()=>a.increaseVolume(e).catch(e=>(a.hooks.afterError.promise(e),0)),t)}decreaseVolume(e,t){let a=this.playbackController.getPlayback(t);return this.playbackController.callIfUnblocked(()=>a.decreaseVolume(e).catch(e=>(a.hooks.afterError.promise(e),0)),t)}decreaseExponentVolume(e,t){let a=this.playbackController.getPlayback(t);return this.playbackController.callIfUnblocked(()=>a.decreaseExponentVolume(e).catch(e=>(a.hooks.afterError.promise(e),0)),t)}moveForward(e){let t=this.playbackController.getPlayback(e);return this.playbackController.callIfUnblocked(()=>t.moveForward().catch(e=>{t.hooks.afterError.promise(e)}),e)}moveBackward(e){let t=this.playbackController.getPlayback(e);return this.playbackController.callIfUnblocked(()=>t.moveBackward().catch(e=>{t.hooks.afterError.promise(e)}),e)}setEntityByIndex(e,t){let a=this.playbackController.getPlayback(t);return this.playbackController.callIfUnblocked(()=>a.setEntityByIndex(e).catch(e=>{a.hooks.afterError.promise(e)}),t)}togglePause(e){let t=this.playbackController.getPlayback(e);return this.playbackController.callIfUnblocked(()=>t.togglePause().catch(e=>{t.hooks.afterError.promise(e)}),e)}toggleShuffle(e){let t=this.playbackController.getPlayback(e);try{this.playbackController.callIfUnblocked(()=>t.toggleShuffle(),e)}catch(e){t.hooks.afterError.promise(e)}}setShuffle(e,t){let a=this.playbackController.getPlayback(t);try{this.playbackController.callIfUnblocked(()=>a.setShuffle(e),t)}catch(e){a.hooks.afterError.promise(e)}}updateFilterParams(e,t){let a=this.playbackController.getPlayback(t);try{this.playbackController.callIfUnblocked(()=>a.updateFilterParams(e),t)}catch(e){a.hooks.afterError.promise(e)}}bindPlayer(e){this.playbackController.getPlayback(e).bindPlayer()}unbindPlayer(e){this.playbackController.getPlayback(e).unbindPlayer()}setRepeatMode(e,t){let a=this.playbackController.getPlayback(t);try{this.playbackController.callIfUnblocked(()=>a.setRepeatMode(e),t)}catch(e){a.hooks.afterError.promise(e)}}removeAndLoadEntities(e){let{positions:t,playbackId:a,silent:i}=e,r=this.playbackController.getPlayback(a);return this.playbackController.callIfUnblocked(()=>r.removeAndLoadEntities(t,i).catch(e=>{r.hooks.afterError.promise(e)}),a)}remove(e){let{positions:t,playbackId:a,silent:i}=e,r=this.playbackController.getPlayback(a);this.playbackController.callIfUnblocked(()=>r.remove(t,i),a)}hide(e){let{positions:t,playbackId:a,silent:i}=e,r=this.playbackController.getPlayback(a);this.playbackController.callIfUnblocked(()=>r.hide(t,i),a)}inject(e){let{entitiesData:t,position:a,playbackId:i,silent:r}=e,s=this.playbackController.getPlayback(i);this.playbackController.callIfUnblocked(()=>s.inject(t,a,r),i)}injectNext(e){let{entitiesData:t,playbackId:a,silent:i}=e,r=this.playbackController.getPlayback(a);this.playbackController.callIfUnblocked(()=>r.injectNext(t,i),a)}injectLast(e){let{entitiesData:t,playbackId:a,silent:i}=e,r=this.playbackController.getPlayback(a);this.playbackController.callIfUnblocked(()=>r.injectLast(t,i),a)}registerMediaPlayer(e){let{mediaPlayerParams:t,playbackId:a}=e;this.playbackController.getPlayback(a).registerMediaPlayer(t)}setVideoCoreContainer(e){let{container:t,playbackId:a}=e;this.playbackController.getPlayback(a).setVideoCoreContainer(t)}destroyVideoCore(e){this.playbackController.getPlayback(e).destroyVideoCore()}destroy(){return Promise.allSettled(this.playbackController.availablePlaybacks.map(e=>e.hooks.beforeDestroy.promise()))}constructor(e){if((0,N._)(this,"factory",void 0),(0,N._)(this,"playbackController",void 0),this.factory=e.factory,this.playbackController=e.playbackController,this.playbackController.createPlayback(_.MAIN,{factory:e.factory,mediaPlayerParams:e.mediaPlayerParams,entityProvider:e.entityProvider,playbackConfig:e.playbackConfig}),e.plugins){let t=this.playbackController.getPlayback(_.MAIN);for(let a of e.plugins)a.apply({playback:t,hooks:t.hooks})}}}var af=a(48467),aI=a(49444),ak=a(81821),a_=a(46369),aT=a(77575),aC=a(12580),aA=a(94767),aD=a(53799);let aN=e=>{let{audioLoader:t,children:a}=e;return(0,A.use)(t),a};var aL=a(29318),ax=a(73761);let aR=(0,C.PA)(()=>{let e=(0,ax.Sq)(),t=(0,aA.iIU)(),{sonataState:a}=(0,aA.Pjs)();(0,A.useEffect)(()=>{e.loadPresets()},[e]),(0,A.useEffect)(()=>{e.isAvailable&&(null==t?void 0:t.equalizer.value)&&(e.isEnabled?(e.currentPreset&&t.equalizer.value.applyPreset((0,aL.HO)(e.currentPreset)),t.equalizer.value.enable()):t.equalizer.value.disable())},[e.currentPreset,e.isEnabled,null==t?void 0:t.equalizer,a.areCoresRegistered,e.isAvailable])}),aw=(0,C.PA)(e=>{let{isConnectionDisabled:t}=e,{experiments:a}=(0,aA.Pjs)(),i=(0,aA.NFA)(),r=a.checkExperiment(aA.zal.WebNextYnisonActivityInterception,"on");(0,A.useEffect)(()=>{i.get(aA.byd).updateVariables({isShadow:!r})},[i,r]),(e=>{let t=(0,aA.NFA)();(0,A.useEffect)(()=>{let a=t.get(aA.byd);if(e.isConnectionDisabled)return void a.connector.disconnect();let i=()=>{document.hidden||a.connector.connect({oauth:t.get(aA.QGx).token,multiAuthUserId:t.get(aA.WA$).getPassportUid()})},r=e=>{a.isActive||e.prevState.active_device_id_optional!==a.deviceConfig.device_id||i()};return a.stateController.on(tb.p$.UPDATED,r,"App"),document.addEventListener("visibilitychange",i),i(),()=>{a.stateController.off(tb.p$.UPDATED,r),document.removeEventListener("visibilitychange",i)}},[t,e.isConnectionDisabled,e.isYnisonActivityInterceptionEnabled]),(e=>{let t=(0,aA.NFA)(),a=(0,A.useRef)(0);(0,A.useEffect)(()=>{if(!e.isEnabled)return;let i=setInterval(()=>{let e=t.get(aA.byd),i=e.isActive,r=Date.now()-a.current>9e5,s=e.stateController.currentState.player_state.status.paused;i&&r&&s&&e.becomePassive()},6e4);return()=>{clearInterval(i)}},[t,e.isEnabled]),(0,A.useEffect)(()=>{if(!e.isEnabled)return;let i=t.get(aA.byd),r=e=>{var t;(null==(t=e.diff)?void 0:t.player_state)&&(a.current=Date.now())};return i.stateController.on(tb.p$.UPDATED,r,"App"),()=>{i.stateController.off(tb.p$.UPDATED,r)}},[t,e.isEnabled])})({isEnabled:!e.isConnectionDisabled||!e.isYnisonActivityInterceptionEnabled})})({isConnectionDisabled:t,isYnisonActivityInterceptionEnabled:r}),(0,A.useEffect)(()=>{if(t||!r)return;let e=i.get(aA.byd),a=()=>{var t,a;let i=(null==(a=e.stateController.fullState.diff.player_state)||null==(t=a.status)?void 0:t.paused)===!1;!e.isActive&&i&&e.interceptActivity()};return e.stateController.on(tb.p$.UPDATED,a,"App"),()=>{e.stateController.off(tb.p$.UPDATED,a)}},[i,t,r])}),aG=e=>{let{children:t}=e,a=(0,aA.iIU)(),i=(0,aA.Yx9)(),[r]=(0,A.useState)(()=>ax.ML.create({isEnabled:!1,modal:{}},i));return(0,A.useEffect)(()=>{let e=null==a?void 0:a.equalizer.onChange(e=>{r.setIsAvailable(!!e)});return()=>{null==e||e()}},[r,null==a?void 0:a.equalizer]),(0,T.jsx)(ax.iV.Provider,{value:r,children:t})},aK=!1;var aO=a(10663);let aM=null,aX=null,aF=null,aj=null,aU=null,aV=null,aB=null,aq=null,aY=null,aW=null,az=[aA.cYZ.YmPlayerQuality,aA.cYZ.YmPlayerShuffle,aA.cYZ.YmPlayerPrevVolume,aA.cYZ.YmPlayerVolume,aA.cYZ.YmPlayerRepeatMode],aH=e=>{var t;let{children:i,hostTld:r,quality:s,withPromoLandingPlayback:l}=e,n=(0,aA.NFA)(),{sonataState:o,experiments:d,library:u,trailer:c,user:g,advert:m,slam:h,settings:y,promolanding:{state:p},album:v,albumCPA:{isPlusCPAPlayerBarEnabled:S}}=(0,aA.Pjs)(),{isPassToProduct:E,isFreemium:P}=(0,aA.XCI)(),b=(0,aA.UlF)(),f=n.get(aA.ooW),I=n.get(aA.QGx),k=n.get(aA.twC),_=n.get(aA.P0Z),{language:C}=(0,aA.h6b)(),N=(0,aA.rs2)(),L=(0,aI.j)(),x=(0,aA.Gdz)(),R=d.checkExperiment(aA.zal.WebNextPlayerBarBackgroundProgress,"on"),w=d.checkExperiment(aA.zal.WebNextCrossMediaPlayer,"on"),K=!g.isAuthorized||E||P,O=K||h.isOfflineModeEnabled,M=g.isAuthorized&&!P,X=_.get(aA.qVS),F=_.get(aA.W4E),j=!!X&&!!f.get(aA.cYZ.EnableMetricsPluginDebugMode),U=(0,A.useMemo)(()=>(aM||(aM=new ae(s)),aM),[s]),V=y.browserInfo,B="Safari"!==V.name&&"iOS"!==V.OSFamily,q=(null==V?void 0:V.isTouch)&&S(v.id,null==(t=v.meta)?void 0:t.isNonMusic),Y=(0,A.useMemo)(()=>aF||(aF=new eM({useAnalyser:B,useEqualizer:B,useFade:!1})),[B]),W=(0,A.useMemo)(()=>{if(null!==aj)return aj;let e=n.get(aA.gdC);return aj=new eF({advertModule:N,afterTrackResource:n.get(aA.EN6),adsResource:e,variables:{get enabled(){return!g.hasPlus}}})},[N,n,g.hasPlus]),z=(0,A.useMemo)(()=>{if(aV)return aV;let e=n.get(aA.qTR),{transport:t,codecs:a}=(0,aA.EKQ)(V);return aV=new ay({getFileInfoProviderParams:{resource:e,secretKey:k.player.secretKey,mediaConfigController:U,transport:t,codecs:a,variables:{get fromPromoLanding(){return!0}},mediaSourceTtlMs:k.player.configVariablesPromoLandingPlayback.strmUrlsTtlMs},vhMediaProviderParams:k.player.vhMediaProvider})},[V,k.player.configVariablesPromoLandingPlayback.strmUrlsTtlMs,k.player.secretKey,k.player.vhMediaProvider,n,U]),H=(0,A.useMemo)(()=>{if(aU)return aU;let e=n.get(aA.qTR),{transport:t,codecs:a}=(0,aA.EKQ)(V);return aU=new ay({getFileInfoProviderParams:{resource:e,secretKey:k.player.secretKey,mediaConfigController:U,transport:t,codecs:a,variables:{get isMediaSourcePreloadEnabled(){return d.checkExperiment(aA.zal.WebNextTracksPreload,"on")}},mediaSourceTtlMs:k.player.configVariablesMainPlayback.strmUrlsTtlMs},vhMediaProviderParams:k.player.vhMediaProvider})},[V,k.player.configVariablesMainPlayback.strmUrlsTtlMs,k.player.secretKey,k.player.vhMediaProvider,n,d,U]),Q=(0,A.useMemo)(()=>aB||(aB=new aP({get useExponentVolume(){return d.checkExperiment(aA.zal.WebNextPlayerBarBackgroundProgress,"on")}})),[d]);(0,A.useEffect)(()=>{N&&Q&&(N.createAudioAdvertPlayback({playbackController:Q}),m.setIsAdvertPlaybackCreated(!0))},[m,N,Q]);let $=(0,A.useMemo)(()=>aq?aq:aq=new aS({tracksResource:n.get(aA.Ooh),clipsResource:n.get(aA.jQD)}),[n]),J=(0,A.useMemo)(()=>{if(aY)return aY;let e=n.get(aA.Ooh),t=n.get(aA._19),a=n.get(aA.ok0),i=n.get(aA.qNr),r=n.get(aA.tzI),s=n.get(aA.O9U);return aY=new eD({contextFactoryParams:{logger:b,variables:{vibe:{get sendFeedbackToSessionTracks(){return d.checkExperiment(aA.zal.WebNextWaveNewFeedbacks,"on")},get enableGetNextTracksAfterCloneVibeContext(){return d.checkExperiment(aA.zal.WebNextLimitTracksFromYnison,"on")},get disableFastVibeSkip(){return d.checkExperiment(aA.zal.WebNextDisableVibeFastSkip,"on")},get enableUpdatedForwardSkipInVibeContext(){return d.checkExperiment(aA.zal.WebNextEnableUpdatedForwardSkipInWave,"on")},get enableRemovingNotPlayedVibeTracksByTtl(){return d.checkExperiment(aA.zal.WebNextRemoveVibeTracksByTtl,"on")},get dontSendDuplicatedFeedbacks(){return d.checkExperiment(aA.zal.WebNextNotSendDuplicatedFeedbacks,"on")},get sendInteractiveToSession(){return d.checkExperiment(aA.zal.WebNextInteractiveSessionNew,"on")}}},tracksResource:e,usersResource:t,rotorResource:a,playlistResource:i,albumsResource:r,artistsResource:s},entityFactoryParams:{likeStore:u}})},[n,d,u,b]),Z=(0,A.useMemo)(()=>aW||(aW=new eB({telemetryResource:n.get(aA.LCy),...k.player.telemetry})),[n,k.player.telemetry]),ee=(()=>{let e=(0,aA.NFA)(),{experiments:t}=(0,aA.Pjs)(),a=e.get(aA.twC),i=t.checkExperiment(aA.zal.WebNextYaspVersion,"default"),r=t.getExperiment(aA.zal.WebNextYaspVersion);return i?a.player.yaspVersionStable:r&&r.group?r.group:a.player.yaspVersionStable})(),et=(0,A.useMemo)(()=>{if(!H||!Q||!$||!J)return null;if(aX)return aX;let e=n.get(aA.A4B)({credentials:"include"}),{player:{prefixUrl:t,configVariablesMainPlayback:a,configVariablesTrailerPlayback:i}}=k,s=new eq(L),l=[new e$({variables:{get isAutoflowEnabled(){return M}}}),new eJ,new eZ,new tp({httpClient:e,playsResourceConfig:{params:{common:{client:(0,aC._)(),device:(0,aA.V7X)(),language:C,oauth:I.token,get multiAuthUserId(){return n.get(aA.WA$).getPassportUid()}}},prefixUrl:(0,D.getTldHost)(t,r,aA.BEZ)},variables:{get disableSendPlaysOnTrackStart(){return d.checkExperiment(aA.zal.WebNextDisableSendPlaysOnTrackStart,"on")},get enableLocalStoredPlaysData(){return d.checkExperiment(aA.zal.WebNextPlayAudioHeartBeat,"on")},get shouldDeletePlaysObjectStore(){return d.checkExperiment(aA.zal.WebNextDeleteIndexedDbPlaysStore,"on")},get enableRemoveDuplicatePlays(){return d.checkExperiment(aA.zal.WebNextRemoveDuplicatePlays,"on")},get enableSendChangeReason(){return d.checkExperiment(aA.zal.WebNextSendChangeReasonInPlaysPlugin,"on")}}}),new tP({browserName:V.name,browserVersion:V.version}),new tf({logger:b}),new tI(U.quality),new tT({httpClient:e,streamsResourceConfig:{params:{common:{client:(0,aC._)(),device:(0,aA.V7X)(),language:C,oauth:I.token,get multiAuthUserId(){return n.get(aA.WA$).getPassportUid()}}},prefixUrl:(0,D.getTldHost)(t,r,aA.BEZ)},variables:{get isEnabled(){return g.isAuthorized}}}),new tG({mediaConfigController:U,transport:s,variables:{get enableDebugMode(){return j}}}),new tO({mediaProvider:H,mediaConfigController:U,config:{entitiesToPreloadStrmUrlsCount:a.entitiesToPreloadStrmUrlsCount,entitiesToPreloadSourceCount:a.entitiesToPreloadSourceCount,preloadedSourcesMaxCount:a.preloadedSourcesMaxCount,strmUrlsTtlMs:a.strmUrlsTtlMs,bufferGoal:a.bufferGoal},variables:{get isMediaSourcePreloadEnabled(){return d.checkExperiment(aA.zal.WebNextTracksPreload,"on")}}}),new tM({onTrailerPaused:()=>{c.setIsManuallyPaused(!0)},onTrailerPlaying:()=>{c.setIsManuallyPaused(!1)},playbackController:Q,trailerPlaybackParams:{id:aA.V_r.TRAILER,plugins:[new eM({useFade:B,useSmartPreview:!0}),new e$({variables:{get isAutoflowEnabled(){return!1}}}),new tf({logger:b}),new eZ,new tG({mediaConfigController:U,transport:s,variables:{get enableDebugMode(){return j}}}),new tp({httpClient:e,playsResourceConfig:{params:{common:{client:(0,aC._)(),device:(0,aA.V7X)(),language:C,oauth:I.token,get multiAuthUserId(){return n.get(aA.WA$).getPassportUid()}}},prefixUrl:(0,D.getTldHost)(t,r,aA.BEZ)},variables:{get disableSendPlaysOnTrackStart(){return d.checkExperiment(aA.zal.WebNextDisableSendPlaysOnTrackStart,"on")},get enableLocalStoredPlaysData(){return d.checkExperiment(aA.zal.WebNextPlayAudioHeartBeat,"on")},get shouldDeletePlaysObjectStore(){return d.checkExperiment(aA.zal.WebNextDeleteIndexedDbPlaysStore,"on")},get enableSendChangeReason(){return d.checkExperiment(aA.zal.WebNextSendChangeReasonInPlaysPlugin,"on")}},storePlaysProgressIntervalMs:5e3}),new tF],factory:J,entityProvider:$,playbackConfig:{mediaElementErrorReloadCount:i.mediaElementErrorReloadCount,windowSize:i.windowSize,setupQueueWindowSize:i.setupQueueWindowSize}}}),W,new tF];if(Y&&l.push(Y),!K){let e=n.get(aA.byd),t=new t4({factory:J,deviceConfig:e.deviceConfig,ynisonStateController:e.stateController,variables:{get enableLimitTracksFromYnison(){return d.checkExperiment(aA.zal.WebNextLimitTracksFromYnison,"on")},get shouldApplyState(){return o.shouldApplyYnisonState},get enableSendLimitedEntityListToYnison(){return d.checkExperiment(aA.zal.WebNextEnableSendLimitedEntityListToYnison,"on")}}});l.push(t)}return l.push(new t2({factory:J,platform:"desktop",variables:{get enabled(){return M}}})),Z&&l.push(new t5({telemetry:Z,get puid(){return g.puid},yaspVersion:ee,get telemetryTestIds(){return x()}})),aX=new ab({factory:J,playbackController:Q,plugins:l,entityProvider:$,playbackConfig:{mediaElementErrorReloadCount:a.mediaElementErrorReloadCount,windowSize:a.windowSize,setupQueueWindowSize:a.setupQueueWindowSize}})},[H,Q,$,J,n,k,L,C,I.token,r,V.name,V.version,b,U,B,Y,W,K,Z,M,d,g.isAuthorized,g.puid,j,c,o.shouldApplyYnisonState,ee,x]);(0,aT.H)(et);let ea=(0,aE.c)(e=>{R?(null==et||et.setExponentVolume(e),null==et||et.setExponentVolume(e,aA.V_r.TRAILER)):(null==et||et.setVolume(e),null==et||et.setVolume(e,aA.V_r.TRAILER)),o.setVolume(e),l&&(R?null==et||et.setExponentVolume(e,aA.V_r.PROMO_LANDING):null==et||et.setVolume(e,aA.V_r.PROMO_LANDING),p.setVolume(e))}),ei=(0,aE.c)(()=>{let e=f.get(aA.cYZ.YmPlayerVolume);"number"==typeof e?ea(e):ea(1)});(e=>{let{mediaProvider:t,playbackController:a,factory:i,entityProvider:r,mediaConfigController:s,isEnabled:l,isMetricsDebugEnabled:n,hostTld:o,browserInfo:d}=e,u=(0,aA.NFA)(),c=(0,aA.UlF)(),g=(0,aI.j)(),{experiments:m}=(0,aA.Pjs)(),{language:h}=(0,aA.h6b)();if(!l||!a||!i||!t||!r||!s||aK)return;let y=u.get(aA.QGx),p=u.get(aA.twC),v=u.get(aA.A4B)({credentials:"include"}),S=new eq(g),{player:{configVariablesPromoLandingPlayback:E,prefixUrl:P}}=p;null==a||a.createPlayback(aA.V_r.PROMO_LANDING,{factory:i,entityProvider:r,playbackConfig:{mediaElementErrorReloadCount:E.mediaElementErrorReloadCount,windowSize:E.windowSize,setupQueueWindowSize:E.setupQueueWindowSize}});let b=a.getPlayback(aA.V_r.PROMO_LANDING);for(let e of[new e$({variables:{get isAutoflowEnabled(){return!1}}}),new eJ,new eZ,new tp({httpClient:v,playsResourceConfig:{params:{common:{client:(0,aC._)(),device:(0,aA.V7X)(),language:h,oauth:y.token,get multiAuthUserId(){return u.get(aA.WA$).getPassportUid()}}},prefixUrl:(0,D.getTldHost)(P,o,aA.BEZ)},variables:{get disableSendPlaysOnTrackStart(){return m.checkExperiment(aA.zal.WebNextDisableSendPlaysOnTrackStart,"on")},get enableLocalStoredPlaysData(){return m.checkExperiment(aA.zal.WebNextPlayAudioHeartBeat,"on")},get shouldDeletePlaysObjectStore(){return m.checkExperiment(aA.zal.WebNextDeleteIndexedDbPlaysStore,"on")},get enablePartialPlayReporting(){return!0},get enableSendChangeReason(){return m.checkExperiment(aA.zal.WebNextSendChangeReasonInPlaysPlugin,"on")}}}),new tP({browserName:d.name,browserVersion:d.version}),new tf({logger:c}),new tG({mediaConfigController:s,transport:S,variables:{get enableDebugMode(){return n}}}),new tF])e.apply({playback:b,hooks:b.hooks});aK=!0})({isEnabled:!!l,playbackController:Q,entityProvider:$,factory:J,mediaConfigController:U,isNonSafariBrowser:B,isMetricsDebugEnabled:j,browserInfo:V,hostTld:r,mediaProvider:z}),(0,A.useEffect)(()=>{et&&F&&(window.sonataState=et.state)},[F,et]),(0,A.useEffect)(()=>{et&&H&&z&&Z&&!o.areCoresRegistered&&(Promise.all([a.e(2200),a.e(7654)]).then(a.bind(a,47654)).then(e=>{let{YaspCoreAdapter:t,YaspLoader:a,HlsCoreAdapter:i,HtmlAudioCoreAdapter:r}=e,s=new a({logger:b,yaspTelemetry:Z,get telemetryTestIds(){return x()}}),n=B?new i({hlsErrorRetryLimit:k.player.hlsErrorRetryLimit}):new r;et.registerMediaPlayer({mediaPlayerParams:{core:n,mediaProvider:H,contentKind:"audio",contentType:G.e.HLS}}),N&&et.registerMediaPlayer({mediaPlayerParams:{core:new r,mediaProvider:new aA.Uvn,contentKind:"audio",contentType:G.e.AUDIO},playbackId:aA.V_r.ADVERT}),et.registerMediaPlayer({mediaPlayerParams:{core:new r,mediaProvider:H,contentKind:"audio",contentType:G.e.DOWNLOADED_AUDIO}});let o=async()=>s.loadYasp(ee).then(()=>{let e=s.getYaspAudioElement();et.registerMediaPlayer({mediaPlayerParams:{core:new t({yaspAudioElement:e,yaspTelemetry:Z}),mediaProvider:H,contentKind:"audio",contentType:G.e.AUDIO,additionalCore:w?new t({yaspAudioElement:e,yaspTelemetry:Z}):void 0}}),et.registerMediaPlayer({mediaPlayerParams:{core:new t({yaspAudioElement:e}),mediaProvider:H,contentKind:"audio",contentType:G.e.AUDIO},playbackId:aA.V_r.TRAILER}),l&&z&&et.registerMediaPlayer({mediaPlayerParams:{core:new t({yaspAudioElement:e}),mediaProvider:z,contentKind:"audio",contentType:G.e.AUDIO},playbackId:aA.V_r.PROMO_LANDING}),ei()}).catch(()=>{setTimeout(o,1e3)});o()}),o.setCoresAsRegistered(!0))},[N,k.player.hlsErrorRetryLimit,ee,B,b,H,z,ei,et,o,l,n,o.areCoresRegistered,Z,w,x]),(0,A.useEffect)(()=>{a.e(4211).then(a.bind(a,34211)).then(e=>{let{loadVHPlayerSdk:t,VHPlayerCoreAdapter:a}=e;if(!et||!H||!Q||!$||!J)return;let i=new a({hideAds:!0}),{configVariablesMainPlayback:r}=k.player,s=async()=>t(k.player.vhPlayerSdkVersion).then(()=>{Q.createPlayback(aA.V_r.CLIP,{mediaPlayerParams:{core:i,mediaProvider:H,contentKind:"video",contentType:G.e.CLIP},entityProvider:$,factory:J,playbackConfig:{mediaElementErrorReloadCount:r.mediaElementErrorReloadCount,windowSize:r.windowSize,setupQueueWindowSize:r.setupQueueWindowSize},syncVolumeWithMainPlayback:!0});let e=Q.getPlayback(aA.V_r.CLIP);for(let t of[new e$({variables:{get isAutoflowEnabled(){return!1}}}),new eZ,W])t.apply({playback:e,hooks:e.hooks});o.setIsVHCoreRegistered(!0)}).catch(()=>{setTimeout(s,1e3)});s()})},[W,k.player,n,$,J,H,Q,et,o,g.hasPlus]),(0,aT.OM)({sonata:et}),(0,a_.rb)({sonata:et}),(e=>{let{sonata:t,playbackId:a,withStorage:i,sonataState:r}=e,s=(0,aA.NFA)().get(aA.ooW),{experiments:l}=(0,aA.Pjs)(),n=l.checkExperiment(aA.zal.WebNextPlayerBarBackgroundProgress,"on");(0,A.useEffect)(()=>{var e;let l,o,d,u,c,g=null==t?void 0:t.getState(a).queueState.currentEntity.onChange(e=>{let t=null==e?void 0:e.context.data.type,a=null==e?void 0:e.context.data.meta.id,i=null==e?void 0:e.entity;i&&r.setEntityMeta(i),t&&r.setContextType(t),a&&r.setContextId(a)}),m=null==t?void 0:t.getState(a).playerState.status.onChange(e=>{e&&r.setStatus(e)}),h=null==t?void 0:t.getState(a).currentContext.onChange(()=>{var e,n,g,m,h,y;if(null==l||l(),null==o||o(),null==d||d(),null==u||u(),null==c||c(),i){let e=null!=(y=s.get(aA.cYZ.YmPlayerRepeatMode))?y:aO.pM.NONE;null==t||t.setRepeatMode(e,a);let i=!!s.get(aA.cYZ.YmPlayerShuffle);null==t||t.setShuffle(i,a)}l=null==t||null==(e=t.getState(a).currentContext.value)?void 0:e.availableActions.moveBackward.onChange(e=>{r.setCanMoveBackward(!!e)}),o=null==t||null==(n=t.getState(a).currentContext.value)?void 0:n.availableActions.moveForward.onChange(e=>{r.setCanMoveForward(!!e)}),d=null==t||null==(g=t.getState(a).currentContext.value)?void 0:g.availableActions.repeat.onChange(e=>{"boolean"==typeof e&&r.setCanChangeRepeatMode(e)}),u=null==t||null==(m=t.getState(a).currentContext.value)?void 0:m.availableActions.shuffle.onChange(e=>{"boolean"==typeof e&&r.setCanShuffle(e)}),c=null==t||null==(h=t.getState(a).currentContext.value)?void 0:h.availableActions.speed.onChange(e=>{"boolean"==typeof e&&(r.setCanSpeed(e),e||null==t||t.setSpeed(1,a))})}),y=null==t||null==(e=t.getState(a).playerState)?void 0:e.progress.onChange(e=>{e&&(r.setPosition(e.position),r.setDuration(e.duration))}),p=null==t?void 0:t.getState(a).playerState.volume.onChange(e=>{let i=n?null==t?void 0:t.getState(a).playerState.exponentVolume.value:e;"number"==typeof i&&r.setVolume(i)}),v=null==t?void 0:t.getState(a).queueState.repeat.onChange(e=>{e&&(r.setRepeatMode(e),i&&s.set(aA.cYZ.YmPlayerRepeatMode,e,{expires:365}))}),S=null==t?void 0:t.getState(a).queueState.shuffle.onChange(e=>{"boolean"==typeof e&&(r.setShuffle(e),i&&s.set(aA.cYZ.YmPlayerShuffle,e,{expires:365}))});return()=>{null==g||g(),null==m||m(),null==h||h(),null==p||p(),null==v||v(),null==d||d(),null==u||u(),null==S||S(),null==y||y(),null==l||l(),null==o||o(),null==c||c()}},[n,a,t,r,s,i])})({sonata:et,playbackId:l?aA.V_r.PROMO_LANDING:void 0,withStorage:!l,sonataState:l?p:o});let er=(0,A.useCallback)(()=>{if(!g.isAuthorized||E||!g.hasPlus&&q)return tx.e.PREVIEW;if(P)return tx.e.EFFICIENT;let e=f.get(aA.cYZ.YmPlayerQuality);if(e){if(Object.values(aA.lv9).includes(e)){let t=(0,aA.SBI)(e);return f.set(aA.cYZ.YmPlayerQuality,t,{expires:365}),t}return e}return f.set(aA.cYZ.YmPlayerQuality,tx.e.BALANCED,{expires:365}),tx.e.BALANCED},[f,E,P,g.isAuthorized,g.hasPlus,q]);return(0,A.useEffect)(()=>(l&&(null==et||et.stop(),Object.values(aA.V_r).forEach(e=>{e!==aA.V_r.PROMO_LANDING&&(null==et||et.stop(e))})),()=>{l&&(null==et||et.stop(aA.V_r.PROMO_LANDING))}),[et,l]),(0,A.useEffect)(()=>{l||(U.setQuality(er()),o.setQuality(er()))},[U,er,o,l]),(0,A.useEffect)(()=>{(0,af.Bx)(f,az)},[f]),(0,T.jsx)(aA.cdg.Provider,{value:U,children:(0,T.jsxs)(aA.GsR.Provider,{value:et,children:[(0,T.jsx)(ak.mW,{}),(0,T.jsx)(aw,{isConnectionDisabled:O}),(0,T.jsx)(aA.WM$.Provider,{value:Y,children:(0,T.jsxs)(aG,{children:[(0,T.jsx)(aR,{}),i]})})]})})},aQ=(0,C.PA)(e=>{let{children:t,hostTld:a,quality:i,...r}=e,s=(0,aA.Dg5)();return(0,T.jsx)(A.Suspense,{fallback:(0,T.jsx)(aD.JR,{}),children:(0,T.jsx)(aN,{audioLoader:s,children:(0,T.jsx)(aH,{hostTld:a,quality:i,...r,children:t})})})})},11201:(e,t,a)=>{"use strict";a.r(t),a.d(t,{StoreProvider:()=>tA});var i,r,s=a(33008),l=a(97531),n=a(41028),o=a(17846),d=a(66268);a(30293);var u=a(94767),c=a(43090),g=a(10663),m=a(25581),h=a(70235);a(8584);var y=a(61299),p=a(52732),v=a(537),S=a(59615);let E=n.gK.compose(n.gK.model("UpcomingAlbums",{items:n.gK.maybeNull(n.gK.array(p.VH))}),S.pl,S.XT).actions(e=>({reset(){e.loadingState=u.GuX.IDLE,e.destroyItems([e.items])}})),P=n.gK.compose(n.gK.model("CollectionAlbumsPage",{sort:n.gK.maybeNull(v.wY),items:n.gK.array(n.gK.maybeNull(p.JC)),pager:n.gK.maybeNull(S.jd),alreadyRequestedPages:n.gK.map(n.gK.number),pendingPages:n.gK.map(n.gK.number),requestsCount:n.gK.maybeNull(n.gK.number),upcomingAlbums:E}),S.pl,S.XT).views(e=>{let t={get isAlbumsLoading(){return e.isNeededToLoad||e.loadingState===u.GuX.PENDING&&0===e.items.length},get isLoading(){return t.isAlbumsLoading||e.upcomingAlbums.isNeededToLoad||e.upcomingAlbums.isLoading},get isUpcomingAlbumsLoading(){return e.upcomingAlbums.isNeededToLoad||e.upcomingAlbums.isLoading},get isUpcomingAlbumsEmpty(){return!t.isUpcomingAlbumsLoading&&(!e.upcomingAlbums.items||0===e.upcomingAlbums.items.length)},get isAlbumsEmpty(){var a;return!t.isAlbumsLoading&&(!e.items||(null==(a=e.items)?void 0:a.length)===0)}};return t}).actions(e=>({getData:(0,n.L3)(function*(t){let{userId:a,page:i=0,pageSize:r=20,sortBy:s,sortOrder:l,metaType:o}=t,{usersResource:d,modelActionsLogger:c}=(0,n._$)(e);if(!(e.loadingState===u.GuX.PENDING&&e.pendingPages.has("".concat(i)))&&!e.alreadyRequestedPages.has("".concat(i))){"number"==typeof i&&e.alreadyRequestedPages.set("".concat(i),i),e.sort=null,(0,v.WG)(s)&&(0,v.hl)(l)&&(e.sort=(0,n.wg)({sortBy:s,sortOrder:l}));try{var g,m,h;e.loadingState=u.GuX.PENDING,e.pendingPages.set("".concat(i),i);let t=yield d.getLikedAlbums({userId:a,page:i,pageSize:r,sortBy:s,sortOrder:l,metaType:o}),c={page:i,perPage:r,total:t.pager.total};0===e.items.length&&(e.items=(0,n.wg)(Array.from({length:c.total},()=>null)));let y=null!=(m=null==(g=t.albums)?void 0:g.map(e=>{let{album:t}=e;return(0,p.pp)(t)}))?m:[];(0,u.Iyy)({items:e.items,mappedRawItems:y,page:i,pageSize:r}),e.pager=c,e.requestsCount=(null!=(h=e.requestsCount)?h:0)+1,e.loadingState!==u.GuX.IDLE&&(e.loadingState=u.GuX.RESOLVE)}catch(t){c.error(t),e.loadingState=u.GuX.REJECT}finally{e.pendingPages.delete("".concat(i))}}}),getPresaves:(0,n.L3)(function*(t){let{userId:a}=t,{usersResource:i,modelActionsLogger:r}=(0,n._$)(e);if(!e.upcomingAlbums.isLoading)try{var s;e.upcomingAlbums.loadingState=u.GuX.PENDING;let t=yield i.getPresaves({userId:a,includeReleased:!1,includeUpcoming:!0});e.upcomingAlbums.items=(0,n.wg)(null==(s=t.upcomingAlbums)?void 0:s.map(p.lO)),e.upcomingAlbumsLoadingState!==u.GuX.IDLE&&(e.upcomingAlbums.loadingState=u.GuX.RESOLVE)}catch(t){r.error(t),e.upcomingAlbums.isNeededToLoad||(e.upcomingAlbums.loadingState=u.GuX.REJECT)}}),reset(){e.loadingState=u.GuX.IDLE,e.pendingPages.clear(),e.alreadyRequestedPages.clear(),e.upcomingAlbums.reset(),e.destroyItems([e.items,e.sort,e.pager])}}));var b=a(90317),f=a(70879);let I=n.gK.compose(n.gK.model("TopArtists",{items:n.gK.array(b.GV)}),S.pl,S.XT).actions(e=>({reset(){e.loadingState=u.GuX.IDLE,e.destroyItems([e.items])}})),k=n.gK.compose(n.gK.model("CollectionArtistsPage",{sort:n.gK.maybeNull(v.wY),items:n.gK.array(n.gK.maybeNull(f.PK)),pager:n.gK.maybeNull(S.jd),alreadyRequestedPages:n.gK.map(n.gK.number),pendingPages:n.gK.map(n.gK.number),requests:n.gK.maybeNull(n.gK.number),topArtists:I}),S.pl,S.XT).views(e=>({get isLoading(){return e.isNeededToLoad||e.loadingState===u.GuX.PENDING},get isLoadingTopArtists(){return e.topArtists.isNeededToLoad||e.topArtists.isLoading}})).actions(e=>({getDataTopArtists:(0,n.L3)(function*(){let{personalResource:t,modelActionsLogger:a}=(0,n._$)(e);try{var i,r;e.topArtists.loadingState=u.GuX.PENDING;let a=yield t.getTopArtists();e.topArtists.items=(0,n.wg)(null!=(r=null==(i=a.artists)?void 0:i.map(e=>(0,b.MX)(e)))?r:[]),e.topArtists.loadingState=u.GuX.RESOLVE}catch(t){a.error(t),e.topArtists.loadingState=u.GuX.REJECT}}),getData:(0,n.L3)(function*(t){let{userId:a,page:i=0,pageSize:r=20,sortBy:s,sortOrder:l}=t,{usersResource:o,modelActionsLogger:d}=(0,n._$)(e);if(!(e.loadingState===u.GuX.PENDING&&e.pendingPages.has("".concat(i)))&&!e.alreadyRequestedPages.has("".concat(i))){"number"==typeof i&&e.alreadyRequestedPages.set("".concat(i),i),e.sort=null,(0,v.WG)(s)&&(0,v.hl)(l)&&(e.sort=(0,n.wg)({sortBy:s,sortOrder:l}));try{var c,g,m;e.loadingState=u.GuX.PENDING,e.pendingPages.set("".concat(i),i);let t=yield o.getLikedArtists({userId:a,page:i,pageSize:r,sortBy:s,sortOrder:l}),d={page:i,perPage:r,total:t.pager.total};0===e.items.length&&(e.items=(0,n.wg)(Array.from({length:d.total},()=>null))),e.loadingState=u.GuX.RESOLVE;let h=null!=(g=null==(c=t.artists)?void 0:c.map(f.dM))?g:[];(0,u.Iyy)({items:e.items,mappedRawItems:h,page:i,pageSize:r}),e.pager=d,e.requests=(null!=(m=e.requests)?m:0)+1,e.loadingState!==u.GuX.IDLE&&(e.loadingState=u.GuX.RESOLVE)}catch(t){d.error(t),e.loadingState=u.GuX.REJECT}finally{e.pendingPages.delete("".concat(i))}}}),reset(){e.loadingState=u.GuX.IDLE,e.pendingPages.clear(),e.alreadyRequestedPages.clear(),e.topArtists.reset(),e.destroyItems([e.items,e.sort,e.pager])}}));var _=a(64641);let T=n.gK.compose(n.gK.model("CollectionClipsPageWillLike",{clips:n.gK.maybeNull(n.gK.array(_.kv))}),S.XT,S.pl).views(e=>({get isShimmerVisible(){return e.isLoading||e.isRejected},get isEmpty(){var t;return e.isResolved&&(!e.clips||(null==(t=e.clips)?void 0:t.length)===0)}})).actions(e=>({getData:(0,n.L3)(function*(){let{clipsResource:t,modelActionsLogger:a}=(0,n._$)(e);try{e.loadingState=u.GuX.PENDING;let a=yield t.getClipsWillLike({page:0,pageSize:50});a.clips&&(e.clips=(0,n.wg)(a.clips.map(_.i$))),e.loadingState!==u.GuX.IDLE&&(e.loadingState=u.GuX.RESOLVE)}catch(t){a.error(t),e.loadingState!==u.GuX.IDLE&&(e.loadingState=u.GuX.REJECT)}}),reset(){e.loadingState=u.GuX.IDLE,e.destroyItems([e.clips])}})),C=n.gK.compose(n.gK.model("CollectionClipsPage",{items:n.gK.array(n.gK.maybeNull(_.kv)),pager:n.gK.maybeNull(S.jd),alreadyRequestedPages:n.gK.map(n.gK.number),pendingPages:n.gK.map(n.gK.number),clipsWillLike:T}),S.XT,S.pl).views(e=>({get isEmpty(){return e.isResolved&&(!e.pager||0===e.pager.total)},get isLoaded(){return e.isResolved||e.isRejected}})).actions(e=>({setInitialShimmer(){e.items=(0,n.wg)(Array.from({length:20},()=>null))},getData:(0,n.L3)(function*(t){var a;let{userId:i,page:r=0,pageSize:s=20}=t,{usersResource:l,modelActionsLogger:o}=(0,n._$)(e);if(!(e.pager&&e.items.length>=(null==(a=e.pager)?void 0:a.total)||e.loadingState===u.GuX.PENDING&&e.pendingPages.has(r.toString()))&&!e.alreadyRequestedPages.has(r.toString())){"number"==typeof r&&e.alreadyRequestedPages.set(r.toString(),r);try{e.loadingState=u.GuX.PENDING,e.pendingPages.set(r.toString(),r);let t=yield l.getLikedClips({userId:i,page:r,pageSize:s}),a={page:r,perPage:s,total:t.pager.total};if(t.clips){let i=t.clips.map(_.i$);(0,u.Iyy)({items:e.items,mappedRawItems:i,page:r,pageSize:s}),e.items=(0,n.wg)(e.items.slice(0,a.total))}e.pager=a,e.loadingState=u.GuX.RESOLVE}catch(t){o.error(t),e.loadingState=u.GuX.REJECT}finally{e.pendingPages.delete(r.toString())}}}),reset(){e.loadingState=u.GuX.IDLE,e.pager=null,e.alreadyRequestedPages.clear(),e.pendingPages.clear(),e.destroyItems([e.items]),e.clipsWillLike.reset()}})),A=n.gK.compose(n.gK.model("CollectionNonMusicPage",{items:n.gK.array(n.gK.maybeNull(p.JC)),pager:n.gK.maybeNull(S.jd),alreadyRequestedPages:n.gK.map(n.gK.number),pendingPages:n.gK.map(n.gK.number),requestsCount:n.gK.maybeNull(n.gK.number)}),S.XT).views(e=>({get isLoading(){return e.isNeededToLoad||e.loadingState===u.GuX.PENDING&&0===e.items.length},get isEmptyItems(){var t;return!!(!(null==(t=e.items)?void 0:t.length)&&e.requestsCount)}})).actions(e=>({getData:(0,n.L3)(function*(t){let{userId:a,page:i=0,pageSize:r=20,metaType:s}=t,{usersResource:l,modelActionsLogger:o}=(0,n._$)(e);if(!(e.loadingState===u.GuX.PENDING&&e.pendingPages.has("".concat(i)))&&!e.alreadyRequestedPages.has("".concat(i))){"number"==typeof i&&e.alreadyRequestedPages.set("".concat(i),i);try{var d,c,g;e.loadingState=u.GuX.PENDING,e.pendingPages.set("".concat(i),i);let t=yield l.getLikedAlbums({userId:a,page:i,pageSize:r,metaType:s}),o={page:i,perPage:r,total:t.pager.total};0===e.items.length&&(e.items=(0,n.wg)(Array.from({length:o.total},()=>null)));let m=null!=(c=null==(d=t.albums)?void 0:d.map(e=>{let{album:t}=e;return(0,p.pp)(t)}))?c:[];(0,u.Iyy)({items:e.items,mappedRawItems:m,page:i,pageSize:r}),e.pager=o,e.requestsCount=(null!=(g=e.requestsCount)?g:0)+1,e.loadingState!==u.GuX.IDLE&&(e.loadingState=u.GuX.RESOLVE)}catch(t){o.error(t),e.loadingState=u.GuX.REJECT}finally{e.pendingPages.delete("".concat(i))}}}),reset(){e.loadingState=u.GuX.IDLE,e.items=(0,n.wg)([]),e.pendingPages.clear(),e.pager=null,e.alreadyRequestedPages.clear(),e.requestsCount=0}}));var D=a(45242),N=a(25911);let L=n.gK.compose(n.gK.model("CollectionPlaylistsCreatedPage",{sort:n.gK.maybeNull(v.wY),items:n.gK.array(n.gK.maybeNull(N.Zq)),pager:n.gK.maybeNull(S.jd),alreadyRequestedPages:n.gK.map(n.gK.number),pendingPages:n.gK.map(n.gK.number),kinds:n.gK.array(n.gK.number),requests:n.gK.maybeNull(n.gK.number)}),S.XT).views(e=>({get isLoading(){return e.isNeededToLoad||e.loadingState===u.GuX.PENDING},get isEmpty(){return e.isResolved&&(!e.pager||0===e.pager.total)}})).actions(e=>{let t={getKinds:(0,n.L3)(function*(t){let a=[],{usersResource:i}=(0,n._$)(e);a=yield i.getPlaylistsKinds({userId:t,addPlaylistWithLikes:!0}),e.kinds=(0,n.wg)(a)}),getData:(0,n.L3)(function*(a){let{userId:i,page:r=0,pageSize:s=20,withLikesCount:l}=a,{usersResource:o,modelActionsLogger:d}=(0,n._$)(e);if(!(e.loadingState===u.GuX.PENDING&&e.pendingPages.has("".concat(r)))&&!e.alreadyRequestedPages.has("".concat(r))){"number"==typeof r&&e.alreadyRequestedPages.set("".concat(r),r);try{var c;e.isResolved||(e.loadingState=u.GuX.PENDING),e.pendingPages.set("".concat(r),r),0===e.kinds.length&&(yield t.getKinds(i));let a=r*s,d=e.kinds.slice(a,a+s),g=yield o.getPlaylistsByKinds({userId:i,kinds:d,withLikesCount:l,withTracks:!0});e.requests=(null!=(c=e.requests)?c:0)+1;let m={page:r,perPage:s,total:e.kinds.length};0===e.items.length&&(e.items=(0,n.wg)(Array.from({length:m.total},()=>null)));let h=g.map(D.pd);(0,u.Iyy)({items:e.items,mappedRawItems:h,page:r,pageSize:s}),e.pager=m,e.loadingState=u.GuX.RESOLVE}catch(t){d.error(t),e.loadingState=u.GuX.REJECT}finally{e.pendingPages.delete("".concat(r))}}}),reset(){e.loadingState=u.GuX.IDLE,e.sort=null,e.items=(0,n.wg)([]),e.pager=null,e.alreadyRequestedPages.clear(),e.pendingPages.clear(),e.kinds=(0,n.wg)([]),e.requests=null}};return t}),x=n.gK.compose(n.gK.model("CollectionPlaylistsLikedPage",{sort:n.gK.maybeNull(v.wY),items:n.gK.array(n.gK.maybeNull(N.$o)),pager:n.gK.maybeNull(S.jd),alreadyRequestedPages:n.gK.map(n.gK.number),pendingPages:n.gK.map(n.gK.number),requests:n.gK.maybeNull(n.gK.number)}),S.XT).views(e=>({get isLoading(){return e.isNeededToLoad||e.loadingState===u.GuX.PENDING},get isEmpty(){return e.isResolved&&(!e.pager||0===e.pager.total)}})).actions(e=>({getData:(0,n.L3)(function*(t){let{userId:a,page:i=0,pageSize:r=20,sortBy:s,sortOrder:l,playlistMetaType:o,withTracks:d}=t;if(e.loadingState===u.GuX.PENDING&&e.pendingPages.has("".concat(i))||e.alreadyRequestedPages.has("".concat(i)))return;"number"==typeof i&&e.alreadyRequestedPages.set("".concat(i),i);let{usersResource:c,modelActionsLogger:g}=(0,n._$)(e);e.sort=null,(0,v.WG)(s)&&(0,v.hl)(l)&&(e.sort=(0,n.wg)({sortBy:s,sortOrder:l}));try{var m;e.loadingState=u.GuX.PENDING,e.pendingPages.set("".concat(i),i);let{likedPlaylists:t,pager:g}=yield c.getLikedPlaylists({userId:a,page:i,pageSize:r,sortBy:s,sortOrder:l,playlistMetaType:o,withTracks:d});e.requests=(null!=(m=e.requests)?m:0)+1,0===e.items.length&&(e.items=(0,n.wg)(Array.from({length:g.total},()=>null)));let h=t.map(e=>{let{playlist:t}=e;return(0,N.jX)(t)});(0,u.Iyy)({items:e.items,mappedRawItems:h,page:i,pageSize:r}),e.pager=g,e.loadingState=u.GuX.RESOLVE}catch(t){g.error(t),"number"==typeof i&&e.alreadyRequestedPages.delete("".concat(i)),e.requests="number"==typeof e.requests?e.requests-1:0,e.loadingState=u.GuX.REJECT}finally{e.pendingPages.delete("".concat(i))}}),reset(){e.loadingState=u.GuX.IDLE,e.sort=null,e.items=(0,n.wg)([]),e.pager=null,e.alreadyRequestedPages.clear(),e.pendingPages.clear(),e.requests=null}})),R=n.gK.model("CollectionPlaylists",{playlistsLiked:x,playlistsCreated:L,activeTabIndex:n.gK.number,tabs:n.gK.array(n.gK.number),tabIndexElement:n.gK.maybe(n.gK.string)}).views(e=>({get isLikedTabActive(){return e.activeTabIndex===h.a.LIKED},get isCreatedTabActive(){return e.activeTabIndex===h.a.CREATED},get activePlaylistsModel(){switch(e.activeTabIndex){case h.a.CREATED:return e.playlistsCreated;case h.a.LIKED:return e.playlistsLiked;default:return e.playlistsCreated}},get isEmptyLikedTab(){var t;return(null==(t=e.playlistsLiked.pager)?void 0:t.total)===0}})).actions(e=>({setActiveTabIndex(t){e.activeTabIndex=t},setTabIndexElement(t){e.tabIndexElement=t},reset(){e.playlistsLiked.reset(),e.playlistsCreated.reset(),e.activeTabIndex=h.a.CREATED}}));var w=a(44078);let G=e=>(0,n.wg)({type:e.type,track:(0,w.vU)(e.track),album:e.album&&(0,p.pp)(e.album)}),K=e=>(0,n.wg)({type:e.type,album:e.album&&(0,p.pp)(e.album),playlist:e.playlist&&(0,D.ZC)(e.playlist),track:(0,w.vU)(e.track)}),O=n.gK.model("ShelfLikedItem",{type:n.gK.string,track:w.vj,album:n.gK.maybe(p.JC)});n.gK.model("ShelfNewEpisodesItem",{type:n.gK.string,playlist:n.gK.maybe(D.BL),track:w.vj});let M=n.gK.model("ShelfRecentlyPlayedItem",{type:n.gK.string,album:n.gK.maybe(p.JC),playlist:n.gK.maybe(D.IP),track:w.vj}),X=n.gK.compose(n.gK.model("CollectionShelfLiked",{title:n.gK.maybeNull(n.gK.string),typeForFrom:n.gK.maybeNull(n.gK.string),entities:n.gK.maybeNull(n.gK.array(O)),pager:n.gK.maybeNull(S.jd)}),S.XT).views(e=>({get isLoading(){return e.isNeededToLoad||e.loadingState===u.GuX.PENDING},get isEmpty(){var t;return e.isResolved&&(null==(t=e.entities)?void 0:t.length)===0}})).actions(e=>({getData:(0,n.L3)(function*(){let{nonMusicResource:t,modelActionsLogger:a}=(0,n._$)(e);if(e.loadingState!==u.GuX.PENDING)try{var i,r;e.loadingState=u.GuX.PENDING;let a=yield t.getShelfLiked();e.title=a.title,e.typeForFrom=null!=(i=a.typeForFrom)?i:null,e.pager=null!=(r=a.pager)?r:null,e.entities=(0,n.wg)(a.entities?a.entities.map(G):[]),e.loadingState=u.GuX.RESOLVE}catch(t){a.error(t),e.loadingState=u.GuX.REJECT}}),reset(){e.entities=null,e.title=null,e.typeForFrom=null,e.pager=null,e.loadingState=u.GuX.IDLE}})),F=n.gK.compose(n.gK.model("CollectionShelfNewEpisodes",{title:n.gK.maybeNull(n.gK.string),typeForFrom:n.gK.maybeNull(n.gK.string),playlist:n.gK.maybeNull(D.BL),tracks:n.gK.maybeNull(n.gK.array(w.vj))}),S.XT).views(e=>({get withPlaylist(){return!!(e.playlist&&e.playlist.kind&&e.playlist.isAvailable&&e.playlist.uuid)},get isLoading(){return e.isNeededToLoad||e.loadingState===u.GuX.PENDING},get isEmpty(){return e.isResolved&&(!e.tracks||0===e.tracks.length)}})).actions(e=>({getData:(0,n.L3)(function*(){let{nonMusicResource:t,modelActionsLogger:a}=(0,n._$)(e);if(e.loadingState!==u.GuX.PENDING)try{var i;e.loadingState=u.GuX.PENDING;let a=yield t.getNewEpisodes();e.title=a.title;let r=a.blocks[0];(null==r?void 0:r.typeForFrom)&&(e.typeForFrom=r.typeForFrom),(null==r||null==(i=r.entities[0])?void 0:i.playlist)&&(e.playlist=(0,D.ZC)(r.entities[0].playlist)),(null==r?void 0:r.entities)&&(e.tracks=(0,n.wg)(r.entities.filter(e=>e.track).map(e=>(0,w.vU)(e.track)))),e.loadingState=u.GuX.RESOLVE}catch(t){a.error(t),e.loadingState=u.GuX.REJECT}}),reset(){e.title=null,e.playlist=null,e.typeForFrom=null,e.tracks=null,e.loadingState=u.GuX.IDLE}})),j=n.gK.compose(n.gK.model("CollectionShelfRecentlyPlayed",{title:n.gK.maybeNull(n.gK.string),typeForFrom:n.gK.maybeNull(n.gK.string),entities:n.gK.maybeNull(n.gK.array(M)),pager:n.gK.maybeNull(S.jd)}),S.XT).views(e=>({get isLoading(){return e.isNeededToLoad||e.loadingState===u.GuX.PENDING},get isEmpty(){return!!(e.isResolved&&e.entities&&0===e.entities.length)}})).actions(e=>({getData:(0,n.L3)(function*(){let{nonMusicResource:t,modelActionsLogger:a}=(0,n._$)(e);if(e.loadingState!==u.GuX.PENDING)try{var i,r;e.loadingState=u.GuX.PENDING;let a=yield t.getShelfRecentlyPlayed();e.title=a.title,e.typeForFrom=null!=(i=a.typeForFrom)?i:null,e.pager=null!=(r=a.pager)?r:null,e.entities=(0,n.wg)(a.entities.map(K)),e.loadingState=u.GuX.RESOLVE}catch(t){a.error(t),e.loadingState=u.GuX.REJECT}}),reset(){e.entities=null,e.title=null,e.typeForFrom=null,e.pager=null,e.loadingState=u.GuX.IDLE}})),U=n.gK.model("CollectionShelfPage",{recentlyPlayed:j,newEpisodes:F,liked:X}).views(e=>({get isLoading(){return e.recentlyPlayed.isLoading&&e.liked.isLoading},get isRejected(){return e.recentlyPlayed.isRejected&&e.liked.isRejected},get isResolved(){return e.recentlyPlayed.isResolved&&e.liked.isResolved},get isIdle(){return e.recentlyPlayed.loadingState===u.GuX.IDLE&&e.liked.loadingState===u.GuX.IDLE},get hasRecentlyPlayed(){var t;return e.recentlyPlayed.isLoading||((null==(t=e.recentlyPlayed.entities)?void 0:t.length)||0)>0},get hasLiked(){var a;return e.liked.isLoading||((null==(a=e.liked.entities)?void 0:a.length)||0)>0}})).actions(e=>({reset(){e.recentlyPlayed.reset(),e.liked.reset()}})),V=n.gK.compose(n.gK.model("CollectionDislikesPageArtists",{items:n.gK.maybeNull(n.gK.array(f.PK))}),S.XT).views(e=>{let t={get isLoading(){return e.isNeededToLoad||e.loadingState===u.GuX.PENDING},get isEmpty(){var a;return!t.isLoading&&(null==(a=e.items)?void 0:a.length)===0}};return t}).actions(e=>({getData:(0,n.L3)(function*(){let{usersResource:t,modelActionsLogger:a}=(0,n._$)(e);if(!(0,n._n)(e))return null;let{user:i}=(0,n.Zn)(e);if(e.loadingState===u.GuX.PENDING)return null;if(e.loadingState=u.GuX.PENDING,i.account.data.uid)try{let a=yield t.getDislikedArtists({userId:i.account.data.uid});return e.items=(0,n.wg)((a||[]).map(f.dM)),e.loadingState!==u.GuX.IDLE&&(e.loadingState=u.GuX.RESOLVE),a}catch(t){a.error(t),e.loadingState!==u.GuX.IDLE&&(e.loadingState=u.GuX.REJECT)}return e.loadingState=u.GuX.REJECT,null}),reset(){e.loadingState=u.GuX.IDLE,e.items=null}}));var B=a(73508),q=a(2865);let Y=n.gK.model("CollectionDislikesPageTracksItem",{id:n.gK.string,loadingState:n.gK.enumeration(Object.values(u.GuX)),data:n.gK.maybeNull(w.vj)}),W=n.gK.compose(n.gK.model("CollectionDislikesPageTracks",{items:n.gK.maybeNull(n.gK.array(Y))}),S.XT).views(e=>{let t={get isLoading(){return e.isNeededToLoad||e.loadingState===u.GuX.PENDING},get isEmpty(){var a;return!t.isLoading&&(null==(a=e.items)?void 0:a.length)===0},get sonataEntitiesData(){var i,r;return null!=(r=null==(i=e.items)?void 0:i.map(e=>(0,q.li)(e.id)))?r:[]}};return t}).actions(e=>({getData:(0,n.L3)(function*(){let{usersResource:t,modelActionsLogger:a}=(0,n._$)(e),{user:i}=(0,n.Zn)(e);if(i.account.data.uid&&e.loadingState!==u.GuX.PENDING){e.loadingState=u.GuX.PENDING;try{let{library:{tracks:a}}=yield t.getDislikedTracks({userId:i.account.data.uid}),r=a.map(e=>{let{id:t,albumId:a}=e;return{id:String((0,B.V)(t,a)),loadingState:u.GuX.IDLE}});e.items=(0,n.wg)(r),e.loadingState=u.GuX.RESOLVE}catch(t){a.error(t),e.loadingState!==u.GuX.IDLE&&(e.loadingState=u.GuX.REJECT)}}}),getTracksByRange:(0,n.L3)(function*(t,a){var i;let{tracksResource:r,modelActionsLogger:s}=(0,n._$)(e);if(!(null==(i=e.items)?void 0:i.length))return null;t=Math.max(0,t),a=Math.min(a,e.items.length);let l=((e,t,a)=>{let i=[];for(let l=t;l<=a;l++){var r,s;((null==(r=e[l])?void 0:r.loadingState)===u.GuX.IDLE||(null==(s=e[l])?void 0:s.loadingState)===u.GuX.REJECT)&&i.push(l)}return i})(e.items,t,a);try{let t,a=(t=e.items,l.map(e=>{let a=t[e];return String(null==a?void 0:a.id)}));if(!a.length)return null;l.forEach(t=>{var a;let i=null==(a=e.items)?void 0:a[t];i&&(i.loadingState=u.GuX.PENDING)});let i=yield r.getTracksMeta({trackIds:a,withProgress:!0});l.forEach((t,a)=>{var r;let s=null==i?void 0:i[a];(null==(r=e.items)?void 0:r[t])&&s&&(e.items[t]={id:String(s.id),data:(0,w.vU)(s),loadingState:u.GuX.RESOLVE})})}catch(t){s.error(t),l.forEach(t=>{var a;let i=null==(a=e.items)?void 0:a[t];i&&(i.loadingState=u.GuX.REJECT)})}return null}),reset(){e.loadingState=u.GuX.IDLE,e.items=null}})),z=n.gK.model("CollectionDislikesPage",{artists:V,tracks:W}).views(e=>({get isNeededToLoad(){return e.tracks.isNeededToLoad&&e.artists.isNeededToLoad},get isLoading(){return e.tracks.isLoading&&e.artists.isLoading},get isResolved(){return e.tracks.isResolved&&e.artists.isResolved}})).actions(e=>({reset(){e.artists.reset(),e.tracks.reset()}}));var H=a(56732);let Q=n.gK.compose(n.gK.model("CollectionKidsAlbumsPage",{items:n.gK.maybeNull(n.gK.array(n.gK.maybeNull(p.JC))),pager:n.gK.maybeNull(S.jd),alreadyRequestedPages:n.gK.map(n.gK.number),pendingPages:n.gK.map(n.gK.number),requests:n.gK.maybeNull(n.gK.number)}),S.pl,S.XT).views(e=>{let t={get isShimmerVisible(){return e.isLoading||e.isRejected},get shouldShowContent(){return t.isShimmerVisible||t.loadedItems.length>0},get loadedItems(){var a,i;return null!=(i=null==(a=e.items)?void 0:a.filter(e=>null!==e))?i:[]},get isEmpty(){return e.isResolved&&(!e.pager||0===e.pager.total)}};return t}).actions(e=>({getData:(0,n.L3)(function*(t){let{pageSize:a=H.c,page:i=0}=t,{landingBlocksResource:r,modelActionsLogger:s}=(0,n._$)(e);if(!(e.loadingState===u.GuX.PENDING&&e.pendingPages.has("".concat(i)))&&!e.alreadyRequestedPages.has("".concat(i))){"number"==typeof i&&e.alreadyRequestedPages.set("".concat(i),i);try{var l;e.loadingState=u.GuX.PENDING,e.pendingPages.set("".concat(i),i);let t=yield r.getCollectionKidsAlbumsLiked({page:i,pageSize:a}),s={page:i,perPage:a,total:t.pager.total};e.items&&0!==e.items.length||(e.items=(0,n.wg)(Array.from({length:s.total},()=>null)));let o=t.items.map(e=>(0,y.vj)(e.data).data);e.items&&(0,u.Iyy)({items:e.items,mappedRawItems:o,page:i,pageSize:a}),e.pager=s,e.requests=(null!=(l=e.requests)?l:0)+1,e.loadingState!==u.GuX.IDLE&&(e.loadingState=u.GuX.RESOLVE)}catch(t){s.error(t),e.loadingState!==u.GuX.IDLE&&(e.loadingState=u.GuX.REJECT)}finally{e.pendingPages.delete("".concat(i))}}}),reset(){e.loadingState=u.GuX.IDLE,e.destroyItems([e.pager,e.items]),e.pendingPages.clear(),e.alreadyRequestedPages.clear(),e.requests=null}})),$=n.gK.compose(n.gK.model("CollectionKidsPlaylistsPage",{items:n.gK.maybeNull(n.gK.array(n.gK.maybeNull(D.IP))),pager:n.gK.maybeNull(S.jd),alreadyRequestedPages:n.gK.map(n.gK.number),pendingPages:n.gK.map(n.gK.number),requests:n.gK.maybeNull(n.gK.number)}),S.pl,S.XT).views(e=>{let t={get isShimmerVisible(){return e.isLoading||e.isRejected},get shouldShowContent(){return t.isShimmerVisible||t.loadedItems.length>0},get loadedItems(){var a,i;return null!=(i=null==(a=e.items)?void 0:a.filter(e=>null!==e))?i:[]},get isEmpty(){return e.isResolved&&(!e.pager||0===e.pager.total)}};return t}).actions(e=>({getData:(0,n.L3)(function*(t){let{pageSize:a=H.c,page:i=0}=t,{landingBlocksResource:r,modelActionsLogger:s}=(0,n._$)(e);if(!(e.loadingState===u.GuX.PENDING&&e.pendingPages.has("".concat(i)))&&!e.alreadyRequestedPages.has("".concat(i))){"number"==typeof i&&e.alreadyRequestedPages.set("".concat(i),i);try{var l;e.loadingState=u.GuX.PENDING,e.pendingPages.set("".concat(i),i);let t=yield r.getCollectionKidsPlaylistsLiked({page:i,pageSize:a}),s={page:i,perPage:a,total:t.pager.total};e.items&&0!==e.items.length||(e.items=(0,n.wg)(Array.from({length:s.total},()=>null)));let o=t.items.map(e=>(0,y.dF)(e.data).data);e.items&&(0,u.Iyy)({items:e.items,mappedRawItems:o,page:i,pageSize:a}),e.pager=s,e.requests=(null!=(l=e.requests)?l:0)+1,e.loadingState!==u.GuX.IDLE&&(e.loadingState=u.GuX.RESOLVE)}catch(t){s.error(t),e.loadingState!==u.GuX.IDLE&&(e.loadingState=u.GuX.REJECT)}finally{e.pendingPages.delete("".concat(i))}}}),reset(){e.loadingState=u.GuX.IDLE,e.destroyItems([e.pager,e.items]),e.pendingPages.clear(),e.alreadyRequestedPages.clear(),e.requests=null}})),J=n.gK.compose(n.gK.model("CollectionKidsTracksPage",{items:n.gK.maybeNull(n.gK.array(n.gK.maybeNull(w.vj))),pager:n.gK.maybeNull(S.jd),alreadyRequestedPages:n.gK.map(n.gK.number),pendingPages:n.gK.map(n.gK.number),requests:n.gK.maybeNull(n.gK.number)}),S.pl,S.XT).views(e=>{let t={get isShimmerVisible(){return e.isLoading||e.isRejected},get shouldShowContent(){return t.isShimmerVisible||t.loadedItems.length>0},get loadedItems(){var a,i;return null!=(i=null==(a=e.items)?void 0:a.filter(e=>null!==e))?i:[]},get sonataEntitiesData(){return t.loadedItems.map(w.$b)},get isEmpty(){return e.isResolved&&(!e.pager||0===e.pager.total)}};return t}).actions(e=>({getData:(0,n.L3)(function*(t){let{pageSize:a=H.c,page:i=0}=t,{landingBlocksResource:r,modelActionsLogger:s}=(0,n._$)(e);if(!(e.loadingState===u.GuX.PENDING&&e.pendingPages.has("".concat(i)))&&!e.alreadyRequestedPages.has("".concat(i))){"number"==typeof i&&e.alreadyRequestedPages.set("".concat(i),i);try{var l;e.loadingState=u.GuX.PENDING,e.pendingPages.set("".concat(i),i);let t=yield r.getCollectionKidsTracksLiked({page:i,pageSize:a}),s={page:i,perPage:a,total:t.pager.total};e.items&&0!==e.items.length||(e.items=(0,n.wg)(Array.from({length:s.total},()=>null)));let o=t.items.map(y.vI).map(e=>e.data);e.items&&(0,u.Iyy)({items:e.items,mappedRawItems:o,page:i,pageSize:a}),e.pager=s,e.requests=(null!=(l=e.requests)?l:0)+1,e.loadingState!==u.GuX.IDLE&&(e.loadingState=u.GuX.RESOLVE)}catch(t){s.error(t),e.loadingState!==u.GuX.IDLE&&(e.loadingState=u.GuX.REJECT)}finally{e.pendingPages.delete("".concat(i))}}}),reset(){e.loadingState=u.GuX.IDLE,e.destroyItems([e.pager,e.items]),e.pendingPages.clear(),e.alreadyRequestedPages.clear(),e.requests=null}})),Z=n.gK.model("CollectionKidsPage",{albums:Q,playlists:$,tracks:J}).views(e=>({get isNeededToLoad(){return e.albums.isNeededToLoad&&e.playlists.isNeededToLoad&&e.tracks.isNeededToLoad},get isRejected(){return e.albums.isRejected&&e.playlists.isRejected&&e.tracks.isRejected},get isResolved(){return e.albums.isResolved&&e.playlists.isResolved&&e.tracks.isResolved},get shouldShowContent(){return e.albums.shouldShowContent||e.playlists.shouldShowContent||e.tracks.shouldShowContent}})).actions(e=>({reset(){e.albums.reset(),e.playlists.reset(),e.tracks.reset()}})),ee=n.gK.compose(n.gK.model("CollectionShelfLikedPage",{pagesLoader:(0,S.Ij)(O),typeForFrom:n.gK.maybeNull(n.gK.string)}),S.pl).views(e=>({get isShimmerVisible(){return!e.pagesLoader.isSomePageResolved},get isNeededToLoad(){return e.pagesLoader.isNeedToMakeInitialRequest},get isRejected(){return e.pagesLoader.isInitialRequestRejected},get isEmpty(){return e.pagesLoader.isEmpty},get isResolved(){return e.pagesLoader.isSomePageResolved},get requestsCount(){return e.pagesLoader.requestsCount},get items(){return e.pagesLoader.items||[]}})).actions(e=>({getData:(0,n.L3)(function*(t){let{pageSize:a=H.c,page:i=0}=t,{nonMusicResource:r,modelActionsLogger:s}=(0,n._$)(e);if(e.pagesLoader.isPageNeedToLoad(i))try{var l,o;e.pagesLoader.setPageState(i,u.GuX.PENDING);let t=yield r.getShelfLiked({page:i,pageSize:a}),s=(null==(l=t.entities)?void 0:l.map(G))||[];e.pagesLoader.setItems(s,{page:i,pager:t.pager}),e.typeForFrom=null!=(o=t.typeForFrom)?o:null}catch(t){s.error(t),e.pagesLoader.setItems(null,{responseStatus:u.FlZ.ERROR,page:i})}}),reset(){e.pagesLoader.reset()}})),et=n.gK.compose(n.gK.model("CollectionShelfRecentlyPlayedPage",{items:n.gK.maybeNull(n.gK.array(n.gK.maybeNull(M))),pager:n.gK.maybeNull(S.jd),alreadyRequestedPages:n.gK.map(n.gK.number),pendingPages:n.gK.map(n.gK.number),requests:n.gK.maybeNull(n.gK.number),typeForFrom:n.gK.maybeNull(n.gK.string)}),S.pl,S.XT).views(e=>({get isShimmerVisible(){return e.isLoading||e.isRejected},get isEmpty(){return e.isResolved&&(!e.pager||0===e.pager.total)}})).actions(e=>({getData:(0,n.L3)(function*(t){let{pageSize:a=H.c,page:i=0}=t,{nonMusicResource:r,modelActionsLogger:s}=(0,n._$)(e);if(!(e.isLoading&&e.pendingPages.has("".concat(i)))&&!e.alreadyRequestedPages.has("".concat(i))){"number"==typeof i&&e.alreadyRequestedPages.set("".concat(i),i);try{var l,o,d,c,g;e.loadingState=u.GuX.PENDING,e.pendingPages.set("".concat(i),i);let t=yield r.getShelfRecentlyPlayed({page:i,pageSize:a}),s={page:i,perPage:a,total:null!=(d=null==(l=t.pager)?void 0:l.total)?d:0};e.items&&0!==e.items.length||(e.items=(0,n.wg)(Array.from({length:s.total},()=>null)));let m=(null==(o=t.entities)?void 0:o.map(K))||[];e.items&&(0,u.Iyy)({items:e.items,mappedRawItems:m,page:i,pageSize:a}),e.pager=s,e.typeForFrom=null!=(c=t.typeForFrom)?c:null,e.requests=(null!=(g=e.requests)?g:0)+1,e.loadingState!==u.GuX.IDLE&&(e.loadingState=u.GuX.RESOLVE)}catch(t){s.error(t),e.loadingState!==u.GuX.IDLE&&(e.loadingState=u.GuX.REJECT)}finally{e.pendingPages.delete("".concat(i))}}}),reset(){e.loadingState=u.GuX.IDLE,e.destroyItems([e.pager,e.items]),e.pendingPages.clear(),e.alreadyRequestedPages.clear(),e.requests=null}})),ea=n.gK.model("CollectionPage",{landing:y.Ju,albums:P,playlists:R,artists:k,shelf:U,shelfRecentlyPlayed:et,shelfLiked:ee,nonMusicLiked:A,dislikes:z,kids:Z,clips:C});a(69077),a(73250),a(26389),a(98150),a(51460),a(23144),a(4190),a(34620),a(84674),a(36422),a(47052),a(83708),a(94800),a(91302),a(18696),a(45324),a(53827),a(6949),a(24238);var ei=a(73437),er=a(15840);let es={experiments:{loadingState:u.GuX.IDLE,experiments:{},overwrittenExperiments:{}},disclaimers:{loadingState:u.GuX.IDLE,recentDisclaimersRequestTS:0},user:{account:{loadingState:u.GuX.IDLE,data:{}},settings:{loadingState:u.GuX.IDLE}},wizard:{loadingState:u.GuX.IDLE,modal:{},savedLikedArtists:[],likedArtists:[],unlikedArtists:[]},collection:{albums:{loadingState:u.GuX.IDLE,items:[],upcomingAlbums:{loadingState:u.GuX.IDLE}},playlists:{playlistsLiked:{loadingState:u.GuX.IDLE,items:[]},playlistsCreated:{loadingState:u.GuX.IDLE,items:[]},activeTabIndex:h.a.CREATED,tabs:[h.a.CREATED,h.a.LIKED]},artists:{loadingState:u.GuX.IDLE,items:[],topArtists:{loadingState:u.GuX.IDLE,items:[]}},landing:{loadingState:u.GuX.IDLE,tabs:{loadingState:u.GuX.IDLE}},shelf:{recentlyPlayed:{loadingState:u.GuX.IDLE},newEpisodes:{loadingState:u.GuX.IDLE},liked:{loadingState:u.GuX.IDLE}},nonMusicLiked:{loadingState:u.GuX.IDLE,items:[]},dislikes:{artists:{loadingState:u.GuX.IDLE},tracks:{loadingState:u.GuX.IDLE}},kids:{albums:{loadingState:u.GuX.IDLE},playlists:{loadingState:u.GuX.IDLE},tracks:{loadingState:u.GuX.IDLE}},shelfRecentlyPlayed:{loadingState:u.GuX.IDLE},shelfLiked:{pagesLoader:{}},clips:{loadingState:u.GuX.IDLE,clipsWillLike:{loadingState:u.GuX.IDLE}}},main:{landing:{loadingState:u.GuX.IDLE,tabs:{loadingState:u.GuX.IDLE}}},nonMusic:{landing:{loadingState:u.GuX.IDLE,tabs:{loadingState:u.GuX.IDLE}},albums:{loadingState:u.GuX.IDLE},categorySubpage:{loadingState:u.GuX.IDLE},categoryPlaylistsSubpage:{loadingState:u.GuX.IDLE}},kids:{landing:{loadingState:u.GuX.IDLE,tabs:{loadingState:u.GuX.IDLE}},kidsEditorialPlaylistSubpage:{loadingState:u.GuX.IDLE},kidsEditorialAlbumSubpage:{loadingState:u.GuX.IDLE}},settings:{layout:null,isLandscape:!1,isMobileLandscapeHeight:!1,browserInfo:{name:void 0,version:void 0,OSFamily:void 0,isMobile:!1,isTablet:!1,isTouch:!1,isBrowser:!1,inAppBrowser:!1,hasHuaweiAppGallery:!1}},currentClipInfo:{clipLoadingState:u.GuX.IDLE,creditsLoadingState:u.GuX.IDLE,id:null,clip:null,credits:null,modal:{}},currentTrackInfo:{trackLoadingState:u.GuX.IDLE,creditsLoadingState:u.GuX.IDLE,descriptionLoadingState:u.GuX.IDLE,id:null,albumId:null,isUGC:null,fullTrack:null,credits:null,modal:{}},trackLyrics:{loadingState:u.GuX.IDLE,lyrics:null,lyricId:null,externalLyricId:null,track:null,modal:{}},album:{loadingState:u.GuX.IDLE,items:[],meta:null,otherAlbumVersions:[],allTracksUnfinished:!1,donations:{loadingState:u.GuX.IDLE,items:[]},latestGenreAlbums:{loadingState:u.GuX.IDLE,items:[]},otherArtistAlbums:{loadingState:u.GuX.IDLE,items:[]},relatedContent:{loadingState:u.GuX.IDLE,items:[]}},promolanding:{loadingState:u.GuX.IDLE,items:[],meta:null,allTracksUnfinished:!1,promoCampaign:{loadingState:u.GuX.IDLE,isActive:!1},state:{contextId:null,contextType:null,entityMeta:null,status:m.MT.IDLE,canMoveBackward:!1,canMoveForward:!1,canSpeed:!1,canChangeRepeatMode:!0,repeatMode:g.pM.NONE,quality:c.e.BALANCED,canShuffle:!0,shuffle:!1}},albumCPA:{},artist:{loadingState:u.GuX.IDLE,meta:null,landing:{loadingState:u.GuX.IDLE,tabs:{loadingState:u.GuX.IDLE}},popularTracks:[],similarArtists:[],albums:[],discography:[],compilations:[],playlists:[],clips:[],fullTracksListSubpage:{loadingState:u.GuX.IDLE},albumsSubpage:{loadingState:u.GuX.IDLE},concertsSubpage:{loadingState:u.GuX.IDLE},similarArtistsSubPage:{loadingState:u.GuX.IDLE},familiarInfo:{loadingState:u.GuX.IDLE},familiarSubpage:{loadingState:u.GuX.IDLE},clipsSubpage:{loadingState:u.GuX.IDLE},commonSubPage:{},offlineArtist:{loadingState:u.GuX.IDLE,trackIds:{loadingState:u.GuX.IDLE},downloadedTracks:{loadingState:u.GuX.IDLE}},infoLoadingState:{loadingState:u.GuX.IDLE}},library:{loadingState:u.GuX.IDLE,tracks:{},artists:{},playlists:{},albums:{},clips:{}},sonataState:{contextId:null,contextType:null,entityMeta:null,status:m.MT.IDLE,canMoveBackward:!1,canMoveForward:!1,canSpeed:!1,canChangeRepeatMode:!0,repeatMode:g.pM.NONE,quality:c.e.BALANCED,canShuffle:!0,shuffle:!1,areCoresRegistered:!1,isVHCoreRegistered:!1},playlist:{loadingState:u.GuX.IDLE,meta:null,items:[],initialItems:[],similarPlaylists:[],filters:{loadingState:u.GuX.IDLE,shouldSendEventOnTabOpened:!0,shouldSendEventOnTabLoaded:!0},editorFeature:{shouldShowDuplicate:!1,shouldShowGenre:!1,shouldShowMajor:!1,colorMajorMap:{},duplicate:{}},search:{loadingState:u.GuX.IDLE,text:""}},slides:{userSlidesLoadingState:u.GuX.IDLE,artistSlidesLoadingState:u.GuX.IDLE,podcastSlidesLoadingState:u.GuX.IDLE,specialSlidesLoadingState:u.GuX.IDLE,userItems:[],artistItems:[],podcastItems:[],specialItems:[],isMuted:!1},vibe:{loadingState:u.GuX.IDLE,vibeResetLoadingState:u.GuX.IDLE,isApplying:!1},search:{searchCorrectedText:null,loadingState:u.GuX.IDLE,results:[],historyPage:{loadingState:u.GuX.IDLE,items:[]},mixes:{loadingState:u.GuX.IDLE,items:[]},landing:{loadingState:u.GuX.IDLE,tabs:{loadingState:u.GuX.IDLE}},history:{loadingState:u.GuX.IDLE}},vibeSettings:{loadingState:u.GuX.IDLE},pinsCollection:{loadingState:u.GuX.IDLE,index:{}},genre:{loadingState:u.GuX.IDLE,albumsSubpage:{loadingState:u.GuX.IDLE},artistsSubpage:{loadingState:u.GuX.IDLE,pagesLoader:{}},playlistsSubpage:{loadingState:u.GuX.IDLE}},genres:{title:null,loadingState:u.GuX.IDLE,items:[]},mixes:{loadingState:u.GuX.IDLE,items:[]},tag:{tagLoadingState:u.GuX.IDLE,playlistsLoadingState:u.GuX.IDLE,playlistsData:[],playlists:[]},chart:{tracksSubPage:{loadingState:u.GuX.IDLE,items:[]},podcastsSubPage:{loadingState:u.GuX.IDLE,items:[]}},post:{loadingState:u.GuX.IDLE},landingBlockEntities:{loadingState:u.GuX.IDLE},contextMenuPlaylists:{loadingState:u.GuX.IDLE,items:[]},musicHistory:{loadingState:u.GuX.IDLE,tabs:null},createPlaylist:{},location:{},disclaimer:{loadingState:u.GuX.IDLE},disclaimerModalData:{loadingState:u.GuX.IDLE},myMusic:{downloadedTracks:{loadingState:u.GuX.IDLE}},trailer:{loadingState:u.GuX.IDLE,withAnimation:!0,shouldAutoStartPlaying:!0,shouldSendEventOnTracksShowed:!0,modal:{},sonataStatusBeforeTrailerStart:m.MT.IDLE,isManuallyPaused:!0,state:{contextId:null,contextType:null,entityMeta:null,status:m.MT.IDLE}},communication:{loadingState:u.GuX.IDLE},modals:{disclaimerModal:{},shortcutsModal:{},aboutAppModal:{},overviewModal:{},ugcTrackEditModal:{modal:{}},popoverOverPlayer:{},crackdownModal:{},overwrittenExperimentsModal:{},buySubscriptionModal:{isOpened:!0},promoLandingBuySubscriptionModal:{},clearMemoryModal:{},imageSliderModal:{modal:{}},artistAboutModal:{loadingState:u.GuX.IDLE,modal:{}}},landing:{loadingState:u.GuX.IDLE,tabs:{loadingState:u.GuX.IDLE}},fullscreenPlayer:{modal:{},syncLyrics:{loadingState:u.GuX.IDLE},playQueue:{}},fullscreenVideoPlayer:{modal:{},ids:[],loadingState:u.GuX.IDLE,sonataStatusBeforeClipStart:m.MT.IDLE,withAnimation:!0,state:{contextId:null,contextType:null,entityMeta:null,status:m.MT.IDLE,canMoveBackward:!1,canMoveForward:!1}},advert:{data:null,isAdvertPlaying:!0,isAdvertShown:!1,isAdvertPlaybackCreated:!1},ugcUploadCenter:{checkProcessingTracksAttempts:0,notifications:{}},paymentWidgetModal:{modal:{},target:"",serviceSessionId:"",tariffOfferName:"",offersBatchId:"",offersPositionIds:"",isSilent:!1,status:er.cF.IDLE},offers:{music:{loadingState:u.GuX.IDLE}},quality:{modal:{}},releaseNotes:{modal:{}},slam:{networkStatus:{}},favoriteTracks:{loadingState:u.GuX.IDLE},track:{loadingState:u.GuX.IDLE,withAnimation:!0,shouldSendEventOnPlusButtonShowed:!0},familyInvite:{info:{loadingState:u.GuX.IDLE},acceptanceLoadingState:u.GuX.IDLE,modal:{},step:ei._n.INFO},continueListen:{},playlistPersonal:{loadingState:u.GuX.IDLE},redAlert:{loadingState:u.GuX.IDLE},shareIframe:{modal:{}},paywall:{modal:{}},downloadMobileApp:{modal:{}},advertBanners:{banners:{topAdvertBanner:{type:u.h8o.EMPTY,noAds:!1,hasError:!1,isShowBanner:!0},sideAdvertBanner:{type:u.h8o.EMPTY,noAds:!1,hasError:!1,isShowBanner:!0},brandedPlaylistBanner:{type:u.h8o.EMPTY,noAds:!1,hasError:!1,isShowBanner:!0}}},label:{loadingState:u.GuX.IDLE,albumsSubpage:{loadingState:u.GuX.IDLE,sort:{}},artistsSubpage:{loadingState:u.GuX.IDLE}},desktopPaywall:{},concerts:{loadingState:u.GuX.IDLE,config:{loadingState:u.GuX.IDLE},landing:{loadingState:u.GuX.IDLE,tabs:{loadingState:u.GuX.IDLE}}},concert:{loadingState:u.GuX.IDLE,landing:{loadingState:u.GuX.IDLE,tabs:{loadingState:u.GuX.IDLE}}}};var el=a(14795),en=a(48301),eo=a(45648),ed=a(63661),eu=a(44958),ec=a(61979),eg=a(90848);let em=n.gK.compose(n.gK.model("FavoriteTracksPage",{playlistUuid:n.gK.maybeNull(n.gK.string),errorStatusCode:n.gK.maybeNull(n.gK.number)}),S.XT).views(e=>({get playlistUrl(){if(!e.playlistUuid)return"";let{href:t}=(0,u.uvd)("/playlists/:playlistUuid",{params:{playlistUuid:e.playlistUuid}});return t}})).actions(e=>({getPlaylistUrl:(0,n.L3)(function*(){let{landingResource:t,modelActionsLogger:a}=(0,n._$)(e);if(e.loadingState!==u.GuX.PENDING)try{e.loadingState=u.GuX.PENDING,e.playlistUuid=(yield t.getBlock({source:{uri:"/landing/block/collection/playlist-with-likes",countWeb:8},type:eg.t.COLLECTION_PLAYLIST_WITH_LIKES})).playlist.playlistUuid,e.loadingState!==u.GuX.IDLE&&(e.loadingState=u.GuX.RESOLVE)}catch(t){a.error(t),t instanceof ec.GX&&(t.statusCode===ec.X1.NOT_FOUND||t.statusCode===ec.X1.BAD_REQUEST)&&(e.errorStatusCode=ec.X1.NOT_FOUND),e.loadingState!==u.GuX.IDLE&&(e.loadingState=u.GuX.REJECT)}}),reset(){e.loadingState=u.GuX.IDLE,e.playlistUuid=null}}));a(75414);var eh=a(97410),ey=a(74259),ep=a(17660),ev=a(25767);let eS=n.gK.model("MainPage",{landing:y.Ju});a(95936);var eE=a(61475),eP=a(12277),eb=a(65582);let ef=n.gK.compose(n.gK.model("MusicHistoryPage",{indexesMap:n.gK.map(n.gK.number),items:n.gK.maybeNull(n.gK.array(eP.UN)),datesMap:n.gK.map(n.gK.boolean),tabs:n.gK.maybeNull(n.gK.array(eP.WW))}),S.XT).views(e=>{let t={get isEmpty(){var a;return(e.isResolved||e.isRejected)&&(null==(a=e.tabs)?void 0:a.length)===0},get isShimmerVisible(){return e.isNeededToLoad||e.isLoading||e.isRejected},get isShimmerActive(){return e.isLoading},getStartAndEndIndexes(t){var a,i;let r=t,s=t+1;return(null==(a=e.items)?void 0:a.slice(t-25+1,t).some(e=>!e.isResolved))&&(r=t-25+1),(null==(i=e.items)?void 0:i.slice(t,t+25).some(e=>!e.isResolved))&&(s=t+25),[r,s]},getItemsToLoad(a){var i,r;let[s,l]=t.getStartAndEndIndexes(a);return null!=(r=null==(i=e.items)?void 0:i.slice(s,l).filter(e=>!e.isResolved))?r:[]},isInObservationRange(t){var a;return 0!==t&&t%25==0||e.items&&t===(null==(a=e.items)?void 0:a.length)-1},get dates(){var i,r;return null!=(r=null==(i=e.tabs)?void 0:i.map(e=>e.date))?r:[]}};return t}).actions(e=>{let t={fillItemsAndIndexes(){var t;let a=0;e.items=(0,n.wg)([]),null==(t=e.tabs)||t.forEach((t,i)=>{var r;e.datesMap.set(t.date,!1),null==(r=t.blocks)||r.forEach((t,r)=>{var s;let l=t.id;e.indexesMap.set("".concat(i,"_").concat(r,"_").concat(l),a),null==(s=e.items)||s.push({id:l,type:t.type,tabIndex:i,blockIndex:r,trackIndex:null,loadingState:a<25?u.GuX.RESOLVE:u.GuX.IDLE}),++a,t.tracks.forEach((t,s)=>{var l;e.indexesMap.set("".concat(i,"_").concat(r,"_").concat(s,"_").concat(t.id),a),null==(l=e.items)||l.push({id:t.id,type:t.type,tabIndex:i,blockIndex:r,trackIndex:s,loadingState:a<25?u.GuX.RESOLVE:u.GuX.IDLE}),++a})})})},setTrack(t,a){var i,r,s,l;let{tabIndex:n,blockIndex:o,trackIndex:d}=t,{fullModel:c}=a.data;if(null===d)return;let g=null==(l=e.tabs)||null==(s=l[n])||null==(r=s.blocks)||null==(i=r[o])?void 0:i.tracks[d];g&&(g.data=(0,w.vU)(c),g.loadingState=u.GuX.RESOLVE)},setAlbum(t,a){var i,r,s;let{tabIndex:l,blockIndex:n}=t,{fullModel:o}=a.data,d=null==(s=e.tabs)||null==(r=s[l])||null==(i=r.blocks)?void 0:i[n];(0,eP.z)(d)&&(d.meta=(0,p.sK)({album:o.album,artists:o.artists}),d.loadingState=u.GuX.RESOLVE)},setArtist(t,a){var i,r,s;let{tabIndex:l,blockIndex:n}=t,{fullModel:o}=a.data,d=null==(s=e.tabs)||null==(r=s[l])||null==(i=r.blocks)?void 0:i[n];(0,eP.bg)(d)&&(d.meta=(0,f.as)({artist:o.artist}),d.loadingState=u.GuX.RESOLVE)},setPlaylist(t,a){var i,r,s;let{tabIndex:l,blockIndex:n}=t,{fullModel:o}=a.data,d=null==(s=e.tabs)||null==(r=s[l])||null==(i=r.blocks)?void 0:i[n];(0,eP.kU)(d)&&(d.meta={...(0,D.bk)({playlist:o.playlist}),tracksCount:o.tracksCount},d.loadingState=u.GuX.RESOLVE)},setVibe(t,a){var i,r,s;let{tabIndex:l,blockIndex:n}=t,{fullModel:o}=a.data,d=null==(s=e.tabs)||null==(r=s[l])||null==(i=r.blocks)?void 0:i[n];(0,eP.sr)(d)&&(d.meta={...(0,eb.er)(o.wave),imageUrl:o.simpleWaveForegroundImageUrl,backgroundColor:o.simpleWaveBackgroundColor},d.loadingState=u.GuX.RESOLVE)},getMusicHistory:(0,n.L3)(function*(){let{musicHistoryResource:a,modelActionsLogger:i}=(0,n._$)(e);if(e.loadingState!==u.GuX.PENDING)try{e.loadingState=u.GuX.PENDING;let i=yield a.getMusicHistory({fullModelsCount:25}),r=(e=>{let t={historyTabs:[]},a=0;for(let s of e.historyTabs){var i,r;if(a>1e3)break;let e={...s,items:[]};for(let t of null!=(i=s.items)?i:[]){if(a>1e3)break;let i={...t,tracks:[]};for(let e of t.tracks){if(a>1e3)break;i.tracks.push(e),++a}null==(r=e.items)||r.push(i)}e.items&&e.items.length>0&&t.historyTabs.push(e)}return t})(i);e.tabs=(0,n.wg)(r.historyTabs.map(eP.Sv)),t.fillItemsAndIndexes(),e.loadingState=u.GuX.RESOLVE}catch(t){i.error(t),e.loadingState=u.GuX.REJECT}}),getItems:(0,n.L3)(function*(a){let{musicHistoryResource:i,modelActionsLogger:r}=(0,n._$)(e);try{let r=e.getItemsToLoad(a);r.forEach(e=>{e.loadingState=u.GuX.RESOLVE});let s=yield i.getMusicHistoryItems({items:r.map(e=>{switch(e.type){case eE.D.ARTIST:case eE.D.ALBUM:return{type:e.type,data:{itemId:{id:e.id}}};case eE.D.PLAYLIST:{let[t,a]=e.id.split(":");return{type:e.type,data:{itemId:{uid:Number(t),kind:Number(a)}}}}case eE.D.WAVE:return{type:e.type,data:{itemId:{seeds:e.id.split(",")}}};case eE.D.TRACK:{let[t,a]=e.id.split(":");return{type:e.type,data:{itemId:{trackId:String(t),albumId:a}}}}default:return null}}).filter(e=>e)}),l=r.reduce((e,t)=>{let a="".concat(t.type,"_").concat(t.id);if(a in e){var i;null==(i=e[a])||i.push(t)}else e[a]=[t];return e},{});s.items.forEach(e=>{var a;null==(a=l[(e=>{switch(e.type){case eE.D.ALBUM:return"".concat(e.type,"_").concat((0,eP.tM)(e));case eE.D.TRACK:return"".concat(e.type,"_").concat((0,eP.QF)(e));case eE.D.WAVE:return"".concat(e.type,"_").concat((0,eP.u)(e));case eE.D.PLAYLIST:return"".concat(e.type,"_").concat((0,eP.uZ)(e));case eE.D.ARTIST:return"".concat(e.type,"_").concat((0,eP.Hp)(e))}})(e)])||a.forEach(a=>{switch(e.type){case eE.D.ALBUM:t.setAlbum(a,e);break;case eE.D.TRACK:t.setTrack(a,e);break;case eE.D.WAVE:t.setVibe(a,e);break;case eE.D.PLAYLIST:t.setPlaylist(a,e);break;case eE.D.ARTIST:t.setArtist(a,e)}a.loadingState=u.GuX.RESOLVE})})}catch(e){r.error(e)}}),setDatesMap(t,a){e.datesMap.set(t,a)},reset(){e.items=null,e.tabs=null,e.indexesMap.clear(),e.datesMap.clear(),e.loadingState=u.GuX.IDLE}};return t});a(35233),a(68941);var eI=a(47416);let ek=n.gK.model("MyMusicPage",{downloadedTracks:eI.b});a(39959);var e_=a(55613),eT=a(84706),eC=a(83001),eA=a(36800),eD=a(39535),eN=a(21837),eL=a(18194),ex=a(88081);let eR=[ex.n.ARTIST,ex.n.ALBUM,ex.n.TRACK,ex.n.PLAYLIST,ex.n.WAVE,ex.n.PODCAST,ex.n.PODCAST_EPISODE],ew=[ex.n.ALBUM,ex.n.ARTIST,ex.n.PLAYLIST,ex.n.TRACK,ex.n.UGC_TRACK,ex.n.WAVE,ex.n.PODCAST,ex.n.PODCAST_EPISODE,ex.n.CLIP],eG=e=>{let{wave:t}=e,a="".concat(t.id.type,":").concat(t.id.tag);return(0,n.wg)({title:t.title,description:t.subTitle,stationId:a,seeds:[a],backgroundColor:t.color,imageUrl:t.image,agent:(0,eb.KU)(t.agent)})},eK=e=>{let{type:t}=e;switch(t){case ex.n.UGC_TRACK:return{type:t,data:(0,w.or)(e.track)};case ex.n.TRACK:return{type:t,data:(0,w.vU)(e.track)};case ex.n.ARTIST:return{type:t,data:(0,f.dM)(e.artist)};case ex.n.PLAYLIST:return{type:t,data:(0,D.Ew)({...e.playlist,artists:[]})};case ex.n.ALBUM:return{type:t,data:(0,p.pp)(e.album)};case ex.n.WAVE:return{type:t,data:eG(e)};case ex.n.PODCAST:return{type:t,data:(0,p.pp)(e.podcast)};case ex.n.PODCAST_EPISODE:return{type:t,data:(0,w.vU)(e.podcast_episode)};default:return null}};var eO=a(11167),eM=a(65255),eX=a(51551);let eF=n.gK.compose(n.gK.model("SearchHistoryPage",{items:n.gK.array(eL.jU)}),S.pl,S.XT).actions(e=>({reset(){e.destroyItems([e.items])}})),ej=n.gK.model("SearchHistory",{loadingState:n.gK.enumeration(Object.values(u.GuX)),shouldUpdateHistory:n.gK.optional(n.gK.boolean,!1)}).views(e=>({get hasCleared(){return e.loadingState===u.GuX.RESOLVE}})).actions(e=>({setShouldUpdateHistory(t){e.shouldUpdateHistory=t},clear:(0,n.L3)(function*(){if(!(0,n._n)(e))return;let{user:t}=(0,n.Zn)(e),{usersResource:a,modelActionsLogger:i}=(0,n._$)(e);if(e.loadingState!==u.GuX.PENDING&&t.account.data.uid)try{e.loadingState=u.GuX.PENDING,yield a.clearSearchHistory({userId:t.account.data.uid}),e.loadingState=u.GuX.RESOLVE}catch(t){i.error(t),e.loadingState=u.GuX.REJECT}}),reset(){e.loadingState=u.GuX.IDLE}})),eU=n.gK.compose(n.gK.model("SearchPage",{searchCorrectedText:n.gK.maybeNull(n.gK.string),searchRequestId:n.gK.optional(n.gK.string,""),results:n.gK.array(eL.jU),bestResults:n.gK.array(eL.xo),historyPage:eF,mixes:eN.YM,landing:y.Ju,history:ej,filters:n.gK.maybeNull(n.gK.array(eL.k1))}),S.pl,S.XT).views(e=>({get isHistoryShimmerVisible(){return e.historyPage.isLoading||e.historyPage.isRejected},get isHistoryLoading(){return e.historyPage.isLoading},get isHistoryReady(){return e.historyPage.isNeededToLoad},get isEmptyHistory(){return!e.historyPage.items.length&&e.historyPage.isResolved},get isShimmerVisible(){return e.isLoading||e.isRejected},get isEmpty(){return!e.isLoading&&0===e.results.length&&0===e.bestResults.length}})).actions(e=>({getSearchResults:(0,n.L3)(function*(t){let{text:a,filter:i,withClips:r=!1}=t,{searchResource:s}=(0,n._$)(e),{experiments:l}=(0,n.Zn)(e);try{let t;e.loadingState=u.GuX.PENDING;let o=yield s.getInstantMixedSearch({text:a,type:(t=[...ew],i===eD.$.TOP&&(t=t.filter(e=>e!==ex.n.UGC_TRACK)),r||(t=t.filter(e=>e!==ex.n.CLIP)),t),filter:i===eD.$.TOP?void 0:i,withLikesCount:!0,page:0,pageSize:36,withBestResults:l.checkExperiment(u.zal.WebNextSearchBestResults,"on")&&i===eD.$.TOP});o.misspellResult&&(e.searchCorrectedText=o.misspellResult),o.results&&o.results.length>0&&(e.results=(0,n.wg)(o.results.map(e=>{switch(e.type){case ex.n.ALBUM:return{type:ex.n.ALBUM,data:(0,p.pp)(e.album)};case ex.n.ARTIST:return{type:ex.n.ARTIST,data:(0,f.dM)(e.artist)};case ex.n.PLAYLIST:return{type:ex.n.PLAYLIST,data:(0,D.Ew)({...e.playlist,artists:[]})};case ex.n.UGC_TRACK:return{type:ex.n.UGC_TRACK,data:(0,w.or)(e.track)};case ex.n.TRACK:return{type:ex.n.TRACK,data:(0,w.vU)(e.track)};case ex.n.WAVE:return{type:ex.n.WAVE,data:eG(e)};case ex.n.PODCAST:return{type:ex.n.PODCAST,data:(0,p.pp)(e.podcast)};case ex.n.CLIP:return{type:ex.n.CLIP,data:(0,_.i$)(e.clip)};case ex.n.PODCAST_EPISODE:return{type:ex.n.PODCAST_EPISODE,data:(0,w.vU)(e.podcast_episode)}}}).filter(e=>e)),e.searchRequestId=o.searchRequestId),o.bestResults&&o.bestResults.length>0&&l.checkExperiment(u.zal.WebNextSearchBestResults,"on")&&(e.bestResults=(0,n.wg)(o.bestResults.map(e=>{switch(e.type){case eO.r.ALBUM:return{type:eO.r.ALBUM,data:(0,p.sK)({album:e.best_result_album.album,artists:e.best_result_album.artists,trailer:e.best_result_album.trailer})};case eO.r.PLAYLIST:return{type:eO.r.PLAYLIST,data:(0,D.bk)({playlist:e.best_result_playlist.playlist,likesCount:e.best_result_playlist.likesCount,tracksCount:e.best_result_playlist.trackCount,trailer:e.best_result_playlist.trailer})};case eO.r.RECENT_RELEASE:return{type:eO.r.RECENT_RELEASE,data:(0,p.sK)({album:e.best_result_recent_release.album,artists:e.best_result_recent_release.artists,trailer:e.best_result_recent_release.trailer})};case eO.r.WAVE:return{type:eO.r.WAVE,data:(0,eb.er)(e.best_result_wave)};case eO.r.ARTIST:return{type:eO.r.ARTIST,data:(0,f.as)({artist:e.best_result_artist.artist,trailer:e.best_result_artist.trailer,likesCount:e.best_result_artist.likesCount})};case eO.r.UPCOMING:return{type:eO.r.UPCOMING,data:(0,p.lO)(e.best_result_upcoming)};case eO.r.CONCERT:return{type:eO.r.CONCERT,data:(0,eX.oP)(e.best_result_concert)};case eO.r.PODCAST:return{type:eO.r.PODCAST,data:(0,p.sK)({album:e.best_result_podcast.album,likesCount:e.best_result_podcast.likesCount})};case eO.r.PODCAST_EPISODE:return{type:eO.r.PODCAST_EPISODE,data:(0,w.vU)(e.best_result_podcast_episode)};case eO.r.OVERVIEW:return{type:eO.r.OVERVIEW,data:(0,eM.tm)(e.best_result_overview)};case eO.r.NON_MUSIC:return{type:eO.r.NON_MUSIC,data:(0,p.sK)({album:e.best_result_non_music.album,artists:e.best_result_non_music.artists,releaseYear:e.best_result_non_music.releaseYear})};case eO.r.TRACK:return{type:eO.r.TRACK,data:(0,w.vU)(e.best_result_track)};case eO.r.CLIP:return{type:eO.r.CLIP,data:(0,_.i$)(e.best_result_clip)};case eO.r.BOOK_CHAPTER:return{type:eO.r.BOOK_CHAPTER,data:(0,w.vU)(e.best_result_book_chapter)}}}).filter(e=>e))),o.filters&&o.filters.length>0&&(e.filters=(0,n.wg)(o.filters)),e.loadingState=u.GuX.RESOLVE}catch(t){e.loadingState=u.GuX.REJECT}}),getHistory:(0,n.L3)(function*(t){let{userId:a}=t;if(e.historyPage.loadingState===u.GuX.PENDING)return;let{usersResource:i,modelActionsLogger:r}=(0,n._$)(e);try{e.historyPage.loadingState=u.GuX.PENDING;let t=yield i.getSearchHistory({userId:a,supportedTypes:eR});e.historyPage.items=(0,n.wg)(t.map(eK).filter(e=>e)),e.historyPage.loadingState=u.GuX.RESOLVE}catch(t){r.error(t),e.historyPage.loadingState=u.GuX.REJECT}}),clearHistory:(0,n.L3)(function*(t){let{userId:a}=t,{usersResource:i,modelActionsLogger:r}=(0,n._$)(e);if(e.loadingState!==u.GuX.PENDING)try{e.loadingState=u.GuX.PENDING,yield i.clearSearchHistory({userId:a}),e.loadingState=u.GuX.RESOLVE}catch(t){r.error(t),e.loadingState=u.GuX.REJECT}}),resetHistoryItems(){e.historyPage.reset()},resetHistoryStateRequest(){e.historyPage.loadingState=u.GuX.IDLE,e.historyPage.reset()},resetResults(){e.destroyItems([e.results,e.bestResults])},resetSearchCorrectedText(){e.searchCorrectedText=null},reset(){e.searchCorrectedText=null,e.loadingState=u.GuX.IDLE,e.filters=null,e.destroyItems([e.results,e.bestResults])},sendFeedback:(0,n.L3)(function*(t){let{searchResource:a,modelActionsLogger:i}=(0,n._$)(e);try{yield a.sendFeedback(t)}catch(e){i.error(e)}})}));a(2488),a(3230),a(15533),a(5762);var eV=a(70286),eB=a(36396),eq=a(267);let eY=n.gK.model("AdvertBanners",{banners:n.gK.model({topAdvertBanner:S.JE,sideAdvertBanner:S.JE,brandedPlaylistBanner:eq.Ab})}).views(e=>{let t={get values(){return[e.banners.topAdvertBanner,e.banners.sideAdvertBanner,e.banners.brandedPlaylistBanner]},get hasBranding(){return t.values.some(e=>e.type===u.h8o.BRANDING)},isVisible(a){let{experiments:i}=(0,n.Zn)(e);if(i.checkExperiment(u.zal.WebNextDisableAds,"on"))return!1;if(a===u.h8o.EMPTY)return!0;let r=t.values.filter(e=>e.type!==u.h8o.EMPTY);return a===u.h8o.DIRECT?r.every(e=>e.type===u.h8o.DIRECT):a!==u.h8o.CREATIVE||r.every(e=>e.type!==u.h8o.BRANDING)}};return t});var eW=a(40238);!function(e){e.BAR_BELOW="barBellow",e.FULLSCREEN="fullscreen"}(i||(i={}));var ez=a(86823),eH=a(10560);let eQ=n.gK.model("CommunicationList",{barBelow:ez.t5,modal:eH.k8}),e$=n.gK.model("Communication",{loadingState:n.gK.enumeration(Object.values(u.GuX)),list:n.gK.maybe(eQ),errorStatusCode:n.gK.maybeNull(n.gK.number)}).actions(e=>{let t={getData:(0,n.L3)(function*(){let{dynamicPagesResource:a,modelActionsLogger:r}=(0,n._$)(e);if(e.loadingState!==u.GuX.PENDING&&e.loadingState!==u.GuX.RESOLVE)try{e.loadingState=u.GuX.PENDING;let r=yield a.getTriggers({anchorIds:Object.values(eW.v)});if(e.list=(e=>{let t=[],a=[];return e.triggers.forEach(e=>{switch(e.meta.notificationId){case i.BAR_BELOW:t.push((0,ez.S3)(e));return;case i.FULLSCREEN:a.push((0,eH.fZ)(e));return}}),(0,n.wg)({barBelow:{list:t},modal:{list:a}})})(r),e.loadingState!==u.GuX.IDLE&&(e.loadingState=u.GuX.RESOLVE),!e.list)return;let{barBelow:s,modal:l}=e.list;s.setAnchorId(eW.v.ON_START_BAR_BELOW),s.barBelowItem&&(s.show(),t.shown(s.barBelowItem.anchorId,s.barBelowItem.screenId)),l.setAnchorId(eW.v.ON_START_FULLSCREEN),l.modalItem&&(l.open(),t.shown(l.modalItem.anchorId,l.modalItem.screenId))}catch(t){r.error(t),t instanceof ec.GX&&(t.statusCode===ec.X1.NOT_FOUND||t.statusCode===ec.X1.BAD_REQUEST)&&(e.errorStatusCode=ec.X1.NOT_FOUND),e.loadingState!==u.GuX.IDLE&&(e.loadingState=u.GuX.REJECT)}}),shown:(0,n.L3)(function*(t,a){let{dynamicPagesResource:i,modelActionsLogger:r}=(0,n._$)(e);try{yield i.shown({anchorIds:[t],screenId:a})}catch(e){r.error(e)}}),action:(0,n.L3)(function*(t,a,i){let{dynamicPagesResource:r,modelActionsLogger:s}=(0,n._$)(e);try{yield r.action({anchorIds:[t],screenId:a,actionId:i})}catch(e){s.error(e)}})};return t});var eJ=a(81821),eZ=a(43535),e0=a(13552);let e1=n.gK.model("ModalsModel",{disclaimerModal:S.qt,shortcutsModal:S.qt,aboutAppModal:S.qt,overviewModal:S.qt,ugcTrackEditModal:w.n_,popoverOverPlayer:S.qt,crackdownModal:S.qt,overwrittenExperimentsModal:S.qt,buySubscriptionModal:S.qt,clearMemoryModal:S.qt,imageSliderModal:e0.J,promoLandingBuySubscriptionModal:S.qt,artistAboutModal:b.Xj});var e3=a(72713),e6=a(32717),e7=a(93222),e8=a(31512),e4=a(96342),e9=a(74726),e2=a(15259),e5=a(77575),te=a(55329),tt=a(85897);let ta=n.gK.model("Network",{isOffline:n.gK.optional(n.gK.boolean,!1)}),ti=n.gK.model("Entity",{progress:n.gK.maybe(n.gK.number),loadingState:n.gK.enumeration(Object.values(tt.DT))}),tr=n.gK.model("Slam",{networkStatus:ta,offlineMode:n.gK.optional(n.gK.boolean,!1),tracks:n.gK.map(ti)}).views(e=>{let t={isTrackDownloaded:t=>{var a;return(null==(a=e.tracks.get(t))?void 0:a.loadingState)===tt.DT.DOWNLOADED},isTrackDownloading:t=>{var a;return(null==(a=e.tracks.get(t))?void 0:a.loadingState)===tt.DT.DOWNLOADING},getTrackDownloadingProgress:t=>{var a,i;return null!=(i=null==(a=e.tracks.get(t))?void 0:a.progress)?i:0},isPlaylistDownloaded:e=>e.every(e=>{let[a]=(0,B.d)(e);return!!a&&t.isTrackDownloaded(a)}),isPlaylistDownloading:e=>e.some(e=>{let[a]=(0,B.d)(e);return!!a&&t.isTrackDownloading(a)}),getPlaylistDownloadingProgress:e=>Math.floor(e.reduce((e,a)=>{let[i]=(0,B.d)(a);return i&&t.isTrackDownloaded(i)?e+1:e},0)/e.length*100),get isOfflineModeEnabled(){if(!(0,n._n)(e))return!1;return e.offlineMode}};return t}).actions(e=>({setNetworkStatus:t=>{e.networkStatus=t},setTrack:(t,a)=>{e.tracks.set(t,a)},setTracks:t=>{e.tracks=(0,n.wg)(t)},setOfflineMode:t=>{let{localStorage:a}=(0,n._$)(e);e.offlineMode=t,a.set(u.cYZ.OfflineMode,t)}}));var ts=a(82060),tl=a(8159),tn=a(29318);!function(e){e.PROCESSING="processing",e.PLAYABLE="playable"}(r||(r={}));var to=a(61744),td=a(38261);let tu=n.gK.model("UgcUploadCenterNotificationsPairModel",{playlist:N.$o,type:n.gK.enumeration(Object.values(td.u))}),tc=n.gK.model("UgcUploadCenterNotificationsModel",{pairs:n.gK.array(tu)}).views(e=>({isNotificationExists:(t,a)=>e.pairs.some(e=>e.playlist.kind===t&&e.type===a)})).actions(e=>{let t={addNotification(t,a){e.pairs.push({playlist:(0,tn.HO)(t),type:a})},addNonexistentNotification(a,i){e.isNotificationExists(a.kind,i)||t.addNotification(a,i)},showAllNotifications(){let t=(0,tn.HO)(e.pairs);return e.pairs=(0,n.wg)([]),t}};return t}),tg=n.gK.model("UgcUploadCenterTrackPlaylistPair",{playlist:N.$o,file:to.vz}),tm=n.gK.model("UgcUploadCenterModel",{tracks:n.gK.array(tg),notifications:tc,checkProcessingTracksAttempts:n.gK.number}).views(e=>({getUploadingTracksByPlaylistKind:t=>t?e.tracks.filter(e=>e.playlist.kind===t).map(e=>e.file):[],getTracksByLoadingState:t=>e.tracks.filter(e=>e.file.loadingState===t).map(e=>e.file),get idleTracks(){return this.getTracksByLoadingState(to.pK.IDLE)},get preparingTracks(){return this.getTracksByLoadingState(to.pK.PREPARE)},get uploadingTracks(){return this.getTracksByLoadingState(to.pK.UPLOADING)},get processingTracks(){return this.getTracksByLoadingState(to.pK.PROCESSING)},get hasTracksInUploadingState(){return this.preparingTracks.length+this.uploadingTracks.length>0},get shouldCheckProcessingTracks(){return e.checkProcessingTracksAttempts<25&&this.processingTracks.length>0},getPlaylistByKind(t){var a;return null==(a=e.tracks.find(e=>e.playlist.kind===t))?void 0:a.playlist}})).actions(e=>{let t={appendFiles(t,a){if(t.forEach(t=>{if(t.size>0x19000000)return void e.notifications.addNonexistentNotification(a,td.u.FILE_TOO_LARGE);let i=to.vz.create({loadingState:to.pK.IDLE,playlistKind:a.kind});i.setFile(t);let r=tg.create({file:i,playlist:(0,tn.HO)(a)});e.tracks.unshift(r)}),!(0,n._n)(e))return;let{playlist:i}=(0,n.Zn)(e);i.search.setText(""),i.search.reset(),this.runUploadTracksQueue()},async runUploadTracksQueue(){let a=e.idleTracks;if(a.length&&!e.hasTracksInUploadingState){let i=a[a.length-1];i&&(await i.runUpload(),i.loadingState===to.pK.REJECT&&i.errorReason===to.oQ.TOO_MANY_FILES&&(e.tracks=(0,n.wg)([]),t.addNotificationForPlaylistKind(i.playlistKind,td.u.TOO_MANY_FILES)),t.checkNotifications()),t.setCheckProcessingTracksAttempts(0),t.runUploadTracksQueue()}},checkProcessingTracks:(0,n.L3)(function*(){let{tracksResource:a,modelActionsLogger:i}=(0,n._$)(e),s=[];if(e.checkProcessingTracksAttempts>=25)return null;t.setCheckProcessingTracksAttempts(e.checkProcessingTracksAttempts+1);try{let t=e.processingTracks.map(e=>e.trackId).filter(e=>!!e);if(!t.length)return null;let i=yield a.getTracksMeta({trackIds:t,withProgress:!0});null==i||i.forEach(t=>{let a=e.tracks.find(e=>e.file.trackId===t.id&&t.state===r.PLAYABLE);a&&(a.file.loadingState=to.pK.RESOLVE,a.file.trackId&&s.push(a.file.trackId))})}catch(e){i.error(e)}return t.checkNotifications(s),t.moveTracksFromUploadCenterToPlaylist(),null}),moveTracksFromUploadCenterToPlaylist(){var t;if(!(0,n._n)(e))return;let{playlist:a}=(0,n.Zn)(e);(null==(t=a.meta)?void 0:t.kind)&&e.tracks.find(e=>{var t;return e.file.loadingState===to.pK.RESOLVE&&e.playlist.kind===(null==(t=a.meta)?void 0:t.kind)})&&a.refreshTracks(),e.tracks=(0,n.wg)(e.tracks.filter(e=>e.file.loadingState!==to.pK.RESOLVE))},setCheckProcessingTracksAttempts(t){e.checkProcessingTracksAttempts=t},clearCancelledUploads(){e.tracks=(0,n.wg)(e.tracks.filter(e=>e.file.loadingState!==to.pK.CANCELLED))},checkNotifications(a){let i=new Set;e.tracks.forEach(e=>i.add(e.playlist.kind)),i.forEach(i=>{let r=e.getUploadingTracksByPlaylistKind(i);if(!(!r.length||r.some(e=>e.loadingState!==to.pK.RESOLVE&&e.loadingState!==to.pK.REJECT)))if(r.some(e=>e.loadingState===to.pK.REJECT)){let s=!0;if(a&&a.length){let t=r.map(e=>e.trackId).filter(e=>e),i=(0,ts.A)(t,a,tl.A);i.length&&(s=i.map(t=>e.tracks.find(e=>e.file.trackId===t)).some(e=>(null==e?void 0:e.file.loadingState)===to.pK.REJECT))}s&&t.addNotificationForPlaylistKind(i,td.u.UNKNOWN_ERROR)}else t.addNotificationForPlaylistKind(i,td.u.SUCCESS)})},addNotificationForPlaylistKind(t,a){let i=e.getPlaylistByKind(t);i&&e.notifications.addNonexistentNotification(i,a)}};return t});a(73258);var th=a(78597),ty=a(52931);let tp=e=>{var t,a;return{id:e.id,type:e.type,title:e.title,description:e.description,details:{text:null==(t=e.details)?void 0:t.text,url:null==(a=e.details)?void 0:a.url}}},tv=n.gK.compose(n.gK.model("Disclaimers",{disclaimers:n.gK.maybe(n.gK.array(S.GV)),recentDisclaimersRequestTS:n.gK.number}),S.XT).actions(e=>{let t={getDisclaimers:(0,n.L3)(function*(){let{disclaimersResource:t,modelActionsLogger:a}=(0,n._$)(e);if(e.loadingState!==u.GuX.PENDING)try{e.loadingState=u.GuX.PENDING,e.recentDisclaimersRequestTS=Date.now();let a=yield t.getDisclaimers();e.disclaimers=(0,n.wg)(a.map(tp)),e.loadingState!==u.GuX.IDLE&&(e.loadingState=u.GuX.RESOLVE)}catch(t){a.error(t),e.loadingState!==u.GuX.IDLE&&(e.loadingState=u.GuX.REJECT)}}),getDisclaimerById:(0,n.L3)(function*(a){var i,r;let s=null==(i=e.disclaimers)?void 0:i.find(e=>e.id===a);return s||(Date.now()-e.recentDisclaimersRequestTS>18e5&&(yield t.getDisclaimers()),null==(r=e.disclaimers)?void 0:r.find(e=>e.id===a))})};return t}),tS=n.gK.model("DesktopPaywallModel").volatile(()=>({crackdownTimeoutId:null})).views(e=>{let t={get isPaywallOpen(){let{paywall:t}=(0,n.Zn)(e);return t.modal.isOpened},get intervalMsOnEnter(){var a;let{experiments:t}=(0,n.Zn)(e),i=null==(a=t.getExperiment(u.zal.WebNextDesktopPaywallInterval))?void 0:a.value.interval;if(Number.isNaN(i))return 2592e5;return i},get intervalMsCrackdown(){var i;let{experiments:t}=(0,n.Zn)(e),a=null==(i=t.getExperiment(u.zal.WebNextPaywallCrackdownInterval))?void 0:i.value.interval;if(Number.isNaN(a))return 9e5;return a},get shouldShowOnEnter(){var r,s;let{settings:a}=(0,n.Zn)(e);if(null==(r=a.browserInfo)?void 0:r.isMobile)return!1;let{localStorage:i}=(0,n._$)(e),l=null==(s=i.get(u.cYZ.DesktopPaywall))?void 0:s.lastOnLoadShowDate;if(void 0===l)return!0;return new Date(l).getTime()<Date.now()-t.intervalMsOnEnter},get isReadyToShowCrackdown(){if(this.isPaywallOpen)return!1;let{paymentWidgetModal:t,modals:{crackdownModal:a}}=(0,n.Zn)(e);if(t.modal.isOpened||a.isOpened)return!1;return!0}};return t}).actions(e=>({showPaywall(){let{paywall:t,settings:a}=(0,n.Zn)(e),{localStorage:i}=(0,n._$)(e);a.isMobile},clearCrackdownTimeout(){null!==e.crackdownTimeoutId&&(clearTimeout(e.crackdownTimeoutId),e.crackdownTimeoutId=null)},startCrackdownTimeout(){let{paywall:t,settings:a,experiments:i}=(0,n.Zn)(e);a.isMobile}})),tE=n.gK.model({text:n.gK.string,buttonText:n.gK.string,href:n.gK.string}),tP=n.gK.compose(n.gK.model("RedAlert",{data:n.gK.maybeNull(tE)}),S.XT).views(e=>({get isVisible(){let{settings:t}=(0,n.Zn)(e);return t.layout!==u.u40.Mobile&&!!e.data},get text(){if(null===e.data)throw Error("Missing data");return e.data.text},get buttonText(){if(null===e.data)throw Error("Missing data");return e.data.buttonText},get href(){if(null===e.data)throw Error("Missing data");return e.data.href}})).actions(e=>({getData:(0,n.L3)(function*(){if(e.loadingState===u.GuX.PENDING)return;let{user:t}=(0,n.Zn)(e),{redAlertResource:a,modelActionsLogger:i}=(0,n._$)(e);if(!t.isAuthorized){e.loadingState=u.GuX.IDLE;return}e.loadingState=u.GuX.PENDING;try{let t=yield a.getRedAlerts({service:"music",client:"music-web",platform:"web"});e.data=(e=>{let t=e.alerts.find(e=>{let{id:t}=e;return"music-grace"===t});return void 0===t?null:(0,n.wg)({text:t.texts["bar-text"],buttonText:t.texts["bar-button-text"],href:t.clickUrl})})(t),e.loadingState=u.GuX.RESOLVE}catch(t){i.error(t),e.loadingState=u.GuX.REJECT}})}));var tb=a(69725),tf=a(34944);let tI=n.gK.model("Root",{experiments:S.YL,user:tf.Fv,wizard:e2.H,collection:ea,disclaimers:tv,main:eS,settings:S.dA,currentClipInfo:_.$d,currentTrackInfo:w.UU,album:el.MH,promolanding:el.Wh,artist:en.E,library:S.br,sonataState:q.bG,playlist:eT.Pn,albumCPA:el.dx,slides:tb.M1,vibe:e4.D,search:eU,vibeSettings:th.LL,pinsCollection:e3._1,genre:eh.G8,genres:ey.Zt,mixes:eN.YM,myMusic:ek,tag:eV.vV,chart:eo.vB,post:eA.VQ,landingBlockEntities:y.hn,contextMenuPlaylists:L,musicHistory:ef,createPlaylist:N.Co,location:S.FN,nonMusic:e_.rN,disclaimer:ty.WA,disclaimerModalData:ty.WA,communication:e$,trailer:e8.v,modals:e1,landing:y.Ju,fullscreenPlayer:e7.uZ,fullscreenVideoPlayer:e9.bg,releaseNotes:e5._o,trackLyrics:w.DP,ugcUploadCenter:tm,paymentWidgetModal:er.bo,offers:S.Fr,quality:e7.OK,kids:ep.GY,slam:tr,favoriteTracks:em,advert:e7.kn,track:eB.qQ,continueListen:eJ.mK,playlistPersonal:eC.Hj,familyInvite:ei.J4,redAlert:tP,shareIframe:te.D,paywall:e6.Sz,downloadMobileApp:eZ.A,advertBanners:eY,label:ev.X,desktopPaywall:tS,concerts:eu.cw,concert:ed.Bd}),tk=(e,t)=>tI.create(e,t);var t_=a(86512);let tT=["settings","sonataState","offers","modals","shareIframe","paywall","downloadMobileApp","disclaimerModalData","fullscreenPlayer","fullscreenVideoPlayer","advertBanners","redAlert","communication","desktopPaywall"];(0,l.eO)(!1);let tC=e=>{let{nonce:t,snapshotsRef:a}=e;(0,d.useContext)(o.ServerInsertedHTMLContext)},tA=e=>{let{children:t,nonce:a}=e,i=(0,d.useRef)([]),r=(0,u.Yx9)(),[l]=(0,d.useState)(()=>{var e;return(null==(e=window.__STATE_SNAPSHOT__)?void 0:e.length)?tk(window.__STATE_SNAPSHOT__[window.__STATE_SNAPSHOT__.length-1],r):tk(es,r)});return(0,d.useLayoutEffect)(()=>{function e(){var e;let t=null==(e=window.__STATE_SNAPSHOT__)?void 0:e[window.__STATE_SNAPSHOT__.length-1];t&&(0,n.Nh)(l,tT.reduce((e,t)=>(e[t]=l[t],e),(0,t_.A)(t))),delete window.__STATE_SNAPSHOT__}return e(),window.addEventListener("yMusicStateSnapshotUpdated",e),()=>window.removeEventListener("yMusicStateSnapshotUpdated",e)},[l]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(tC,{nonce:a,snapshotsRef:i}),(0,s.jsx)(u.PdQ.Provider,{value:l,children:t})]})}},11463:(e,t,a)=>{"use strict";a.d(t,{KidsEditorialAlbumsPage:()=>P});var i=a(33008),r=a(85896),s=a(97531),l=a(17846),n=a(66268),o=a(73827),d=a(18064),u=a(42213),c=a(42314),g=a(77868),m=a(83888),h=a(52732),y=a(64143),p=a(94767),v=a(53799),S=a(24147),E=a.n(S);let P=(0,s.PA)(e=>{var t,a,s;let{id:S}=e,{kids:{kidsEditorialAlbumSubpage:P},settings:{isMobile:b}}=(0,p.Pjs)(),f=(0,p.W6M)(),{contentScrollRef:I,setContentScrollRef:k}=(0,p.gKY)(),{formatMessage:_}=(0,o.A)(),T=(0,u.c)(e=>{P.getAlbums({page:e,pageSize:20})});P.isNotFound&&(0,l.notFound)(),(0,n.useEffect)(()=>()=>{P.reset()},[P]);let C=(0,c.L)(()=>({Footer:()=>(0,i.jsx)(v.A,{children:(0,i.jsx)(v.wi,{className:E().footer})})}));if((0,p.Jzs)(P.isResolved),P.isNeededToLoad&&(0,n.use)(P.getData({id:S,page:0,pageSize:20})),P.isSomethingWrong)return(0,i.jsx)(m.w,{});let A=P.isLoading?20:null!=(a=null==P||null==(t=P.albums)?void 0:t.length)?a:0;return(0,i.jsx)(p.nVz,{pageId:p._Q$.KIDS_EDITORIAL_ALBUMS,children:(0,i.jsx)(y.hO,{scrollElement:I,outerTitle:P.title,children:(0,i.jsxs)("div",{className:E().root,...(0,d.Am)(d.Xk.kids.KIDS_EDITORIAL_ALBUMS),children:[(0,i.jsx)(v.Y9,{variant:v.Vw.TEXT,withForwardControl:!1,withBackwardControl:f.canBack,children:(0,i.jsx)(g.Heading,{variant:"h2",weight:"bold",size:"xl",lineClamp:1,children:P.title})}),(0,i.jsx)(v.$$,{context:{listAriaLabel:_({id:"mixes.albums-list"},{genreName:P.title||""})},className:(0,r.$)(E().scrollContainer,E().important),customComponents:C,itemContentCallback:e=>{var t,a;let r=null==P||null==(a=P.albums)||null==(t=a[e])?void 0:t.data,s=_({id:"loading-messages.entity-is-loading"},{entityName:_({id:"entity-names.album"})});return r?(0,i.jsx)(h.aX,{withLikesCount:!0,album:r,contentLinesCount:3},r.id):(0,i.jsx)(v.Vt,{isActive:!0,"aria-label":s})},initialItemCount:A,totalCount:A,onGetDataByPage:T,pageSize:20,totalRequests:null!=(s=P.requests)?s:0,listClassName:E().content,itemClassName:E().item,handleRef:k,isMobileLayout:b,useWindowScroll:b})]})})})})},11856:e=>{e.exports={root:"MyMusicDownloadedTracksPageEmpty_root__LAXpY",icon:"MyMusicDownloadedTracksPageEmpty_icon__PDhk2",title:"MyMusicDownloadedTracksPageEmpty_title__g2w5R",text:"MyMusicDownloadedTracksPageEmpty_text__8RJFg"}},12627:e=>{e.exports={root:"PlaylistPersonalDummyPage_root__tGxHG",cover:"PlaylistPersonalDummyPage_cover__XcCD1",title:"PlaylistPersonalDummyPage_title__ZSf9O",important:"PlaylistPersonalDummyPage_important__uEHGe",text:"PlaylistPersonalDummyPage_text__ci30d"}},14795:(e,t,a)=>{"use strict";a.d(t,{dx:()=>d,l$:()=>R.AlbumPage,MH:()=>x,Wh:()=>G}),a(86916);var i,r,s=a(41028),l=a(94767),n=a(59615);let o=s.gK.model("Cpa",{clid:s.gK.string,artistId:s.gK.number}),d=s.gK.compose(s.gK.model("AlbumCpa",{albumId:s.gK.maybeNull(s.gK.number),cpa:s.gK.maybeNull(o)}),n.pl).views(e=>({isPlusCPAEnabled(t){let{pageAlbumId:a,albumId:i,isNonMusic:r}=t,{experiments:l,user:{isAuthorized:n}}=(0,s.Zn)(e);return!1},isPlusCPAPlayerBarEnabled(t,a){let{experiments:i,user:{hasPlus:r}}=(0,s.Zn)(e);return!1},isPlusCPABannerEnabled(t){var a;let{pageAlbumId:i,albumId:r,isNonMusic:l}=t,{experiments:n,settings:o,user:{hasPlus:d}}=(0,s.Zn)(e);return null==(a=o.browserInfo)||a.isTouch,!1},isHidePlusModalEnabled(t,a){var i;let{experiments:r,settings:l,user:{hasPlus:n}}=(0,s.Zn)(e);return null==(i=l.browserInfo)||i.isTouch,!1}})).actions(e=>({getCpa:(0,s.L3)(function*(t){let{albumId:a,preloadedCpa:i}=t,{experiments:r,user:l}=(0,s.Zn)(e)}),reset(){e.albumId=null,e.destroyItems([e.cpa])}}));var u=a(61979),c=a(72315),g=a(93435),m=a(15479),h=a(6247);(i||(i={})).RECENT_ALBUMS="recent-albums",function(e){e[e.DAY=1]="DAY",e[e.WEEK=7]="WEEK",e[e.MONTH=30]="MONTH"}(r||(r={}));var y=a(85897),p=a(12853),v=a(52732),S=a(53706),E=a(2865),P=a(44078),b=a(95592);let f=e=>(0,s.wg)({type:b.rU.TEXT,data:null!=e?e:null,loadingState:l.GuX.RESOLVE}),I=e=>{var t;let{data:a,...i}=e;return(0,s.wg)({type:null!=(t=null==a?void 0:a.type)?t:h.S.TRACK,data:null!=a?a:null,...i})},k=e=>"".concat(e,"-text"),_=e=>String(e),T=e=>(0,s.wg)({id:e.id,type:e.type,title:e.title,albums:e.albums.map(v.pp)}),C=e=>!!(e&&"position"in e),A=s.gK.compose(s.gK.model("AlbumDonations",{items:s.gK.maybeNull(s.gK.array(S.eG))}),n.pl,n.XT).actions(e=>({reset(){e.loadingState=l.GuX.IDLE,e.destroyItems([e.items])}})),D=s.gK.model("LabelItem",{id:s.gK.number,name:s.gK.string}),N=s.gK.compose(s.gK.model("RelatedAlbumsPage",{items:s.gK.array(v.JC)}),n.pl,n.XT).actions(e=>({reset(){e.loadingState=l.GuX.IDLE,e.destroyItems([e.items])}})),L=s.gK.compose(s.gK.model("RelatedContent",{items:s.gK.maybeNull(s.gK.array(p.N3))}),n.pl,n.XT).actions(e=>({reset(){e.loadingState=l.GuX.IDLE,e.destroyItems([e.items])}})),x=s.gK.compose(s.gK.model("AlbumPage",{id:s.gK.maybeNull(s.gK.number),meta:s.gK.maybeNull(v.JC),items:s.gK.array(p.PX),indexItems:s.gK.map(s.gK.array(s.gK.number)),errorStatusCode:s.gK.maybeNull(s.gK.number),deprecationTargetAlbumId:s.gK.maybeNull(s.gK.number),latestGenreAlbums:s.gK.maybe(N),otherArtistAlbums:s.gK.maybe(N),otherAlbumVersions:s.gK.maybe(s.gK.array(v.JC)),labels:s.gK.maybeNull(s.gK.array(D)),description:s.gK.maybe(s.gK.string),donations:s.gK.maybe(A),relatedContent:s.gK.maybe(L),allTracksUnfinished:s.gK.boolean}),n.Ec,n.pl,n.XT).views(e=>{let t={get isOtherArtistAlbumsAvailable(){var a,i,r,n,o;return!!(!(null==(a=e.meta)?void 0:a.isNonMusic)&&(null==(r=e.meta)||null==(i=r.artists)?void 0:i.length)===1&&!(null==(o=e.meta)||null==(n=o.artists[0])?void 0:n.various))},get isLatestGenreAlbumsAvailable(){var d,c;return!!(!(null==(d=e.meta)?void 0:d.isNonMusic)&&(null==(c=e.meta)?void 0:c.genre))},get isNotFound(){return e.isRejected&&(e.errorStatusCode===u.X1.NOT_FOUND||e.errorStatusCode===u.X1.BAD_REQUEST)},get isCacheNotFound(){return e.isRejected&&e.errorStatusCode===y.FX},get hasDonations(){var g;return!!((null==(g=e.donations)?void 0:g.isResolved)&&e.donations&&e.donations.items&&e.donations.items.length>0)},get hasOtherAlbumVersions(){return!!(e.isNeededToLoad||e.loadingState===l.GuX.PENDING||e.otherAlbumVersions&&e.otherAlbumVersions.length>0)},get hasLatestGenreAlbums(){var m,h;let a=e.latestGenreAlbums&&e.latestGenreAlbums.items&&e.latestGenreAlbums.items.length>0;return!!(t.isLatestGenreAlbumsAvailable&&((null==(m=e.latestGenreAlbums)?void 0:m.isNeededToLoad)||(null==(h=e.latestGenreAlbums)?void 0:h.isLoading)||a))},get hasOtherArtistAlbums(){var p,v;let a=e.otherArtistAlbums&&e.otherArtistAlbums.items&&e.otherArtistAlbums.items.length>0;return!!(t.isOtherArtistAlbumsAvailable&&((null==(p=e.otherArtistAlbums)?void 0:p.isNeededToLoad)||(null==(v=e.otherArtistAlbums)?void 0:v.isLoading)||a))},get isLoading(){return e.isNeededToLoad||e.loadingState===l.GuX.PENDING},get isLatestGenreAlbumsLoading(){var S,E;return!!((null==(S=e.latestGenreAlbums)?void 0:S.isNeededToLoad)||(null==(E=e.latestGenreAlbums)?void 0:E.isLoading))},get isOtherArtistAlbumsLoading(){var P,f;return!!((null==(P=e.otherArtistAlbums)?void 0:P.isNeededToLoad)||(null==(f=e.otherArtistAlbums)?void 0:f.isLoading))},get isRelatedContentLoading(){var I,k;return!!((null==(I=e.relatedContent)?void 0:I.isNeededToLoad)||(null==(k=e.relatedContent)?void 0:k.isLoading))},get contextMeta(){var _,T,C,A,D,N,L,x,R;return{id:e.meta.id,title:null==(_=e.meta)?void 0:_.title,coverUri:null==(T=e.meta)?void 0:T.coverUri,type:null==(C=e.meta)?void 0:C.type,year:null==(A=e.meta)?void 0:A.year,version:null==(D=e.meta)?void 0:D.version,genre:null==(N=e.meta)?void 0:N.genre,likesCount:null==(L=e.meta)?void 0:L.likesCount,averageColor:null==(x=e.meta)?void 0:x.averageColor,available:null==(R=e.meta)?void 0:R.isAvailable}},get tracks(){return e.items.filter(e=>e.type!==b.rU.TEXT)},get lastEpisodes(){return t.tracks.slice(0,5)},get lastEpisodesTrackIds(){return t.lastEpisodes.map(e=>e.id)},get hasLabel(){return!!(e.labels&&e.labels.length)},get shouldShowLabel(){let{experiments:a}=(0,s.Zn)(e);return t.hasLabel&&a.checkExperiment(l.zal.WebNextLabelPage,"on")},labelUrl(e){let{href:t}=(0,l.uvd)("/label/:labelId",{params:{labelId:e}});return t}};return t}).actions(e=>{let t={makeFlatVolumeItems:t=>{let a=0;t.volumes.forEach(i=>{t.volumes.length>1&&i[0]&&(e.items.push(f()),e.indexItems.set(k(i[0].id),[e.items.length-1])),i.forEach(t=>{e.items.push(I({id:t.id,loadingState:l.GuX.IDLE,positionInContext:a}));let i=e.indexItems.get(String(t.id));e.indexItems.set(_(t.id),i?[...i,e.items.length-1]:[e.items.length-1]),a++})})},updateVolumeItemsState:(t,a)=>{t.forEach(t=>{let i=e.indexItems.get(String(t));null==i||i.forEach(i=>{let r=e.items[i];C(r)&&(e.items[i]=I({id:t,loadingState:a,positionInContext:r.positionInContext,hasEverFinished:r.hasEverFinished}))})})},insertDataToVolumeItems:t=>{t.forEach((t,a)=>{let i=e.indexItems.get(_(t.id));null==i||i.forEach(i=>{var r,s,n,o,d;let u=e.items[0],c=e.items[i],g=e.items[i-1];if(!C(c))return;let m=C(u)&&u.id===c.id?1:null==(n=t.albums)||null==(s=n[0])||null==(r=s.trackPosition)?void 0:r.index,h=null==c?void 0:c.positionInContext,y=C(g)&&(null==g?void 0:g.position)?g.position+1:m,p=(0,P.vU)(t,{hasEverFinished:null==c?void 0:c.hasEverFinished});if(p.isRemoved){e.items[i]=I({id:t.id,loadingState:l.GuX.REJECT,positionInContext:h,position:C(g)?g.position:a});return}e.items[i]=I({id:t.id,loadingState:l.GuX.RESOLVE,positionInContext:h,data:p,position:(null==g?void 0:g.type)===b.rU.TEXT?1:y,isBest:null==(d=e.meta)||null==(o=d.bestAlbumTracks)?void 0:o.includes(Number(t.id)),hasEverFinished:null==c?void 0:c.hasEverFinished})});let r=e.indexItems.get(k(t.id));null==r||r.forEach(a=>{var i,r,s;e.items[a]=f(null==(s=t.albums)||null==(r=s[0])||null==(i=r.trackPosition)?void 0:i.volume)})})},afterCreate(){e.getDescriptionTexts()},setAlbumUnfinished:()=>{var a;t.markUnfinished({albumId:e.id||0}),null==(a=e.meta)||a.updateFinished(!1)},setAllTracksUnfinished:t=>{e.allTracksUnfinished=t},checkAllAlbumTrackFinished:()=>{var a,i;e.items.filter(e=>{let{type:t,data:a}=e;return a&&t!==b.rU.TEXT}).every(e=>{var t;let{data:a}=e;return null==a||null==(t=a.streamProgress)?void 0:t.hasEverFinished})&&((null==(a=e.meta)?void 0:a.listeningFinished)||(t.markFinished({albumId:Number(e.id)}),null==(i=e.meta)||i.updateFinished(!0)))},markTracksFinished:t=>{let{withoutTracks:a=[]}=t;e.items.forEach(e=>{if(e.type===b.rU.TEXT)return;let{data:t}=e;if(!(t&&a.includes(t.id)))if(t){var i;null==(i=t.streamProgress)||i.updateEverFinished(!0)}else e.updateEverFinished(!0)})},markFinished:(0,s.L3)(function*(t){let{streamsResource:a,modelActionsLogger:i}=(0,s._$)(e);try{return yield a.markAlbumFinished(t)}catch(e){return i.error(e),c.T.ERROR}}),markUnfinished:(0,s.L3)(function*(t){let{streamsResource:a,modelActionsLogger:i}=(0,s._$)(e);try{return yield a.markAlbumUnfinished(t)}catch(e){return i.error(e),c.T.ERROR}}),setListeningFinishedStatus:(0,s.L3)(function*(){var a;return(null==(a=e.meta)?void 0:a.listeningFinished)?(t.setAllTracksUnfinished(!0),yield t.markUnfinished({albumId:Number(e.id)})):yield t.markFinished({albumId:Number(e.id)})}),getLatestGenreAlbums:(0,s.L3)(function*(t){let{topResource:a,modelActionsLogger:i}=(0,s._$)(e);if(e.latestGenreAlbums&&!e.latestGenreAlbums.isLoading)try{e.latestGenreAlbums.loadingState=l.GuX.PENDING;let i=yield a.getTopByGenre(t);e.latestGenreAlbums.items=(0,s.wg)(i.albums.map(v.pp)),e.latestGenreAlbums.loadingState=l.GuX.RESOLVE}catch(t){i.error(t),e.latestGenreAlbums.loadingState=l.GuX.REJECT}}),getOtherArtistAlbums:(0,s.L3)(function*(t,a){let{artistsResource:i,modelActionsLogger:r}=(0,s._$)(e);if(e.otherArtistAlbums&&!e.otherArtistAlbums.isLoading)try{if(!t.artistId){e.otherArtistAlbums.loadingState=l.GuX.REJECT;return}e.otherArtistAlbums.loadingState=l.GuX.PENDING;let r=yield i.getSafeDirectAlbums({...t,artistId:t.artistId});e.otherArtistAlbums.items=(0,s.wg)(r.albums.filter(e=>String(e.id)!==String(a)).map(v.pp)),e.otherArtistAlbums.loadingState=l.GuX.RESOLVE}catch(t){r.error(t),e.otherArtistAlbums.loadingState=l.GuX.REJECT}}),getTracks:(0,s.L3)(function*(a){let{trackIds:i}=a,{tracksResource:r,modelActionsLogger:n}=(0,s._$)(e);try{var o;let a;if(!(null==(o=e.meta)?void 0:o.id))return;t.updateVolumeItemsState(i,l.GuX.PENDING);let s=yield r.getTracksMeta({trackIds:(a=e.meta.id,i.map(e=>"".concat(e,":").concat(a))),withProgress:!0});t.insertDataToVolumeItems(s)}catch(e){n.error(e),t.updateVolumeItemsState(i,l.GuX.REJECT)}}),getDonations:(0,s.L3)(function*(t){let{albumId:a}=t,{experiments:i}=(0,s.Zn)(e),{donationResource:r,modelActionsLogger:n}=(0,s._$)(e);if(i.checkExperiment(l.zal.WebNextAlbumDonationButton,"on")&&e.donations&&!e.donations.isLoading)try{e.donations.loadingState=l.GuX.PENDING;let{donations:t}=yield r.getAlbumDonations({albumId:a});t&&(e.donations.items=(0,s.wg)(t.map(e=>{var t;let{data:a}=e;return(0,S.GT)({url:a.tipUrl,goal:null==(t=a.goal)?void 0:t.title,artist:a.artist})}))),e.donations.loadingState=l.GuX.RESOLVE}catch(t){n.error(t),e.donations.loadingState=l.GuX.REJECT}}),getData:(0,s.L3)(function*(a){let{albumId:n,resumeStream:o,preloadedAlbum:d,withLatestGenreAlbumsRequest:c=!0,withOtherArtistAlbumsRequest:y=!0,sonataState:p}=a,{albumResource:S,modelActionsLogger:P}=(0,s._$)(e),{experiments:b,disclaimer:f}=(0,s.Zn)(e),I=b.checkExperiment(l.zal.WebNextAgentPodcast,"on");if(e.id=n,e.loadingState!==l.GuX.PENDING)try{var k,_,T,C,A,D,N;let a,P;e.loadingState=l.GuX.PENDING;let b=d;if(b||(b=yield S.getAlbumWithTracksIds({albumId:n,resumeStream:o})),(null==b?void 0:b.error)==="not-found"){e.errorStatusCode=u.X1.NOT_FOUND,e.loadingState=l.GuX.REJECT,e.otherArtistAlbums&&(e.otherArtistAlbums.loadingState=l.GuX.REJECT),e.latestGenreAlbums&&(e.latestGenreAlbums.loadingState=l.GuX.REJECT);return}if(null==(k=b.deprecation)?void 0:k.targetAlbumId){e.deprecationTargetAlbumId=b.deprecation.targetAlbumId,e.loadingState=l.GuX.RESOLVE;return}let L=(null!=(T=b.disclaimers)?T:[]).includes(g.M.MODAL),x=b.type===m._.PODCAST&&(null!=(C=b.disclaimers)?C:[]).includes(g.M.FOREIGN_AGENT),R=null==(_=(0,l.bRW)(null!=(A=b.disclaimers)?A:[],g.M.FOREIGN_AGENT))?void 0:_[0];(L||I&&x||R)&&(yield f.getDisclaimerData({entityId:n,entityType:b.type===m._.PODCAST?l.nPY.PODCAST:l.nPY.ALBUM,disclaimerId:null==R?void 0:R.id})),p.setUnloadedEntitiesData(b.volumes.flat().map(e=>(0,E.li)(e.id))),e.meta=(0,v.pp)(b),e.labels=(0,s.wg)(b.labels),e.contentWarning=(0,s.wg)(b.contentWarning),e.description=(0,s.wg)(b.description),b.duplicates&&b.duplicates.length>0&&(e.otherAlbumVersions=(0,s.wg)(null==(D=b.duplicates)?void 0:D.map(v.pp))),t.makeFlatVolumeItems(b);let w=[];for(let t=0;t<10;t++){let a=e.items[t];(null==a?void 0:a.type)===h.S.TRACK&&w.push(String(a.id))}yield t.getTracks({trackIds:w}),e.isLatestGenreAlbumsAvailable&&c&&(a=t.getLatestGenreAlbums({category:i.RECENT_ALBUMS,period:r.WEEK,pageSize:8,genre:b.genre})),e.isOtherArtistAlbumsAvailable&&y&&(P=t.getOtherArtistAlbums({artistId:String(null==(N=b.artists[0])?void 0:N.id),limit:8},n)),yield Promise.allSettled([a,P]),e.loadingState!==l.GuX.IDLE&&(e.loadingState=l.GuX.RESOLVE)}catch(t){P.error(t),t instanceof u.GX&&(e.errorStatusCode=t.statusCode),e.loadingState!==l.GuX.IDLE&&(e.loadingState=l.GuX.REJECT,e.otherArtistAlbums&&(e.otherArtistAlbums.loadingState=l.GuX.REJECT),e.latestGenreAlbums&&(e.latestGenreAlbums.loadingState=l.GuX.REJECT))}}),loadLastEpisodes(){t.getTracks({trackIds:e.lastEpisodesTrackIds})},getRelatedContent:(0,s.L3)(function*(){let{albumResource:t,modelActionsLogger:a}=(0,s._$)(e);if(e.relatedContent&&!e.relatedContent.isLoading)try{var i,r;if(!(null==(i=e.meta)?void 0:i.id))return;e.relatedContent.loadingState=l.GuX.PENDING;let a=yield t.getRelatedContent({albumId:e.meta.id});e.relatedContent.items=(0,s.wg)(null==(r=a.blocks)?void 0:r.map(T)),e.relatedContent.loadingState=l.GuX.RESOLVE}catch(t){a.error(t),e.relatedContent.loadingState=l.GuX.REJECT}}),reset(t){var a,i,r,n;let{albumCPA:o}=(0,s.Zn)(e);o.reset(),t.resetUnloadedEntitiesData(),e.id=null,e.errorStatusCode=null,e.deprecationTargetAlbumId=null,e.indexItems.clear(),e.loadingState=l.GuX.IDLE,e.description="",e.allTracksUnfinished=!1,null==(a=e.latestGenreAlbums)||a.reset(),null==(i=e.otherArtistAlbums)||i.reset(),null==(r=e.relatedContent)||r.reset(),null==(n=e.donations)||n.reset(),e.destroyItems([e.meta,e.items,e.otherAlbumVersions,e.labels])}};return t});a(99683);var R=a(82358);a(47954),a(33801);let w=s.gK.compose(s.gK.model("PromoCampaign",{isActive:s.gK.boolean}),n.XT).views(e=>({get isPromoCampaignActive(){return e.isResolved&&e.isActive},get isPromoCampaignInactive(){return e.isRejected||e.isResolved&&!e.isActive}})).actions(e=>({getData:(0,s.L3)(function*(t){let{isActive:a,albumId:i}=t,{promoResource:r,modelActionsLogger:n}=(0,s._$)(e);if(!e.isLoading)try{e.loadingState=l.GuX.PENDING,"boolean"==typeof a?e.isActive=a:e.isActive=(yield r.getPromoAlbumInfo({albumId:i})).active,e.loadingState=l.GuX.RESOLVE}catch(t){n.error(t),e.loadingState=l.GuX.REJECT}})})),G=x.props({promoCampaign:w,state:E.QQ}).actions(e=>({getDataByCampaign:(0,s.L3)(function*(t){let{albumId:a,preloadedAlbum:i,preloadedCpa:r,isActive:l}=t;if(yield e.promoCampaign.getData({albumId:a,isActive:l}),e.promoCampaign.isPromoCampaignActive){let{albumCPA:t}=(0,s.Zn)(e),l=e.getData({albumId:a,resumeStream:!1,preloadedAlbum:i,withLatestGenreAlbumsRequest:!1,withOtherArtistAlbumsRequest:!1,sonataState:e.state}),n=t.getCpa({albumId:a,preloadedCpa:r});yield Promise.allSettled([l,n])}})})).named("PromoLandingAlbumPage")},15734:(e,t,a)=>{"use strict";a.d(t,{DesktopPaywallInitializer:()=>n});var i=a(97531),r=a(66268),s=a(73437),l=a(94767);let n=(0,i.PA)(()=>{let{desktopPaywall:e,user:t}=(0,l.Pjs)(),{isFreemium:a}=(0,l.XCI)(),{shouldShowFamilyInvite:i}=(0,s.hj)();(0,r.useEffect)(()=>{if((!t.isAuthorized||a)&&!i)return e.shouldShowOnEnter&&e.showPaywall(),e.startCrackdownTimeout(),()=>{e.clearCrackdownTimeout()}},[e,a,i,t.isAuthorized])})},16967:(e,t,a)=>{"use strict";a.d(t,{CrackdownInitializer:()=>n});var i=a(97531),r=a(94767),s=a(5663),l=a(85554);let n=(0,i.PA)(()=>{var e;let{user:t,modals:{crackdownModal:a},settings:{isMobile:i},experiments:n,sonataState:o,desktopPaywall:d}=(0,r.Pjs)(),{isFreemium:u}=(0,r.XCI)(),c=t.isAuthorized&&u&&!i,g=null==(e=n.getExperiment(r.zal.WebNextCrackdownInterval))?void 0:e.value.interval;(0,l.W)({isEnabled:c,intervalMs:(0,s.P)(g),modal:a,sonataState:o,isPaywallOpen:d.isPaywallOpen})})},17353:(e,t,a)=>{"use strict";a.d(t,{KidsCategoryPage:()=>b});var i=a(33008),r=a(85896),s=a(97531),l=a(17846),n=a(66268),o=a(18064),d=a(57747),u=a(77868),c=a(61299),g=a(83888),m=a(64143),h=a(94767),y=a(53799),p=a(26729),v=a.n(p),S=a(66342),E=a.n(S);let P=()=>(0,i.jsxs)("div",{className:E().root,children:[(0,i.jsx)("div",{children:(0,i.jsx)(c.Rj,{isActive:!0,length:4})}),(0,i.jsx)(y.OY,{isShimmerVisible:!0,isShimmerActive:!0}),(0,i.jsx)(y.OY,{isShimmerVisible:!0,isShimmerActive:!0})]}),b=(0,s.PA)(e=>{let{categoryId:t}=e,{kids:a}=(0,h.Pjs)(),{contentScrollRef:s,setContentScrollRef:p}=(0,h.gKY)(),S=(0,h.W6M)();(0,n.useEffect)(()=>()=>a.landing.reset(),[a.landing]),(0,h.Jzs)(a.landing.isResolved),a.landing.isLoadedAndEmpty&&(0,l.notFound)();let E=(0,c._9)(a.landing),b=(0,n.useMemo)(()=>a.landing.isLoading||a.landing.isNeededToLoad?(0,i.jsx)(P,{}):(0,i.jsx)(c.EA,{landing:a.landing,errorComponent:(0,i.jsx)(g.w,{className:v().error,withBackwardControl:!1})}),[a.landing.loadingState,a.landing]);return a.landing.isNeededToLoad&&(0,n.use)(a.landing.getChildrenSkeleton({categoryId:t})),(0,i.jsx)(h.nVz,{pageId:h._Q$.KIDS_CATEGORY,children:(0,i.jsxs)(m.hO,{scrollElement:s,outerTitle:a.landing.title,children:[(0,i.jsx)(y.Y9,{variant:y.Vw.TEXT,withForwardControl:!1,withBackwardControl:S.canBack,children:(0,i.jsx)("div",{className:v().header,children:(0,i.jsx)(u.Heading,{variant:"h1",weight:"bold",size:"xl",children:a.landing.title})})}),(0,i.jsxs)(d.N,{className:v().root,containerClassName:v().content,ref:p,...(0,o.Am)(o.Xk.kids.KIDS_CATEGORY_PAGE),children:[(0,i.jsx)("div",{className:(0,r.$)(v().landing,{[v().landing_onlyWizard]:E}),children:b}),(0,i.jsx)(y.A,{children:(0,i.jsx)(y.wi,{className:v().footer})})]})]})})})},17660:(e,t,a)=>{"use strict";a.d(t,{jM:()=>v.KidsCategoryPage,u3:()=>S.KidsEditorialAlbumsPage,bU:()=>E.KidsEditorialPlaylistsPage,GY:()=>p});var i=a(94767),r=a(41028),s=a(61979),l=a(52732),n=a(95592),o=a(59615);let d=r.gK.model("KidsEditorialAlbumItem",{id:r.gK.number,data:r.gK.maybeNull(l.JC)}),u=r.gK.compose(r.gK.model("KidsEditorialAlbumPage",{errorStatusCode:r.gK.maybe(r.gK.number),title:r.gK.maybeNull(r.gK.string),pager:r.gK.maybeNull(o.jd),albums:r.gK.maybeNull(r.gK.array(d)),alreadyRequestedPages:r.gK.map(r.gK.number),requests:r.gK.maybeNull(r.gK.number)}),o.XT).views(e=>{let t={get isLoading(){return e.isNeededToLoad||e.loadingState===i.GuX.PENDING},get isNotFound(){let t=e.errorStatusCode===s.X1.NOT_FOUND||e.errorStatusCode===s.X1.BAD_REQUEST;return e.isRejected&&t},get isSomethingWrong(){return e.isRejected&&!t.isNotFound}};return t}).actions(e=>{let t={getAlbums:(0,r.L3)(function*(t){var a,l,o;let{page:d=0,pageSize:u=20}=t,{albumResource:c,modelActionsLogger:g}=(0,r._$)(e);if((null==(a=e.albums)?void 0:a.length)&&!e.alreadyRequestedPages.has("".concat(d))){e.alreadyRequestedPages.set("".concat(d),d);try{let t=d*u,a=e.albums.slice(t,t+u).map(e=>e.id),i=yield c.getAlbums({albumIds:a});e.requests=(null!=(o=e.requests)?o:0)+1;let s={page:d,perPage:u,total:null==(l=e.albums)?void 0:l.length},g=i.map(n.e7),m=d*u,h=0;for(let t=m;t<m+u;t++){let a=e.albums[t];g[h]&&a&&(a.data=(0,r.wg)(g[h])),h++}e.pager=s}catch(t){g.error(t),t instanceof s.GX&&(t.statusCode===s.X1.NOT_FOUND||t.statusCode===s.X1.BAD_REQUEST)&&(e.errorStatusCode=s.X1.NOT_FOUND),e.loadingState!==i.GuX.IDLE&&(e.loadingState=i.GuX.REJECT)}}}),getData:(0,r.L3)(function*(a){let{id:l,page:n=0,pageSize:o=20}=a,{childrenLandingResource:d,modelActionsLogger:u}=(0,r._$)(e);if(e.loadingState!==i.GuX.PENDING)try{e.loadingState=i.GuX.PENDING;let a=yield d.getEditorialAlbum({id:l});e.title=a.title,a.entities&&a.entities.length>0&&(e.albums=(0,r.wg)(a.entities.map(e=>(0,r.wg)({id:e})))),e.loadingState!==i.GuX.IDLE&&(e.loadingState=i.GuX.RESOLVE),yield t.getAlbums({page:n,pageSize:o})}catch(t){u.error(t),t instanceof s.GX&&(t.statusCode===s.X1.NOT_FOUND||t.statusCode===s.X1.BAD_REQUEST)&&(e.errorStatusCode=s.X1.NOT_FOUND),e.loadingState!==i.GuX.IDLE&&(e.loadingState=i.GuX.REJECT)}}),reset(){e.loadingState=i.GuX.IDLE,e.alreadyRequestedPages.clear(),e.title=null,e.albums=null,e.requests=null,e.pager=null}};return t});var c=a(45242),g=a(25911);let m=r.gK.model("KidsEditorialPlaylistItem",{uid:r.gK.number,kind:r.gK.number,data:r.gK.maybeNull(c.IP)}),h=r.gK.compose(r.gK.model("KidsEditorialPlaylistPage",{errorStatusCode:r.gK.maybe(r.gK.number),title:r.gK.maybeNull(r.gK.string),pager:r.gK.maybeNull(o.jd),playlists:r.gK.maybeNull(r.gK.array(m)),alreadyRequestedPages:r.gK.map(r.gK.number),requests:r.gK.maybeNull(r.gK.number)}),o.XT).views(e=>{let t={get isLoading(){return e.isNeededToLoad||e.loadingState===i.GuX.PENDING},get isNotFound(){let t=e.errorStatusCode===s.X1.NOT_FOUND||e.errorStatusCode===s.X1.BAD_REQUEST;return e.isRejected&&t},get isSomethingWrong(){return e.isRejected&&!t.isNotFound}};return t}).actions(e=>{let t={getPlaylists:(0,r.L3)(function*(t){var a,l,n;let{page:o=0,pageSize:d=20}=t,{playlistsResource:u,modelActionsLogger:c}=(0,r._$)(e);if((null==(a=e.playlists)?void 0:a.length)&&!e.alreadyRequestedPages.has("".concat(o))){e.alreadyRequestedPages.set("".concat(o),o);try{let t=o*d,a=e.playlists.slice(t,t+d),i=yield u.getPlaylists({playlistIds:a.map(e=>"".concat(e.uid,":").concat(e.kind)),resumeStream:!1});e.requests=(null!=(n=e.requests)?n:0)+1;let s={page:o,perPage:d,total:null==(l=e.playlists)?void 0:l.length},c=i.playlists.map(g.jX),m=o*d,h=0;for(let t=m;t<m+d;t++){let a=e.playlists[t];c[h]&&a&&(a.data=(0,r.wg)(c[h])),h++}e.pager=s}catch(t){c.error(t),t instanceof s.GX&&(t.statusCode===s.X1.NOT_FOUND||t.statusCode===s.X1.BAD_REQUEST)&&(e.errorStatusCode=s.X1.NOT_FOUND),e.loadingState!==i.GuX.IDLE&&(e.loadingState=i.GuX.REJECT)}}}),getData:(0,r.L3)(function*(a){let{id:l,page:n=0,pageSize:o=20}=a,{childrenLandingResource:d,modelActionsLogger:u}=(0,r._$)(e);if(e.loadingState!==i.GuX.PENDING)try{e.loadingState=i.GuX.PENDING;let a=yield d.getEditorialPlaylist({id:l});e.title=a.title,a.entities&&a.entities.length>0&&(e.playlists=(0,r.wg)(a.entities.map(e=>(0,r.wg)({uid:e.uid,kind:e.kind})))),e.loadingState!==i.GuX.IDLE&&(e.loadingState=i.GuX.RESOLVE),yield t.getPlaylists({page:n,pageSize:o})}catch(t){u.error(t),t instanceof s.GX&&(t.statusCode===s.X1.NOT_FOUND||t.statusCode===s.X1.BAD_REQUEST)&&(e.errorStatusCode=s.X1.NOT_FOUND),e.loadingState!==i.GuX.IDLE&&(e.loadingState=i.GuX.REJECT)}}),reset(){e.loadingState=i.GuX.IDLE,e.alreadyRequestedPages.clear(),e.title=null,e.playlists=null,e.requests=null,e.pager=null}};return t});var y=a(61299);let p=r.gK.model("KidsPage",{landing:y.Ju,kidsEditorialPlaylistSubpage:h,kidsEditorialAlbumSubpage:u});var v=a(17353),S=a(11463),E=a(90157);a(84031),a(29601)},18998:e=>{e.exports={root:"ConcertPage_root__pqTvU",averageColorBackground:"ConcertPage_averageColorBackground__wj67a",header:"ConcertPage_header__FxHk1",container:"ConcertPage_container__ca9h4",footer:"ConcertPage_footer____Dnb",skeleton:"ConcertPage_skeleton__8aWkf",error:"ConcertPage_error__gcEp_"}},21934:(e,t,a)=>{"use strict";a.d(t,{PromoLandingShortcutsProvider:()=>d});var i=a(33008),r=a(97531),s=a(66268),l=a(94767),n=a(87145);let o=null,d=(0,r.PA)(e=>{let{children:t}=e,{promolanding:{state:a}}=(0,l.Pjs)(),r=(0,s.useMemo)(()=>(o||(o=new l.G8o(new l.z$B)),o),[]);return(0,n.E)({controller:r,sonataState:a,playbackId:l.V_r.PROMO_LANDING,groupId:l.Mo.PROMO_LANDING}),(0,s.useEffect)(()=>(null==r||r.listen(),()=>{null==r||r.stopListening()}),[r]),(0,i.jsx)(l.Pic.Provider,{value:r,children:t})})},22745:(e,t,a)=>{"use strict";a.d(t,{PromoLandingCrackdownInitializer:()=>n});var i=a(97531),r=a(94767),s=a(5663),l=a(85554);let n=(0,i.PA)(()=>{var e;let{modals:{crackdownModal:t,promoLandingBuySubscriptionModal:a},settings:{isMobile:i},experiments:n,promolanding:{state:o}}=(0,r.Pjs)(),{isFreemium:d}=(0,r.XCI)(),u=d&&n.checkExperiment(r.zal.WebNextPromoLanding,"on"),c=null==(e=n.getExperiment(r.zal.WebNextPromoLandingCrackdownInterval))?void 0:e.value.interval;(0,l.W)({isEnabled:u,intervalMs:(0,s.P)(c),modal:i?a:t,playbackId:r.V_r.PROMO_LANDING,sonataState:o})})},23031:(e,t,a)=>{"use strict";a.d(t,{G4:()=>n.Genre,Gc:()=>l,kc:()=>r});var i=a(41028);let r=e=>({tag:e.tag,title:e.title,subGenres:(0,i.wg)((e.leaves||[]).map(e=>({tag:e.tag,title:e.title})))}),s=i.gK.model("GenreListItemSubGenreModel",{tag:i.gK.string,title:i.gK.string}),l=i.gK.model("GenreListItemModel",{tag:i.gK.string,title:i.gK.string,subGenres:i.gK.array(s)});var n=a(23663)},23663:(e,t,a)=>{"use strict";a.d(t,{Genre:()=>d});var i=a(33008),r=a(97531),s=a(77868),l=a(53799),n=a(83673),o=a.n(n);let d=(0,r.PA)(e=>{let{tag:t,title:a,subGenres:r}=e;return(0,i.jsxs)("div",{className:o().root,children:[(0,i.jsx)(l.N_,{className:o().link,href:"/genre/".concat(t),children:(0,i.jsx)(s.Heading,{variant:"h2",size:"m",lineClamp:1,className:o().linkTitle,children:a})}),r.length>0&&(0,i.jsx)("div",{className:o().list,children:r.map(e=>(0,i.jsx)("div",{className:o().item,children:(0,i.jsx)(l.N_,{className:o().link,href:"/genre/".concat(e.tag),children:(0,i.jsx)(s.Caption,{variant:"span",size:"l",lineClamp:1,className:o().linkTitle,children:e.title})})},e.tag))})]})})},23724:e=>{e.exports={root:"PostShimmer_root__MlLkY",top:"PostShimmer_top__ySpmZ",bottom:"PostShimmer_bottom__ajW_P"}},24147:e=>{e.exports={root:"KidsEditorialAlbumsPage_root__7rHF8",scrollContainer:"KidsEditorialAlbumsPage_scrollContainer__nQVlt",important:"KidsEditorialAlbumsPage_important__hmmxn",footer:"KidsEditorialAlbumsPage_footer__6rwU1",item:"KidsEditorialAlbumsPage_item__Wc243",content:"KidsEditorialAlbumsPage_content__u3zcW"}},25757:(e,t,a)=>{"use strict";a.d(t,{FamilyInviteInitializer:()=>n});var i=a(97531),r=a(66268),s=a(73437),l=a(94767);let n=(0,i.PA)(()=>{let e=(0,s.hj)(),{user:t,familyInvite:{start:a}}=(0,l.Pjs)();(0,r.useEffect)(()=>{e.shouldShowFamilyInvite&&e.inviteId&&(t.isAuthorized&&e.clear(),a(e.inviteId))},[t.isAuthorized,e,a])})},26729:e=>{e.exports={root:"KidsCategoryPage_root__bk7_R",content:"KidsCategoryPage_content__LN0NB",header:"KidsCategoryPage_header__Agys3",landing:"KidsCategoryPage_landing__aSDYw",landing_onlyWizard:"KidsCategoryPage_landing_onlyWizard__3EC9N",footer:"KidsCategoryPage_footer__BQhqi",error:"KidsCategoryPage_error__tSXF7"}},27742:(e,t,a)=>{"use strict";a.r(t),a.d(t,{HistoryProvider:()=>d});var i=a(33008),r=a(17846),s=a(66268),l=a(42213),n=a(94767);let o=null,d=e=>{let{children:t}=e,a=(0,n.NFA)(),d=(0,r.useRouter)(),u=(0,r.usePathname)(),c=(0,r.useSearchParams)(),[g,m]=(0,s.useState)(!1),[h,y]=(0,s.useState)(!1),[p,v]=(0,s.useState)(null),S=(0,s.useRef)(0),E=(0,s.useRef)(null),P=(0,s.useMemo)(()=>{if(o)return o;let e=a.get(n.vHc);return o=new n.fiH(e)},[a]),b=(0,l.c)(()=>{P&&(m(P.canBack),y(P.canForward),v(P.state))}),f=(0,l.c)(e=>{P&&(P.replaceState(e),d.replace(e.href))}),I=(0,l.c)(e=>{P&&(P.pushState(e),b())}),k=(0,l.c)(()=>{P&&(P.back(),b(),d.back())}),_=(0,l.c)(()=>{P&&(P.forward(),b(),d.forward())});(0,s.useEffect)(()=>{var e;let t=[u,c.toString()].join("?");(!(null==P?void 0:P.state)||(null==P||null==(e=P.state)?void 0:e.isLocationNotEqual(t)))&&I({href:t})},[P,u,c,I]);{let e=(0,n.Cvn)(u,c);e!==E.current&&(E.current=e,S.current=S.current+1)}return(0,i.jsx)(n.Q0U.Provider,{value:{pushState:I,replaceState:f,canForward:h,canBack:g,back:k,forward:_,state:p,length:S.current},children:t})}},28430:e=>{e.exports={root:"MyMusicDownloadedTracksPage_root__hZZwz",important:"MyMusicDownloadedTracksPage_important__QP_t0",pageContainer:"MyMusicDownloadedTracksPage_pageContainer__qu3hF",footer:"MyMusicDownloadedTracksPage_footer__KI5OP",content:"MyMusicDownloadedTracksPage_content__Iz1WY",trackShimmer:"MyMusicDownloadedTracksPage_trackShimmer__MZgW3"}},29601:(e,t,a)=>{"use strict";a.d(t,{KidsPage:()=>P});var i=a(33008),r=a(85896),s=a(97531),l=a(66268),n=a(73827),o=a(96560),d=a(18064),u=a(43836),c=a(57747),g=a(77868),m=a(61299),h=a(83888),y=a(64143),p=a(94767),v=a(53799),S=a(91173),E=a.n(S);let P=(0,s.PA)(()=>{let{kids:e,user:t}=(0,p.Pjs)(),{formatMessage:a}=(0,n.A)(),{contentScrollRef:s,setContentScrollRef:S}=(0,p.gKY)();(0,l.useEffect)(()=>()=>e.landing.reset(),[e.landing]),(0,p.Jzs)(e.landing.isResolved);let P=(0,m._9)(e.landing);return e.landing.isNeededToLoad&&(0,l.use)(e.landing.getSkeleton({id:u.p.KIDS,showWizard:t.settings.showWizard},{preloadBlocksCount:2})),(0,i.jsx)(p.nVz,{pageId:p._Q$.KIDS,children:(0,i.jsxs)(y.hO,{scrollElement:s,outerTitle:a({id:"kids.for-kids"}),children:[(0,i.jsx)(v.Y9,{variant:v.Vw.TEXT,showControls:!1,children:(0,i.jsx)("div",{className:E().header,children:(0,i.jsx)(g.Heading,{variant:"h1",weight:"bold",size:"xl",children:(0,i.jsx)(o.A,{id:"kids.for-kids"})})})}),(0,i.jsxs)(c.N,{className:E().root,containerClassName:E().content,ref:S,...(0,d.Am)(d.Xk.kids.KIDS_PAGE),children:[(0,i.jsx)("div",{className:(0,r.$)(E().landing,{[E().landing_onlyWizard]:P}),children:(0,i.jsx)(m.EA,{landing:e.landing,errorComponent:(0,i.jsx)(h.w,{className:E().error,withBackwardControl:!1})})}),(0,i.jsx)(v.A,{children:(0,i.jsx)(v.wi,{className:E().footer})})]})]})})})},31610:e=>{e.exports={root:"MyMusicDownloadedTracksInfo_root__yIYHx"}},33727:(e,t,a)=>{"use strict";a.r(t),a.d(t,{ContainerProvider:()=>u});var i=a(33008),r=a(66268),s=a(94767),l=a(53799);let n=null,o=async e=>{let{userAgent:t,hostTld:a,forwardedForY:i,changeLanguageToken:r,tracestate:l,traceparent:n,icookie:o,serverDetectedLocale:d,env:u,browserName:c,browserVersion:g,executionContextStore:m}=e,h=await (0,s.MyF)({userAgent:t,tld:a,forwardedForY:i,changeLanguageToken:r,tracestate:l,traceparent:n,icookie:o,serverDetectedLocale:d,env:u,browserName:c,browserVersion:g,executionContextStore:m});return await h.get(s.Xc9).loadDictionary(),h},d=e=>{let{children:t,containerLoader:a}=e;return n||(n=(0,r.use)(a)),(0,i.jsx)(s.Bz0.Provider,{value:n,children:t})},u=e=>{let{children:t,hostTld:a,env:s,forwardedForY:n,tracestate:u,traceparent:c,icookie:g,changeLanguageToken:m,serverDetectedLocale:h,userAgent:y,browserName:p,browserVersion:v,executionContextStore:S}=e,E=o({userAgent:y,hostTld:a,forwardedForY:n,changeLanguageToken:m,tracestate:u,traceparent:c,icookie:g,serverDetectedLocale:h,env:s,browserName:p,browserVersion:v,executionContextStore:S});return(0,i.jsx)(r.Suspense,{fallback:(0,i.jsx)(l.JR,{}),children:(0,i.jsx)(d,{containerLoader:E,children:t})})}},35050:e=>{e.exports={root:"TagPage_root__EWN9A",scrollContainer:"TagPage_scrollContainer__lvG_1",important:"TagPage_important__Jq37E",content:"TagPage_content__rUC_l",footer:"TagPage_footer__W0mZr",item:"TagPage_item__X_lW7"}},36442:e=>{e.exports={root:"MyMusicDownloadedTracksPageHeader_root__2vfuc",container:"MyMusicDownloadedTracksPageHeader_container__hQ_wt",title:"MyMusicDownloadedTracksPageHeader_title__Ncn5X",stickyTitle:"MyMusicDownloadedTracksPageHeader_stickyTitle__Efl0U",playButton:"MyMusicDownloadedTracksPageHeader_playButton__seWgC",stickyPlayButton:"MyMusicDownloadedTracksPageHeader_stickyPlayButton__JVicd",titleContainer:"MyMusicDownloadedTracksPageHeader_titleContainer__rLAkS",staticHeader:"MyMusicDownloadedTracksPageHeader_staticHeader__LSVC8",important:"MyMusicDownloadedTracksPageHeader_important__JIubq",stickyHeader:"MyMusicDownloadedTracksPageHeader_stickyHeader__MuQh4"}},36800:(e,t,a)=>{"use strict";a.d(t,{EX:()=>m.PostPage,VQ:()=>g});var i=a(41028),r=a(61979),s=a(60411),l=a(52732),n=a(45242),o=a(70879),d=a(25911),u=a(94767),c=a(59615);let g=i.gK.compose(i.gK.model("PostPage",{errorStatusCode:i.gK.maybe(i.gK.number),title:i.gK.maybeNull(i.gK.string),promotionType:i.gK.maybeNull(i.gK.enumeration(Object.values(s.Q))),artists:i.gK.maybe(i.gK.array(o.PK)),albums:i.gK.maybe(i.gK.array(l.JC)),playlists:i.gK.maybe(i.gK.array(n.IP))}),c.XT).views(e=>{let t={get isLoading(){return e.isNeededToLoad||e.loadingState===u.GuX.PENDING},get isNotFound(){let t=e.errorStatusCode===r.X1.NOT_FOUND||e.errorStatusCode===r.X1.BAD_REQUEST;return e.isRejected&&t},get isSomethingWrong(){return e.isRejected&&!t.isNotFound}};return t}).actions(e=>({getData:(0,i.L3)(function*(t){let{promoId:a}=t,{feedResource:s,modelActionsLogger:n}=(0,i._$)(e);if(e.loadingState!==u.GuX.PENDING)try{e.loadingState=u.GuX.PENDING;let t=yield s.getPromotionsById({promoId:a});e.title=t.title,e.promotionType=t.promotionType,t.artists&&t.artists.length>0&&(e.artists=(0,i.wg)(t.artists.map(o.dM))),t.albums&&t.albums.length>0&&(e.albums=(0,i.wg)(t.albums.map(l.pp))),t.playlists&&t.playlists.length>0&&(e.playlists=(0,i.wg)(t.playlists.map(e=>{let{playlist:t}=e;return(0,d.jX)(t)}))),e.loadingState!==u.GuX.IDLE&&(e.loadingState=u.GuX.RESOLVE)}catch(t){n.error(t),t instanceof r.GX&&(t.statusCode===r.X1.NOT_FOUND||t.statusCode===r.X1.BAD_REQUEST)&&(e.errorStatusCode=r.X1.NOT_FOUND),e.loadingState!==u.GuX.IDLE&&(e.loadingState=u.GuX.REJECT)}}),reset(){e.loadingState=u.GuX.IDLE,e.title=null,e.artists=(0,i.wg)([]),e.albums=(0,i.wg)([])}}));a(75926);var m=a(69686)},38261:(e,t,a)=>{"use strict";a.d(t,{u:()=>i});var i=function(e){return e.FILE_TOO_LARGE="FILE_TOO_LARGE",e.TOO_MANY_FILES="TOO_MANY_FILES",e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.SUCCESS="SUCCESS",e}({})},38298:(e,t,a)=>{"use strict";a.d(t,{ServiceWorkerInitialiazer:()=>s});var i=a(66268),r=a(94767);let s=()=>{let e=(0,r.NFA)().get(r.Zft);(0,i.useEffect)(()=>{"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",t=>{var a,i,r,s,l;if((null==(a=t.data)?void 0:a.type)==="PUT_RSC_WORKER_ERROR_MESSAGE_TYPE"){let a=new URL(null==(r=t.data)||null==(i=r.payload)?void 0:i.url);e.error("[RSC worker] Error getting url ".concat(a.origin," ").concat(a.pathname).concat(a.search,", reason: ").concat(null==(l=t.data)||null==(s=l.payload)?void 0:s.error))}})},[e])}},39959:(e,t,a)=>{"use strict";a.d(t,{MyMusicDownloadedTracksPage:()=>x});var i=a(33008),r=a(85896),s=a(97531),l=a(66268),n=a(73827),o=a(18064),d=a(48509),u=a(42213),c=a(47416),g=a(83888),m=a(64143),h=a(44078),y=a(94767),p=a(53799),v=a(28430),S=a.n(v),E=a(96560),P=a(78016),b=a(77868),f=a(31610),I=a.n(f);let k=(0,s.PA)(()=>{var e;let{myMusic:{downloadedTracks:t}}=(0,y.Pjs)(),a=(0,i.jsx)(b.Caption,{variant:"span",size:"s",weight:"medium","aria-hidden":!0,children:"•"}),r=[];(null==(e=t.tracks)?void 0:e.length)&&r.push((0,i.jsx)(b.Caption,{variant:"span",size:"s",weight:"medium",lineClamp:1,children:(0,i.jsx)(E.A,{id:"entity-names.tracks-count",values:{value:t.tracks.length}})}));let s=Math.floor(t.tracksDurationInMinutes/60),n=Math.floor(t.tracksDurationInMinutes%60);return(s||n)&&(r.push(a),r.push((0,i.jsx)(b.Caption,{variant:"span",size:"s",weight:"medium",children:(0,i.jsx)(E.A,{id:"time.hours-minutes",values:{hours:s,minutes:n}})}))),(0,i.jsx)("div",{className:I().root,children:r.map((e,t)=>(0,l.cloneElement)(e,{key:t}))})});var _=a(36442),T=a.n(_);let C=(0,s.PA)(()=>{let{isScrolling:e}=(0,l.useContext)(p.B9),t=(0,y.W6M)(),{myMusic:{downloadedTracks:a},settings:{isMobile:r},slam:s}=(0,y.Pjs)(),{from:n}=(0,y.fyy)({pageId:y._Q$.OWN_TRACKS,blockId:y.UfI.TRACK_LIST}),o=(0,y.PT7)(),c=(0,y.brA)(),{isPlaying:g,togglePlay:m}=(0,y.Dx4)({playContextParams:{contextData:{type:d.K.Various,meta:{id:y._Q$.DOWNLOADS_TRACKS},from:n},entitiesData:a.entitiesData,loadContextMeta:!1}}),h=(0,u.c)(()=>{o()||(m(),c(!g))});return(0,i.jsx)("header",{className:T().root,"aria-hidden":e,children:(0,i.jsxs)("div",{className:T().container,children:[!s.isOfflineModeEnabled&&t.canBack&&(0,i.jsx)(p.Lh,{withForwardControl:!1,withBackwardControl:t.canBack,shouldFocusOnMount:!e,buttonSize:"xxs"}),(0,i.jsxs)("div",{className:T().titleContainer,children:[(0,i.jsx)(b.Heading,{variant:"h1",weight:"bold",size:"xs",lineClamp:1,className:T().title,children:(0,i.jsx)(E.A,{id:"offline.downloaded-tracks"})}),(0,i.jsx)(k,{})]}),!a.isEmpty&&(0,i.jsx)(p.DM,{withRipple:!0,buttonVariant:"default",radius:"xxxl",size:"s",color:"primary",iconSize:"xxs",isPlaying:g,onClick:h,className:T().playButton,ariaHidden:e,tabIndex:e?-1:0,children:!r&&(0,i.jsx)(E.A,{id:"player-actions.listen"})})]})})});var A=a(11856),D=a.n(A);let N=(0,s.PA)(()=>(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(C,{}),(0,i.jsxs)("div",{className:D().root,children:[(0,i.jsx)(P.Icon,{className:D().icon,size:"l",variant:"download"}),(0,i.jsx)(b.Heading,{className:D().title,variant:"div",size:"xs",children:(0,i.jsx)(E.A,{id:"offline.downloaded-empty"})}),(0,i.jsx)(b.Caption,{className:D().text,variant:"span",type:"controls",size:"l",weight:"normal",children:(0,i.jsx)(E.A,{id:"offline.download-for-offline"})})]})]})),L=(0,s.PA)(()=>{let{isScrolling:e}=(0,l.useContext)(p.B9),t=(0,y.W6M)(),{myMusic:{downloadedTracks:a},settings:{isMobile:s},slam:n}=(0,y.Pjs)(),{from:o}=(0,y.fyy)({pageId:y._Q$.OWN_TRACKS,blockId:y.UfI.TRACK_LIST}),c=(0,y.brA)(),g=(0,y.PT7)(),{isPlaying:m,togglePlay:h}=(0,y.Dx4)({playContextParams:{contextData:{type:d.K.Various,meta:{id:y._Q$.DOWNLOADS_TRACKS},from:o},entitiesData:a.entitiesData,loadContextMeta:!1}}),v=(0,u.c)(()=>{g()||(h(),c(!m))});return(0,i.jsx)(p.Y9,{variant:p.Vw.COMPOSITE,"aria-hidden":!e,stickyChild:(0,i.jsxs)("div",{className:T().container,children:[!n.isOfflineModeEnabled&&t.canBack&&(0,i.jsx)(p.Lh,{withForwardControl:!1,withBackwardControl:t.canBack,shouldFocusOnMount:!1,buttonSize:"xxs"}),(0,i.jsx)(b.Heading,{variant:"h1",weight:"bold",size:"xs",lineClamp:1,className:T().stickyTitle,children:(0,i.jsx)(E.A,{id:"offline.downloaded-tracks"})}),!a.isEmpty&&(0,i.jsx)(p.DM,{withRipple:!0,buttonVariant:"default",radius:"xxxl",size:"s",color:"primary",iconSize:"xxs",isPlaying:m,onClick:v,className:(0,r.$)(T().playButton,{[T().stickyPlayButton]:!s}),ariaHidden:!e,tabIndex:e?0:-1,children:!s&&(0,i.jsx)(E.A,{id:"player-actions.listen"})})]}),stickyClassName:(0,r.$)(T().stickyHeader,T().important),staticClassName:(0,r.$)(T().staticHeader,T().important)})}),x=(0,s.PA)(()=>{var e;let t=(0,y.jRO)(),{contentScrollRef:a,setContentScrollRef:s}=(0,y.gKY)(),{formatMessage:v}=(0,n.A)(),{myMusic:{downloadedTracks:E}}=(0,y.Pjs)(),{from:P}=(0,y.fyy)({pageId:y._Q$.OWN_TRACKS,blockId:y.UfI.TRACK_LIST}),b=(0,y.wZZ)(),f=(0,u.c)(()=>{t.tracksController&&E.getData(t.tracksController)});(0,c.L)(f),(0,l.useEffect)(()=>{E.isNeededToLoad&&f()},[E.isNeededToLoad,f]),(0,l.useEffect)(()=>()=>{E.reset()},[E]),(0,y.Jzs)(E.isResolved);let I=(0,l.useMemo)(()=>({Header:()=>(0,i.jsx)(C,{}),Footer:()=>(0,i.jsx)(p.A,{children:(0,i.jsx)(p.wi,{className:S().footer})})}),[]);if(E.loadingState===y.GuX.REJECT)return(0,i.jsx)(g.w,{});if(E.isEmpty)return(0,i.jsx)(N,{});let k=(null==(e=E.items)?void 0:e.length)||10;return(0,i.jsx)(y.nVz,{pageId:y._Q$.DOWNLOADS_TRACKS,children:(0,i.jsx)(m.hO,{scrollElement:a,children:(0,i.jsxs)("div",{className:S().pageContainer,children:[(0,i.jsx)(L,{}),(0,i.jsx)(p.$$,{context:{listAriaLabel:v({id:"offline.downloaded-track-list"})},className:(0,r.$)(S().root,S().important),listClassName:S().content,customComponents:I,totalCount:k,itemContentCallback:e=>{var t;let a=null==(t=E.items)?void 0:t[e];return a?(0,i.jsx)(h.Kt,{track:a,playContextParams:b(a.id,{contextData:{type:d.K.Various,meta:{id:y._Q$.DOWNLOADS_TRACKS},from:P},entitiesData:E.entitiesData,queueParams:{index:e,entityId:a.id},loadContextMeta:!1})},a.id):(0,i.jsx)(p.DS,{isActive:!0,className:S().trackShimmer,variant:y.Xjt.PLAYLIST})},debounceDurationInMs:300,initialItemCount:k,handleRef:s,shouldTriggerRangeChangedOn:[k],testId:o.Xk.myMusic.MY_MUSIC_DOWNLOADED_TRACKS_PAGE})]})})})})},40013:e=>{e.exports={root:"PostPlaylists_root__3tea0",content:"PostPlaylists_content__2fXI5"}},40311:e=>{e.exports={icon:"ConcertNotFoundPage_icon__9yJIB"}},43459:(e,t,a)=>{"use strict";a.d(t,{l:()=>r});var i=a(75305);function r(e){return(null==e?void 0:e.data.type)===i.R.SmartPreview}},44958:(e,t,a)=>{"use strict";a.d(t,{km:()=>y,h4:()=>B,cw:()=>u,k_:()=>q});var i=a(94767),r=a(41028),s=a(61299),l=a(51551),n=a(59615);let o=(e,t,a)=>-1===a?e.slice(t):e.slice(t,t+a),d=r.gK.compose(r.gK.model("ConcertsPageConfig",{topOffset:r.gK.optional(r.gK.number,0),topLimit:r.gK.optional(r.gK.number,3),feedOffset:r.gK.optional(r.gK.number,3),feedLimit:r.gK.optional(r.gK.number,-1)}),n.XT).actions(e=>({getData:(0,r.L3)(function*(){let{concertsResource:t,modelActionsLogger:a}=(0,r._$)(e);if(!e.isLoading)try{e.loadingState=i.GuX.PENDING;let{config:{feed:a,top:r}}=yield t.getTabConfig({});e.feedLimit=a.limit,e.feedOffset=a.offset,e.topLimit=r.limit,e.topOffset=r.offset,e.loadingState=i.GuX.RESOLVE}catch(t){a.error(t),e.loadingState=i.GuX.REJECT}}),reset(){e.loadingState=i.GuX.IDLE,e.feedLimit=-1,e.feedOffset=3,e.topLimit=3,e.topOffset=0}})),u=r.gK.compose(r.gK.model("ConcertsPage",{config:d,landing:s.Ju,topConcerts:r.gK.maybeNull(r.gK.array(l.aR)),feedConcerts:r.gK.maybeNull(r.gK.array(l.aR))}),n.XT,n.pl).views(e=>({get isShimmerVisible(){return e.isNeededToLoad||e.isLoading||e.isRejected},get isShimmerActive(){return e.isLoading}})).actions(e=>({getData:(0,r.L3)(function*(){let{concertsResource:t,modelActionsLogger:a}=(0,r._$)(e);if(!e.config.isLoading&&!e.isLoading)try{e.loadingState=i.GuX.PENDING,yield e.config.getData();let{items:a}=yield t.getFeed({}),{feedConcerts:s,topConcerts:n}=((e,t)=>{let{topLimit:a,topOffset:i,feedLimit:r,feedOffset:s}=e;return{topConcerts:o(t,i,a),feedConcerts:o(t,s,r)}})(e.config,a.map(e=>(0,l.ho)(e.data.concert,e.data.minPrice)));e.feedConcerts=(0,r.wg)(s),e.topConcerts=(0,r.wg)(n),e.loadingState=i.GuX.RESOLVE}catch(t){a.error(t),e.loadingState=i.GuX.REJECT}}),reset(){e.config.reset(),e.landing.reset(),e.loadingState=i.GuX.IDLE,e.destroyItems([e.topConcerts,e.feedConcerts])}}));var c=a(33008),g=a(97531),m=a(66268),h=a(35233);let y=(0,g.PA)(()=>{let{concerts:e}=(0,i.Pjs)();return(0,m.useEffect)(()=>()=>{e.reset()},[e]),(0,c.jsx)(h.M,{})});var p=a(17846),v=a(73827),S=a(96560),E=a(54960),P=a(93967),b=a(43836),f=a(57747),I=a(77868),k=a(42213),_=a(44612),T=a(95227),C=a(53799),A=a(8038),D=a.n(A);let N=(0,g.PA)(()=>{let e=(0,m.useId)(),{concerts:t}=(0,i.Pjs)(),{formatMessage:a}=(0,v.A)(),[r,s]=(0,_.d)(),n=(0,i.fBs)(),o=(0,m.useRef)(!1),d=(0,k.c)(()=>{var e;return!t.isShimmerVisible&&(null==(e=t.feedConcerts)?void 0:e.length)?t.feedConcerts.length:50}),{virtualizer:u,rowResizeObserver:g,columnCount:h,indices:y}=(0,T.LW)({count:d(),rowGap:32,columnGap:16,getEstimateRowSize:()=>371,minColumnCount:2,minColumnWidth:170,maxColumnWidth:227,containerRef:r}),p={"--feed-concerts-height":"".concat(u.getTotalSize(),"px"),"--feed-concerts-column-count":h},S=(0,m.useCallback)(e=>{var a,r,s;let n=null==(a=t.feedConcerts)?void 0:a[e];return!n||t.isShimmerVisible?(0,c.jsx)(l.LY,{isActive:t.isShimmerActive}):(0,c.jsx)(i.Bki,{objectType:P.ky.Concert,objectId:n.id,objectPosX:e%h+1,objectPosY:Math.floor(e/h)+1,objectsCount:null!=(s=null==(r=t.feedConcerts)?void 0:r.length)?s:0,children:(0,c.jsx)(l.Qb,{concert:n})})},[h,t.feedConcerts,t.isShimmerActive,t.isShimmerVisible]);return(0,m.useEffect)(()=>{t.isResolved&&!o.current&&(n(),o.current=!0)},[t.isResolved,n]),(0,c.jsxs)("div",{className:D().root,children:[(0,c.jsx)(C.Tw,{className:D().header,labeledForId:e,title:a({id:"concerts.all-concerts"}),headingVariant:"h2"}),(0,c.jsx)("div",{"aria-labelledby":e,ref:s,style:p,className:D().container,children:u.getVirtualItems().map(e=>(0,c.jsx)(T.Ux,{className:D().row,columnClassName:D().column,virtualItem:e,resizeObserver:g,indices:y,renderItemByIndex:S,scrollMargin:u.options.scrollMargin},e.key))})]})});var L=a(85896),x=a(95567),R=a(59646),w=a.n(R);let G=e=>{let{children:t}=e,a=(0,m.useId)(),i=(0,m.useRef)(null),{formatMessage:r}=(0,v.A)();return(0,c.jsxs)("div",{className:w().root,children:[(0,c.jsx)(C.Tw,{className:w().header,labeledForId:a,title:r({id:"concerts.top-for-you"}),controls:(0,c.jsx)(C.X9,{className:w().controls,carouselRef:i}),headingVariant:"h2"}),(0,c.jsx)(x.Carousel,{className:w().carousel,ref:i,itemClassName:(0,L.$)(w().item,w().important),"aria-labelledby":a,children:t})]})},K=e=>Array.from({length:10},(t,a)=>(0,c.jsx)(l.LY,{isActive:e,withPriceButton:!0},a)),O=(0,g.PA)(()=>{let{concerts:e}=(0,i.Pjs)(),t=(0,i.fBs)(),a=(0,m.useRef)(!1),r=(0,m.useMemo)(()=>{var t;return(null==(t=e.topConcerts)?void 0:t.length)&&!e.isShimmerVisible?e.topConcerts.map((t,a)=>{var r,s;return(0,c.jsx)(i.Bki,{objectType:P.ky.Concert,objectId:t.id,objectPosX:a+1,objectPosY:1,objectsCount:null!=(s=null==(r=e.topConcerts)?void 0:r.length)?s:0,children:(0,c.jsx)(l.Qb,{withMask:!1,withPriceButton:!0,concert:t})},t.getKey(a))}):K(e.isShimmerActive)},[e.isShimmerActive,e.isShimmerVisible,e.topConcerts]);return(0,m.useEffect)(()=>{e.isResolved&&!a.current&&(t(),a.current=!0)},[e.isResolved,t]),e.isNeededToLoad&&(0,m.use)(e.getData()),(0,c.jsx)(G,{children:r})}),M=()=>(0,c.jsx)(m.Suspense,{fallback:(0,c.jsx)(G,{children:K(!0)}),children:(0,c.jsx)(O,{})});var X=a(83888),F=a(64143),j=a(48551),U=a(94503),V=a.n(U);let B=(0,g.PA)(()=>{var e,t,a,r,l,n,o,d,u;let{formatMessage:g}=(0,v.A)(),{setContentScrollRef:h,contentScrollRef:y}=(0,i.gKY)(),{concerts:_,experiments:T,user:A}=(0,i.Pjs)(),D=(()=>{let e=(0,j.st)(),t=(0,i.UlF)(),{hash:a}=(0,j.gf)();return(0,k.c)((i,r)=>{if(!e)return;let s={hash:a,pageId:P.QT.ConcertsLandingScreen,pageStyle:P.QL.Fullscreen,pagePlacement:P.c4.Fullscreen,viewUuid:r},l=(0,P.Fx)({params:s,logger:t,context:"useSendEventOnConcertsOpenedOrClosed"});l&&(i?(0,P.Fn)(e.evgenInstance,l):(0,P.PO)(e.evgenInstance,l))})})(),L=(0,m.useRef)(String((0,E.A)())),x=null!=(n=null==(e=_.landing.meta)?void 0:e.selectedTabIndex)?n:0,R=null!=(o=null==(a=_.landing.tabs.data)||null==(t=a[x])?void 0:t.blocks.length)?o:0;return(T.checkExperiment(i.zal.WebNextConcertsTab,"on")||(0,p.notFound)(),A.hasPlus||(0,p.redirect)(i.Zyd.main.href),(0,m.useEffect)(()=>()=>{_.reset()},[_]),(0,m.useEffect)(()=>{let e=L.current;return D(!0,e),()=>{D(!1,e)}},[D]),(0,i.Jzs)(_.landing.isResolved),(()=>{let e=(0,m.useRef)(1),{concerts:t}=(0,i.Pjs)(),{notify:a}=(0,i.lkh)(),{formatMessage:r}=(0,v.A)();(0,m.useEffect)(()=>{e&&(t.isRejected&&a((0,c.jsx)(C.hT,{error:r({id:"concerts.feed-error"})}),{containerId:i.uQT.ERROR}),e.current--)},[t.isRejected,r,a])})(),_.landing.isNeededToLoad&&(0,m.use)(_.landing.getSkeleton({id:b.p.CONCERTS,showWizard:A.settings.showWizard},{preloadBlocksCount:2})),_.landing.isRejected)?(0,c.jsx)(X.w,{}):(0,c.jsx)(i.nVz,{pageId:i._Q$.CONCERTS,children:(0,c.jsxs)(F.hO,{scrollElement:y,outerTitle:g({id:"entity-names.concerts"}),children:[(0,c.jsx)(C.Y9,{variant:C.Vw.TEXT,showControls:!1,children:(0,c.jsx)(I.Heading,{variant:"h1",weight:"bold",size:"xl",children:(0,c.jsx)(S.A,{id:"entity-names.concerts"})})}),(0,c.jsxs)(f.N,{ref:h,className:V().root,containerClassName:V().container,children:[(0,c.jsx)(i.jPc,{children:(0,c.jsx)(i.hjC,{tabId:"",tabPos:0,isTabSelectedByDefault:!1,children:(0,c.jsx)(i.FoH,{blockId:P.LA.ConcertTabHeader,blockType:P.LA.ConcertTabHeader,blockPosX:1,blockPosY:1,objectsCount:null!=(d=null==(r=_.topConcerts)?void 0:r.length)?d:0,children:(0,c.jsx)(M,{})})})}),(0,c.jsx)(i.MZP,{offsetBlockPosY:1,children:(0,c.jsx)(s.EA,{landing:_.landing,errorComponent:(0,c.jsx)(X.w,{withBackwardControl:!1})})}),(0,c.jsx)(i.jPc,{children:(0,c.jsx)(i.hjC,{tabId:"",tabPos:0,isTabSelectedByDefault:!1,children:(0,c.jsx)(i.FoH,{blockId:P.LA.ConcertTabFeed,blockType:P.LA.ConcertTabFeed,blockPosX:1,blockPosY:R+2,objectsCount:null!=(u=null==(l=_.feedConcerts)?void 0:l.length)?u:0,children:(0,c.jsx)(N,{})})})}),(0,c.jsx)(C.A,{children:(0,c.jsx)(C.wi,{className:V().footer})})]})]})})}),q=()=>(0,c.jsx)(C.JR,{style:{position:"absolute",background:"var(--ym-background-color-primary-enabled-content)"}})},45648:(e,t,a)=>{"use strict";a.d(t,{vB:()=>g,t6:()=>m.ChartPodcastsPage});var i=a(94767),r=a(41028),s=a(61979),l=a(52732),n=a(59615);let o=r.gK.compose(r.gK.model("ChartPodcastsPage",{title:r.gK.maybeNull(r.gK.string),items:r.gK.array(l.JC),errorStatusCode:r.gK.maybeNull(r.gK.number)}),n.pl,n.XT).views(e=>{let t={get isLoading(){return e.isNeededToLoad||e.loadingState===i.GuX.PENDING},get isNotFound(){var a;let t=e.isResolved&&!(null==(a=e.items)?void 0:a.length),r=e.errorStatusCode===s.X1.NOT_FOUND||e.errorStatusCode===s.X1.BAD_REQUEST;return e.loadingState===i.GuX.REJECT&&r||t},get isSomethingWrong(){return e.isRejected&&!t.isNotFound}};return t}).actions(e=>({getData:(0,r.L3)(function*(t){let{chartResource:a,modelActionsLogger:n}=(0,r._$)(e);if(e.loadingState!==i.GuX.PENDING)try{let s;e.loadingState=i.GuX.PENDING,e.title=(s=t?yield a.getChartPodcastsCategory({categoryId:t}):yield a.getChartPodcasts()).title,s.chartPositions&&(e.items=(0,r.wg)(s.chartPositions.map(e=>(0,l.bl)(e.album,e.chartPosition)))),e.loadingState!==i.GuX.IDLE&&(e.loadingState=i.GuX.RESOLVE)}catch(t){n.error(t),t instanceof s.GX&&(t.statusCode===s.X1.NOT_FOUND||t.statusCode===s.X1.BAD_REQUEST)&&(e.errorStatusCode=s.X1.NOT_FOUND),e.loadingState!==i.GuX.IDLE&&(e.loadingState=i.GuX.REJECT)}}),reset(){e.loadingState=i.GuX.IDLE,e.title=null,e.errorStatusCode=null,e.destroyItems([e.items])}}));var d=a(44078);let u=r.gK.model("ChartPagePlaylistModel",{uuid:r.gK.string,uid:r.gK.number,kind:r.gK.number}),c=r.gK.compose(r.gK.model("ChartTracksPage",{title:r.gK.maybeNull(r.gK.string),playlistMeta:r.gK.maybeNull(u),items:r.gK.array(d.vj)}),n.XT).views(e=>({get isLoading(){return e.isNeededToLoad||e.loadingState===i.GuX.PENDING}})).actions(e=>({getTracks:(0,r.L3)(function*(){let{landing3Resource:t,modelActionsLogger:a}=(0,r._$)(e);if(e.loadingState!==i.GuX.PENDING)try{e.loadingState=i.GuX.PENDING;let a=yield t.getChart();e.title=a.chart.title,e.playlistMeta=(0,r.wg)({uuid:a.chart.playlistUuid,uid:a.chart.uid,kind:a.chart.kind}),e.items=(0,r.wg)(a.chart.tracks.map(e=>(0,d.bV)(e.track,e.chart))),e.loadingState!==i.GuX.IDLE&&(e.loadingState=i.GuX.RESOLVE)}catch(t){a.error(t),e.loadingState!==i.GuX.IDLE&&(e.loadingState=i.GuX.REJECT)}})})),g=r.gK.model("ChartPageModel",{tracksSubPage:c,podcastsSubPage:o});a(60180);var m=a(63e3);a(67956)},46052:e=>{e.exports={root:"PostPage_root__Orhf7",scrollableContainer:"PostPage_scrollableContainer__iV9Bo",scrollContainer:"PostPage_scrollContainer__zrIrH",important:"PostPage_important__qUlED",container:"PostPage_container__orSfz",shimmerTitle:"PostPage_shimmerTitle__EeFCD"}},49077:(e,t,a)=>{"use strict";a.d(t,{PlaylistPersonalDummyPage:()=>c});var i=a(33008),r=a(85896),s=a(97531),l=a(77868),n=a(94767),o=a(53799),d=a(12627),u=a.n(d);let c=(0,s.PA)(()=>{let{playlistPersonal:{dummyCoverUrl:e,dummyDescription:t,title:a}}=(0,n.Pjs)();return(0,i.jsxs)("div",{className:u().root,children:[(0,i.jsx)(o.Y9,{}),(0,i.jsx)(o.BW,{src:e,size:200,fit:"cover",withAvatarReplace:!0,"aria-hidden":!0,className:u().cover}),a&&(0,i.jsx)(l.Heading,{className:(0,r.$)(u().title,u().important),variant:"h1",size:"xs",children:a}),t&&(0,i.jsx)(l.Caption,{className:(0,r.$)(u().text,u().important),variant:"span",type:"text",size:"l",weight:"normal",children:t})]})})},50270:e=>{e.exports={root:"ChartTracksPage_root__QMbqY",scrollContainer:"ChartTracksPage_scrollContainer__Pxe8S",important:"ChartTracksPage_important__Lddyf",content:"ChartTracksPage_content__yyIAN",footer:"ChartTracksPage_footer__6sNBk",shimmerItem:"ChartTracksPage_shimmerItem__YwM0h"}},52568:(e,t,a)=>{"use strict";a.d(t,{GenresNotFoundPage:()=>s});var i=a(33008),r=a(35233);let s=()=>(0,i.jsx)(r.M,{})},54388:(e,t,a)=>{"use strict";a.r(t),a.d(t,{DesktopInitializer:()=>o});var i=a(33008),r=a(66268),s=a(49444),l=a(77575),n=a(94767);let o=()=>{let{language:e}=(0,n.h6b)();{let{theme:t}=(0,n.DPo)(),a=(0,s.j)();(0,l.sq)(),(0,l.P4)(),(0,l.bk)(),(0,l.LD)(),(0,l.t4)(),(0,l.Fn)(),(0,l.eP)(),(0,l.sb)(),(0,r.useEffect)(()=>{(0,l.M4)(e),(0,l.CA)()},[e]),(0,r.useEffect)(()=>{let e=(0,n.HFS)();e&&a.count(e,"appVersion")},[a]),(0,r.useEffect)(()=>{t&&((0,l._E)(t),a.count(t,"appTheme"))},[t])}return(0,i.jsx)(l.qw,{})}},59646:e=>{e.exports={root:"TopConcertsCarousel_root__opMbb",controls:"TopConcertsCarousel_controls__c92PW",header:"TopConcertsCarousel_header__3h3Zn",carousel:"TopConcertsCarousel_carousel__uMke6",item:"TopConcertsCarousel_item__fz8lR",important:"TopConcertsCarousel_important__ZcT6Z"}},59745:(e,t,a)=>{"use strict";a.r(t),a.d(t,{UrlInitializer:()=>l});var i=a(97531),r=a(17846),s=a(94767);let l=(0,i.PA)(e=>{let{host:t}=e,{location:a}=(0,s.Pjs)(),i=(0,r.usePathname)(),l=(0,r.useSearchParams)().toString(),n=window.location.host,o=t||n,d="https://".concat(o),u="https://".concat(o).concat(i).concat(l?"?":"").concat(l);d=o,u="".concat(o).concat(i).concat(l?"?":"").concat(l),a.setPathname(i),a.setSearchParams(l),a.setHost(o),a.setTld((0,s.fMM)(o)||s.lYh),a.setOrigin(d),a.setHref(u)})},59938:e=>{e.exports={root:"BrowserUpdateNotification_root__IN495",important:"BrowserUpdateNotification_important__6k4Gb"}},60180:(e,t,a)=>{"use strict";a.d(t,{ChartPodcastsNotFoundPage:()=>o});var i=a(33008),r=a(97531),s=a(66268),l=a(35233),n=a(94767);let o=(0,r.PA)(()=>{let{chart:{podcastsSubPage:e}}=(0,n.Pjs)();return(0,s.useEffect)(()=>{e.reset()},[]),(0,i.jsx)(l.M,{})})},60411:(e,t,a)=>{"use strict";var i;a.d(t,{Q:()=>i}),function(e){e.ALBUMS="albums",e.ARTISTS="artists",e.PLAYLISTS="playlists"}(i||(i={}))},61334:(e,t,a)=>{"use strict";a.r(t),a.d(t,{WebInitializer:()=>l});var i=a(33008);a(66268);var r=a(94767);let s=(0,a(97531).PA)(e=>{let{children:t,userIp:a}=e,{location:i}=(0,r.Pjs)();return t}),l=e=>{let{userIp:t}=e,{experiments:a}=(0,r.Pjs)();return(0,r.NFA)().get(r.ooW).get(r.cYZ.DisallowDeeplinksRedirect),(0,i.jsx)(s,{userIp:t})}},62289:(e,t,a)=>{"use strict";a.r(t),a.d(t,{ThemeProvider:()=>o});var i=a(33008),r=a(66268),s=a(42213),l=a(94767),n=a(53799);let o=e=>{let{children:t,predefinedTheme:a}=e,o=(0,l.NFA)().get(l.ooW),{getThemeFromStorage:d,setThemeToStorage:u}=(0,l.QDo)(o),[c,g]=(0,r.useState)(()=>null!=a?a:d()),m=(0,s.c)(e=>{d()||a||(u(l.W3W),g(e))});(0,r.useLayoutEffect)(()=>{a||(0,l.Z8R)(c)},[c,a]),(0,l.kgS)({onSystemThemeChange:m}),(0,r.useLayoutEffect)(()=>{m((0,l.VDQ)())},[m]);let h=(0,r.useMemo)(()=>({theme:c,setTheme:g}),[c]);return(0,i.jsx)(l.Dx0.Provider,{value:h,children:(0,i.jsx)(r.Suspense,{fallback:(0,i.jsx)(n.JR,{}),children:t})})}},63e3:(e,t,a)=>{"use strict";a.d(t,{ChartPodcastsPage:()=>E});var i=a(33008),r=a(85896),s=a(97531),l=a(17846),n=a(66268),o=a(73827),d=a(18064),u=a(91342),c=a(77868),g=a(83888),m=a(52732),h=a(64143),y=a(94767),p=a(53799),v=a(98154),S=a.n(v);let E=(0,s.PA)(e=>{let{categoryId:t}=e,{chart:{podcastsSubPage:a},settings:{isMobile:s}}=(0,y.Pjs)(),{contentScrollRef:v,setContentScrollRef:E}=(0,y.gKY)(),{formatMessage:P}=(0,o.A)(),b=(0,y.W6M)(),f=(0,n.useMemo)(()=>({Footer:()=>(0,i.jsx)(p.A,{children:(0,i.jsx)(p.wi,{className:S().footer})})}),[]),I=(0,n.useMemo)(()=>a.title?(0,i.jsx)(c.Heading,{id:"collection-artists-header",variant:"h1",weight:"bold",size:"xl",lineClamp:1,children:a.title}):(0,i.jsx)(u.Shimmer,{className:S().shimmerTitle,radius:"l"}),[a.title]);if((0,y.Jzs)(a.isResolved),a.isNotFound&&(0,l.notFound)(),(0,n.useEffect)(()=>()=>{a.reset()},[a]),a.isNeededToLoad&&(0,n.use)(a.getData(t)),a.isSomethingWrong)return(0,i.jsx)(g.w,{});let k=a.isLoading?20:a.items.length;return(0,i.jsx)(y.nVz,{pageId:t?y._Q$.CHART_PODCASTS_CATEGORY:y._Q$.CHART_PODCASTS,children:(0,i.jsx)(h.hO,{scrollElement:v,outerTitle:a.title,children:(0,i.jsxs)("div",{className:S().root,...(0,d.Am)(d.Xk.chart.CHART_PODCASTS),children:[(0,i.jsx)(p.Y9,{variant:p.Vw.TEXT,withForwardControl:!1,withBackwardControl:b.canBack,children:I}),(0,i.jsx)(p.$$,{className:(0,r.$)(S().scrollContainer,S().important),listClassName:S().content,customComponents:f,itemContentCallback:e=>{let t=a.items[e],r=P({id:"loading-messages.entity-is-loading"},{entityName:P({id:"entity-names.album"})});return!t||a.isLoading?(0,i.jsx)(p.Vt,{"aria-label":r}):(0,i.jsx)(m.aX,{album:t,contentLinesCount:3,withLikesCount:!0,withChart:!0,withAddition:!1})},handleRef:E,initialItemCount:k,totalCount:k,isMobileLayout:s,useWindowScroll:s,context:{listAriaLabel:P({id:"entity-names.chart-podcasts-list"})}})]})})})})},63661:(e,t,a)=>{"use strict";a.d(t,{bp:()=>P,A6:()=>O,Bd:()=>c});var i=a(41028);let r=i.gK.model("ConcertDescription",{text:i.gK.string,genre:i.gK.maybe(i.gK.string),source:i.gK.maybe(i.gK.string)});var s=a(61979),l=a(61299),n=a(70879),o=a(51551),d=a(94767),u=a(59615);let c=i.gK.compose(i.gK.model("ConcertPage",{meta:i.gK.maybeNull(o.aR),covers:i.gK.maybeNull(i.gK.array(u.$B)),description:i.gK.maybeNull(r),leadArtistId:i.gK.maybeNull(i.gK.union(i.gK.string,i.gK.number)),artists:i.gK.maybeNull(i.gK.array(n.PK)),errorStatusCode:i.gK.maybeNull(i.gK.number),landing:l.Ju}),u.XT,u.pl).views(e=>({get isShimmerVisible(){return e.isNeededToLoad||e.isLoading||e.isRejected},get isShimmerActive(){return e.isLoading},get isNotFound(){return e.isRejected&&(e.errorStatusCode===s.X1.NOT_FOUND||e.errorStatusCode===s.X1.BAD_REQUEST)},get coversUri(){var t,a;return null!=(a=null==(t=e.covers)?void 0:t.map(e=>e.uri).filter(e=>!!e))?a:[]}})).actions(e=>({getInfo:(0,i.L3)(function*(t){let{concertId:a}=t,{concertsResource:r,modelActionsLogger:l}=(0,i._$)(e);if(!e.isLoading)try{e.loadingState=d.GuX.PENDING;let{concert:t,minPrice:s,covers:l,description:u,leadArtistId:c,artists:g}=yield r.getInfo({concertId:a});e.meta=(0,o.ho)(t,s),e.covers=(0,i.wg)(null==l?void 0:l.map(e=>(0,d.pX4)(e))),e.description=u?(0,i.wg)(u):null,e.leadArtistId=c?(0,i.wg)(c):null,e.artists=(0,i.wg)(null==g?void 0:g.map(e=>(0,n.dM)(e))),e.loadingState=d.GuX.RESOLVE}catch(t){l.error(t),t instanceof s.GX&&(t.statusCode===s.X1.NOT_FOUND||t.statusCode===s.X1.BAD_REQUEST)&&(e.errorStatusCode=s.X1.NOT_FOUND),e.loadingState=d.GuX.REJECT}}),reset(){e.loadingState=d.GuX.IDLE,e.landing.reset(),e.leadArtistId=null,e.destroyItems([e.covers,e.description,e.artists])}}));var g=a(33008),m=a(97531),h=a(66268),y=a(73827),p=a(35233),v=a(40311),S=a.n(v);let E=(0,m.PA)(()=>{let{experiments:e,user:t,concert:a}=(0,d.Pjs)(),{formatMessage:i}=(0,y.A)(),r=e.checkExperiment(d.zal.WebNextConcertPage,"on");if((0,d.ACS)(),(0,h.useEffect)(()=>()=>{a.reset()},[a]),!r||!t.hasPlus)return(0,g.jsx)(p.M,{});let s=i({id:"page-error.concert-page-does-not-exist"}),l=i({id:"page-error.concert-page-does-not-exist-description"});return(0,g.jsx)(p.M,{title:s,description:l,iconVariant:"attention",iconSize:"xxl",iconClassName:S().icon})}),P=(0,m.PA)(()=>(0,g.jsx)(d.nVz,{pageId:d._Q$.PAGE_NOT_FOUND_SCREEN,children:(0,g.jsx)(E,{})}));var b=a(17846),f=a(54960),I=a(93967),k=a(43836),_=a(42213),T=a(1357),C=a(42314),A=a(57747),D=a(74837),N=a(83888),L=a(64143),x=a(53799),R=a(48551),w=a(18998),G=a.n(w);let K=(0,m.PA)(e=>{var t,a,i;let{concertId:r,isWebNextNavigationOn:s}=e,{experiments:n,user:o,concert:u,modals:{imageSliderModal:c}}=(0,d.Pjs)(),m=(()=>{let e=(0,R.st)(),t=(0,d.UlF)(),{pageId:a}=(0,d.$au)(),{hash:i}=(0,R.gf)();return(0,_.c)((r,s)=>{if(!e||!a)return;let l={hash:i,pageId:a,pageStyle:I.QL.Fullscreen,pagePlacement:I.c4.Fullscreen,viewUuid:s,mainObjectType:I.ky.Concert},n=(0,I.Fx)({params:l,logger:t,context:"useSendEventOnConcertOpenedOrClosed"});n&&(r?(0,I.Fn)(e.evgenInstance,n):(0,I.PO)(e.evgenInstance,n))})})(),y=(0,h.useRef)(String((0,f.A)())),{setContentScrollRef:p,contentScrollRef:v}=(0,d.gKY)(),{forceUpdateRefCallback:S,offsetY:E}=(0,T.G)(v),P=(0,d.ytd)(null==(a=u.covers)||null==(t=a[0])?void 0:t.color),{topColorStyle:w,headerStyle:K}=(0,L.QZ)(P,E,s),O=(0,_.c)(()=>{u.coversUri.length>0&&c.openImages({images:u.coversUri,sizeImage:800,withAspectRatio:!1})}),M=n.checkExperiment(d.zal.WebNextConcertPage,"on");(0,d.ACS)(),(0,h.useEffect)(()=>()=>{u.reset()},[u]),(0,h.useEffect)(()=>{let e=y.current;return m(!0,e),()=>{m(!1,e)}},[m]),(0,d.Jzs)(u.isResolved);let X=[];if(u.isNeededToLoad&&X.push(u.getInfo({concertId:r})),u.landing.isNeededToLoad&&X.push(u.landing.getConcertSkeleton({concertId:r,skeletonId:k.p.CONCERT_PAGE},{preloadBlocksCount:2})),X.length&&(0,h.use)(Promise.allSettled(X)),M&&o.hasPlus&&!u.isNotFound||(0,b.notFound)(),u.isRejected)return(0,g.jsx)(N.w,{});let F=(0,C.L)(()=>{var e,t,a;return u.isLoading||!u.meta||u.isRejected?(0,g.jsx)(D.c6,{className:G().header,isActive:!0}):(0,g.jsx)(d.Bki,{objectType:I.ky.Concert,objectId:null==(e=u.meta)?void 0:e.id,objectPosX:1,objectPosY:1,objectsCount:1,mainObjectType:I.ky.Concert,mainObjectId:null==(t=u.meta)?void 0:t.id,children:(0,g.jsx)(D.Dc,{description:u.description,onCoverClick:O,leadArtistId:u.leadArtistId,ref:S,className:G().header,concert:u.meta,cover:null==(a=u.covers)?void 0:a[0]})})});return(0,g.jsx)(d.jPc,{children:(0,g.jsxs)(L.hO,{scrollElement:v,children:[(0,g.jsx)(x.Y9,{style:K,variant:x.Vw.INNER,showControls:!1}),(0,g.jsx)("div",{className:G().averageColorBackground,style:w}),(0,g.jsxs)(A.N,{ref:p,className:G().root,containerClassName:G().container,children:[(0,g.jsxs)("div",{children:[(0,g.jsx)(d.hjC,{tabId:"",tabPos:0,isTabSelectedByDefault:!1,children:(0,g.jsx)(d.FoH,{blockId:I.LA.ConcertHeader,blockType:I.LA.ConcertHeader,blockPosX:1,blockPosY:1,objectsCount:1,mainObjectType:I.ky.Concert,mainObjectId:null==(i=u.meta)?void 0:i.id,children:F})}),(0,g.jsx)(l.EA,{containerClassName:G().skeleton,landing:u.landing,errorComponent:(0,g.jsx)(N.w,{className:G().error,withBackwardControl:!1})})]}),(0,g.jsx)(x.A,{children:(0,g.jsx)(x.wi,{className:G().footer})})]})]})})}),O=(0,m.PA)(e=>(0,g.jsx)(d.nVz,{pageId:d._Q$.CONCERT,pageEntityId:e.concertId,children:(0,g.jsx)(K,{...e})}))},66342:e=>{e.exports={root:"KidsCategoryPageShimmer_root__0V_bC"}},66513:e=>{e.exports={root:"PostArtists_root__Zxmjq",content:"PostArtists_content__JzGOH"}},67956:(e,t,a)=>{"use strict";a.d(t,{ChartTracksPage:()=>E});var i=a(33008),r=a(85896),s=a(97531),l=a(66268),n=a(73827),o=a(18064),d=a(48509),u=a(91342),c=a(77868),g=a(83888),m=a(64143),h=a(44078),y=a(94767),p=a(53799),v=a(50270),S=a.n(v);let E=(0,s.PA)(()=>{let{formatMessage:e}=(0,n.A)(),{chart:{tracksSubPage:t},settings:{isMobile:a}}=(0,y.Pjs)(),s=(0,y.W6M)(),{contentScrollRef:v,setContentScrollRef:E}=(0,y.gKY)(),P=(0,y.wZZ)(),{from:b}=(0,y.fyy)({pageId:y._Q$.CHART});(0,y.Jzs)(t.isResolved);let f=(0,l.useCallback)(e=>{let a=t.items[e];return a&&!t.isLoading&&t.playlistMeta?(0,i.jsx)(h.QB,{track:a,playContextParams:P(e,{contextData:{type:d.K.Playlist,meta:{id:"".concat(t.playlistMeta.uid,":").concat(t.playlistMeta.kind)},from:b},queueParams:{index:e,entityId:a.id},loadContextMeta:!0})}):(0,i.jsx)(p.DS,{isActive:!0,className:S().shimmerItem,variant:y.Xjt.PLAYLIST})},[b,P,t.isLoading,t.items,t.playlistMeta]),I=(0,l.useMemo)(()=>({Footer:()=>(0,i.jsx)(p.A,{children:(0,i.jsx)(p.wi,{className:S().footer})})}),[]),k=(0,l.useMemo)(()=>t.title?(0,i.jsx)(c.Heading,{id:"collection-artists-header",variant:"h1",weight:"bold",size:"xl",lineClamp:1,children:t.title}):(0,i.jsx)(u.Shimmer,{className:S().shimmerTitle,radius:"l"}),[t.title]);return(t.isNeededToLoad&&(0,l.use)(t.getTracks()),t.isRejected)?(0,i.jsx)(g.w,{}):(0,i.jsx)(y.nVz,{pageId:y._Q$.CHART,children:(0,i.jsx)(m.hO,{scrollElement:v,...t.title&&{outerTitle:t.title},children:(0,i.jsxs)("div",{className:S().root,...(0,o.Am)(o.Xk.chart.CHART_PAGE),children:[(0,i.jsx)(p.Y9,{variant:p.Vw.TEXT,withForwardControl:!1,withBackwardControl:s.canBack,children:k}),(0,i.jsx)(p.$$,{className:(0,r.$)(S().scrollContainer,S().important),listClassName:S().content,customComponents:I,totalCount:t.items.length,itemContentCallback:f,debounceDurationInMs:300,handleRef:E,context:{listAriaLabel:e({id:"entity-names.chart-tracks-list"})},isMobileLayout:a,useWindowScroll:a})]})})})})},69132:(e,t,a)=>{"use strict";a.d(t,{ShortcutsProvider:()=>d});var i=a(33008),r=a(97531),s=a(66268),l=a(94767),n=a(87145);let o=null,d=(0,r.PA)(e=>{let{children:t}=e,{sonataState:a}=(0,l.Pjs)(),r=(0,s.useMemo)(()=>(o||(o=new l.G8o(new l.z$B)),o),[]);return(0,n.E)({controller:r,sonataState:a,groupId:l.Mo.MAIN}),(0,s.useEffect)(()=>(null==r||r.listen(),()=>{null==r||r.stopListening()}),[r]),(0,i.jsx)(l.Pic.Provider,{value:r,children:t})})},69326:(e,t,a)=>{"use strict";a.d(t,{DeeplinkInitializer:()=>d});var i=a(97531),r=a(17846),s=a(66268),l=a(45415),n=a(94767);let o=[n.K3F.DEEPLINK,n.K3F.SEEDS,n.K3F.STATION_ID,n.K3F.OPEN_PLAYER,n.K3F.SCREEN],d=(0,i.PA)(()=>((()=>{let{fullscreenPlayer:e,sonataState:t,user:a,location:i}=(0,n.Pjs)(),d=(0,r.useSearchParams)(),u=(0,n.XJ9)(),c=d.get(n.K3F.SEEDS),g=d.get(n.K3F.STATION_ID),{isFreemium:m}=(0,n.XCI)(),{state:h,toggleTrue:y}=(0,l.e)(!1),p=(0,s.useMemo)(()=>{let e=c?c.split(","):[];return g&&e.unshift(g),e},[c,g]),{togglePlay:v}=(0,n.B0S)({seeds:p,pageIdForFrom:n._Q$.RADIO,blockIdForFrom:p.join("_")});(0,s.useEffect)(()=>{if(h){let e=new URL(window.location.href);o.forEach(t=>e.searchParams.delete(t)),u(e.toString()),i.setHref(window.location.href)}},[i,u,h,i.href]),(0,s.useEffect)(()=>{if(d.get(n.K3F.DEEPLINK)===n.vEM.PLAY_VIBE){if(!a.isAuthorized||m)return void y();t.setShouldApplyYnisonState(!1),v(),"true"===d.get(n.K3F.OPEN_PLAYER)&&e.modal.open(),y()}return()=>{t.setShouldApplyYnisonState(!0)}},[e.modal,m,d,y,t,v,a.isAuthorized])})(),null))},69686:(e,t,a)=>{"use strict";a.d(t,{PostPage:()=>R});var i=a(33008),r=a(85896),s=a(97531),l=a(17846),n=a(66268),o=a(60411),d=a(57747),u=a(91342),c=a(77868),g=a(83888),m=a(64143),h=a(94767),y=a(53799),p=a(23724),v=a.n(p);let S=()=>(0,i.jsxs)("div",{className:v().root,children:[(0,i.jsx)(u.Shimmer,{radius:"l",className:v().top}),(0,i.jsx)(u.Shimmer,{radius:"l",className:v().bottom})]});var E=a(46052),P=a.n(E),b=a(52732),f=a(4115),I=a.n(f);let k=(0,s.PA)(e=>{let{albums:t=[]}=e;return(0,i.jsx)("div",{className:I().root,children:(0,i.jsx)("div",{className:I().content,"aria-labelledby":"post-page-header",tabIndex:0,children:t.map(e=>(0,i.jsx)(b.aX,{className:I().item,album:e,contentLinesCount:3},e.id))})})});var _=a(90317),T=a(66513),C=a.n(T);let A=(0,s.PA)(e=>{let{artists:t=[]}=e;return(0,i.jsx)("div",{className:C().root,children:(0,i.jsx)("div",{className:C().content,"aria-labelledby":"post-page-header",tabIndex:0,children:t.map(e=>(0,i.jsx)(_.ao,{className:C().item,artist:e,contentLinesCount:3},e.id))})})});var D=a(45242),N=a(40013),L=a.n(N);let x=(0,s.PA)(e=>{let{playlists:t=[]}=e;return(0,i.jsx)("div",{className:L().root,children:(0,i.jsx)("div",{className:L().content,"aria-labelledby":"post-page-header",tabIndex:0,children:t.map(e=>(0,i.jsx)(D.B6,{className:L().item,playlist:e,contentLinesCount:3},e.id))})})}),R=(0,s.PA)(e=>{let{promoId:t}=e,{post:a}=(0,h.Pjs)(),s=(0,h.W6M)(),{contentScrollRef:p,setContentScrollRef:v}=(0,h.gKY)();(0,n.useEffect)(()=>()=>{a.reset()},[a]),a.isNotFound&&(0,l.notFound)(),(0,h.Jzs)(a.isResolved);let E=(0,n.useMemo)(()=>{if(a.isLoading)return(0,i.jsx)(S,{});switch(a.promotionType){case o.Q.ARTISTS:return(0,i.jsx)(A,{artists:a.artists});case o.Q.ALBUMS:return(0,i.jsx)(k,{albums:a.albums});case o.Q.PLAYLISTS:return(0,i.jsx)(x,{playlists:a.playlists});default:(0,l.notFound)()}},[a.albums,a.artists,a.isLoading,a.playlists,a.promotionType]);return(t&&a.isNeededToLoad&&(0,n.use)(a.getData({promoId:t})),a.isSomethingWrong)?(0,i.jsx)(g.w,{}):(0,i.jsx)(h.nVz,{pageId:h._Q$.POST,children:(0,i.jsx)(m.hO,{scrollElement:p,outerTitle:a.title||void 0,children:(0,i.jsxs)("div",{className:P().root,children:[(0,i.jsx)(y.Y9,{variant:y.Vw.TEXT,withForwardControl:!1,withBackwardControl:s.canBack,children:a.title?(0,i.jsx)(c.Heading,{id:"post-header",variant:"h2",weight:"bold",size:"xl",lineClamp:1,children:a.title}):(0,i.jsx)(u.Shimmer,{className:P().shimmerTitle,radius:"l"})}),(0,i.jsx)(d.N,{containerClassName:(0,r.$)(P().scrollContainer,P().important),className:P().scrollableContainer,ref:v,children:(0,i.jsx)("div",{className:P().container,children:E})})]})})})})},70286:(e,t,a)=>{"use strict";a.d(t,{oN:()=>d.TagPage,vV:()=>o});var i=a(41028),r=a(61979),s=a(25911),l=a(94767),n=a(59615);let o=i.gK.model("TagPage",{title:i.gK.maybe(i.gK.string),errorStatusCode:i.gK.maybeNull(i.gK.number),tagLoadingState:i.gK.enumeration(Object.values(l.GuX)),playlistsLoadingState:i.gK.enumeration(Object.values(l.GuX)),playlistsData:i.gK.array(i.gK.model({uid:i.gK.number,kind:i.gK.number})),playlists:i.gK.array(i.gK.maybeNull(s.$o)),pager:i.gK.maybeNull(n.jd),alreadyRequestedPages:i.gK.map(i.gK.number),pendingPages:i.gK.map(i.gK.number),requests:i.gK.maybeNull(i.gK.number)}).views(e=>{let t={get isNeededToLoad(){return e.tagLoadingState===l.GuX.IDLE},get isResolved(){return e.tagLoadingState===l.GuX.RESOLVE&&e.playlistsLoadingState===l.GuX.RESOLVE},get isNotFound(){let t=e.playlistsLoadingState===l.GuX.RESOLVE&&0===e.playlists.length;return(e.tagLoadingState===l.GuX.REJECT||e.playlistsLoadingState===l.GuX.REJECT)&&(e.errorStatusCode===r.X1.NOT_FOUND||e.errorStatusCode===r.X1.BAD_REQUEST)||t},get isSomethingWrong(){return(e.tagLoadingState===l.GuX.REJECT||e.playlistsLoadingState===l.GuX.REJECT)&&!t.isNotFound}};return t}).actions(e=>{let t={getPlaylists:(0,i.L3)(function*(t){let{page:a=0,pageSize:n=20}=t,{playlistsResource:o,modelActionsLogger:d}=(0,i._$)(e);if(!(e.tagLoadingState!==l.GuX.RESOLVE||e.playlistsLoadingState===l.GuX.PENDING&&e.pendingPages.has("".concat(a)))&&!e.alreadyRequestedPages.has("".concat(a))){e.alreadyRequestedPages.set("".concat(a),a);try{var u;e.playlistsLoadingState=l.GuX.PENDING,e.pendingPages.set("".concat(a),a);let t=a*n,r=e.playlistsData.slice(t,t+n),d=yield o.getPlaylists({playlistIds:r.map(e=>"".concat(e.uid,":").concat(e.kind)),resumeStream:!1});e.requests=(null!=(u=e.requests)?u:0)+1;let c={page:a,perPage:n,total:e.playlistsData.length};0===e.playlists.length&&(e.playlists=(0,i.wg)(Array.from({length:c.total},()=>null)));let g=d.playlists.map(s.jX);(0,l.Iyy)({items:e.playlists,mappedRawItems:g,page:a,pageSize:n}),e.pager=c,e.playlistsLoadingState!==l.GuX.IDLE&&(e.playlistsLoadingState=l.GuX.RESOLVE)}catch(t){d.error(t),t instanceof r.GX&&(t.statusCode===r.X1.NOT_FOUND||t.statusCode===r.X1.BAD_REQUEST)&&(e.errorStatusCode=r.X1.NOT_FOUND),e.playlistsLoadingState!==l.GuX.IDLE&&(e.playlistsLoadingState=l.GuX.REJECT)}finally{e.pendingPages.delete("".concat(a))}}}),reset(){e.tagLoadingState=l.GuX.IDLE,e.playlistsLoadingState=l.GuX.IDLE,e.alreadyRequestedPages.clear(),e.pendingPages.clear(),e.title=void 0,e.playlistsData=(0,i.wg)([]),e.playlists=(0,i.wg)([]),e.errorStatusCode=null},getTag:(0,i.L3)(function*(a){let{id:s,page:n=0,pageSize:o=20}=a,{tagResource:d,modelActionsLogger:u}=(0,i._$)(e);if(e.tagLoadingState!==l.GuX.PENDING)try{var c;e.tagLoadingState=l.GuX.PENDING;let a=yield d.getPlaylistIds({id:s});e.title=null==(c=a.tag)?void 0:c.name,e.playlistsData=(0,i.wg)(a.ids.map(e=>({uid:e.uid,kind:e.kind}))),e.tagLoadingState!==l.GuX.IDLE&&(e.tagLoadingState=l.GuX.RESOLVE),yield t.getPlaylists({page:n,pageSize:o})}catch(t){u.error(t),t instanceof r.GX&&(t.statusCode===r.X1.NOT_FOUND||t.statusCode===r.X1.BAD_REQUEST)&&(e.errorStatusCode=r.X1.NOT_FOUND),e.tagLoadingState!==l.GuX.IDLE&&(e.tagLoadingState=l.GuX.REJECT)}})};return t});a(84936);var d=a(99556)},70512:e=>{e.exports={root:"UgcUploadCenterNotification_root__K_U0z",title:"UgcUploadCenterNotification_title__s3yTL",link:"UgcUploadCenterNotification_link__NPz6r"}},71016:(e,t,a)=>{"use strict";a.r(t),a.d(t,{TranslationsProvider:()=>l});var i=a(33008),r=a(43576),s=a(94767);let l=e=>{let{children:t}=e,{dictionary:a,language:l,defaultLanguage:n}=(0,s.h6b)(),o=(0,s.Crf)();return(0,i.jsx)(r.A,{onError:o,defaultLocale:n,locale:l,messages:a,children:t})}},72321:e=>{e.exports={toastClassName:"NotificationsInitializer_toastClassName__ZVvrd",notificationContainer:"NotificationsInitializer_notificationContainer__oe1ot"}},73258:(e,t,a)=>{"use strict";a.d(t,{UgcUploadInitializer:()=>v});var i=a(97531),r=a(66268),s=a(94767),l=a(33008),n=a(73827),o=a(53799),d=a(96560),u=a(18064),c=a(77868),g=a(70512),m=a.n(g),h=function(e){return e.ERROR="error",e.SUCCESS="success",e}({});let y=e=>{let{playlistName:t,url:a,variant:i}=e,s=(0,r.useMemo)(()=>(0,l.jsx)(o.N_,{href:a,className:m().link,children:(0,l.jsx)(c.Caption,{className:m().title,variant:"span",type:"controls",size:"m",lineClamp:1,children:t})}),[t,a]),n=(0,r.useMemo)(()=>"error"===i?(0,l.jsx)(c.Caption,{variant:"div",type:"controls",size:"m",...(0,u.Am)(u.S7.BASE_NOTIFICATION_UGC_TRACK_ERROR_TEXT),children:(0,l.jsx)(d.A,{id:"ugc.notification-unknown-error",values:{playlistName:s}})}):(0,l.jsxs)(c.Caption,{variant:"div",type:"controls",size:"m",children:[(0,l.jsx)(d.A,{id:"ugc.notification-success",values:{playlistName:s}}),";"]}),[s,i]);return(0,l.jsx)(o.$W,{className:m().root,message:n})};var p=a(38261);let v=(0,i.PA)(()=>{let{ugcUploadCenter:e}=(0,s.Pjs)(),t=(0,r.useRef)(void 0);(()=>{var e;let{ugcUploadCenter:{notifications:t},playlist:a}=(0,s.Pjs)(),{notify:i}=(0,s.lkh)(),{formatMessage:d}=(0,n.A)();(0,r.useEffect)(()=>{t.showAllNotifications().forEach(e=>{switch(e.type){case p.u.FILE_TOO_LARGE:i((0,l.jsx)(o.hT,{error:d({id:"ugc.notification-too-large-file-error"})}),{containerId:s.uQT.ERROR});break;case p.u.TOO_MANY_FILES:i((0,l.jsx)(o.hT,{error:d({id:"ugc.notification-too-many-files-error"})}),{containerId:s.uQT.ERROR});break;case p.u.UNKNOWN_ERROR:i((0,l.jsx)(y,{url:e.playlist.url,playlistName:e.playlist.title,variant:h.ERROR}),{containerId:s.uQT.ERROR});break;case p.u.SUCCESS:var t;(null==(t=a.meta)?void 0:t.kind)!==e.playlist.kind&&i((0,l.jsx)(y,{url:e.playlist.url,playlistName:e.playlist.title,variant:h.SUCCESS}),{containerId:s.uQT.INFO})}})},[d,t,t.pairs.length,i,null==(e=a.meta)?void 0:e.kind])})();let a=(0,r.useCallback)(()=>{e.checkProcessingTracks()},[e]),i=(0,r.useCallback)(()=>{t.current||(t.current=setInterval(a,2e3))},[a]),d=(0,r.useCallback)(()=>{clearInterval(t.current),t.current=void 0},[]);(0,r.useEffect)(()=>{e.shouldCheckProcessingTracks?i():d()},[d,i,e.shouldCheckProcessingTracks]),(0,r.useEffect)(()=>()=>d(),[d])})},74259:(e,t,a)=>{"use strict";a.d(t,{uN:()=>d.GenresPage,Zt:()=>o});var i=a(41028),r=a(61979),s=a(23031),l=a(94767),n=a(59615);let o=i.gK.compose(i.gK.model("GenresPageModel",{title:i.gK.maybeNull(i.gK.string),items:i.gK.array(s.Gc),errorStatusCode:i.gK.maybeNull(i.gK.number)}),n.XT).views(e=>({get isLoading(){return e.isNeededToLoad||e.loadingState===l.GuX.PENDING},get isNotFound(){let t=e.isResolved&&0===e.items.length;return e.errorStatusCode===r.X1.NOT_FOUND||t}})).actions(e=>({getData:(0,i.L3)(function*(t){let{landing3Resource:a,modelActionsLogger:n}=(0,i._$)(e);if(e.loadingState!==l.GuX.PENDING)try{e.loadingState=l.GuX.PENDING;let n=(yield a.getMetatags({})).trees.find(e=>e.navigationId===t);if(!n){e.errorStatusCode=r.X1.NOT_FOUND;return}e.title=n.title,e.items=(0,i.wg)(n.leaves.map(s.kc)),e.loadingState!==l.GuX.IDLE&&(e.loadingState=l.GuX.RESOLVE)}catch(t){n.error(t),t instanceof r.GX&&(t.statusCode===r.X1.NOT_FOUND||t.statusCode===r.X1.BAD_REQUEST)&&(e.errorStatusCode=r.X1.NOT_FOUND),e.loadingState!==l.GuX.IDLE&&(e.loadingState=l.GuX.REJECT)}}),reset(){e.loadingState=l.GuX.IDLE,e.title=null,e.items=(0,i.wg)([]),e.errorStatusCode=null}}));a(52568);var d=a(74270)},74270:(e,t,a)=>{"use strict";a.d(t,{GenresPage:()=>p});var i=a(33008),r=a(97531),s=a(17846),l=a(66268),n=a(57747),o=a(77868),d=a(83888),u=a(64143),c=a(23031),g=a(94767),m=a(53799),h=a(89102),y=a.n(h);let p=(0,r.PA)(e=>{let{navigationId:t}=e,{genres:a}=(0,g.Pjs)(),{contentScrollRef:r,setContentScrollRef:h}=(0,g.gKY)(),p=(0,g.W6M)();return((0,l.useEffect)(()=>()=>{a.reset()},[a,t]),a.isNotFound&&(0,s.notFound)(),(0,g.Jzs)(a.isResolved),t&&a.isNeededToLoad&&(0,l.use)(a.getData(t)),a.isRejected)?(0,i.jsx)(d.w,{}):(0,i.jsxs)(u.hO,{scrollElement:r,outerTitle:a.title,children:[(0,i.jsx)(m.Y9,{variant:m.Vw.TEXT,withForwardControl:!1,withBackwardControl:p.canBack,children:(0,i.jsx)(o.Heading,{variant:"h2",weight:"bold",size:"xl",lineClamp:1,children:a.title})}),(0,i.jsx)(n.N,{className:y().root,containerClassName:y().content,ref:h,children:(0,i.jsx)("div",{className:y().list,children:a.items.map(e=>(0,i.jsx)(c.G4,{tag:e.tag,title:e.title,subGenres:e.subGenres},e.tag))})})]})})},75414:(e,t,a)=>{"use strict";a.d(t,{FavoriteTracksPage:()=>d});var i=a(33008),r=a(97531),s=a(66268),l=a(94767),n=a(35233);let o=(0,r.PA)(()=>(0,i.jsx)(n.M,{})),d=(0,r.PA)(()=>{let{favoriteTracks:e}=(0,l.Pjs)(),t=(0,l.ZpR)(e.playlistUrl);if((0,s.useEffect)(()=>()=>{e.reset()},[e]),(0,s.useEffect)(()=>{e.playlistUrl&&t()},[e.playlistUrl,t]),e.isNeededToLoad&&(0,s.use)(e.getPlaylistUrl()),e.isRejected)return(0,i.jsx)(o,{})})},75926:(e,t,a)=>{"use strict";a.d(t,{PostNotFoundPage:()=>l});var i=a(33008),r=a(97531),s=a(35233);let l=(0,r.PA)(()=>(0,i.jsx)(s.M,{}))},79145:(e,t,a)=>{"use strict";a.d(t,{CommunicationsInitializer:()=>l});var i=a(97531),r=a(66268),s=a(94767);let l=(0,i.PA)(()=>{let{user:e,redAlert:t,communication:a}=(0,s.Pjs)();(0,r.useEffect)(()=>{e.isAuthorized&&Promise.allSettled([a.getData(),t.getData()])},[t,a,e.isAuthorized])})},79242:(e,t,a)=>{"use strict";a.d(t,{AdvertProvider:()=>u});var i=a(33008),r=a(97531),s=a(66268),l=a(25581),n=a(93222),o=a(94767);let d=null,u=(0,r.PA)(e=>{let{children:t}=e,{advert:a,experiments:r,user:u,location:c}=(0,o.Pjs)(),g=(0,o.UlF)();return(!d&&u.isAuthorized&&r.checkExperiment(o.zal.WebNextAudioVideoAdvert,"on")&&(d=new o.vaf({logger:g,videoSlotId:n.so.SLOT,videoElementId:n.so.VIDEO})),(0,s.useEffect)(()=>{null==d||d.init(c.tld)},[c.tld]),(0,s.useEffect)(()=>{if(!r.checkExperiment(o.zal.WebNextAudioVideoAdvert,"on")||!u.isAuthorized)return;let e=null==d?void 0:d.state.isAdvertPlaying.onChange(e=>{if(a.setAdvertShown(e),e){var t,i;a.setType((null==d||null==(t=d.state.advertData)?void 0:t.type)||null),a.setData((null==d||null==(i=d.state.advertData)?void 0:i.data)||null)}else a.reset()});return()=>{null==e||e()}},[a,r,u.isAuthorized]),(0,s.useEffect)(()=>{let e;if(a.isAdvertPlaybackCreated){var t;e=null==d||null==(t=d.audioAdvertPlayback)?void 0:t.state.playerState.event.onChange(e=>{if(a.isAdvertShown){if(e===l.Iu.END&&(a.setAdvertShown(!1),null==d||d.state.setDefaultState()),e===l.Iu.PLAYING)return void a.setAdvertPlaying(!0);if(e===l.Iu.END||e===l.Iu.PAUSED)return void a.setAdvertPlaying(!1)}})}return()=>{null==e||e()}},[a,a.isAdvertPlaybackCreated]),(0,s.useEffect)(()=>()=>{a.reset()},[a]),r.checkExperiment(o.zal.WebNextAudioVideoAdvert,"on")&&u.isAuthorized)?(0,i.jsx)(o.p8J.Provider,{value:d,children:t}):t})},80233:e=>{e.exports={root:"KidsEditorialPlaylistsPage_root__HeHqc",scrollContainer:"KidsEditorialPlaylistsPage_scrollContainer__Hy6HY",important:"KidsEditorialPlaylistsPage_important__283cd",footer:"KidsEditorialPlaylistsPage_footer___UaP5",item:"KidsEditorialPlaylistsPage_item__0wBk2",content:"KidsEditorialPlaylistsPage_content__6wWkP"}},81821:(e,t,a)=>{"use strict";a.d(t,{mK:()=>c,mW:()=>g});var i=a(66268),r=a(94767),s=a(38025),l=a(29318),n=a(41028),o=a(48509),d=a(44078),u=a(61744);let c=n.gK.model("ContinueListen",{track:n.gK.maybe(d.vj),trackIndex:n.gK.maybe(n.gK.number),contextType:n.gK.maybeNull(n.gK.enumeration(Object.values(o.K))),contextId:n.gK.maybeNull(n.gK.union(n.gK.string,n.gK.number)),albumDuration:n.gK.maybe(n.gK.number),albumStreamProgress:n.gK.optional(u.B9,{endPositionSec:0}),trackTempStreamProgress:n.gK.optional(u.B9,{endPositionSec:0})}).actions(e=>({saveTrack:t=>{let{contextType:a,contextId:i,track:r,isDefaultTrack:s}=t;s&&e.track||(e.contextType=a,e.contextId=i,e.track=(0,n.wg)((0,l.HO)(r)))},saveTrackIndex:t=>{e.trackIndex=t},saveAlbumDuration:t=>{e.albumDuration=t}})),g=(0,a(97531).PA)(()=>{(e=>{var t;let{sonataState:a,continueListen:l}=(0,r.Pjs)();(0,i.useEffect)(()=>{var t,i,r,n,o,d,u,c;if(!e||!(null==(t=a.entityMeta)?void 0:t.isPodcast)&&!(null==(i=a.entityMeta)?void 0:i.isAudiobook))return;let g=e.state.queueState.index.value;e.state.queueState.order.value.length>0&&"number"==typeof g&&l.saveTrackIndex(g);let m=null==(r=e.state.currentContext.value)?void 0:r.data.meta;if(m&&a.contextType&&a.contextId&&(l.saveTrack({contextType:a.contextType,contextId:a.contextId,track:a.entityMeta}),a.entityMeta.isAudiobook)){if("volumes"in m&&m.volumes){let e,t=((e,t)=>{let a=!0;return(0,s.A)(e).reduce((e,i)=>{if(!i.durationMs)return e;if(i.id===t){var r;return a=!1,e+((null==(r=i.streamProgress)?void 0:r.endPositionSec)||0)}return a?e+i.durationMs/1e3:e},0)})(m.volumes,a.entityMeta.id);"durationSec"in m&&(e=m.durationSec),l.saveAlbumDuration(e),null==(d=l.trackTempStreamProgress)||d.updateEndPositionSec((null==(o=l.track)||null==(n=o.streamProgress)?void 0:n.endPositionSec)||0),null==(u=l.albumStreamProgress)||u.updateEndPositionSec(t)}"listeningFinished"in m&&(null==(c=l.albumStreamProgress)||c.updateEverFinished(m.listeningFinished||!1))}},[null==(t=a.entityMeta)?void 0:t.id,a.entityMeta,a.contextType,a.contextId,e,l])})((0,r.eGp)())})},83001:(e,t,a)=>{"use strict";a.d(t,{uA:()=>o.PlaylistPersonalPage,Hj:()=>n});var i=a(41028),r=a(61979),s=a(94767),l=a(59615);let n=i.gK.compose(i.gK.model("PlaylistPersonalPage",{errorStatusCode:i.gK.maybeNull(i.gK.number),playlistUuid:i.gK.maybe(i.gK.string),isReady:i.gK.optional(i.gK.boolean,!1),dummyCoverUrl:i.gK.maybe(i.gK.string),dummyDescription:i.gK.maybe(i.gK.string),title:i.gK.maybe(i.gK.string)}),l.XT).views(e=>({getUrl(t){if(!e.playlistUuid)return"";let{href:a}=(0,s.uvd)("/playlists/:playlistUuid",{params:{playlistUuid:e.playlistUuid},query:t});return a},get url(){if(!e.playlistUuid)return"";let{href:t}=(0,s.uvd)("/playlists/:playlistUuid",{params:{playlistUuid:e.playlistUuid}});return t},get isNotFound(){let t=e.errorStatusCode===r.X1.NOT_FOUND||e.errorStatusCode===r.X1.BAD_REQUEST;return e.loadingState===s.GuX.REJECT&&t}})).actions(e=>({getPlaylistPersonalDetails:(0,i.L3)(function*(t){if(!(0,i._n)(e))return;let{playlistsResource:a,modelActionsLogger:l}=(0,i._$)(e);if(e.loadingState!==s.GuX.PENDING)try{var n,o;e.loadingState=s.GuX.PENDING;let i=yield a.getPlaylistPersonal({playlistId:t});if((null==(n=i.error)?void 0:n.name)==="no-such-playlist"){e.errorStatusCode=r.X1.NOT_FOUND,e.loadingState=s.GuX.REJECT;return}e.isReady=i.ready,e.playlistUuid=i.data.playlistUuid,e.dummyCoverUrl=null==(o=i.data.dummyCover)?void 0:o.uri,e.dummyDescription=i.data.dummyDescription,e.title=i.data.title,e.loadingState!==s.GuX.IDLE&&(e.loadingState=s.GuX.RESOLVE)}catch(t){l.error(t),t instanceof r.GX&&(t.statusCode===r.X1.NOT_FOUND||t.statusCode===r.X1.BAD_REQUEST)&&(e.errorStatusCode=r.X1.NOT_FOUND),e.loadingState!==s.GuX.IDLE&&(e.loadingState=s.GuX.REJECT)}}),reset(){e.loadingState=s.GuX.IDLE,e.errorStatusCode=null,e.isReady=!1,e.playlistUuid=void 0,e.dummyCoverUrl=void 0,e.dummyDescription=void 0,e.title=void 0}}));a(49077),a(33008),a(35233);var o=a(95985)},83673:e=>{e.exports={root:"Genre_root__80dlk",link:"Genre_link__Wewaq",linkTitle:"Genre_linkTitle__ORAsw",list:"Genre_list__C2Pxf"}},84031:(e,t,a)=>{"use strict";a.d(t,{KidsNotFoundPage:()=>o});var i=a(33008),r=a(97531),s=a(66268),l=a(35233),n=a(94767);let o=(0,r.PA)(()=>{let{kids:e}=(0,n.Pjs)();return(0,s.useEffect)(()=>()=>{e.landing.reset()},[e.landing]),(0,i.jsx)(l.M,{})})},84706:(e,t,a)=>{"use strict";a.d(t,{SM:()=>I.PlaylistPage,Pn:()=>f,Cm:()=>k.PlaylistShimmersPage}),a(48708);var i=a(41028),r=a(30293),s=a(94767),l=function(e){return e.MAJOR="Major",e.NAME="Название",e.ARTISCS="Исполнители",e.LINK="Ссылка",e.ALBUM_ID="albumId",e.TRACK_ID="trackId",e}({}),n=function(e){return e.MAJOR="major",e.NAME="name",e.ARTISCS="artists",e.LINK="link",e.ALBUM_ID="albumId",e.TRACK_ID="trackId",e}({});let o=i.gK.model("EditorFeature",{shouldShowMajor:i.gK.boolean,shouldShowGenre:i.gK.boolean,shouldShowDuplicate:i.gK.boolean,colorMajorMap:i.gK.map(i.gK.string),duplicate:i.gK.map(i.gK.number)}).views(e=>{let t={getNumberGroupTrackDuplicated(t){let{experiments:a}=(0,i.Zn)(e);if(t&&a.checkExperiment(s.zal.WebEditorsFeatures,"on"))return e.duplicate.get(String(t.id))},shouldHighlightDublicatedTrack:a=>!!(e.shouldShowDuplicate&&t.getNumberGroupTrackDuplicated(a)),get sheetDataPlaylist(){var a,o;let{location:t,playlist:s}=(0,i.Zn)(e),d="https://".concat(t.host,".").concat(t.tld),u={sheet:"Playlist",columns:[{label:l.MAJOR,value:n.MAJOR},{label:l.NAME,value:n.NAME},{label:l.ARTISCS,value:n.ARTISCS},{label:l.LINK,value:n.LINK},{label:l.ALBUM_ID,value:n.ALBUM_ID},{label:l.TRACK_ID,value:n.TRACK_ID}],content:s.items.filter(e=>e.data).map(e=>{var t,a,i,s,l,n,o,u,c,g,m,h,y;let{href:p}=(0,r.getLinkAttributesBase)(null!=(u=null==(t=e.data)?void 0:t.url)?u:"",{options:{host:d}}),v=(null==(a=e.data)?void 0:a.url)?p:"";return{major:null!=(c=null==(s=e.data)||null==(i=s.major)?void 0:i.name)?c:"",name:null!=(g=null==(l=e.data)?void 0:l.title)?g:"",artists:null!=(m=null==(n=e.data)?void 0:n.artists.map(e=>e.name).join(", "))?m:"",link:v,albumId:null!=(h=e.albumId)?h:"",trackId:null!=(y=null==(o=e.data)?void 0:o.id)?y:""}})};return{data:u,settings:{fileName:(null==(a=s.meta)?void 0:a.uid)&&(null==(o=s.meta)?void 0:o.kind)?"%".concat(s.meta.uid,"%_%").concat(s.meta.kind,"%_to_text"):"to_text"}}}};return t}).actions(e=>({exportToExcel:(0,i.L3)(function*(){let{modelActionsLogger:t}=(0,i._$)(e);try{let t=yield Promise.all([a.e(714),a.e(8473),a.e(3592)]).then(a.t.bind(a,54540,23)),{data:i,settings:r}=e.sheetDataPlaylist;if(0===i.content.length)return s.FlZ.ERROR;return yield new Promise(e=>{t.default([i],r,()=>e())}),s.FlZ.OK}catch(e){return t.error(e),s.FlZ.ERROR}}),getAllPlaylistItems:(0,i.L3)(function*(t){let{batchSize:a}=t,{playlist:r}=(0,i.Zn)(e),s=r.items.length-1;for(let e=0;e<s;e+=a)yield r.getTracksByRange({startIndex:e,endIndex:Math.min(e+a,s)})}),getColorForMajor(t){let a=e.colorMajorMap.get(t);if(a)return a;let i=(0,s.KkH)(t),r="hsl(".concat(i,", 50%, 50%)");return e.colorMajorMap.set(t,r),r},getDuplicates(t){let a=new Map;t.forEach(e=>{let t=a.get(e.id)||0;a.set(e.id,t+1)});let i=1;a.forEach((t,a)=>{t>1&&(e.duplicate.set(String(a),i),i++)})},toggleShouldShowMajor(){e.shouldShowMajor=!e.shouldShowMajor},toggleShouldShowGenre(){e.shouldShowGenre=!e.shouldShowGenre},toggleShouldShowDuplicate(){e.shouldShowDuplicate=!e.shouldShowDuplicate},reset(){e.shouldShowDuplicate=!1,e.shouldShowGenre=!1,e.shouldShowMajor=!1,e.colorMajorMap=(0,i.wg)({}),e.duplicate=(0,i.wg)({})}}));var d=a(29318),u=a(61979),c=a(73508),g=a(46369),m=a(45242),h=a(44078),y=a(25911),p=a(59615),v=a(2865);let S=e=>e.map(e=>(0,v.li)(e.id,e.albumId||void 0)),E=e=>{var t,a,r;let l=null==(t=e.tracks)?void 0:t.map(g.Qy),n=(null==(a=e.tracks)?void 0:a.length)?null==(r=e.tracks)?void 0:r.map((e,t)=>((e,t)=>{let[a,r]=e.split(":");return(0,i.wg)({id:a||"",albumId:r||"",key:"".concat(a,"-").concat(t),data:null,loadingState:s.GuX.IDLE})})(e,t)):[];return{id:e.id,name:e.name,tracks:(0,i.wg)(n),unloadedTracks:(0,i.wg)(l)}},P=i.gK.compose(i.gK.model("PlaylistPageFilters",{items:i.gK.maybeNull(i.gK.array(g.S9)),activeFilter:i.gK.maybe(i.gK.string),activeFilterName:i.gK.maybeNull(i.gK.string),shouldSendEventOnTabOpened:i.gK.boolean,shouldSendEventOnTabLoaded:i.gK.boolean}),p.XT,p.pl).views(e=>{let t={get isShimmerVisible(){return e.isRejected||e.isLoading},get activeFilterIndex(){var a;let t=null==(a=e.items)?void 0:a.findIndex(t=>t.id===e.activeFilter);return t&&t>-1?t:0},get analyticsParamsActiveFilterIndex(){return t.activeFilterIndex+1}};return t}).actions(e=>{let t={getFilters:(0,i.L3)(function*(){var a,r;let{filtersResource:l,modelActionsLogger:n}=(0,i._$)(e),{sonataState:o,playlist:d}=(0,i.Zn)(e);if(e.isLoading||!(null==(a=d.items)?void 0:a.length))return;let u=d.items.map(e=>String((0,c.V)(e.id,e.albumId)))||[];try{e.loadingState=s.GuX.PENDING;let a=yield l.getTracksFilters({trackIds:u});e.items=(0,i.wg)((e=>{let t=e.filters.map(E);if(t.length<3)return[];let a=t.find(e=>e.id===g.Q1.ALL);if(!a)return[];let i=t.filter(e=>e.tracks.length>=8);return i.length<2?[]:[a].concat(i.slice(0,7))})(a)),t.setActiveFilter(o.playlistFilter),t.getFilterName(o.playlistFilter||g.Q1.ALL);let n=null==(r=e.items)?void 0:r.find(t=>t.id===e.activeFilter);n&&(d.setItems(n.tracks),o.setUnloadedEntitiesData(S(d.items))),e.loadingState=s.GuX.RESOLVE}catch(t){n.error(t),e.loadingState=s.GuX.REJECT}}),getFilterName:(0,i.L3)(function*(t){let{filtersResource:a,modelActionsLogger:r}=(0,i._$)(e);try{e.activeFilterName=(yield a.getFilterName({filterId:t})).name}catch(e){r.error(e)}}),handleFilterClick(a){if(!(0,i._n)(e))return;let{sonataState:r,playlist:s}=(0,i.Zn)(e);t.setActiveFilter(a.id),t.getFilterName(a.id),s.setItems(e.activeFilter?a.tracks:s.initialItems),r.setUnloadedEntitiesData(S(s.items)),t.setShouldSendEventOnTabOpened(!0)},setActiveFilter(t){t!==g.Q1.ALL?e.activeFilter=t:e.activeFilter=void 0},setShouldSendEventOnTabOpened(t){e.shouldSendEventOnTabOpened=t},setShouldSendEventOnTabLoaded(t){e.shouldSendEventOnTabLoaded=t},reset(){e.destroyItems([e.items]),e.loadingState=s.GuX.IDLE,e.activeFilter=void 0,e.activeFilterName=null,e.shouldSendEventOnTabOpened=!0,e.shouldSendEventOnTabLoaded=!0}};return t}),b=i.gK.compose(i.gK.model("PlaylistPageSearch",{errorStatusCode:i.gK.maybeNull(i.gK.number),text:i.gK.string,playlistTrackIds:i.gK.maybeNull(i.gK.array(i.gK.string)),suggestedTrackIds:i.gK.maybeNull(i.gK.array(i.gK.string)),additionTrackInProggress:i.gK.maybeNull(i.gK.string),tracks:i.gK.maybeNull(i.gK.array(h.vj)),isFocused:i.gK.optional(i.gK.boolean,!1)}),p.XT).views(e=>({get isLoading(){return e.isNeededToLoad||e.loadingState===s.GuX.PENDING},get hasText(){return!!e.text.length},get suggestedTracks(){var t;return null==(t=e.suggestedTrackIds)?void 0:t.map(t=>{var a;return(null==(a=e.tracks)?void 0:a.find(e=>e.id===t))||null})},get playlistTracks(){let t=[...e.playlistTrackIds||[]];return e.additionTrackInProggress&&t.unshift(e.additionTrackInProggress),null==t?void 0:t.map(t=>{var a;return(null==(a=e.tracks)?void 0:a.find(e=>{var a;return((null==(a=e.mainAlbum)?void 0:a.id)&&t.includes(":")?"".concat(e.id,":").concat(e.mainAlbum.id):e.id)===t}))||null})}})).actions(e=>{let t={getTracksMeta:(0,i.L3)(function*(){let{tracksResource:t,modelActionsLogger:a}=(0,i._$)(e),r=[...e.playlistTrackIds||[]].concat(e.suggestedTrackIds||[]);try{let a=yield t.getTracksMeta({trackIds:r,removeDuplicates:!0,withProgress:!0});e.tracks=(0,i.wg)(null==a?void 0:a.map(e=>(0,h.vU)(e))),e.loadingState!==s.GuX.IDLE&&(e.loadingState=s.GuX.RESOLVE)}catch(e){a.error(e)}return null}),getTracks:(0,i.L3)(function*(a){let{uid:r,kind:l}=a,{searchPlaylistResource:n,modelActionsLogger:o}=(0,i._$)(e);if(e.loadingState===s.GuX.PENDING||!e.hasText||!(0,i._n)(e))return;let{playlist:d}=(0,i.Zn)(e);try{var c,g;let a;e.loadingState=s.GuX.PENDING;let{playlistTrackIds:o=[],suggestedTrackIds:u=[]}=yield n.getTrackIds({uid:r,kind:l,part:e.text}),m=(a=d.items,o.map(e=>{let t=a.find(t=>String(t.id)===e);return(null==t?void 0:t.albumId)?"".concat(e,":").concat(t.albumId):e}));e.playlistTrackIds=(0,i.wg)(m),e.suggestedTrackIds=(0,i.wg)(u),((null==(c=e.playlistTrackIds)?void 0:c.length)||0)+((null==(g=e.suggestedTrackIds)?void 0:g.length)||0)>0?t.getTracksMeta():e.loadingState=s.GuX.RESOLVE}catch(t){o.error(t),t instanceof u.GX&&(t.statusCode===u.X1.NOT_FOUND||t.statusCode===u.X1.BAD_REQUEST)&&(e.errorStatusCode=u.X1.NOT_FOUND),e.loadingState!==s.GuX.IDLE&&(e.loadingState=s.GuX.REJECT)}}),setText(t){e.text=t},setIdleState(){e.loadingState=s.GuX.IDLE},setAdditionTrackAnimation(t){e.additionTrackInProggress=t},setFocus(){e.isFocused=!0},removeFocus(){e.isFocused=!1},replaceAdditionTrackInProggress(){if(e.additionTrackInProggress){var t,a;null==(t=e.playlistTrackIds)||t.unshift(e.additionTrackInProggress),e.suggestedTrackIds=(0,i.wg)(null==(a=e.suggestedTrackIds)?void 0:a.filter(t=>t!==e.additionTrackInProggress)),e.additionTrackInProggress=null}},resetAdditionTrackAnimation(){e.additionTrackInProggress=null},reset(){e.playlistTrackIds=null,e.suggestedTrackIds=null,e.additionTrackInProggress=null,e.tracks=null,e.loadingState=s.GuX.IDLE,e.isFocused=!1}};return t}),f=i.gK.compose(i.gK.model("PlaylistPage",{uuid:i.gK.maybeNull(i.gK.string),meta:i.gK.maybeNull(m.BL),items:i.gK.array(g.PZ),errorStatusCode:i.gK.maybeNull(i.gK.number),similarPlaylists:i.gK.array(m.IP),initialItems:i.gK.array(g.PZ),shouldShowTrailerOnboarding:i.gK.maybeNull(i.gK.boolean),editorFeature:o,search:b,filters:P}),p.pl,p.XT).views(e=>{let t={getUrl(t){if(!e.uuid)return"";let{href:a}=(0,s.uvd)("/playlists/:playlistUuid",{params:{playlistUuid:e.uuid},query:t});return a},get isLoading(){return e.isNeededToLoad||e.loadingState===s.GuX.PENDING},get isDisabled(){var a;return e.isResolved&&(0===e.items.length||!(null==(a=e.meta)?void 0:a.isAvailable))},get isNotFound(){return e.isRejected&&e.errorStatusCode===u.X1.NOT_FOUND},get hasSimilarPlaylists(){return t.isLoading||e.similarPlaylists.length>0},get isEmptyPlaylist(){return e.isResolved&&0===e.items.length},get contextMeta(){var r,l,n,o,d,g,m,h,p,v;return{isAvailable:null==(r=e.meta)?void 0:r.isAvailable,id:e.meta.id,uid:null==(l=e.meta)?void 0:l.uid,uuid:e.meta.uuid,kind:null==(n=e.meta)?void 0:n.kind,title:null==(o=e.meta)?void 0:o.title,coverUri:null==(d=e.meta)?void 0:d.coverUri,likesCount:null==(g=e.meta)?void 0:g.likesCount,averageColor:null==(m=e.meta)?void 0:m.averageColor,owner:null==(h=e.meta)?void 0:h.owner,description:null==(p=e.meta)?void 0:p.description,modified:null==(v=e.meta)?void 0:v.modified}},get isDragAndDropEnabled(){var S;if(!(0,i._n)(e))return!1;let{ugcUploadCenter:t}=(0,i.Zn)(e);return!!((null==(S=e.meta)?void 0:S.canUserChange)&&(e.items.length>1||t.getUploadingTracksByPlaylistKind(e.meta.kind).length>0))},get itemsKeys(){return e.items.map(e=>e.key)},get isFavouritePlaylist(){var E;return(null==(E=e.meta)?void 0:E.kind)===y.ji.LIKE},get enableVariousAutoFlow(){return!!e.filters.activeFilter},get trackIds(){return e.initialItems.map(e=>String((0,c.V)(e.id,e.albumId)))},get isRewind2024Playlist(){var P;return(null==(P=e.meta)?void 0:P.generatedPlaylistType)==="rewind2024"},get areAllTracksUploaded(){return e.items.every(e=>e.loadingState===s.GuX.RESOLVE)},get shouldShowEmptyBlock(){var b,f;if(!(0,i._n)(e))return!1;let{ugcUploadCenter:a}=(0,i.Zn)(e),r=!!(null==(b=e.meta)?void 0:b.isOwnPlaylist),s=!!((null==(f=e.meta)?void 0:f.kind)&&a.getUploadingTracksByPlaylistKind(e.meta.kind).length),l=!!e.search.hasText;return t.isEmptyPlaylist&&r&&!s&&!l},get virtualListItemsCount(){var I,k;if(e.search.hasText)return 0;return null!=(k=null==(I=e.items)?void 0:I.length)?k:0},get isFiltersAvailable(){var _;return!!(t.isFavouritePlaylist&&(null==(_=e.meta)?void 0:_.isOwnPlaylist))},get analyticsParams(){return{objectId:e.uuid||void 0,tabId:e.filters.activeFilter,tabPos:e.filters.analyticsParamsActiveFilterIndex}}};return t}).actions(e=>{let t={getTracksByRange:(0,i.L3)(function*(t){var a,r;let{startIndex:l,endIndex:n}=t,{tracksResource:o,modelActionsLogger:d}=(0,i._$)(e);if(!(null==(a=e.meta)?void 0:a.uid)||!(null==(r=e.meta)?void 0:r.kind))return null;l=Math.max(0,l),n=Math.min(n,e.items.length);let u=((e,t)=>{let{startIndex:a,endIndex:i}=t,r=[];for(let t=a;t<=i;t++){var l,n;((null==(l=e[t])?void 0:l.loadingState)===s.GuX.IDLE||(null==(n=e[t])?void 0:n.loadingState)===s.GuX.REJECT)&&r.push(t)}return r})(e.items,{startIndex:l,endIndex:n});try{let t,a=(t=e.items,u.map(e=>{let a=t[e];return(null==a?void 0:a.albumId)?"".concat(a.id,":").concat(a.albumId):String(null==a?void 0:a.id)}));if(!a.length)return null;u.forEach(t=>{let a=e.items[t];a&&(a.loadingState=s.GuX.PENDING)});let i=yield o.getTracksMeta({trackIds:a,withProgress:!0});u.forEach((t,a)=>{let r=null==i?void 0:i[a];if(e.items[t]&&r){var l,n;e.items[t]={id:r.id,albumId:(null==(n=r.albums)||null==(l=n[0])?void 0:l.id)||null,key:"".concat(r.id,"-").concat(t),data:(0,h.vU)(r),loadingState:s.GuX.RESOLVE}}})}catch(t){d.error(t),u.forEach(t=>{let a=e.items[t];a&&(a.loadingState=s.GuX.REJECT)})}return null}),updateData:(0,i.L3)(function*(a){var r;if((null==a?void 0:a.error)==="not-found")return e.errorStatusCode=u.X1.NOT_FOUND,e.loadingState=s.GuX.REJECT,null;e.similarPlaylists=(0,i.wg)(null==(r=a.similarPlaylists)?void 0:r.map(m.Ew)),e.meta=(0,m.ZC)(a),e.items=(0,i.wg)(a.tracks.map((e,t)=>({id:String(e.id),albumId:e.albumId||null,key:"".concat(e.id,"-").concat(t),loadingState:s.GuX.IDLE}))),e.initialItems=(0,d.HO)(e.items);let{sonataState:l,playlist:n,experiments:o}=(0,i.Zn)(e);return l.setUnloadedEntitiesData(S(e.items)),(null==o?void 0:o.checkExperiment(s.zal.WebEditorsFeatures,"on"))&&n.editorFeature.getDuplicates(e.items),yield t.getTracksByRange({startIndex:0,endIndex:10})}),getPlaylistByUserIdAndKind:(0,i.L3)(function*(a){let{userId:r,playlistKind:l,resumeStream:n=!1,trackMetaType:o,preloadedPlaylist:d}=a,{usersResource:c,modelActionsLogger:g}=(0,i._$)(e);if(e.loadingState!==s.GuX.PENDING)try{e.loadingState=s.GuX.PENDING;let a=d;if(a||(a=yield c.getPlaylistWithTracksIds({userId:r,playlistKind:l,resumeStream:n,trackMetaType:o})),e.uuid=null==a?void 0:a.playlistUuid,"string"!=typeof a.playlistUuid){e.errorStatusCode=u.X1.NOT_FOUND,e.loadingState=s.GuX.REJECT;return}yield t.updateData(a),e.loadingState=s.GuX.RESOLVE}catch(t){g.error(t),t instanceof u.GX&&(t.statusCode===u.X1.NOT_FOUND||t.statusCode===u.X1.BAD_REQUEST)&&(e.errorStatusCode=u.X1.NOT_FOUND),e.loadingState=s.GuX.REJECT}}),getPlaylistByUuid:(0,i.L3)(function*(a){let{playlistUuid:r,richTracks:l=!1,resumeStream:n=!1,preloadedPlaylist:o}=a,{playlistResource:d,modelActionsLogger:c}=(0,i._$)(e);if(e.uuid=r,e.loadingState!==s.GuX.PENDING)try{e.loadingState=s.GuX.PENDING;let a=o;a||(a=yield d.getPlaylist({playlistUuid:r,resumeStream:n,richTracks:l})),yield t.updateData(a),e.loadingState!==s.GuX.IDLE&&(e.loadingState=s.GuX.RESOLVE)}catch(t){c.error(t),t instanceof u.GX&&(t.statusCode===u.X1.NOT_FOUND||t.statusCode===u.X1.BAD_REQUEST)&&(e.errorStatusCode=u.X1.NOT_FOUND),e.loadingState!==s.GuX.IDLE&&(e.loadingState=s.GuX.REJECT)}}),updatePlaylistTrackByUuid:(0,i.L3)(function*(a){let{playlistUuid:r,richTracks:l=!1,resumeStream:n=!1}=a,{playlistResource:o,modelActionsLogger:d}=(0,i._$)(e);e.uuid=r;try{let a=yield o.getPlaylist({playlistUuid:r,resumeStream:n,richTracks:l}),d=[];if(e.items=(0,i.wg)(a.tracks.map((t,a)=>{var i,r;let l=String(t.id),n=t.albumId||null;return l===(null==(i=e.items[a])?void 0:i.id)&&n===(null==(r=e.items[a])?void 0:r.albumId)?e.items[a]:(d.push(a),{id:String(t.id),albumId:t.albumId||null,key:"".concat(t.id,"-").concat(a),loadingState:s.GuX.IDLE})})),e.meta&&(e.meta.modified=a.modified,e.meta.revision=a.revision,d.length)){let e=Math.min(...d),a=Math.max(...d);t.getTracksByRange({startIndex:e,endIndex:a})}if(e.loadingState!==s.GuX.IDLE&&(e.loadingState=s.GuX.RESOLVE),(0,i._n)(e)){let{sonataState:t}=(0,i.Zn)(e);t.setUnloadedEntitiesData(S(e.items))}}catch(t){d.error(t),t instanceof u.GX&&(t.statusCode===u.X1.NOT_FOUND||t.statusCode===u.X1.BAD_REQUEST)&&(e.errorStatusCode=u.X1.NOT_FOUND),e.loadingState!==s.GuX.IDLE&&(e.loadingState=s.GuX.REJECT)}}),moveTrack(t,a){let r=(0,d.HO)(e.items[t]);if(!(t<0)&&!(a<0)&&!(t>=e.items.length)&&!(a>=e.items.length)&&r&&(e.items.splice(t,1),e.items.splice(a,0,r),(0,i._n)(e))){let{sonataState:t}=(0,i.Zn)(e);t.setUnloadedEntitiesData(S(e.items))}},removeTracksFromItems(t,a){if(e.items.splice(t,a),(0,i._n)(e)){let{sonataState:t}=(0,i.Zn)(e);t.setUnloadedEntitiesData(S(e.items))}},setItems(t){e.items=(0,i.wg)((0,d.HO)(t))},setShouldShowTrailerOnboarding(t){e.shouldShowTrailerOnboarding=t},reset(){let{sonataState:t}=(0,i.Zn)(e);t.resetUnloadedEntitiesData(),e.uuid=null,e.loadingState=s.GuX.IDLE,e.errorStatusCode=null,e.shouldShowTrailerOnboarding=null,e.search.setText(""),e.search.reset(),e.filters.reset(),e.destroyItems([e.meta,e.items,e.initialItems,e.similarPlaylists])},refresh(){var a,i;(null==(a=e.meta)?void 0:a.uuid)&&t.getPlaylistByUuid({playlistUuid:null==(i=e.meta)?void 0:i.uuid,resumeStream:!1})},refreshTracks(){var a,i;(null==(a=e.meta)?void 0:a.uuid)&&t.updatePlaylistTrackByUuid({playlistUuid:null==(i=e.meta)?void 0:i.uuid,resumeStream:!1})}};return t});a(138);var I=a(84684),k=a(68300)},84936:(e,t,a)=>{"use strict";a.d(t,{TagNotFoundPage:()=>l});var i=a(33008),r=a(97531),s=a(35233);let l=(0,r.PA)(()=>(0,i.jsx)(s.M,{}))},85554:(e,t,a)=>{"use strict";a.d(t,{W:()=>n});var i=a(66268),r=a(42213),s=a(25581),l=a(94767);let n=e=>{let{isEnabled:t,intervalMs:a,modal:n,playbackId:o,sonataState:d,isPaywallOpen:u}=e,c=(0,i.useRef)(new Date),g=(0,l.eGp)(),m=(0,r.c)(()=>{c.current=new Date}),h=(0,r.c)(()=>{c.current.getTime()<Date.now()-(null!=a?a:18e5)&&!u&&(n.open(),m())});(0,i.useEffect)(()=>{if(!t)return;let e=null==g?void 0:g.getState(o).playerState.status.onChange(e=>{e===s.MT.ENDED&&h()});return()=>{null==e||e()}},[t,g,h,o]),(0,i.useEffect)(()=>{t&&n.isOpened&&(null==g||g.pause(o))},[t,n.isOpened,g,d.status,o]),(0,i.useEffect)(()=>{if(!t)return;let e=new AbortController;return window.addEventListener("mousemove",m,{signal:e.signal}),window.addEventListener("keydown",m,{signal:e.signal}),window.addEventListener("touchstart",m,{signal:e.signal}),()=>{e.abort()}},[t,m])}},86631:(e,t,a)=>{"use strict";a.d(t,{SlamProvider:()=>y});var i=a(33008),r=a(97531),s=a(66268),l=a(96560),n=a(98369),o=a(28999),d=a(55845),u=a(85897),c=a(49444),g=a(88190),m=a(94767);let h=!0,y=(0,r.PA)(e=>{var t,a,r;let{children:y}=e,{slam:p,user:v,experiments:S}=(0,m.Pjs)(),E=(0,m.jRO)(),P=(0,m.NFA)(),b=P.get(m.U2_),f=(0,m.gQL)(),{notify:I}=(0,m.lkh)(),k=(0,c.j)(),_=(0,s.useCallback)(e=>{p.setNetworkStatus(e)},[p]),T=(0,s.useCallback)(e=>{let{id:t,state:a}=e;p.setTrack(t,a),a.loadingState===u.DT.DOWNLOAD_FAILED&&I((0,i.jsx)(g.i,{message:(0,i.jsx)(l.A,{id:"offline.track-download-error"})}),{containerId:m.uQT.ERROR})},[I,p]),C=(0,s.useCallback)(e=>{p.setTracks(e)},[p]);return v.account.data.uid&&v.hasPlus&&E.init({userConfig:{uid:v.account.data.uid},resources:{tracksResource:P.get(m.Ooh),getFileInfoResource:P.get(m.qTR),availabilityResource:P.get(m.$5W),albumsResource:P.get(m.tzI)},downloaderVariables:{maxConcurrentDownloads:5,getQuality:()=>(0,n.i)({productQuality:null==f?void 0:f.quality.value})},featureFlags:{entities:!0},tracksControllerVariables:{requestTrackChunkSize:100},trackDownloadTaskParams:{secretKey:P.get(m.twC).player.secretKey,transport:d.o.ENCRAW,variables:{chunkSize:1048576,coverSize:1e3,codecs:o.iy}}}),(0,s.useEffect)(()=>{if(h){var e;null==(e=E.tracksController)||e.getTracksCount().then(e=>{let t=(0,m.f2y)(e);t&&k.count({[m.xQR.TRACKS_COUNT]:t},m.l6e)}),h=!1}},[k,E.tracksController]),(0,s.useEffect)(()=>{if(void 0!==v.puid&&!S.checkExperiment(m.zal.WebNextOfflineDegradation,"default")){var e,t;let a=null==(e=S.getExperiment(m.zal.WebNextOfflineDegradation))?void 0:e.group,i="".concat(m.cYZ.OfflineDegradation,"_").concat(v.puid),r=b.get(i);a&&a!==r&&(null==(t=E.tracksController)||t.clearAll(),b.set(i,a))}},[S,b,E,v.puid]),(0,s.useEffect)(()=>{var e,t,a;return null==(e=E.store)||e.tracks.events.on(u.je.ENTITY_CHANGED,T),null==(t=E.store)||t.tracks.events.on(u.je.STATE_CHANGED,C),null==(a=E.tracksController)||a.initTracksState(),()=>{var e,t;null==(e=E.store)||e.tracks.events.off(u.je.ENTITY_CHANGED,T),null==(t=E.store)||t.tracks.events.off(u.je.STATE_CHANGED,C)}},[T,C,null==(t=E.store)?void 0:t.tracks.events,E.tracksController]),(0,s.useEffect)(()=>{var e;return null==(e=E.network)||e.subscribe(_),()=>{var e;null==(e=E.network)||e.unsubscribe(_)}},[_,E.network,null==(a=E.network)?void 0:a.subscribe,null==(r=E.network)?void 0:r.unsubscribe]),(0,s.useEffect)(()=>{let e=(0,m.gHp)(b);p.setOfflineMode(e)},[b,p]),(0,i.jsx)(m.h5g.Provider,{value:E.artistsController,children:(0,i.jsx)(m.mDy.Provider,{value:E.playlistsController,children:y})})})},87145:(e,t,a)=>{"use strict";a.d(t,{E:()=>l});var i=a(66268),r=a(2865),s=a(94767);let l=e=>{let{controller:t,sonataState:a,playbackId:l,groupId:n}=e,o=(0,s.eGp)(),d=(0,s.NFA)(),u=(0,r.d0)(),{experiments:c}=(0,s.Pjs)(),g=c.checkExperiment(s.zal.WebNextPlayerBarBackgroundProgress,"on"),m=d.get(s.ooW);(0,i.useEffect)(()=>(null==t||t.addShortcutsListener(n,s.lbr.DECREASE_VOLUME,async()=>{let e=g?await (null==o?void 0:o.decreaseExponentVolume(.05,l)):await (null==o?void 0:o.decreaseVolume(.05,l));m.set(s.cYZ.YmPlayerVolume,e,{expires:365})}),null==t||t.addShortcutsListener(n,s.lbr.INCREASE_VOLUME,async()=>{let e=g?await (null==o?void 0:o.increaseExponentVolume(.05,l)):await (null==o?void 0:o.increaseVolume(.05,l));m.set(s.cYZ.YmPlayerVolume,e,{expires:365})}),null==t||t.addShortcutsListener(n,s.lbr.TOGGLE_MUTE,async()=>{let e=null==o?void 0:o.getState(l).playerState.exponentVolume.value;void 0!==e&&await u(a,e,l)}),()=>{null==t||t.removeShortcutsListener(n,s.lbr.DECREASE_VOLUME),null==t||t.removeShortcutsListener(n,s.lbr.INCREASE_VOLUME),null==t||t.removeShortcutsListener(n,s.lbr.TOGGLE_MUTE)}),[t,l,o,m,u,a,n,g]),(0,i.useEffect)(()=>{if(!a.isGenerativeContext)return null==t||t.addShortcutsListener(n,s.lbr.MOVE_BACKWARD,async()=>{var e;(null==o||null==(e=o.getState(l).currentContext.value)?void 0:e.availableActions.moveBackward.value)&&await o.moveBackward(l)}),null==t||t.addShortcutsListener(n,s.lbr.MOVE_FORWARD,async()=>{var e;(null==o||null==(e=o.getState(l).currentContext.value)?void 0:e.availableActions.moveForward.value)&&await (null==o?void 0:o.moveForward(l))}),null==t||t.addShortcutsListener(n,s.lbr.SLIDE_BACKWARD,async()=>{(null==o?void 0:o.getState(l).playerState.progress.value.duration)&&await (null==o?void 0:o.slideBackward(2,l))}),null==t||t.addShortcutsListener(n,s.lbr.SLIDE_FORWARD,async()=>{(null==o?void 0:o.getState(l).playerState.progress.value.duration)&&await (null==o?void 0:o.slideForward(2,l))}),()=>{null==t||t.removeShortcutsListener(n,s.lbr.MOVE_FORWARD),null==t||t.removeShortcutsListener(n,s.lbr.MOVE_BACKWARD),null==t||t.removeShortcutsListener(n,s.lbr.SLIDE_BACKWARD),null==t||t.removeShortcutsListener(n,s.lbr.SLIDE_FORWARD)}},[t,o,m,a.isGenerativeContext,l,n])}},89102:e=>{e.exports={root:"GenresPage_root__LhP_S",shimmerTitle:"GenresPage_shimmerTitle__4j8uH",content:"GenresPage_content__yhKrQ",list:"GenresPage_list__l2Cuc"}},90157:(e,t,a)=>{"use strict";a.d(t,{KidsEditorialPlaylistsPage:()=>P});var i=a(33008),r=a(85896),s=a(97531),l=a(17846),n=a(66268),o=a(73827),d=a(18064),u=a(42213),c=a(42314),g=a(77868),m=a(83888),h=a(64143),y=a(45242),p=a(94767),v=a(53799),S=a(80233),E=a.n(S);let P=(0,s.PA)(e=>{var t,a,s;let{id:S}=e,{kids:{kidsEditorialPlaylistSubpage:P},settings:{isMobile:b}}=(0,p.Pjs)(),f=(0,p.W6M)(),{contentScrollRef:I,setContentScrollRef:k}=(0,p.gKY)(),{formatMessage:_}=(0,o.A)(),T=(0,u.c)(e=>{P.getPlaylists({page:e,pageSize:20})});P.isNotFound&&(0,l.notFound)(),(0,n.useEffect)(()=>()=>{P.reset()},[P]);let C=(0,c.L)(()=>({Footer:()=>(0,i.jsx)(v.A,{children:(0,i.jsx)(v.wi,{className:E().footer})})}));if((0,p.Jzs)(P.isResolved),P.isNeededToLoad&&(0,n.use)(P.getData({id:S,page:0,pageSize:20})),P.isSomethingWrong)return(0,i.jsx)(m.w,{});let A=P.isLoading?20:null!=(a=null==P||null==(t=P.playlists)?void 0:t.length)?a:0;return(0,i.jsx)(p.nVz,{pageId:p._Q$.KIDS_EDITORIAL_PLAYLISTS,children:(0,i.jsx)(h.hO,{scrollElement:I,outerTitle:P.title,children:(0,i.jsxs)("div",{className:E().root,...(0,d.Am)(d.Xk.kids.KIDS_EDITORIAL_PLAYLISTS),children:[(0,i.jsx)(v.Y9,{variant:v.Vw.TEXT,withForwardControl:!1,withBackwardControl:f.canBack,children:(0,i.jsx)(g.Heading,{variant:"h2",weight:"bold",size:"xl",lineClamp:1,children:P.title})}),(0,i.jsx)(v.$$,{context:{listAriaLabel:_({id:"mixes.playlists-list"},{genreName:P.title||""})},className:(0,r.$)(E().scrollContainer,E().important),customComponents:C,itemContentCallback:e=>{var t,a;let r=null==P||null==(a=P.playlists)||null==(t=a[e])?void 0:t.data,s=_({id:"loading-messages.entity-is-loading"},{entityName:_({id:"entity-names.playlist"})});return r?(0,i.jsx)(y.B6,{playlist:r,contentLinesCount:3},r.key):(0,i.jsx)(v.Vt,{isActive:!0,"aria-label":s})},initialItemCount:A,totalCount:A,onGetDataByPage:T,pageSize:20,totalRequests:null!=(s=P.requests)?s:0,listClassName:E().content,itemClassName:E().item,handleRef:k,isMobileLayout:b,useWindowScroll:b})]})})})})},91173:e=>{e.exports={root:"KidsPage_root__yycsJ",content:"KidsPage_content__08pPR",header:"KidsPage_header__2Gk2l",landing:"KidsPage_landing__3QZZj",landing_onlyWizard:"KidsPage_landing_onlyWizard__xKyDo",footer:"KidsPage_footer__p7SVD",error:"KidsPage_error__qa7Qo"}},93813:(e,t,a)=>{"use strict";a.d(t,{BuySubscriptionInitializer:()=>l});var i=a(97531),r=a(66268),s=a(94767);let l=(0,i.PA)(()=>{let{user:e}=(0,s.Pjs)(),{hasFreeUserAccess:t}=(0,s.XCI)(),a=(0,s.jwr)(),i=(0,s.pFh)("music",t),{payment:{environment:l}}=(0,s.NFA)().get(s.twC),n=(0,r.useRef)(new Date),o=(0,r.useCallback)(async()=>{let t="production"===l?e.account.data.uid:void 0;try{await i.getData({uid:t,page:a.page,places:a.places,widgetServiceName:a.widgetServiceName})}catch(e){}n.current=new Date},[i,l,e,a]),d=(0,r.useCallback)(async()=>{let e=n.current.getTime()<Date.now()-6e5;"visible"===document.visibilityState&&e&&a.shouldFetchOffers&&await o()},[o,a.shouldFetchOffers]);(0,r.useEffect)(()=>{if(!t)return;let e=new AbortController;return window.addEventListener("focus",d,{signal:e.signal}),()=>{e.abort()}},[t,d])})},94503:e=>{e.exports={root:"ConcertsPage_root__olabl",container:"ConcertsPage_container__qS7xA",footer:"ConcertsPage_footer__GYRwF"}},95985:(e,t,a)=>{"use strict";a.d(t,{PlaylistPersonalPage:()=>d});var i=a(33008),r=a(97531),s=a(17846),l=a(66268),n=a(94767),o=a(49077);let d=(0,r.PA)(e=>{let{params:t,searchParams:a}=e,{playlistPersonal:r}=(0,n.Pjs)(),d=r.getUrl(a);if((0,l.useEffect)(()=>{r.isNeededToLoad&&r.getPlaylistPersonalDetails(t.playlistId)},[r.isNeededToLoad,t.playlistId,r]),(0,l.useEffect)(()=>()=>{r.reset()},[r]),(0,n.Jzs)(r.isResolved),(r.isNotFound||r.isRejected)&&(0,s.notFound)(),r.isResolved&&!r.isReady)return r.dummyDescription||(0,s.notFound)(),(0,i.jsx)(o.PlaylistPersonalDummyPage,{});r.isResolved&&r.isReady&&(0,s.redirect)(d)})},97097:(e,t,a)=>{"use strict";a.r(t),a.d(t,{PrefetchDataProvider:()=>o});var i=a(97531),r=a(66268),s=a(94767),l=a(9332);let n=async e=>{let{experimentsData:t,userAccountData:a,userId:i,store:r,withPins:s=!0}=e,{user:l,experiments:n,pinsCollection:o,disclaimers:d}=r;if(await l.getAbout(a),l.puid&&i.setPassportUid(l.puid),await Promise.allSettled([n.getData(t),d.getDisclaimers()]),l.isAuthorized){let e=[l.getSettings(),r.library.getData()];s&&e.push(o.getData()),await Promise.allSettled(e)}},o=(0,i.PA)(e=>{let{children:t,...a}=e,i=(0,s.Pjs)(),o=(0,s.NFA)().get(s.WA$);return(0,l.setClientSideLayout)(i.settings),i.user.puid&&o.setPassportUid(i.user.puid),i.user.account.loadingState===s.GuX.IDLE&&(0,r.use)(n({store:i,userId:o,...a})),t})},98154:e=>{e.exports={root:"ChartPodcastsPage_root__J5lnx",scrollContainer:"ChartPodcastsPage_scrollContainer__WQTf7",important:"ChartPodcastsPage_important__fW45m",footer:"ChartPodcastsPage_footer__7ytrT",item:"ChartPodcastsPage_item__vGRt8",content:"ChartPodcastsPage_content__NcV4M"}},98369:(e,t,a)=>{"use strict";a.d(t,{i:()=>l});var i=a(493),r=a(43459),s=a(43090);function l(e){let{productQuality:t,entities:a,entity:l}=e,n=!1;if(a&&(n=a.some(e=>(0,r.l)(e))),l&&(n=(0,r.l)(l)),n)return i.e.SMART_PREVIEW;switch(t){case s.e.HIGH_QUALITY:return i.e.LOSSLESS;case s.e.BALANCED:return i.e.NQ;case s.e.EFFICIENT:return i.e.LQ;case s.e.PREVIEW:return i.e.PREVIEW;default:return i.e.NQ}}},99010:(e,t,a)=>{"use strict";a.r(t),a.d(t,{AnalyticsProvider:()=>l});var i=a(33008),r=a(48551),s=a(94767);let l=e=>{let{children:t}=e,a=(0,s.UlF)(),l="on"===(0,s.NFA)().get(s.ooW).get(s.cYZ.AllowAnalyticsLogs);return(0,i.jsx)(r.vZ,{allowAnalyticsLogs:l,evgenUserParam:"evgen",logger:a,children:t})}},99556:(e,t,a)=>{"use strict";a.d(t,{TagPage:()=>v});var i=a(33008),r=a(85896),s=a(97531),l=a(17846),n=a(66268),o=a(73827),d=a(77868),u=a(83888),c=a(64143),g=a(45242),m=a(94767),h=a(53799),y=a(35050),p=a.n(y);let v=(0,s.PA)(e=>{var t,a,s;let{tagId:y}=e,{tag:v,settings:{isMobile:S}}=(0,m.Pjs)(),{formatMessage:E}=(0,o.A)(),{contentScrollRef:P,setContentScrollRef:b}=(0,m.gKY)(),f=(0,m.W6M)();y||(0,l.notFound)();let I=(0,n.useCallback)(e=>{v.getPlaylists({page:e,pageSize:20})},[v]);v.isNotFound&&(0,l.notFound)(),(0,n.useEffect)(()=>()=>{v.reset()},[v]);let k=(0,n.useMemo)(()=>({Footer:()=>(0,i.jsx)(h.A,{children:(0,i.jsx)(h.wi,{className:p().footer})})}),[]);return((0,m.Jzs)(v.isResolved),v.isNeededToLoad&&(0,n.use)(v.getTag({id:y,page:0,pageSize:20})),v.isSomethingWrong)?(0,i.jsx)(u.w,{}):(0,i.jsx)(m.nVz,{pageId:m._Q$.TAG,children:(0,i.jsx)(c.hO,{scrollElement:P,outerTitle:v.title,children:(0,i.jsxs)("div",{className:p().root,children:[(0,i.jsx)(h.Y9,{variant:h.Vw.TEXT,withForwardControl:!1,withBackwardControl:f.canBack,children:(0,i.jsx)(d.Heading,{variant:"h2",weight:"bold",size:"xl",lineClamp:1,children:v.title})}),(0,i.jsx)(h.$$,{className:(0,r.$)(p().scrollContainer,p().important),customComponents:k,itemContentCallback:e=>{var t;let a=null==v||null==(t=v.playlists)?void 0:t[e],r=E({id:"loading-messages.entity-is-loading"},{entityName:E({id:"entity-names.playlist"})});return a?(0,i.jsx)(g.B6,{playlist:a,contentLinesCount:3},a.key):(0,i.jsx)(h.Vt,{"aria-label":r})},totalCount:null!=(a=null==v||null==(t=v.pager)?void 0:t.total)?a:0,onGetDataByPage:I,pageSize:20,totalRequests:null!=(s=v.requests)?s:0,listClassName:p().content,itemClassName:p().item,handleRef:b,context:{listAriaLabel:E({id:"mixes.albums-list"},{genreName:v.title||""})},isMobileLayout:S,useWindowScroll:S})]})})})})}}]);